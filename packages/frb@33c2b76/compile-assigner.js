function compile(e){return compile.semantics.compile(e)}var compileEvaluator=require("./compile-evaluator"),solve=require("./algebra"),Scope=require("./scope"),valueSyntax={type:"value"},trueScope={type:"literal",value:!0},falseScope={type:"literal",value:!1};module.exports=compile,compile.semantics={compile:function(e){var t=this.compilers;if("equals"===e.type){var n=this.compile(e.args[0]),a=this.compileEvaluator(e.args[1]);return t.equals(n,a)}if("if"===e.type){var s=this.compileEvaluator(e.args[0]),i=this.compile(e.args[1]),r=this.compile(e.args[2]);return t["if"](s,i,r)}if("and"===e.type||"or"===e.type){var o=solve(e.args[0],valueSyntax),l=solve(e.args[1],valueSyntax),c=this.compileEvaluator(e.args[0]),a=this.compileEvaluator(e.args[1]),p=this.compileEvaluator(o[1]),h=this.compileEvaluator(l[1]),n=this.compile(o[0]),d=this.compile(l[0]);return t[e.type](n,d,c,a,p,h)}if("everyBlock"===e.type){var u=this.compileEvaluator(e.args[0]),g=solve(e.args[1],{type:"literal",value:!0}),m=this.compile(g[0]),f=this.compileEvaluator(g[1]);return t.everyBlock(u,m,f)}if(t.hasOwnProperty(e.type)){var v=e.args.map(this.compileEvaluator,this.compileEvaluator.semantics);return t[e.type].apply(null,v)}throw Error("Can't compile assigner for "+JSON.stringify(e.type))},compileEvaluator:compileEvaluator,compilers:{property:function(e,t){return function(n,a){var s=e(a);if(s){var i=t(a);null!=i&&(Array.isArray(s)?s.set(i,n):s[i]=n)}}},get:function(e,t){return function(n,a){var s=e(a);if(s){var i=t(a);null!=i&&s.set(i,n)}}},has:function(e,t){return function(n,a){var s=e(a);if(s){var i=t(a);null!=n&&(n?(s.has||s.contains).call(s,i)||s.add(i):(s.has||s.contains).call(s,i)&&(s.remove||s["delete"]).call(s,i))}}},equals:function(e,t){return function(n,a){return n?e(t(a),a):void 0}},"if":function(e,t,n){return function(a,s){var i=e(s);if(null!=i)return i?t(a,s):n(a,s)}},and:function(e,t,n,a,s,i){return function(r,o){null!=r&&(r?(e(s(trueScope),o),t(i(trueScope),o)):e(n(o)&&!a(o),o))}},or:function(e,t,n,a,s,i){return function(r,o){null!=r&&(r?e(n(o)||!a(o),o):(e(s(falseScope),o),t(i(falseScope),o)))}},rangeContent:function(e){return function(t,n){var a=e(n);a&&(t?a.swap(0,a.length,t):a.clear())}},mapContent:function(e){return function(t,n){var a=e(n);a&&(a.clear(),n.value&&a.addEach(t))}},reversed:function(e){return function(t,n){var a=e(n);a&&a.swap(0,a.length,t.reversed())}},everyBlock:function(e,t,n){return function(a,s){if(a){var i=e(s),r=n(s);i.forEach(function(e){t(r,Scope.nest(s,e))})}}}}};