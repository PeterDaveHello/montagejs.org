function makeLiteralObserver(e){return function(t){return t(e)||Function.noop}}function observeValue(e,t){return e(t.value)||Function.noop}function observeParameters(e,t){return e(t.parameters)||Function.noop}function makeElementObserver(e){return function(t,n){return t(n.document.getElementById(e))||Function.noop}}function makeComponentObserver(e,t){return function(n,a){var s=a.components,i=s.getObjectByLabel||s.getComponentByLabel,r=i.call(s,e);return t.component=r,n(r)||Function.noop}}function observeProperty(e,t,n,a){function s(e,t,a){i(),i=n(e,t,a)||Function.noop}if(null==e)return n();var i=Function.noop;return PropertyChanges.addOwnPropertyChangeListener(e,t,s,a.beforeChange),s(e[t],t,e),once(function(){i(),PropertyChanges.removeOwnPropertyChangeListener(e,t,s,a.beforeChange)})}function makePropertyObserver(e,t){return function(n,a){return t(autoCancelPrevious(function(t){return null==t?n():e(autoCancelPrevious(function(e){return null==e?n():e.observeProperty?e.observeProperty(t,n,a):_observeProperty(e,t,n,a)}),a)}),a)}}function observeGet(e,t,n,a){function s(e,a,s){r(t,a)&&(i(),i=n(e,t,s)||Function.noop)}var i=Function.noop,r=e.contentEquals||Object.equals;return s(e.get(t),t,e),e.addMapChangeListener(s,a.beforeChange),once(function(){i(),e.removeMapChangeListener(s)})}function makeGetObserver(e,t){return function(n,a){return e(autoCancelPrevious(function(e){return e?t(autoCancelPrevious(function(t){return null==t?n():e.observeGet?e.observeGet(t,n,a):_observeGet(e,t,n,a)}),a):n()}),a)}}function makeHasObserver(e,t){return function(n,a){return n=makeUniq(n),t(autoCancelPrevious(function(t){return e(autoCancelPrevious(function(e){return e?observeRangeChange(e,function(){return n((e.has||e.contains).call(e,t))},a):n()}),a)}),a)}}function makeObserversObserver(e){return function(t,n){for(var a=Array(e.length),s=0;e.length>s;s++)a[s]=void 0;var i=e.map(function(e,t){return e(function(e){a.set(t,e)},n)}),r=t(a)||Function.noop;return once(function(){r(),cancelEach(i)})}}function makeObjectObserver(e){return function(t,n){var a={},s={};for(var i in e)(function(e,t){a[e]=t(function(t){s[e]=t},n)})(i,e[i]);var r=t(s)||Function.noop;return function(){r();for(var e in a)a[e]()}}}function makeArrayObserver(){return makeObserversObserver(Array.prototype.slice.call(arguments))}function makeOperatorObserverMaker(e){return function(){var t=makeObserversObserver(Array.prototype.slice.call(arguments)),n=makeRangeContentObserver(t);return function(t,a){return n(autoCancelPrevious(function(n){return n.every(Operators.defined)?t(e.apply(void 0,n)):t()}),a)}}}function makeMethodObserverMaker(e){var t=e.slice(0,1).toUpperCase()+e.slice(1),n="make"+t+"Observer",a="observe"+t;return function(){var t=arguments[0],s=Array.prototype.slice.call(arguments,1),i=s.map(function(e){return function(t,n){return e(autoCancelPrevious(t),n)}}),r=makeObserversObserver(s),o=makeRangeContentObserver(r);return function(s,r){return t(autoCancelPrevious(function(t){return t?t[n]?t[n].apply(t,i)(s,r):t[a]?t[a](s,r):o(autoCancelPrevious(function(n){if(!n.every(Operators.defined))return s();if(t[e])return s(t[e].apply(t,n));throw Error("Object has no method "+JSON.stringify(e)+": "+t)}),r):s()}),r)}}}function makeNotObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){return t(!e)}),n)}}function makeAndObserver(e,t){return function(n,a){return e(autoCancelPrevious(function(e){return e?t(n,a):n(e)}),a)}}function makeOrObserver(e,t){return function(n,a){return e(autoCancelPrevious(function(e){return e?n(e):t(n,a)}),a)}}function makeConditionalObserver(e,t,n){return function(a,s){return e(autoCancelPrevious(function(e){return null==e?a():e?t(a,s):n(a,s)}),s)}}function makeDefinedObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){return t(null!=e)}),n)}}function makeDefaultObserver(e,t){return function(n,a){return e(autoCancelPrevious(function(e){return null==e?t(n,a):n(e)}),a)}}function makeReplacingMapBlockObserver(e,t){return function(n,a){return e(autoCancelPrevious(function(e){function s(t){for(;e.length>t;t++)o[t].index=t}function i(e,n,i){o.swap(i,n.length,e.map(function(e,t){return{index:i+t}})),s(i+e.length);var c,p=[];cancelEach(l.swap(i,n.length,e.map(function(e,n){var s=o[i+n];return t(autoCancelPrevious(function(e){c?r.set(s.index,e):p[n]=e}),Scope.nest(a,e))}))),c=!0,r.swap(i,n.length,p)}if(!e)return n();var r=[],o=[],l=[],c=observeRangeChange(e,i,a),p=n(r,e)||Function.noop;return once(function(){p(),cancelEach(l),c()})}),a)}}function makeReplacingFilterBlockObserver(e,t){var n=makeReplacingMapBlockObserver(e,t);return function(e,t){return n(autoCancelPrevious(function(n,a){function s(e){for(;n.length>e;e++)l[e+1]=l[e]+n[e]}function i(e,t,n){var i=a.slice(n,n+e.length),o=t.map(Boolean).sum(),c=i.filter(function(t,n){return e[n]}),p=l[n];r.swap(p,o,c),s(p)}if(!a)return e();var r=[],o=[],l=[0],c=observeRangeChange(n,i,t),p=e(r)||Function.noop;return once(function(){p(),cancelEach(o),c()})}),t)}}function makeSortedBlockObserver(e,t){var n=makeRelationItemObserver(t),a=makeReplacingMapBlockObserver(e,n),s=function(e,t){return a(autoCancelPrevious(function(n){function a(e,t){i.addEach(e),i.deleteEach(t)}if(!n)return e();var s=[],i=SortedArray(s,function(e,t){return Object.equals(e[1],t[1])},function(e,t){return Object.compare(e[1],t[1])}),r=observeRangeChange(n,a,t),o=e(s)||Function.noop;return function(){o(),r()}}),t)};return makeMapBlockObserver(s,observeItemKey)}function makeRelationItemObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){return t([n.value,e])||Function.noop}),n)}}function makeReplacingReversedObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){function a(e,t,n){var a=s.length-n-t.length;s.swap(a,t.length,e.reversed())}if(!e)return t();var s=[],i=observeRangeChange(e,a,n),r=t(s);return once(function(){r(),i()})}),n)}}function makeReplacingFlattenObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){function a(t){for(var n=t;e.length>n;n++)l[n].index=n,o[n+1]=o[n]+e[n].length}function s(e,t,s){var c=o[s],p=o[s+t.length],h=p-c;i.swap(c,h,[]),l.swap(s,t.length,e.map(function(){return{index:null}})),a(s),cancelEach(r.swap(s,t.length,e.map(function(e,t){function r(e,t,n){a(c.index);var s=o[c.index]+n,r=o[c.index]+n+t.length,l=r-s;i.swap(s,l,e)}var c=l[s+t];return observeRangeChange(e,r,n)})))}if(!e)return t();var i=[],r=[],o=[0],l=[],c=observeRangeChange(e,s,n),p=t(i)||Function.noop;return once(function(){p(),cancelEach(r),c()})}),n)}}function makeSomeBlockObserver(e,t){var n=makeFilterBlockObserver(e,t),a=makePropertyObserver(n,observeLengthLiteral);return makeConverterObserver(a,Boolean)}function makeEveryBlockObserver(e,t){var n=makeConverterObserver(t,Operators.not),a=makeFilterBlockObserver(e,n),s=makePropertyObserver(a,observeLengthLiteral);return makeConverterObserver(s,Operators.not)}function makeGroupBlockObserver(e,t){var n=makeGroupMapBlockObserver(e,t);return makeItemsObserver(n)}function makeGroupMapBlockObserver(e,t){var n=makeRelationItemObserver(t),a=makeReplacingMapBlockObserver(e,n);return function(e,t){return a(autoCancelPrevious(function(n,a){function s(e,t){var n=Set();t.forEach(function(e){var t=i.get(e[1]);t["delete"](e[0]),n.add(e[1])}),e.forEach(function(e){i.has(e[1])||i.set(e[1],a.constructClone());var t=i.get(e[1]);t.add(e[0])}),n.forEach(function(e){var t=i.get(e);0===t.length&&i["delete"](e)})}if(!n)return e();var i=Map(),r=observeRangeChange(n,s,t),o=e(i)||Function.noop;return function(){r(),o()}}),t)}}function makeHeapBlockObserver(e,t,n){function a(e,t){return Object.compare(e[1],t[1])*n}function s(e,t){return Object.equals(e[1],t[1])}var i=makeRelationItemObserver(t),r=makeReplacingMapBlockObserver(e,i);return function(e,t){return r(autoCancelPrevious(function(n){function i(e,t){o.addEach(e),o.deleteEach(t)}function r(t,n){return 0===n?t?e(t[0]):e():void 0}if(!n)return e();var o=new Heap(null,s,a),l=observeRangeChange(n,i,t),c=observeMapChange(o,r,t);return function(){l(),c()}}),t)}}function makeMaxBlockObserver(e,t){return makeHeapBlockObserver(e,t,1)}function makeMinBlockObserver(e,t){return makeHeapBlockObserver(e,t,-1)}function makeCollectionObserverMaker(e){return function(t){return function(n,a){return n=makeUniq(n),t(autoCancelPrevious(function(t){if(!t)return n();var s=e(t,n);return observeRangeChange(t,function(e,t,a){return n(s(e,t,a))},a)}),a)}}}function makeReplacingViewObserver(e,t,n){return function(a,s){return e(autoCancelPrevious(function(e){return e?n(autoCancelPrevious(function(n){return null==n?a():t(autoCancelPrevious(function(t){function i(a,s,i){var o=a.length-s.length;t>i&&0>o&&n>o?(r.swap(r.length,0,e.slice(t+n+o,t+n)),r.splice(0,-o)):t>i&&o>0&&n>o?(r.swap(0,0,e.slice(t,t+o)),r.splice(r.length-o,o)):i>=t&&0>o&&t+n>i?(r.swap(r.length,0,e.slice(t+n+o,t+n)),r.splice(i-t,-o)):i>=t&&o>0&&t+n>i?(r.swap(i-t,0,e.slice(i,i+o)),r.splice(r.length-o,o)):t+n>i&&r.swap(0,r.length,e.slice(t,t+n))}if(null==t)return a();var r=[],o=observeRangeChange(e,i,s),l=a(r)||Function.noop;return once(function(){l(),o()})}),s)}),s):a()}),s)}}function makeReplacingEnumerateObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){function a(e){for(;i.length>e;e++)i[e].set(0,e)}function s(e,t,n){i.swap(n,t.length,e.map(function(e,t){return[n+t,e]})),a(n+e.length)}if(!e)return t();var i=[],r=observeRangeChange(e,s,n),o=t(i)||Function.noop;return function(){o(),r()}}),n)}}function makeRangeObserver(e){return function(t,n){var a=[],s=t(a)||Function.noop,i=e(function(e){if(e>>>=0,null==e)a.clear();else if(e>a.length){for(var t=[],n=a.length;e>n;n++)t.push(n);a.swap(a.length,0,t)}else a.length>e&&a.splice(e,a.length)},n);return function(){s(),i()}}}function makeStartsWithObserver(e,t){return function(n,a){return t(function(t){var s=RegExp("^"+RegExp.escape(t));return e(function(e){return n(s.test(e))||Function.noop},a)},a)}}function makeEndsWithObserver(e,t){return function(n,a){return t(function(t){var s=RegExp(RegExp.escape(t)+"$");return e(function(e){return n(s.test(e))||Function.noop},a)},a)}}function makeContainsObserver(e,t){return function(n,a){return t(function(t){var s=RegExp(RegExp.escape(t));return e(function(e){return n(s.test(e))||Function.noop},a)},a)}}function observeRangeChange(e,t,n){function a(e,n,a){s(),s=t(e,n,a)||Function.noop}if(e){var s=Function.noop;if(!e.toArray)throw Error("Can't observe range changes on "+e+" because it has no toArray method");if(!e.addRangeChangeListener)throw Error("Can't observe range changes on "+e);a(e.toArray(),[],0);var i=e.addRangeChangeListener(a,n.beforeChange);return once(function(){s(),i()})}}function makeRangeContentObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){return e&&e.addRangeChangeListener?observeRangeChange(e,function(){return t(e)},n):t(e)}),n)}}function makeMapContentObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){return e&&e.addMapChangeListener?observeMapChange(e,function(){return t(e)},n):t(e)}),n)}}function observeMapChange(e,t,n){function a(e,n,a){var i=s.get(n)||Function.noop;i(),i=t(e,n,a)||Function.noop,s.set(n,i)}var s=Map();e.forEach(a);var i=e.addMapChangeListener(a,n.beforeChange);return once(function(){s.forEach(function(e){e()}),i()})}function makeReplacingItemsObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){return e?observeItems(e,t,n):t()}),n)}}function observeItems(e,t,n){function a(e,t){var n,a;i.has(t)?null==e?(n=i.get(t),i["delete"](t),a=s.indexOf(n),s.splice(a,1)):(n=i.get(t),n.set(1,e)):(n=[t,e],i.set(t,n),s.push(n))}var s=[],i=Map(),r=t(s)||Function.noop,o=observeMapChange(e,a,n);return once(function(){r(),o()})}function makeKeysObserver(e){var t=makeItemsObserver(e);return makeMapBlockObserver(t,observeItemKey)}function observeItemKey(e,t){return t.value?e(t.value[0])||Function.noop:e()}function makeValuesObserver(e){var t=makeItemsObserver(e);return makeMapBlockObserver(t,observeItemValue)}function observeItemValue(e,t){return t.value?e(t.value[1])||Function.noop:e()}function makeToMapObserver(e){return function(t,n){var a=Map(),s=t(a)||Function.noop,i=e(autoCancelPrevious(function(e){if(a.clear(),e&&!e.addRangeChangeListener){var t=Object.keys(e).map(function(t){return _observeProperty(e,t,autoCancelPrevious(function(e){a.set(t,e)}),n)});return function(){cancelEach(t)}}}),n);return function(){s(),i()}}}function makeParentObserver(e){return function(t,n){return e(t,n.parent||new Scope)}}function makeConverterObserver(e,t,n){return function(a,s){return a=makeUniq(a),e(autoCancelPrevious(function(e){return a(t.call(n,e))}),s)}}function makeComputerObserver(e,t,n){return function(a,s){return a=makeUniq(a),e(autoCancelPrevious(function(e){return e&&e.every(Operators.defined)?a(t.apply(n,e)):void 0}),s)}}function makeExpressionObserver(e,t){var n=require("./parse"),a=require("./compile-observer");return function(s,i){return s=makeUniq(s),t(autoCancelPrevious(function(t){if(null==t)return s();var r,o;try{r=n(t),o=a(r)}catch(l){return s()}return e(autoCancelPrevious(function(e){return o(s,Scope.nest(i,e))}),i)}),i)}}function makeWithObserver(e,t){return function(n,a){return e(autoCancelPrevious(function(e){return t(autoCancelPrevious(function(e){return n(e)}),Scope.nest(a,e))}),a)}}function makeNonReplacing(e){return function(){var t=e.apply(this,arguments);return function(e,n){var a=[],s=t(autoCancelPrevious(function(e){function t(e,t,n){a.swap(n,t.length,e)}if(e){a.swap(0,a.length,e);var s=e.addRangeChangeListener(t,n.beforeChange);return once(s)}a.clear()}),n),i=e(a)||Function.noop;return once(function(){s(),i()})}}}function makeUniq(e){var t;return function(n){if(n!==t){var a=e.apply(this,arguments);return t=n,a}}}function cancelEach(e){e.forEach(function(e){e&&e()})}function autoCancelPrevious(e){var t=Function.noop;return function(){return t(),t=e.apply(this,arguments)||Function.noop,function(){t()}}}function once(e){var t;return function(){return t?Function.noop:(t=!0,e.apply(this,arguments))}}require("collections/shim");var PropertyChanges=require("collections/listen/property-changes");require("collections/listen/array-changes");var SortedArray=require("collections/sorted-array"),Map=require("collections/map"),Set=require("collections/set"),Heap=require("collections/heap"),Scope=require("./scope"),Operators=require("./operators");exports.makeLiteralObserver=makeLiteralObserver,exports.observeValue=observeValue,exports.observeParameters=observeParameters,exports.makeElementObserver=makeElementObserver,exports.makeComponentObserver=makeComponentObserver,exports.observeProperty=observeProperty;var _observeProperty=observeProperty;exports.makePropertyObserver=makePropertyObserver,exports.observeKey=observeGet,exports.observeGet=observeGet;var _observeGet=observeGet;exports.makeGetObserver=makeGetObserver,exports.makeHasObserver=makeHasObserver,exports.makeObserversObserver=makeObserversObserver,exports.makeRecordObserver=makeObjectObserver,exports.makeObjectObserver=makeObjectObserver,exports.makeTupleObserver=makeArrayObserver,exports.makeArrayObserver=makeArrayObserver,exports.makeOperatorObserverMaker=makeOperatorObserverMaker,exports.makeMethodObserverMaker=makeMethodObserverMaker,exports.makeNotObserver=makeNotObserver,exports.makeAndObserver=makeAndObserver,exports.makeOrObserver=makeOrObserver,exports.makeConditionalObserver=makeConditionalObserver,exports.makeDefinedObserver=makeDefinedObserver,exports.makeDefaultObserver=makeDefaultObserver;var makeMapBlockObserver=exports.makeMapBlockObserver=makeNonReplacing(makeReplacingMapBlockObserver),makeFilterBlockObserver=exports.makeFilterBlockObserver=makeNonReplacing(makeReplacingFilterBlockObserver);exports.makeSortedBlockObserver=makeSortedBlockObserver,exports.makeReversedObserver=makeNonReplacing(makeReplacingReversedObserver),exports.makeFlattenObserver=makeNonReplacing(makeReplacingFlattenObserver),exports.makeSomeBlockObserver=makeSomeBlockObserver,exports.makeEveryBlockObserver=makeEveryBlockObserver,exports.makeGroupBlockObserver=makeGroupBlockObserver,exports.makeGroupMapBlockObserver=makeGroupMapBlockObserver,exports.makeMaxBlockObserver=makeMaxBlockObserver,exports.makeMinBlockObserver=makeMinBlockObserver;var observeLengthLiteral=makeLiteralObserver("length");exports.makeSumObserver=makeCollectionObserverMaker(function(){var e=0;return function(t,n){return e+=t.sum()-n.sum()}}),exports.makeAverageObserver=makeCollectionObserverMaker(function(){var e=0,t=0;return function(n,a){return e+=n.sum()-a.sum(),t+=n.length-a.length,e/t}}),exports.makeViewObserver=makeNonReplacing(makeReplacingViewObserver),exports.makeEnumerateObserver=makeNonReplacing(makeReplacingEnumerateObserver),exports.makeEnumerationObserver=exports.makeEnumerateObserver,exports.makeRangeObserver=makeRangeObserver,exports.makeStartsWithObserver=makeStartsWithObserver,exports.makeEndsWithObserver=makeEndsWithObserver,exports.makeContainsObserver=makeContainsObserver,exports.observeRangeChange=observeRangeChange,exports.makeRangeContentObserver=makeRangeContentObserver,exports.makeMapContentObserver=makeMapContentObserver,exports.observeMapChange=observeMapChange;var makeItemsObserver=exports.makeItemsObserver=makeNonReplacing(makeReplacingItemsObserver);exports.observeItems=observeItems,exports.makeKeysObserver=makeKeysObserver,exports.observeItemKey=observeItemKey,exports.makeValuesObserver=makeValuesObserver,exports.observeItemValue=observeItemValue,exports.makeToMapObserver=makeToMapObserver,exports.makeParentObserver=makeParentObserver,exports.makeConverterObserver=makeConverterObserver,exports.makeComputerObserver=makeComputerObserver,exports.makePathObserver=makeExpressionObserver,exports.makeExpressionObserver=makeExpressionObserver,exports.makeWithObserver=makeWithObserver,exports.makeAsArrayObserver=makeNonReplacing(Function.identity),exports.makeUniq=makeUniq,exports.cancelEach=cancelEach,exports.autoCancelPrevious=autoCancelPrevious,exports.once=once;