montageDefine("196fc31","lib/_stream_transform",{dependencies:["./_stream_duplex","util"],factory:function(e,t,n){function a(e,t){this.afterTransform=function(e,n){return s(t,e,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function s(e,t,n){var a=e._transformState;a.transforming=!1;var s=a.writecb;if(!s)return e.emit("error",Error("no writecb in Transform class"));a.writechunk=null,a.writecb=null,null!==n&&void 0!==n&&e.push(n),s&&s(t);var i=e._readableState;(i.needReadable||i.length<i.highWaterMark)&&e._read(i.highWaterMark)}function i(e){if(!(this instanceof i))return new i(e);o.call(this,e),this._transformState=new a(e,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(e){r(t,e)}):r(t)})}function r(e,t){if(t)return e.emit("error",t);var n=e._writableState;e._readableState;var a=e._transformState;if(n.length)throw Error("calling transform done when ws.length != 0");if(a.transforming)throw Error("calling transform done when still transforming");return e.push(null)}n.exports=i;var o=e("./_stream_duplex"),l=e("util");l.inherits(i,o),i.prototype.push=function(e){return this._transformState.needTransform=!1,o.prototype.push.call(this,e)},i.prototype._transform=function(){throw Error("not implemented")},i.prototype._write=function(e,t,n){var a=this._transformState;if(a.writecb=n,a.writechunk=e,a.writeencoding=t,!a.transforming){var s=this._readableState;(a.needTransform||s.needReadable||s.length<s.highWaterMark)&&this._read(s.highWaterMark)}},i.prototype._read=function(){var e=this._transformState;e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0}}});