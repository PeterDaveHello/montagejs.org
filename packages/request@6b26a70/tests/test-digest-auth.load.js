montageDefine("6b26a70","tests/test-digest-auth",{dependencies:["assert","http","../index"],factory:function(e,t,n){var r=e("assert"),i=e("http"),s=e("../index"),o=0,u=i.createServer(function(e,t){console.error("Digest auth server: ",e.method,e.url),o++;var n;e.headers.authorization?e.headers.authorization=='Digest username="test", realm="Private", nonce="WpcHS2/TBAA=dffcc0dbd5f96d49a5477166649b7c0ae3866a93", uri="/test/", qop="auth", response="54753ce37c10cb20b09b769f0bed730e", nc="1", cnonce=""'?n=!0:n=!1:(n=!1,t.setHeader("www-authenticate",'Digest realm="Private", nonce="WpcHS2/TBAA=dffcc0dbd5f96d49a5477166649b7c0ae3866a93", algorithm=MD5, qop="auth"')),n?(console.log("request ok"),t.end("ok")):(console.log("status=401"),t.statusCode=401,t.end("401"))});u.listen(6767),s({method:"GET",uri:"http://localhost:6767/test/",auth:{user:"test",pass:"testing",sendImmediately:!1}},function(e,t,n){r.equal(t.statusCode,200),r.equal(o,2),s({method:"GET",uri:"http://localhost:6767/test/",auth:{user:"test",pass:"testing"}},function(e,t,n){r.equal(t.statusCode,401),r.equal(o,3),console.log("All tests passed"),u.close()})})}})