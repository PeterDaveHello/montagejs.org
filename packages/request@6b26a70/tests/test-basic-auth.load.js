montageDefine("6b26a70","tests/test-basic-auth",{dependencies:["assert","http","../index"],factory:function(e,t,n){function f(e){e<a.length?a[e](function(){f(e+1)}):(console.log("All tests passed"),u.close())}var r=e("assert"),i=e("http"),s=e("../index"),o=0,u=i.createServer(function(e,t){console.error("Basic auth server: ",e.method,e.url),o++;var n;e.headers.authorization?e.headers.authorization=="Basic "+(new Buffer("test:testing2")).toString("base64")?n=!0:e.headers.authorization=="Basic "+(new Buffer(":apassword")).toString("base64")?n=!0:n=!1:(n=!1,t.setHeader("www-authenticate",'Basic realm="Private"'));if(e.url=="/post/"){var i="data_key=data_value";e.on("data",function(e){r.equal(e,i),console.log("received request data: "+e)}),r.equal(e.method,"POST"),r.equal(e.headers["content-length"],""+i.length),r.equal(e.headers["content-type"],"application/x-www-form-urlencoded; charset=utf-8")}n?(console.log("request ok"),t.end("ok")):(console.log("status=401"),t.statusCode=401,t.end("401"))});u.listen(6767);var a=[function(e){s({method:"GET",uri:"http://localhost:6767/test/",auth:{user:"test",pass:"testing2",sendImmediately:!1}},function(t,n,i){r.equal(n.statusCode,200),r.equal(o,2),e()})},function(e){s({method:"GET",uri:"http://localhost:6767/test2/",auth:{user:"test",pass:"testing2"}},function(t,n,i){r.equal(n.statusCode,200),r.equal(o,3),e()})},function(e){s({method:"GET",uri:"http://test:testing2@localhost:6767/test2/"},function(t,n,i){r.equal(n.statusCode,200),r.equal(o,4),e()})},function(e){s({method:"POST",form:{data_key:"data_value"},uri:"http://localhost:6767/post/",auth:{user:"test",pass:"testing2",sendImmediately:!1}},function(t,n,i){r.equal(n.statusCode,200),r.equal(o,6),e()})},function(e){r.doesNotThrow(function(){s({method:"GET",uri:"http://localhost:6767/allow_empty_user/",auth:{user:"",pass:"apassword",sendImmediately:!1}},function(t,n,i){r.equal(n.statusCode,200),r.equal(o,8),e()})})}];f(0)}})