montageDefine("6b26a70","tests/test-protocol-changing-redirect",{dependencies:["./server","assert","../index"],factory:function(e,t,n){function p(e,t){return function(){var n={a:"b",b:"c",c:"d",d:"e",e:"f",f:"g",g:"h",h:"end"},r=!0;Object.keys(n).forEach(function(i){var s=n[i],o=r?301:302;r=!r,e.on("/"+i,function(e,n){n.writeHead(o,{location:t+"/"+s}),n.end()})}),e.on("/end",function(e,t){var n=e.headers["x-test-key"];l[n]=!0,h--,h===0&&m()})}}function m(){i.deepEqual(l,c),process.exit(0)}var r=e("./server"),i=e("assert"),s=e("../index"),o=r.createServer(),u=r.createSSLServer(),a="http://localhost:"+o.port,f="https://localhost:"+u.port;o.listen(o.port,p(o,f)),u.listen(u.port,p(u,a));var l={},c={},h=0;for(var d=0;d<5;d++){h++;var v="test_"+d;c[v]=!0,s({url:(d%2?a:f)+"/a",headers:{"x-test-key":v},rejectUnauthorized:!1})}}})