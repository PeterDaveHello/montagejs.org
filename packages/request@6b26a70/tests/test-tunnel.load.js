montageDefine("6b26a70","tests/test-tunnel",{dependencies:["./server","assert","../index","fs","path","child_process"],factory:function(e,t,n){function y(){console.error("squid must be installed to run this test."),console.error("skipping this test. please install squid and run again if you need to test tunneling."),c=null,v=null,process.exit(0)}var r=e("./server"),i=e("assert"),s=e("../index"),o=e("fs"),u=e("path"),a=u.resolve(__dirname,"ssl/npm-ca.crt"),f=o.readFileSync(a),l=e("child_process"),h=u.resolve(__dirname,"squid.conf"),p=["-f",h,"-N","-d","5"],d="http://localhost:3128",v=null,m=l.spawn("squid",p),g=!1;m.stderr.on("data",function(e){console.error("SQUIDERR "+e.toString().trim().split("\n").join("\nSQUIDERR ")),g=e.toString().match(/ready to serve requests|Accepting HTTP Socket connections/i)}),m.stdout.on("data",function(e){console.error("SQUIDOUT "+e.toString().trim().split("\n").join("\nSQUIDOUT "))}),m.on("error",function(e){console.error("squid: error "+e);if(e&&!g){y();return}}),m.on("exit",function(e){console.error("squid: exit "+e);if(e&&!g){y();return}e&&(v=v||new Error("Squid exited with "+e));if(v)throw v}),setTimeout(function b(){if(!g)return setTimeout(b,100);s({uri:"https://registry.npmjs.org/",proxy:"http://localhost:3128",strictSSL:!0,ca:f,json:!0},function(e,t){v=e,console.log(e||typeof t),e||console.log("ok"),m.kill("SIGKILL")})},100)}})