montageDefine("6b26a70","tests/test-defaults",{dependencies:["./server","assert","../index"],factory:function(e,t,n){var r=e("./server"),i=e("assert"),s=e("../index"),o=r.createServer();o.listen(o.port,function(){var e=0;o.on("/get",function(e,t){i.equal(e.headers.foo,"bar"),i.equal(e.method,"GET"),t.writeHead(200,{"Content-Type":"text/plain"}),t.end("TESTING!")}),s.defaults({headers:{foo:"bar"}})(o.url+"/get",function(t,n,r){if(t)throw t;i.deepEqual("TESTING!",r),e+=1}),o.on("/post",function(e,t){i.equal(e.headers.foo,"bar"),i.equal(e.headers["content-type"],null),i.equal(e.method,"POST"),t.writeHead(200,{"Content-Type":"application/json"}),t.end(JSON.stringify({foo:"bar"}))}),s.defaults({headers:{foo:"bar"}}).post(o.url+"/post",{json:!0},function(t,n,r){if(t)throw t;i.deepEqual("bar",r.foo),e+=1}),o.on("/patch",function(e,t){i.equal(e.headers.foo,"bar"),i.equal(e.headers["content-type"],null),i.equal(e.method,"PATCH"),t.writeHead(200,{"Content-Type":"application/json"}),t.end(JSON.stringify({foo:"bar"}))}),s.defaults({headers:{foo:"bar"}}).patch(o.url+"/patch",{json:!0},function(t,n,r){if(t)throw t;i.deepEqual("bar",r.foo),e+=1}),o.on("/post-body",function(e,t){i.equal(e.headers.foo,"bar"),i.equal(e.headers["content-type"],"application/json"),i.equal(e.method,"POST"),t.writeHead(200,{"Content-Type":"application/json"}),t.end(JSON.stringify({foo:"bar"}))}),s.defaults({headers:{foo:"bar"}}).post(o.url+"/post-body",{json:!0,body:{bar:"baz"}},function(t,n,r){if(t)throw t;i.deepEqual("bar",r.foo),e+=1}),o.on("/del",function(e,t){i.equal(e.headers.foo,"bar"),i.equal(e.method,"DELETE"),t.writeHead(200,{"Content-Type":"application/json"}),t.end(JSON.stringify({foo:"bar"}))}),s.defaults({headers:{foo:"bar"},json:!0}).del(o.url+"/del",function(t,n,r){if(t)throw t;i.deepEqual("bar",r.foo),e+=1}),o.on("/head",function(e,t){i.equal(e.headers.foo,"bar"),i.equal(e.method,"HEAD"),t.writeHead(200,{"Content-Type":"text/plain"}),t.end()}),s.defaults({headers:{foo:"bar"}}).head({uri:o.url+"/head"},function(t,n,r){if(t)throw t;e+=1}),o.on("/get_custom",function(e,t){i.equal(e.headers.foo,"bar"),i.equal(e.headers.x,"y"),t.writeHead(200,{"Content-Type":"text/plain"}),t.end()});var t=s.defaults({headers:{foo:"bar"},body:"TESTING!"},function(e,t,n){var r=s.initParams(e,t,n);return t=r.options,t.headers.x="y",s(r.uri,r.options,r.callback)}),n="defaults test failed. head request should throw earlier";i.throws(function(){t.head(o.url+"/get_custom",function(e,t,r){throw new Error(n)}),e+=1},n),t.get(o.url+"/get_custom",function(t,n,r){if(t)throw t;e+=1,console.log(e.toString()+" tests passed."),o.close()})})}})