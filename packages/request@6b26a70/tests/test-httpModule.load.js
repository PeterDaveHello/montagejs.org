montageDefine("6b26a70","tests/test-httpModule",{dependencies:["http","https","./server","assert","../index"],factory:function(e,t,n){function f(e,t){var n={};return Object.keys(t).forEach(function(r){var i=t[r];r!="request"?n[r]=i:n[r]=function(t,n){return a[e]+=1,i.apply(this,arguments)}}),n}function d(e){var t="http://localhost:"+h.port+"/to_https",n="https://localhost:"+p.port+"/to_plain";u(t,{httpModules:e,strictSSL:!1},function(e,t,n){if(e)throw e;o.equal(n,"https","Received HTTPS server body"),m()}),u(n,{httpModules:e,strictSSL:!1},function(e,t,n){if(e)throw e;o.equal(n,"plain","Received HTTPS server body"),m()})}function m(){v+=1;var e=10;v==e&&(h.close(),p.close(),o.equal(a.http,4,"Wrapped http module called appropriately"),o.equal(a.https,4,"Wrapped https module called appropriately"),console.log(e+2+" tests passed."))}var r=e("http"),i=e("https"),s=e("./server"),o=e("assert"),u=e("../index"),a={http:0,https:0},l=f("http",r),c=f("https",i),h=s.createServer(),p=s.createSSLServer();h.listen(h.port,function(){h.on("/plain",function(e,t){t.writeHead(200),t.end("plain")}),h.on("/to_https",function(e,t){t.writeHead(301,{location:"https://localhost:"+p.port+"/https"}),t.end()}),p.listen(p.port,function(){p.on("/https",function(e,t){t.writeHead(200),t.end("https")}),p.on("/to_plain",function(e,t){t.writeHead(302,{location:"http://localhost:"+h.port+"/plain"}),t.end()}),d(),d({}),d({"http:":l}),d({"https:":c}),d({"http:":l,"https:":c})})});var v=0}})