montageDefine("6b26a70","tests/server",{dependencies:["fs","http","path","https","events","stream","assert"],factory:function(e,t,n){var r=e("fs"),i=e("http"),s=e("path"),o=e("https"),u=e("events"),a=e("stream"),f=e("assert");t.createServer=function(e){e=e||6767;var t=i.createServer(function(e,n){t.emit(e.url,e,n)});return t.port=e,t.url="http://localhost:"+e,t},t.createSSLServer=function(e,t){e=e||16767;var n={key:s.join(__dirname,"ssl","test.key"),cert:s.join(__dirname,"ssl","test.crt")};if(t)for(var i in t)n[i]=t[i];for(var i in n)n[i]=r.readFileSync(n[i]);var u=o.createServer(n,function(e,t){u.emit(e.url,e,t)});return u.port=e,u.url="https://localhost:"+e,u},t.createPostStream=function(e){var t=new a.Stream;return t.writeable=!0,t.readable=!0,setTimeout(function(){t.emit("data",new Buffer(e)),t.emit("end")},0),t},t.createPostValidator=function(e,t){var n=function(n,r){var i="";n.on("data",function(e){i+=e}),n.on("end",function(){if(n.headers["content-type"]&&n.headers["content-type"].indexOf("boundary=")>=0){var s=n.headers["content-type"].split("boundary=")[1];e=e.replace(/__BOUNDARY__/g,s)}i!==e&&console.log(i,e),f.equal(i,e),t&&(f.ok(n.headers["content-type"]),f.ok(~n.headers["content-type"].indexOf(t))),r.writeHead(200,{"content-type":"text/plain"}),r.write("OK"),r.end()})};return n},t.createGetResponse=function(e,t){var n=function(n,r){t=t||"text/plain",r.writeHead(200,{"content-type":t}),r.write(e),r.end()};return n},t.createChunkResponse=function(e,t){var n=function(n,r){t=t||"text/plain",r.writeHead(200,{"content-type":t}),e.forEach(function(e){r.write(e)}),r.end()};return n}}})