montageDefine("3e28815","lib/client",{dependencies:["url","hoek","cryptiles","./crypto","./utils"],factory:function(e,t,n){var r=e("url"),i=e("hoek"),s=e("cryptiles"),o=e("./crypto"),u=e("./utils"),a={};t.header=function(e,t,n){var i={field:"",artifacts:{}};if(!e||typeof e!="string"&&typeof e!="object"||!t||typeof t!="string"||!n||typeof n!="object")return i;var a=n.timestamp||Math.floor((u.now()+(n.localtimeOffsetMsec||0))/1e3),f=n.credentials;if(!f||!f.id||!f.key||!f.algorithm)return i;if(o.algorithms.indexOf(f.algorithm)===-1)return i;typeof e=="string"&&(e=r.parse(e));var l={ts:a,nonce:n.nonce||s.randomString(6),method:t,resource:e.pathname+(e.search||""),host:e.hostname,port:e.port||(e.protocol==="http:"?80:443),hash:n.hash,ext:n.ext,app:n.app,dlg:n.dlg};i.artifacts=l,!l.hash&&n.hasOwnProperty("payload")&&(l.hash=o.calculatePayloadHash(n.payload,f.algorithm,n.contentType));var c=o.calculateMac("header",f,l),h=l.ext!==null&&l.ext!==undefined&&l.ext!=="",p='Hawk id="'+f.id+'", ts="'+l.ts+'", nonce="'+l.nonce+(l.hash?'", hash="'+l.hash:"")+(h?'", ext="'+u.escapeHeaderAttribute(l.ext):"")+'", mac="'+c+'"';return l.app&&(p+=', app="'+l.app+(l.dlg?'", dlg="'+l.dlg:"")+'"'),i.field=p,i},t.authenticate=function(e,t,n,r){n=i.clone(n),r=r||{};if(e.headers["www-authenticate"]){var s=u.parseAuthorizationHeader(e.headers["www-authenticate"],["ts","tsm","error"]);if(s instanceof Error)return!1;if(s.ts){var a=o.calculateTsMac(s.ts,t);if(a!==s.tsm)return!1}}if(!e.headers["server-authorization"]&&!r.required)return!0;var s=u.parseAuthorizationHeader(e.headers["server-authorization"],["mac","ext","hash"]);if(s instanceof Error)return!1;n.ext=s.ext,n.hash=s.hash;var f=o.calculateMac("response",t,n);if(f!==s.mac)return!1;if(!r.hasOwnProperty("payload"))return!0;if(!s.hash)return!1;var l=o.calculatePayloadHash(r.payload,t.algorithm,e.headers["content-type"]);return l===s.hash},t.getBewit=function(e,t){if(!e||typeof e!="string"&&typeof e!="object"||!t||typeof t!="object"||!t.ttlSec)return"";t.ext=t.ext===null||t.ext===undefined?"":t.ext;var n=u.now()+(t.localtimeOffsetMsec||0),i=t.credentials;if(!i||!i.id||!i.key||!i.algorithm)return"";if(o.algorithms.indexOf(i.algorithm)===-1)return"";typeof e=="string"&&(e=r.parse(e));var s=Math.floor(n/1e3)+t.ttlSec,a=o.calculateMac("bewit",i,{ts:s,nonce:"",method:"GET",resource:e.pathname+(e.search||""),host:e.hostname,port:e.port||(e.protocol==="http:"?80:443),ext:t.ext}),f=i.id+"\\"+s+"\\"+a+"\\"+t.ext;return u.base64urlEncode(f)}}})