montageDefine("3e28815","test/index",{dependencies:["url","lab","../lib"],factory:function(e,t,n){var r=e("url"),i=e("lab"),s=e("../lib"),o={},u=i.expect,a=i.before,f=i.after,l=i.experiment,c=i.test;l("Hawk",function(){var e=function(e,t){var n={id:e,key:"werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn",algorithm:e==="1"?"sha1":"sha256",user:"steve"};return t(null,n)};c("should generate a header then successfully parse it (configuration)",function(t){var n={method:"GET",url:"/resource/4?filter=a",host:"example.com",port:8080};e("123456",function(i,o){n.authorization=s.client.header(r.parse("http://example.com:8080/resource/4?filter=a"),n.method,{credentials:o,ext:"some-app-data"}).field,u(n.authorization).to.exist,s.server.authenticate(n,e,{},function(e,n,r){u(e).to.not.exist,u(n.user).to.equal("steve"),u(r.ext).to.equal("some-app-data"),t()})})}),c("should generate a header then successfully parse it (node request)",function(t){var n={method:"POST",url:"/resource/4?filter=a",headers:{host:"example.com:8080","content-type":"text/plain;x=y"}},r="some not so random text";e("123456",function(i,o){var a=s.client.header("http://example.com:8080/resource/4?filter=a",n.method,{credentials:o,ext:"some-app-data",payload:r,contentType:n.headers["content-type"]});n.headers.authorization=a.field,s.server.authenticate(n,e,{},function(e,i,o){u(e).to.not.exist,u(i.user).to.equal("steve"),u(o.ext).to.equal("some-app-data"),u(s.server.authenticatePayload(r,i,o,n.headers["content-type"])).to.equal(!0);var a={headers:{"content-type":"text/plain"}};a.headers["server-authorization"]=s.server.header(i,o,{payload:"some reply",contentType:"text/plain",ext:"response-specific"}),u(a.headers["server-authorization"]).to.exist,u(s.client.authenticate(a,i,o,{payload:"some reply"})).to.equal(!0),t()})})}),c("should generate a header then successfully parse it (no server header options)",function(t){var n={method:"POST",url:"/resource/4?filter=a",headers:{host:"example.com:8080","content-type":"text/plain;x=y"}},r="some not so random text";e("123456",function(i,o){var a=s.client.header("http://example.com:8080/resource/4?filter=a",n.method,{credentials:o,ext:"some-app-data",payload:r,contentType:n.headers["content-type"]});n.headers.authorization=a.field,s.server.authenticate(n,e,{},function(e,i,o){u(e).to.not.exist,u(i.user).to.equal("steve"),u(o.ext).to.equal("some-app-data"),u(s.server.authenticatePayload(r,i,o,n.headers["content-type"])).to.equal(!0);var a={headers:{"content-type":"text/plain"}};a.headers["server-authorization"]=s.server.header(i,o),u(a.headers["server-authorization"]).to.exist,u(s.client.authenticate(a,i,o)).to.equal(!0),t()})})}),c("should generate a header then fails to parse it (missing server header hash)",function(t){var n={method:"POST",url:"/resource/4?filter=a",headers:{host:"example.com:8080","content-type":"text/plain;x=y"}},r="some not so random text";e("123456",function(i,o){var a=s.client.header("http://example.com:8080/resource/4?filter=a",n.method,{credentials:o,ext:"some-app-data",payload:r,contentType:n.headers["content-type"]});n.headers.authorization=a.field,s.server.authenticate(n,e,{},function(e,i,o){u(e).to.not.exist,u(i.user).to.equal("steve"),u(o.ext).to.equal("some-app-data"),u(s.server.authenticatePayload(r,i,o,n.headers["content-type"])).to.equal(!0);var a={headers:{"content-type":"text/plain"}};a.headers["server-authorization"]=s.server.header(i,o),u(a.headers["server-authorization"]).to.exist,u(s.client.authenticate(a,i,o,{payload:"some reply"})).to.equal(!1),t()})})}),c("should generate a header then successfully parse it (with hash)",function(t){var n={method:"GET",url:"/resource/4?filter=a",host:"example.com",port:8080};e("123456",function(r,i){n.authorization=s.client.header("http://example.com:8080/resource/4?filter=a",n.method,{credentials:i,payload:"hola!",ext:"some-app-data"}).field,s.server.authenticate(n,e,{},function(e,n,r){u(e).to.not.exist,u(n.user).to.equal("steve"),u(r.ext).to.equal("some-app-data"),t()})})}),c("should generate a header then successfully parse it then validate payload",function(t){var n={method:"GET",url:"/resource/4?filter=a",host:"example.com",port:8080};e("123456",function(r,i){n.authorization=s.client.header("http://example.com:8080/resource/4?filter=a",n.method,{credentials:i,payload:"hola!",ext:"some-app-data"}).field,s.server.authenticate(n,e,{},function(e,n,r){u(e).to.not.exist,u(n.user).to.equal("steve"),u(r.ext).to.equal("some-app-data"),u(s.server.authenticatePayload("hola!",n,r)).to.be.true,u(s.server.authenticatePayload("hello!",n,r)).to.be.false,t()})})}),c("should generate a header then successfully parse it (app)",function(t){var n={method:"GET",url:"/resource/4?filter=a",host:"example.com",port:8080};e("123456",function(r,i){n.authorization=s.client.header("http://example.com:8080/resource/4?filter=a",n.method,{credentials:i,ext:"some-app-data",app:"asd23ased"}).field,s.server.authenticate(n,e,{},function(e,n,r){u(e).to.not.exist,u(n.user).to.equal("steve"),u(r.ext).to.equal("some-app-data"),u(r.app).to.equal("asd23ased"),t()})})}),c("should generate a header then successfully parse it (app, dlg)",function(t){var n={method:"GET",url:"/resource/4?filter=a",host:"example.com",port:8080};e("123456",function(r,i){n.authorization=s.client.header("http://example.com:8080/resource/4?filter=a",n.method,{credentials:i,ext:"some-app-data",app:"asd23ased",dlg:"23434szr3q4d"}).field,s.server.authenticate(n,e,{},function(e,n,r){u(e).to.not.exist,u(n.user).to.equal("steve"),u(r.ext).to.equal("some-app-data"),u(r.app).to.equal("asd23ased"),u(r.dlg).to.equal("23434szr3q4d"),t()})})}),c("should generate a header then fail authentication due to bad hash",function(t){var n={method:"GET",url:"/resource/4?filter=a",host:"example.com",port:8080};e("123456",function(r,i){n.authorization=s.client.header("http://example.com:8080/resource/4?filter=a",n.method,{credentials:i,payload:"hola!",ext:"some-app-data"}).field,s.server.authenticate(n,e,{payload:"byebye!"},function(e,n,r){u(e).to.exist,u(e.response.payload.message).to.equal("Bad payload hash"),t()})})}),c("should generate a header for one resource then fail to authenticate another",function(t){var n={method:"GET",url:"/resource/4?filter=a",host:"example.com",port:8080};e("123456",function(r,i){n.authorization=s.client.header("http://example.com:8080/resource/4?filter=a",n.method,{credentials:i,ext:"some-app-data"}).field,n.url="/something/else",s.server.authenticate(n,e,{},function(e,n,r){u(e).to.exist,u(n).to.exist,t()})})})})}})