montageDefine("3e28815","test/client",{dependencies:["url","lab","../lib"],factory:function(e,t,n){var r=e("url"),i=e("lab"),s=e("../lib"),o={},u=i.expect,a=i.before,f=i.after,l=i.experiment,c=i.test;l("Hawk",function(){l("client",function(){l("#header",function(){c("should return a valid authorization header (sha1)",function(e){var t={id:"123456",key:"2983d45yun89q",algorithm:"sha1"},n=s.client.header("http://example.net/somewhere/over/the/rainbow","POST",{credentials:t,ext:"Bazinga!",timestamp:1353809207,nonce:"Ygvqdz",payload:"something to write about"}).field;u(n).to.equal('Hawk id="123456", ts="1353809207", nonce="Ygvqdz", hash="bsvY3IfUllw6V5rvk4tStEvpBhE=", ext="Bazinga!", mac="qbf1ZPG/r/e06F4ht+T77LXi5vw="'),e()}),c("should return a valid authorization header (sha256)",function(e){var t={id:"123456",key:"2983d45yun89q",algorithm:"sha256"},n=s.client.header("https://example.net/somewhere/over/the/rainbow","POST",{credentials:t,ext:"Bazinga!",timestamp:1353809207,nonce:"Ygvqdz",payload:"something to write about",contentType:"text/plain"}).field;u(n).to.equal('Hawk id="123456", ts="1353809207", nonce="Ygvqdz", hash="2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=", ext="Bazinga!", mac="q1CwFoSHzPZSkbIvl0oYlD+91rBUEvFk763nMjMndj8="'),e()}),c("should return a valid authorization header (no ext)",function(e){var t={id:"123456",key:"2983d45yun89q",algorithm:"sha256"},n=s.client.header("https://example.net/somewhere/over/the/rainbow","POST",{credentials:t,timestamp:1353809207,nonce:"Ygvqdz",payload:"something to write about",contentType:"text/plain"}).field;u(n).to.equal('Hawk id="123456", ts="1353809207", nonce="Ygvqdz", hash="2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=", mac="HTgtd0jPI6E4izx8e4OHdO36q00xFCU0FolNq3RiCYs="'),e()}),c("should return an empty authorization header on missing options",function(e){var t=s.client.header("https://example.net/somewhere/over/the/rainbow","POST").field;u(t).to.equal(""),e()}),c("should return an empty authorization header on invalid credentials",function(e){var t={key:"2983d45yun89q",algorithm:"sha256"},n=s.client.header("https://example.net/somewhere/over/the/rainbow","POST",{credentials:t,ext:"Bazinga!",timestamp:1353809207}).field;u(n).to.equal(""),e()}),c("should return an empty authorization header on invalid algorithm",function(e){var t={id:"123456",key:"2983d45yun89q",algorithm:"hmac-sha-0"},n=s.client.header("https://example.net/somewhere/over/the/rainbow","POST",{credentials:t,payload:"something, anything!",ext:"Bazinga!",timestamp:1353809207}).field;u(n).to.equal(""),e()})}),l("#authenticate",function(){c("should return false on invalid header",function(e){var t={headers:{"server-authorization":'Hawk mac="abc", bad="xyz"'}};u(s.client.authenticate(t,{})).to.equal(!1),e()}),c("should return false on invalid mac",function(e){var t={headers:{"content-type":"text/plain","server-authorization":'Hawk mac="_IJRsMl/4oL+nn+vKoeVZPdCHXB4yJkNnBbTbHFZUYE=", hash="f9cDF/TDm7TkYRLnGwRMfeDzT6LixQVLvrIKhh0vgmM=", ext="response-specific"'}},n={method:"POST",host:"example.com",port:"8080",resource:"/resource/4?filter=a",ts:"1362336900",nonce:"eb5S_L",hash:"nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=",ext:"some-app-data",app:undefined,dlg:undefined,mac:"BlmSe8K+pbKIb6YsZCnt4E1GrYvY1AaYayNR82dGpIk=",id:"123456"},r={id:"123456",key:"werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn",algorithm:"sha256",user:"steve"};u(s.client.authenticate(t,r,n)).to.equal(!1),e()}),c("should return true on ignoring hash",function(e){var t={headers:{"content-type":"text/plain","server-authorization":'Hawk mac="XIJRsMl/4oL+nn+vKoeVZPdCHXB4yJkNnBbTbHFZUYE=", hash="f9cDF/TDm7TkYRLnGwRMfeDzT6LixQVLvrIKhh0vgmM=", ext="response-specific"'}},n={method:"POST",host:"example.com",port:"8080",resource:"/resource/4?filter=a",ts:"1362336900",nonce:"eb5S_L",hash:"nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=",ext:"some-app-data",app:undefined,dlg:undefined,mac:"BlmSe8K+pbKIb6YsZCnt4E1GrYvY1AaYayNR82dGpIk=",id:"123456"},r={id:"123456",key:"werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn",algorithm:"sha256",user:"steve"};u(s.client.authenticate(t,r,n)).to.equal(!0),e()}),c("should fail on invalid WWW-Authenticate header format",function(e){var t='Hawk ts="1362346425875", tsm="PhwayS28vtnn3qbv0mqRBYSXebN/zggEtucfeZ620Zo=", x="Stale timestamp"';u(s.client.authenticate({headers:{"www-authenticate":t}},{})).to.equal(!1),e()}),c("should fail on invalid WWW-Authenticate header format",function(e){var t={id:"123456",key:"werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn",algorithm:"sha256",user:"steve"},n='Hawk ts="1362346425875", tsm="hwayS28vtnn3qbv0mqRBYSXebN/zggEtucfeZ620Zo=", error="Stale timestamp"';u(s.client.authenticate({headers:{"www-authenticate":n}},t)).to.equal(!1),e()})})})})}})