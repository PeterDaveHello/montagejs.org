montageDefine("3142047","lib/util",{dependencies:["assert-plus","crypto","asn1","ctype"],factory:function(e,t,n){function u(e,t){var n=o.ruint32(e,"big",t);t+=4;var r=t+n;return{data:e.slice(t,r),offset:r}}function a(e,t){e.writeByte(2),e.writeLength(t.length);for(var n=0;n<t.length;n++)e.writeByte(t[n]);return e}function f(e){var t,n,r,i,o,f="",l=0,c,h;try{t=new Buffer(e.split(" ")[1],"base64"),h=u(t,l),c=h.data.toString(),l=h.offset;if(c!=="ssh-rsa")throw new Error("Invalid ssh key type: "+c);h=u(t,l),r=h.data,l=h.offset,h=u(t,l),o=h.data}catch(p){throw new Error("Invalid ssh key: "+e)}n=new s.BerWriter,n.startSequence(),n.startSequence(),n.writeOID("1.2.840.113549.1.1.1"),n.writeNull(),n.endSequence(),n.startSequence(3),n.writeByte(0),n.startSequence(),a(n,o),a(n,r),n.endSequence(),n.endSequence(),n.endSequence(),h=n.buffer.toString("base64");for(i=0;i<h.length;i++)i%64===0&&(f+="\n"),f+=h.charAt(i);return/\\n$/.test(f)||(f+="\n"),"-----BEGIN PUBLIC KEY-----"+f+"-----END PUBLIC KEY-----\n"}function l(e){var t,n=0,r,i,o="",f,l,c,h,p;try{t=new Buffer(e.split(" ")[1],"base64"),r=u(t,n),f=r.data.toString(),n=r.offset;if(!/^ssh-ds[as].*/.test(f))throw new Error("Invalid ssh key type: "+f);r=u(t,n),l=r.data,n=r.offset,r=u(t,n),c=r.data,n=r.offset,r=u(t,n),h=r.data,n=r.offset,r=u(t,n),p=r.data}catch(d){throw console.log(d.stack),new Error("Invalid ssh key: "+e)}i=new s.BerWriter,i.startSequence(),i.startSequence(),i.writeOID("1.2.840.10040.4.1"),i.startSequence(),a(i,l),a(i,c),a(i,h),i.endSequence(),i.endSequence(),i.startSequence(3),i.writeByte(0),a(i,p),i.endSequence(),i.endSequence(),r=i.buffer.toString("base64");for(var v=0;v<r.length;v++)v%64===0&&(o+="\n"),o+=r.charAt(v);return/\\n$/.test(o)||(o+="\n"),"-----BEGIN PUBLIC KEY-----"+o+"-----END PUBLIC KEY-----\n"}var r=e("assert-plus"),i=e("crypto"),s=e("asn1"),o=e("ctype");n.exports={sshKeyToPEM:function(t){r.string(t,"ssh_key");if(/^ssh-rsa.*/.test(t))return f(t);if(/^ssh-ds[as].*/.test(t))return l(t);throw new Error("Only RSA and DSA public keys are allowed")},fingerprint:function(t){r.string(t,"ssh_key");var n=t.split(" ");if(!n||!n.length||n.length<2)throw new Error("invalid ssh key");var s=new Buffer(n[1],"base64"),o=i.createHash("md5");o.update(s);var u=o.digest("hex"),a="";for(var f=0;f<u.length;f++)f&&f%2===0&&(a+=":"),a+=u[f];return a}}}})