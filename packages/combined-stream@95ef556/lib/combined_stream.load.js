montageDefine("95ef556","lib/combined_stream",{dependencies:["util","stream","delayed-stream"],factory:function(e,t,n){function o(){this.writable=!1,this.readable=!0,this.dataSize=0,this.maxDataSize=2097152,this.pauseStreams=!0,this._released=!1,this._streams=[],this._currentStream=null}var r=e("util"),i=e("stream").Stream,s=e("delayed-stream");n.exports=o,r.inherits(o,i),o.create=function(e){var t=new this;e=e||{};for(var n in e)t[n]=e[n];return t},o.isStreamLike=function(e){return typeof e!="function"&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"&&!Buffer.isBuffer(e)},o.prototype.append=function(e){var t=o.isStreamLike(e);return t&&(e instanceof s||(e.on("data",this._checkDataSize.bind(this)),e=s.create(e,{maxDataSize:Infinity,pauseStream:this.pauseStreams})),this._handleErrors(e),this.pauseStreams&&e.pause()),this._streams.push(e),this},o.prototype.pipe=function(e,t){i.prototype.pipe.call(this,e,t),this.resume()},o.prototype._getNext=function(){this._currentStream=null;var e=this._streams.shift();if(typeof e=="undefined"){this.end();return}if(typeof e!="function"){this._pipeNext(e);return}var t=e;t(function(e){var t=o.isStreamLike(e);t&&(e.on("data",this._checkDataSize.bind(this)),this._handleErrors(e)),this._pipeNext(e)}.bind(this))},o.prototype._pipeNext=function(e){this._currentStream=e;var t=o.isStreamLike(e);if(t){e.on("end",this._getNext.bind(this)),e.pipe(this,{end:!1});return}var n=e;this.write(n),this._getNext()},o.prototype._handleErrors=function(e){var t=this;e.on("error",function(e){t._emitError(e)})},o.prototype.write=function(e){this.emit("data",e)},o.prototype.pause=function(){if(!this.pauseStreams)return;this.emit("pause")},o.prototype.resume=function(){this._released||(this._released=!0,this.writable=!0,this._getNext()),this.emit("resume")},o.prototype.end=function(){this._reset(),this.emit("end")},o.prototype.destroy=function(){this._reset(),this.emit("close")},o.prototype._reset=function(){this.writable=!1,this._streams=[],this._currentStream=null},o.prototype._checkDataSize=function(){this._updateDataSize();if(this.dataSize<=this.maxDataSize)return;var e="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this._emitError(new Error(e))},o.prototype._updateDataSize=function(){this.dataSize=0;var e=this;this._streams.forEach(function(t){if(!t.dataSize)return;e.dataSize+=t.dataSize}),this._currentStream&&this._currentStream.dataSize&&(this.dataSize+=this._currentStream.dataSize)},o.prototype._emitError=function(e){this._reset(),this.emit("error",e)}}})