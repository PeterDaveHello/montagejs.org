var common=require("../common"),assert=common.assert,http=require("http"),fs=require("fs"),FormData=require(common.dir.lib+"/form_data"),IncomingForm=require("formidable").IncomingForm,options={filename:"test.png",contentType:"image/gif"},server=http.createServer(function(e,t){var n=new IncomingForm({uploadDir:common.dir.tmp});n.parse(e),n.on("file",function(e,t){assert.strictEqual(e,"my_file"),assert.strictEqual(t.name,options.filename),assert.strictEqual(t.type,options.contentType)}).on("end",function(){t.writeHead(200),t.end("done")})});server.listen(common.port,function(){var e=new FormData;e.append("my_file",fs.createReadStream(common.dir.fixture+"/unicycle.jpg"),options),e.submit("http://localhost:"+common.port+"/",function(e,t){if(e)throw e;assert.strictEqual(t.statusCode,200),server.close()})})