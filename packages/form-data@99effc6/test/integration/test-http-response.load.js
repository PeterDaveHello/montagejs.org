montageDefine("99effc6","test/integration/test-http-response",{dependencies:["../common","http","path","mime","request","url","fs","formidable"],factory:function(e,t,n){var r=e("../common"),i=r.assert,s=e("http"),o=e("path"),u=e("mime"),a=e("request"),f=e("url").parse,l=e("fs"),c=e(r.dir.lib+"/form_data"),h=e("formidable").IncomingForm,p="http://nodejs.org/images/logo.png",d,v,m=f(p),g={method:"get",port:m.port||80,path:m.pathname,host:m.hostname};s.request(g,function(e){d=[{name:"my_field",value:"my_value"},{name:"my_buffer",value:new Buffer([1,2,3])},{name:"remote_file",value:e}];var t=new c;d.forEach(function(e){t.append(e.name,e.value)}),v.listen(r.port,function(){t.submit("http://localhost:"+r.port+"/",function(e,t){if(e)throw e;i.strictEqual(t.statusCode,200),v.close()})})}).end(),v=s.createServer(function(e,t){var n=new h({uploadDir:r.dir.tmp});n.parse(e),n.on("field",function(e,t){var n=d.shift();i.strictEqual(e,n.name),i.strictEqual(t,n.value+"")}).on("file",function(e,t){var n=d.shift();i.strictEqual(e,n.name),i.strictEqual(t.name,o.basename(n.value.path||p)),i.strictEqual(t.type,u.lookup(t.name))}).on("end",function(){t.writeHead(200),t.end("done")})}),process.on("exit",function(){i.strictEqual(d.length,0)})}})