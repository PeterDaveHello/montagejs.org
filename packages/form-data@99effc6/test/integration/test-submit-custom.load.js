montageDefine("99effc6","test/integration/test-submit-custom",{dependencies:["../common","http","path","mime","request","fs","formidable"],factory:function(e,t,n){var r=e("../common"),i=r.assert,s=e("http"),o=e("path"),u=e("mime"),a=e("request"),f=e("fs"),l=e(r.dir.lib+"/form_data"),c=e("formidable").IncomingForm,h="http://nodejs.org/images/logo.png",p=[{name:"my_field",value:"my_value"},{name:"my_buffer",value:function(){return new Buffer([1,2,3])}},{name:"my_file",value:function(){return f.createReadStream(r.dir.fixture+"/unicycle.jpg")}},{name:"remote_file",value:function(){return a(h)}}],d=s.createServer(function(e,t){var n=new c({uploadDir:r.dir.tmp});n.parse(e),n.on("field",function(e,t){var n=p.shift();i.strictEqual(e,n.name),i.strictEqual(t,n.value+"")}).on("file",function(e,t){var n=p.shift();i.strictEqual(e,n.name),i.strictEqual(t.name,o.basename(n.value.path)),i.strictEqual(t.type,u.lookup(t.name))}).on("end",function(){t.writeHead(200),t.end("done")})});d.listen(r.port,function(){var e=new l;p.forEach(function(t){typeof t.value=="function"&&(t.value=t.value()),e.append(t.name,t.value)}),e.submit({port:r.port,path:"/"},function(e,t){if(e)throw e;i.strictEqual(t.statusCode,200),d.close()})}),process.on("exit",function(){i.strictEqual(p.length,0)})}})