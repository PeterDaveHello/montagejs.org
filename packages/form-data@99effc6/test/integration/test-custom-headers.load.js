montageDefine("99effc6","test/integration/test-custom-headers",{dependencies:["../common","http"],factory:function(e,t,n){var r=e("../common"),i=r.assert,s=e("http"),o=e(r.dir.lib+"/form_data"),u="\r\n",a="X-Test-Fake: 123",f,l=s.createServer(function(e,t){var n="";e.setEncoding("utf8"),e.on("data",function(e){n+=e}),e.on("end",function(){i.ok(n.indexOf(a)!=-1),i.ok(typeof e.headers["content-length"]!="undefined"),i.equal(e.headers["content-length"],f),t.writeHead(200),t.end("done")})});l.listen(r.port,function(){var e=new o,t={header:u+"--"+e.getBoundary()+u+a+u+u,knownLength:1},n=[];for(var s=0;s<1e3;s++)n.push(1);var c=new Buffer(n);e.append("my_buffer",c,t),f=e._lastBoundary().length+e._overheadLength+t.knownLength,e.submit("http://localhost:"+r.port+"/",function(e,t){if(e)throw e;i.strictEqual(t.statusCode,200),l.close()})})}})