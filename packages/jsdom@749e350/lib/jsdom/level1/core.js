var attachId=function(e,t,n){e&&t&&n&&(n._ids[e]||(n._ids[e]=[]),n._ids[e].push(t))},detachId=function(e,t,n){var r,i;if(e&&t&&n&&n._ids&&n._ids[e]){r=n._ids[e];for(i=0;i<r.length;i++)r[i]===t&&(r.splice(i,1),i--);r.length===0&&delete n._ids[e]}},core={mapper:function(e,t,n){return function(){return core.mapDOMNodes(e,n!==!1,t)}},mapDOMNodes:function(e,t,n){function r(e,t){return e.childNodes.reduce(i,t)}function i(e,i){return n(i)&&e.push(i),t&&i._childNodes&&r(i,e),e}return r(e,[])},visitTree:function(e,t){function r(e){if(e){t(e);if(e._childNodes){var n=0,i=e._childNodes,s=i.length;for(n;n<s;n++)r(i[n])}}}var n=e;r(e)},markTreeReadonly:function(e){function t(e){e._readonly=!0;if(e.attributes){var n=e.attributes,r=n.length,i=0;n._readonly=!0;for(i;i<r;i++)core.visitTree(n[i],t)}}core.visitTree(e,t)}},INDEX_SIZE_ERR=core.INDEX_SIZE_ERR=1,DOMSTRING_SIZE_ERR=core.DOMSTRING_SIZE_ERR=2,HIERARCHY_REQUEST_ERR=core.HIERARCHY_REQUEST_ERR=3,WRONG_DOCUMENT_ERR=core.WRONG_DOCUMENT_ERR=4,INVALID_CHARACTER_ERR=core.INVALID_CHARACTER_ERR=5,NO_DATA_ALLOWED_ERR=core.NO_DATA_ALLOWED_ERR=6,NO_MODIFICATION_ALLOWED_ERR=core.NO_MODIFICATION_ALLOWED_ERR=7,NOT_FOUND_ERR=core.NOT_FOUND_ERR=8,NOT_SUPPORTED_ERR=core.NOT_SUPPORTED_ERR=9,INUSE_ATTRIBUTE_ERR=core.INUSE_ATTRIBUTE_ERR=10,ELEMENT_NODE=1,ATTRIBUTE_NODE=2,TEXT_NODE=3,CDATA_SECTION_NODE=4,ENTITY_REFERENCE_NODE=5,ENTITY_NODE=6,PROCESSING_INSTRUCTION_NODE=7,COMMENT_NODE=8,DOCUMENT_NODE=9,DOCUMENT_TYPE_NODE=10,DOCUMENT_FRAGMENT_NODE=11,NOTATION_NODE=12,messages=core.exceptionMessages={};messages[INDEX_SIZE_ERR]="Index size error",messages[DOMSTRING_SIZE_ERR]="DOMString size error",messages[HIERARCHY_REQUEST_ERR]="Hierarchy request error",messages[WRONG_DOCUMENT_ERR]="Wrong document",messages[INVALID_CHARACTER_ERR]="Invalid character",messages[NO_DATA_ALLOWED_ERR]="No data allowed",messages[NO_MODIFICATION_ALLOWED_ERR]="No modification allowed",messages[NOT_FOUND_ERR]="Not found",messages[NOT_SUPPORTED_ERR]="Not supported",messages[INUSE_ATTRIBUTE_ERR]="Attribute in use",core.DOMException=function(e,t){this.code=e,Error.call(this,core.exceptionMessages[e]),this.message=core.exceptionMessages[e],t&&(this.message=this.message+": "+t),Error.captureStackTrace&&Error.captureStackTrace(this,core.DOMException)},core.DOMException.INDEX_SIZE_ERR=INDEX_SIZE_ERR,core.DOMException.DOMSTRING_SIZE_ERR=DOMSTRING_SIZE_ERR,core.DOMException.HIERARCHY_REQUEST_ERR=HIERARCHY_REQUEST_ERR,core.DOMException.WRONG_DOCUMENT_ERR=WRONG_DOCUMENT_ERR,core.DOMException.INVALID_CHARACTER_ERR=INVALID_CHARACTER_ERR,core.DOMException.NO_DATA_ALLOWED_ERR=NO_DATA_ALLOWED_ERR,core.DOMException.NO_MODIFICATION_ALLOWED_ERR=NO_MODIFICATION_ALLOWED_ERR,core.DOMException.NOT_FOUND_ERR=NOT_FOUND_ERR,core.DOMException.NOT_SUPPORTED_ERR=NOT_SUPPORTED_ERR,core.DOMException.INUSE_ATTRIBUTE_ERR=INUSE_ATTRIBUTE_ERR,core.DOMException.prototype={INDEX_SIZE_ERR:INDEX_SIZE_ERR,DOMSTRING_SIZE_ERR:DOMSTRING_SIZE_ERR,HIERARCHY_REQUEST_ERR:HIERARCHY_REQUEST_ERR,WRONG_DOCUMENT_ERR:WRONG_DOCUMENT_ERR,INVALID_CHARACTER_ERR:INVALID_CHARACTER_ERR,NO_DATA_ALLOWED_ERR:NO_DATA_ALLOWED_ERR,NO_MODIFICATION_ALLOWED_ERR:NO_MODIFICATION_ALLOWED_ERR,NOT_FOUND_ERR:NOT_FOUND_ERR,NOT_SUPPORTED_ERR:NOT_SUPPORTED_ERR,INUSE_ATTRIBUTE_ERR:INUSE_ATTRIBUTE_ERR},core.DOMException.prototype.__proto__=Error.prototype;var NodeArray=function(){};NodeArray.prototype=new Array,NodeArray.prototype.item=function(e){return this[e]},core.NodeList=function(t,n){if(!n){var r=new NodeArray;return Array.isArray(t)&&Array.prototype.push.apply(r,t),r}Object.defineProperties(this,{_element:{value:t},_query:{value:n},_snapshot:{writable:!0},_length:{value:0,writable:!0},_version:{value:-1,writable:!0}}),this.update()},core.NodeList.prototype={update:function(){var e;if(this._element&&this._version<this._element._version){for(e=0;e<this._length;e++)this[e]=undefined;var t=this._snapshot=this._query();this._length=t.length;for(e=0;e<t.length;e++)this[e]=t[e];this._version=this._element._version}return this._snapshot},toArray:function(){return this.update()||[]},get length(){return this.update(),this._length||0},item:function(e){return this.update(),this[e]||null},toString:function(){return"[ jsdom NodeList ]: contains "+this.length+" items"},indexOf:function(e){var t=this.update().length;for(var n=0;n<t;n++)if(this[n]==e)return n;return-1}},core.DOMImplementation=function(t,n){this._ownerDocument=t,this._features={};if(n)for(var r in n)n.hasOwnProperty(r)&&this.addFeature(r.toLowerCase(),n[r])},core.DOMImplementation.prototype={get ownerDocument(){return this._ownerDocument},removeFeature:function(e,t){e=e.toLowerCase();if(this._features[e])if(t){var n=0,r=this._features[e],i=r.length;for(n;n<i;n++)if(r[n]===t){r.splice(n,1);return}}else delete this._features[e]},addFeature:function(e,t){e=e.toLowerCase(),t&&(this._features[e]||(this._features[e]=[]),t instanceof Array?Array.prototype.push.apply(this._features[e],t):this._features[e].push(t))},hasFeature:function(e,t){e=e?e.toLowerCase():"";var n=this._features[e]?this._features[e]:!1;if(!t&&n.length&&n.length>0)return!0;if(typeof n=="string")return n===t;if(n.indexOf&&n.length>0){for(var r=0;r<n.length;r++){var i=n[r]instanceof RegExp?n[r].test(t):n[r]===t;if(i)return!0}return!1}return!1}};var attrCopy=function(e,t,n){if(e.attributes){var r=e.attributes,i,s=r.length,o,u;for(i=0;i<s;i++){o=r[i];if(!o.specified)continue;if(o.namespaceURI){t.setAttributeNS(o.namespaceURI,o.nodeName,o.nodeValue);var a=o.nodeName.split(":").pop();u=t.getAttributeNodeNS(o.namespaceURI,a)}else t.setAttribute(o.nodeName,o.nodeValue),u=t.getAttributeNode(o.nodeName);typeof n=="function"&&n(o,u)}}return t};core.Node=function(t){this._childNodes=new core.NodeList,this._ownerDocument=t,this._attributes=new core.AttrNodeMap(t,this),this._nodeName=null,this._childrenList=null,this._version=0,this._nodeValue=null,this._parentNode=null,this._nodeName=null,this._readonly=!1},core.Node.ELEMENT_NODE=ELEMENT_NODE,core.Node.ATTRIBUTE_NODE=ATTRIBUTE_NODE,core.Node.TEXT_NODE=TEXT_NODE,core.Node.CDATA_SECTION_NODE=CDATA_SECTION_NODE,core.Node.ENTITY_REFERENCE_NODE=ENTITY_REFERENCE_NODE,core.Node.ENTITY_NODE=ENTITY_NODE,core.Node.PROCESSING_INSTRUCTION_NODE=PROCESSING_INSTRUCTION_NODE,core.Node.COMMENT_NODE=COMMENT_NODE,core.Node.DOCUMENT_NODE=DOCUMENT_NODE,core.Node.DOCUMENT_TYPE_NODE=DOCUMENT_TYPE_NODE,core.Node.DOCUMENT_FRAGMENT_NODE=DOCUMENT_FRAGMENT_NODE,core.Node.NOTATION_NODE=NOTATION_NODE,core.Node.prototype={ELEMENT_NODE:ELEMENT_NODE,ATTRIBUTE_NODE:ATTRIBUTE_NODE,TEXT_NODE:TEXT_NODE,CDATA_SECTION_NODE:CDATA_SECTION_NODE,ENTITY_REFERENCE_NODE:ENTITY_REFERENCE_NODE,ENTITY_NODE:ENTITY_NODE,PROCESSING_INSTRUCTION_NODE:PROCESSING_INSTRUCTION_NODE,COMMENT_NODE:COMMENT_NODE,DOCUMENT_NODE:DOCUMENT_NODE,DOCUMENT_TYPE_NODE:DOCUMENT_TYPE_NODE,DOCUMENT_FRAGMENT_NODE:DOCUMENT_FRAGMENT_NODE,NOTATION_NODE:NOTATION_NODE,get children(){if(!this._childrenList){var e=this;this._childrenList=new core.NodeList(this,function(){return e._childNodes.filter(function(e){return e.tagName})})}return this._childrenList},get nodeValue(){return this._nodeValue},set nodeValue(e){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR,"Attempting to modify a read-only node");this._nodeValue=e},get parentNode(){return this._parentNode},get nodeName(){var e=this._nodeName||this._tagName;return this.nodeType===ELEMENT_NODE&&this._ownerDocument&&this._ownerDocument._doctype&&this._ownerDocument._doctype.name.toLowerCase().indexOf("html")!==-1?e.toUpperCase():e},set nodeName(){throw new core.DOMException},get attributes(){return this._attributes},get firstChild(){return this._childNodes.length>0?this._childNodes[0]:null},set firstChild(){throw new core.DOMException},get ownerDocument(){return this._ownerDocument},get readonly(){return this._readonly},get lastChild(){var e=this._childNodes.length;return e>0?this._childNodes[e-1]:null},set lastChild(){throw new core.DOMException},get childNodes(){return this._childNodes},set childNodes(){throw new core.DOMException},_indexOf:function(e){if(!this._childNodes||!this._childNodes.length)return-1;var t,n=0,r=this._childNodes;while(t=r[n]){if(t==e)break;n++}return t==e?n:-1},get nextSibling(){if(!this._parentNode||!this._parentNode._indexOf)return null;var e=this._parentNode._indexOf(this);return e==-1||e+1>=this._parentNode._childNodes.length?null:this._parentNode._childNodes[e+1]||null},set nextSibling(){throw new core.DOMException},get previousSibling(){if(!this._parentNode||!this._parentNode._indexOf)return null;var e=this._parentNode._indexOf(this);return e==-1||e-1<0?null:this._parentNode._childNodes[e-1]||null},set previousSibling(){throw new core.DOMException},insertBefore:function(e,t){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR,"Attempting to modify a read-only node");e._ownerDocument||(e._ownerDocument=this._ownerDocument);if(e._ownerDocument!==this._ownerDocument)throw new core.DOMException(WRONG_DOCUMENT_ERR);if(e.nodeType&&e.nodeType===ATTRIBUTE_NODE)throw new core.DOMException(HIERARCHY_REQUEST_ERR);var n=this;do if(n===e)throw new core.DOMException(HIERARCHY_REQUEST_ERR);while(n=n._parentNode);if(e.nodeType===DOCUMENT_FRAGMENT_NODE){var r;while(e._childNodes.length>0)r=e.removeChild(e.firstChild),this.insertBefore(r,t)}else{if(e===t)return e;e._parentNode&&e._parentNode.removeChild(e);if(t==null)var i=this._childNodes.length;else{var i=this._indexOf(t);if(i==-1)throw new core.DOMException(NOT_FOUND_ERR)}this._childNodes.splice(i,0,e),e._parentNode=this,this._attached&&e._attach&&e._attach(),this._modified()}return e},_modified:function(){this._version++,this._ownerDocument&&this._ownerDocument._version++,this._childrenList&&this._childrenList.update()},_attrModified:function(e,t,n){if(e=="id"&&this._attached){var r=this._ownerDocument;detachId(n,this,r),attachId(t,this,r)}},replaceChild:function(e,t){return this.insertBefore(e,t),this.removeChild(t)},_attach:function(){this._attached=!0,this.id&&attachId(this.id,this,this._ownerDocument);for(var e=0;e<this._childNodes.length;e++)this._childNodes[e]._attach&&this._childNodes[e]._attach()},_detach:function(){var e,t;this._attached=!1,this.id&&detachId(this.id,this,this._ownerDocument);for(var e=0;e<this._childNodes.length;e++)this._childNodes[e]._detach()},removeChild:function(e){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);var t=this._indexOf(e);if(t==-1)throw new core.DOMException(NOT_FOUND_ERR);return this._childNodes.splice(t,1),e._parentNode=null,this._modified(),e._detach(),e},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return this._childNodes.length>0},cloneNode:function(e,t){var n=null;switch(this.nodeType){case this.ELEMENT_NODE:n=attrCopy(this,this._ownerDocument.createElement(this.tagName),t);break;case this.TEXT_NODE:n=attrCopy(this,this._ownerDocument.createTextNode(this.tagName)),n.nodeValue=this.nodeValue;break;case this.CDATA_SECTION_NODE:n=this._ownerDocument.createCDATASection(this.tagName),n.nodeValue=this.nodeValue;break;case this.ENTITY_REFERENCE_NODE:var r=this._entity?this._entity.name:this._entityName,i=this._ownerDocument.createEntityReference(r);n=attrCopy(this,i),n.nodeValue=this.nodeValue;break;case this.ATTRIBUTE_NODE:n=this._ownerDocument.createAttribute(this.name);break;case this.ENTITY_NODE:var s=this._ownerDocument.createEntityNode(this.name);n=attrCopy(this,s),n.nodeValue=this.nodeValue,n._publicId=this._publicId,n._systemId=this._systemId,n._notationName=this.notationName;break;case this.PROCESSING_INSTRUCTION_NODE:var o=this._ownerDocument.createProcessingInstruction(this._target,this._data);n=attrCopy(this,o),n.nodeValue=this.nodeValue;break;case this.COMMENT_NODE:n=this._ownerDocument.createComment(this.tagName),n.nodeValue=this.nodeValue;break;case this.DOCUMENT_NODE:n=attrCopy(this,new core.Document);break;case this.DOCUMENT_TYPE_NODE:n=attrCopy(this,new core.DocumentType),n.nodeValue=this.nodeValue;break;case this.DOCUMENT_FRAGMENT_NODE:n=this._ownerDocument.createDocumentFragment();break;case this.NOTATION_NODE:n=this._ownerDocument.createNotationNode(this._name,this._publicId,this._systemId),n=attrCopy(this,n),n.nodeValue=this.nodeValue;break;default:throw new core.DOMException(NOT_FOUND_ERR)}typeof t=="function"&&t(this,n);if(e||this.nodeType===ATTRIBUTE_NODE){var u=null;for(var a=0,f=this._childNodes.length;a<f;a++){u=this._childNodes[a].cloneNode(!0);if(u.nodeType===ATTRIBUTE_NODE)n.setAttributeNode(u);else{var l=n._readonly;n._readonly=!1,n.appendChild(u),n._readonly=l}}}return n},normalize:function(){var e,t,n,r;if(this._attributes&&this._attributes.length)for(r=0;r<this._attributes.length;r++)this._attributes.item(r)&&(n=this._attributes.item(r).normalize());for(r=0;r<this._childNodes.length;r++){t=this._childNodes[r],t.normalize&&t.normalize();if(t.nodeValue===""){this.removeChild(t),r--;continue}r>0&&(e=this._childNodes[r-1],t.nodeType===TEXT_NODE&&e.nodeType===TEXT_NODE&&(e.appendData(t.nodeValue),this.removeChild(t),r--))}},toString:function(){var e="";this.id&&(e="#"+this.id);if(this.className){var t=this.className.split(/\s+/);for(var n=0,r=t.length;n<r;n++)e+="."+t[n]}return"[ "+this.tagName+e+" ]"},raise:function(e,t,n){var r=e+": "+t;n&&(n.exception?r=n.exception.stack:r+=" - More:\n"+n);if(e==="error"){this.errors||(this.errors=[]);var i={type:e,message:t||"No message",data:n||null};this.errors.push(i),this._ownerDocument&&this._ownerDocument.raise&&this!==this._ownerDocument&&this._ownerDocument.raise(e,t,n)}}},core.NamedNodeMap=function(t){this._nodes={},this._nsStore={},this.length=0,this._ownerDocument=t,this._readonly=!1},core.NamedNodeMap.prototype={get readonly(){return this._readonly},get ownerDocument(){this._ownerDocument},exists:function(e){return this._nodes[e]||this._nodes[e]===null?!0:!1},getNamedItem:function(e){return this._nodes[e]||null},setNamedItem:function(e){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);if(e&&e._ownerDocument!==this._ownerDocument)throw new core.DOMException(WRONG_DOCUMENT_ERR);if(e&&e._ownerElement)throw new core.DOMException(INUSE_ATTRIBUTE_ERR);var t=e.name||e.tagName,n=this._nodes[t];return n||(this.length++,n=null),e._specified=!0,this[t]=this._nodes[t]=e,n},removeNamedItem:function(e){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);if(!this._nodes.hasOwnProperty(e))throw new core.DOMException(NOT_FOUND_ERR);var t=this._nodes[e]||null;return delete this._nodes[e],delete this[e],this.length--,t},item:function(e){var t=0;for(var n in this._nodes)if(this._nodes.hasOwnProperty(n)){if(t===e&&this._nodes[n])return this._nodes[n];t++}return null}},core.AttrNodeMap=function(t,n){core.NamedNodeMap.call(this,t),this._parentNode=n},core.AttrNodeMap.prototype={get parentNode(){return this._parentNode},setNamedItem:function(e){var t=core.NamedNodeMap.prototype.setNamedItem.call(this,e),n=this._parentNode;return e._ownerElement=n,n._attrModified(e.name,e.value,t&&t.value||null),n._modified(),t},removeNamedItem:function(e){var t=core.NamedNodeMap.prototype.removeNamedItem.call(this,e),n=this._parentNode;t._ownerElement=null,n._attrModified(e),n._modified();var r=this._ownerDocument;if(r&&r._doctype&&r._doctype.name.toLowerCase()!=="html"){var i=!1,s=r._doctype._attributes.getNamedItem(this._parentNode.nodeName);if(s){var i=s.attributes.getNamedItem(e);if(i){var o=r.createAttribute(e);o.value=i.value,o._specified=!1,this._nodes[e]=o,this.length++}}}return t}},core.AttrNodeMap.prototype.__proto__=core.NamedNodeMap.prototype,core.NotationNodeMap=function(t){core.NamedNodeMap.call(this,t),this._readonly=!1;for(var n=1;n<arguments.length;n++)this.setNamedItem(arguments[n]);this._readonly=!0},core.NotationNodeMap.prototype={},core.NotationNodeMap.prototype.__proto__=core.NamedNodeMap.prototype,core.EntityNodeMap=function(t){core.NamedNodeMap.call(this,t),this._readonly=!1;var n=1,r=arguments.length;for(n=1;n<r;n++)this.setNamedItem(arguments[n]);core.markTreeReadonly(this)},core.EntityNodeMap.prototype={},core.EntityNodeMap.prototype.__proto__=core.NamedNodeMap.prototype,core.Element=function(t,n){this._ownerDocument=t,core.Node.call(this,t),this._nodeName=n,this._tagName=n},core.Element.prototype={get nodeValue(){return null},set nodeValue(e){},get tagName(){return this.nodeType===ELEMENT_NODE&&this._ownerDocument&&this._ownerDocument._doctype&&this._ownerDocument._doctype.name.toLowerCase().indexOf("html")!==-1?this.nodeName.toUpperCase():this.nodeName},nodeType:ELEMENT_NODE,get attributes(){for(var e=0;e<this._attributes.length;e++)this._attributes[e]=this._attributes.item(e);return this._attributes},getAttribute:function(e){var t=this._attributes.getNamedItem(e);return t?t.value:""},setAttribute:function(e,t){if(e.length>2&&e[0]=="o"&&e[1]=="n"){var n=this;n[e]=function(){n.run!=undefined?n.run(t):(n._ownerDocument.parentWindow.__tempContextForInlineEventHandler=n,n._ownerDocument.parentWindow.run("(function () {"+t+"}).call(window.__tempContextForInlineEventHandler);"),delete n.ownerDocument.parentWindow.__tempContextForInlineEventHandler)}}if(this._ownerDocument){var r=this._ownerDocument.createAttribute(e);r.value=t,this._attributes.setNamedItem(r)}},removeAttribute:function(e){if(!this._attributes.exists(e))return;this._attributes.removeNamedItem(e)},getAttributeNode:function(e){return this._attributes.getNamedItem(e)},setAttributeNode:function(e){var t=this._attributes.getNamedItem(e.name);return t&&(t._ownerElement=null),this._attributes.setNamedItem(e),t&&t.specified?t:null},removeAttributeNode:function(e){var t=this._attributes.getNamedItem(e.name);if(this._attributes&&t===e)return this._attributes.removeNamedItem(e.name),e;throw new core.DOMException(NOT_FOUND_ERR)},getElementsByTagName:function(e){function t(t){return t=t.nodeType===ENTITY_REFERENCE_NODE?t._entity:t,t.nodeName&&t.nodeType===ELEMENT_NODE?e==="*"||t.nodeName.toLowerCase()===e:!1}return e=e.toLowerCase(),new core.NodeList(this._ownerDocument||this,core.mapper(this,t,!0))}},core.Element.prototype.__proto__=core.Node.prototype,core.DocumentFragment=function(t){core.Node.call(this,t),this._nodeName=this._tagName="#document-fragment"},core.DocumentFragment.prototype={nodeType:DOCUMENT_FRAGMENT_NODE,get nodeValue(){return null},set nodeValue(){},get attributes(){return null}},core.DocumentFragment.prototype.__proto__=core.Node.prototype,core.ProcessingInstruction=function(t,n,r){this._ownerDocument=t,core.Node.call(this,t),this._nodeName=n,this._tagName=n,this._target=n,this._nodeValue=r},core.ProcessingInstruction.prototype={nodeType:PROCESSING_INSTRUCTION_NODE,get target(){return this._target},set target(e){throw new core.DOMException(1)},get nodeValue(){return this._nodeValue},set nodeValue(e){this._nodeValue=e},get data(){return this._nodeValue},set data(){throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR)},get attributes(){return null}},core.ProcessingInstruction.prototype.__proto__=core.Node.prototype,core.Document=function(t){t?typeof t=="string"&&(t={name:t}):t={},core.Node.call(this,"#document"),this._nodeName=this._tagName="#document",this._contentType=t.contentType||"text/xml",this._doctype=t._doctype,this._implementation=t.implementation||new core.DOMImplementation,this._documentElement=null,this._ids={},this._attached=!0,this._ownerDocument=this,this._readonly=!1};var tagRegEx=/[^\w:\d_\.-]+/i,entRegEx=/[^\w\d_\-&;]+/,invalidAttrRegEx=/[^\w:\d_\.-]+/;core.Document.prototype={nodeType:DOCUMENT_NODE,_elementBuilders:{canvas:function(e,t){var n=new core.Element(e,t),r;try{r=new(require("canvas"))(0,0);for(var i in n)r[i]||(r[i]=n[i]);return r}catch(s){return n}}},_defaultElementBuilder:function(e,t){return new core.Element(e,t)},get contentType(){return this._contentType},get doctype(){return this._doctype||null},set doctype(e){this._doctype=e},get documentElement(){if(this._documentElement)return this._documentElement;var e=this._childNodes,t=this._childNodes.length,n=0;for(n;n<t;n++)if(e[n].nodeType===ELEMENT_NODE)return this._documentElement=e[n],e[n];return null},get implementation(){return this._implementation},set implementation(e){this._implementation=e},get nodeName(){return"#document"},get tagName(){return null},get nodeValue(){return null},set nodeValue(){},get attributes(){return null},get ownerDocument(){return null},get readonly(){return this._readonly},createElement:function(e){var t=[],n=e.toLowerCase(),r;if(!e||!e.match||(t=e.match(tagRegEx)))throw new core.DOMException(INVALID_CHARACTER_ERR,"Invalid character in tag name: "+t.pop());r=(this._elementBuilders[n]||this._defaultElementBuilder)(this,e);if(this._doctype&&this._doctype._attributes&&this._doctype.name.toLowerCase()!=="html"){var i=this._doctype._attributes.getNamedItem(e);if(i&&i._childNodes){attrs=i.attributes;var s,o=attrs.length,u;for(var a=0;a<o;a++)u=attrs.item(a),u&&(s=this.createAttribute(u.name),s.value=u.value,r.setAttributeNode(s),s._specified=!1)}}return r._created=!0,r},createDocumentFragment:function(){return new core.DocumentFragment(this)},createTextNode:function(e){return new core.Text(this,e)},createComment:function(e){return new core.Comment(this,e)},createCDATASection:function(e){if(this._doctype&&this._doctype.name==="html")throw new core.DOMException(NOT_SUPPORTED_ERR);return new core.CDATASection(this,e)},createProcessingInstruction:function(e,t){if(this._doctype&&this._doctype.name==="html")throw new core.DOMException(NOT_SUPPORTED_ERR);if(e.match(tagRegEx)||!e||!e.length)throw new core.DOMException(INVALID_CHARACTER_ERR);return new core.ProcessingInstruction(this,e,t)},createAttribute:function(e){if(!e||!e.length||e.match(invalidAttrRegEx))throw new core.DOMException(INVALID_CHARACTER_ERR,"attribute name: "+e);return new core.Attr(this,e,!1)},createEntityReference:function(e){if(this._doctype&&this._doctype.name==="html")throw new core.DOMException(NOT_SUPPORTED_ERR);e=e.replace(/[&;]/g,"");if(!e||!e.length)throw new core.DOMException(INVALID_CHARACTER_ERR);if(e.match(tagRegEx))throw new core.DOMException(INVALID_CHARACTER_ERR);var t;this._doctype&&this._doctype.entities?t=this._doctype.entities.getNamedItem(e):t=null;var n=new core.EntityReference(this,t);return n._entityName=e,n},createEntityNode:function(e){if(e.match(entRegEx)||!e||!e.length)throw new core.DOMException(INVALID_CHARACTER_ERR);var t=new core.Entity(this,e);t._readonly=!1;for(var n=1;n<arguments.length;n++)t.appendChild(arguments[n]);return core.markTreeReadonly(t),t},createNotationNode:function(e,t,n){if(e.match(entRegEx)||!e||!e.length)throw new core.DOMException(INVALID_CHARACTER_ERR);var r=new core.Notation(this,e,t,n);r._readonly=!1;for(var i=3;i<arguments.length;i++)r.appendChild(arguments[i]);return core.markTreeReadonly(r),r},appendChild:function(e){if(this.documentElement&&e.nodeType==ELEMENT_NODE)throw new core.DOMException(HIERARCHY_REQUEST_ERR);return core.Node.prototype.appendChild.call(this,e)},removeChild:function(e){var t=core.Node.prototype.removeChild.call(this,e);return e==this._documentElement&&(this._documentElement=null),t},getElementsByTagName:function(e){function t(t){t.nodeType&&t.nodeType===ENTITY_REFERENCE_NODE&&(t=t._entity);if(t.nodeName&&t.nodeType===ELEMENT_NODE){if(e==="*")return!0;if(t._ownerDocument&&t._ownerDocument._doctype&&t.nodeName.toLowerCase()===e.toLowerCase())return!0;if(t.nodeName.toLowerCase()===e.toLowerCase())return!0}return!1}return new core.NodeList(this.documentElement||this,core.mapper(this,t,!0))}},core.Document.prototype.__proto__=core.Node.prototype,core.CharacterData=function(t,n){core.Node.call(this,t),this._nodeValue=n+""},core.CharacterData.prototype={get data(){return this._nodeValue},set data(e){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);this._nodeValue=e},get length(){return this._nodeValue.length||0},substringData:function(e,t){if(t<0||e<0||e>this._nodeValue.length)throw new core.DOMException(INDEX_SIZE_ERR);return this._nodeValue.length<e+t?this._nodeValue.substring(e):this._nodeValue.substring(e,e+t)},appendData:function(e){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);return this._nodeValue+=e,this._nodeValue},insertData:function(e,t){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);if(e<0||e>this._nodeValue.length)throw new core.DOMException(INDEX_SIZE_ERR);var n=this._nodeValue.substring(0,e),r=this._nodeValue.substring(e);this._nodeValue=n+t+r},deleteData:function(e,t){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);if(e<0||e>this._nodeValue.length||t<0)throw new core.DOMException(INDEX_SIZE_ERR);var n=this._nodeValue.substring(0,e);this._nodeValue=e+t<this._nodeValue.length?n+this._nodeValue.substring(e+t):n},replaceData:function(e,t,n){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);t=e+t>this._nodeValue.length?this.nodeValue.length-e:t;if(e<0||e>this._nodeValue.length||t<0)throw new core.DOMException(INDEX_SIZE_ERR);var r=this._nodeValue.substring(0,e),i=this._nodeValue.substring(e+t);this._nodeValue=r+n+i}},core.CharacterData.prototype.__proto__=core.Node.prototype,core.Attr=function(t,n,r){core.Node.call(this,t),this._nodeValue=r,this._name=n,this._specified=r?!0:!1,this._tagName=n,this._nodeName=n},core.Attr.prototype={nodeType:ATTRIBUTE_NODE,get nodeValue(){var e="";for(var t=0,n=this._childNodes.length;t<n;t++){var r=this._childNodes[t];r.nodeType===ENTITY_REFERENCE_NODE?e+=r.childNodes.reduce(function(e,t){return e+=t.nodeValue||t},""):e+=r.nodeValue}return e},set nodeValue(e){if(this._readonly)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);this._childNodes.length=0,this._childNodes.push(this._ownerDocument.createTextNode(e)),this._modified(),this._specified=!0;var t=this._nodeValue;this._nodeValue=e,this._ownerElement&&this._ownerElement._attrModified(this._name,e,t)},get name(){return this._name},get specified(){return this._specified},get value(){return this.nodeValue},set value(e){this.nodeValue=e},get parentNode(){return null},get attributes(){return null},insertBefore:function(e,t){if(e.nodeType===CDATA_SECTION_NODE||e.nodeType===ELEMENT_NODE)throw new core.DOMException(HIERARCHY_REQUEST_ERR);return core.Node.prototype.insertBefore.call(this,e,t)},appendChild:function(e){if(e.nodeType===CDATA_SECTION_NODE||e.nodeType===ELEMENT_NODE)throw new core.DOMException(HIERARCHY_REQUEST_ERR);return core.Node.prototype.appendChild.call(this,e)}},core.Attr.prototype.__proto__=core.Node.prototype,core.Text=function(t,n,r){core.CharacterData.call(this,t,n),this._nodeName="#text",this._readonly=r?!0:!1},core.Text.prototype={nodeType:TEXT_NODE,get attributes(){return null},splitText:function(e){if(this._readonly)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);if(e<0||e>this._nodeValue.length)throw new core.DOMException(INDEX_SIZE_ERR);var t=this._nodeValue.substring(e);this._nodeValue=this._nodeValue.substring(0,e);var n=this._ownerDocument.createTextNode(t);return this._parentNode.lastChild===this?this._parentNode.appendChild(n):this._parentNode.insertBefore(n,this.nextSibling),n},toString:function(){return this.nodeName}},core.Text.prototype.__proto__=core.CharacterData.prototype,core.Comment=function(t,n){core.Text.call(this,t,n),this._nodeName="#comment",this._tagName="#comment"},core.Comment.prototype={nodeType:COMMENT_NODE},core.Comment.prototype.__proto__=core.Text.prototype,core.CDATASection=function(t,n){core.Text.call(this,t,n),this._nodeName="#cdata-section"},core.CDATASection.prototype={nodeType:CDATA_SECTION_NODE},core.CDATASection.prototype.__proto__=core.Text.prototype,core.DocumentType=function(t,n,r,i,s){core.Node.call(this,t),this._name=n,this._tagName=n,this._nodeName=n,this._entities=r||new core.EntityNodeMap(t),this._notations=i||new core.NotationNodeMap(t),core.markTreeReadonly(this._notations),this._attributes=s||new core.AttrNodeMap(t)},core.DocumentType.prototype={nodeType:DOCUMENT_TYPE_NODE,get nodeValue(){return null},set nodeValue(){},get name(){return this._name},get entities(){return this._entities},get notations(){return this._notations},get attributes(){return null}},core.DocumentType.prototype.__proto__=core.Node.prototype,core.Notation=function(t,n,r,i){core.Node.call(this,t),this._name=n,this._nodeName=n,this._publicId=r||null,this._systemId=i||null,this._nodeValue=null},core.Notation.prototype={nodeType:NOTATION_NODE,get publicId(){return this._publicId},get systemId(){return this._systemId},get name(){return this._name||this._nodeName},get attributes(){return null},set nodeValue(){},get nodeValue(){return this._nodeValue}},core.Notation.prototype.__proto__=core.Node.prototype,core.Entity=function(t,n){core.Node.call(this,t),this._name=n,this._nodeName=n,this._tagName=n,this._publicId=null,this._systemId=null,this._notationName=null,this._readonly=!0},core.Entity.prototype={nodeType:ENTITY_NODE,get nodeValue(){return null},set nodeValue(){this._readonly===!0},get name(){return this._name},get publicId(){return this._publicId},get systemId(){return this._systemId},set publicId(e){this._publicId=e},set systemId(e){this._systemId=e},set notationName(e){this._notationName=e},get notationName(){return this._notationName},get attributes(){return null}},core.Entity.prototype.__proto__=core.Node.prototype,core.EntityReference=function(t,n){core.Node.call(this,t),this._entity=n,this._nodeName=n?n.name:null,this._readonly=!0},core.EntityReference.prototype={nodeType:ENTITY_REFERENCE_NODE,get nodeValue(){return this._entity?this._entity.nodeValue:null},set nodeValue(){this._readonly===!0},get attributes(){return null},get nodeName(){return this._entityName},get firstChild(){return this._entity.firstChild||null},get childNodes(){return this._entity.childNodes},get lastChild(){return this._entity.lastChild||null}},core.EntityReference.prototype.__proto__=core.Node.prototype,exports.dom={level1:{core:core}}