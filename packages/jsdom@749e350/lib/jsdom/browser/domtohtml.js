function stringifyDoctype(e){if(e.ownerDocument&&e.ownerDocument._fullDT)return e.ownerDocument._fullDT;var t="<!DOCTYPE "+e.name;return e.publicId&&(t+=' PUBLIC "'+e.publicId+'" '),!e.publicId&&e.systemId&&(t+=" SYSTEM "),e.systemId&&(e.systemId.indexOf('"')>-1?t+="'"+e.systemId+"'":t+='"'+e.systemId+'"'),t+=">",t}var singleTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1},expr={upperCaseChars:/([A-Z])/g,breakBetweenTags:/(<(\/?\w+).*?>)(?=<(?!\/\2))/gi,singleTag:function(){var e=[];for(var t in singleTags)e.push(t);return new RegExp("<"+e.join("|<"),"i")}()},uncanon=function(e,t){return"-"+t.toLowerCase()},HTMLEncode=require("./htmlencoding").HTMLEncode;exports.stringifyElement=function(t){var n=t.tagName.toLowerCase(),r={start:"<"+n,end:""},i=[],s,o=null;if(t.attributes.length){r.start+=" ";for(s=0;s<t.attributes.length;s++)o=t.attributes.item(s),i.push(o.name+'="'+HTMLEncode(o.nodeValue,!0)+'"')}return r.start+=i.join(" "),singleTags[n]?(r.start+=" />",r.end=""):(r.start+=">",r.end="</"+n+">"),r};var rawTextElements=/SCRIPT|STYLE/i;exports.makeHtmlGenerator=function(t,n){return t=t||"",n=n||"",function r(e,i,s){var o="",u,a,f;s=s||"";if(e){e.nodeType&&e.nodeType===e.ENTITY_REFERENCE_NODE&&(e=e._entity);var l=i||rawTextElements.test(e.nodeName);switch(e.nodeType){case e.ELEMENT_NODE:a=exports.stringifyElement(e),l?o+=s+a.start:o+=s+a.start;if(e._childNodes.length>0){e._childNodes[0].nodeType!==e.TEXT_NODE&&(o+=n);for(f=0;f<e._childNodes.length;f++)o+=r(e._childNodes[f],l,s+t);e._childNodes[e._childNodes.length-1].nodeType!==e.TEXT_NODE&&(o+=s),o+=a.end+n}else o+=((i?e.nodeValue:HTMLEncode(e.nodeValue,!1))||"")+a.end+n;break;case e.TEXT_NODE:if(!t||!/^[\s\n]*$/.test(e.nodeValue))o+=(i?e.nodeValue:HTMLEncode(e.nodeValue,!1))||"";break;case e.COMMENT_NODE:o+=s+"<!--"+e.nodeValue+"-->"+n;break;case e.DOCUMENT_NODE:for(f=0;f<e._childNodes.length;f++)o+=r(e._childNodes[f],l,s);break;case e.DOCUMENT_TYPE_NODE:o+=stringifyDoctype(e)}}return o}},exports.domToHtml=function(e,t,n){var r=exports.makeHtmlGenerator(t?"":"  ",t?"":"\n");e.toArray&&(e=e.toArray());if(typeof e.length!="undefined"){var i="";for(var s=0,o=e.length;s<o;s++)i+=r(e[s],n);return i}return r(e,n)}