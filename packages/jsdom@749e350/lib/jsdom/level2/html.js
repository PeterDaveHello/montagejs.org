function define(e,t){var n=t.tagName,r=t.tagNames||(n?[n]:[]),i=t.parentClass||core.HTMLElement,s=t.attributes||[],o=t.proto||{},u=core[e]=function(e,t){i.call(this,e,t||n.toUpperCase()),u._init&&u._init.call(this)};u._init=t.init,u.prototype=o,u.prototype.__proto__=i.prototype,s.forEach(function(e){var t=e.prop||e,n=e.attr||t.toLowerCase();(!e.prop||e.read!==!1)&&u.prototype.__defineGetter__(t,function(){var t=this.getAttribute(n);return e.type&&e.type==="boolean"?!!t:e.type&&e.type==="long"?+t:typeof e=="object"&&e.normalize?e.normalize(t):t}),(!e.prop||e.write!==!1)&&u.prototype.__defineSetter__(t,function(t){if(!t)this.removeAttribute(n);else{var r=t.toString();e.normalize&&(r=e.normalize(r)),this.setAttribute(n,r)}})}),r.forEach(function(e){core.Document.prototype._elementBuilders[e.toLowerCase()]=function(e,t){var n=new u(e,t);return n}})}function closest(e,t){t=t.toUpperCase();while(e){if(e.nodeName.toUpperCase()===t||e.tagName&&e.tagName.toUpperCase()===t)return e;e=e._parentNode}return null}function descendants(e,t,n){var r=n?e._ownerDocument||e:e;return new core.HTMLCollection(r,core.mapper(e,function(e){return e.nodeName===t&&typeof e._publicId=="undefined"},n))}function firstChild(e,t){if(!e)return null;var n=descendants(e,t,!1);return n.length>0?n[0]:null}function ResourceQueue(e){this.paused=!!e}function loadFrame(e){e._contentDocument&&(e._contentDocument._parentWindow?e._contentDocument.parentWindow.close():delete e._contentDocument);var t=e.src,n=e._ownerDocument,r=core.resourceLoader.resolve(n,t),i=e._contentDocument=new core.HTMLDocument({url:r,documentRoot:Path.dirname(r)});applyDocumentFeatures(i,n.implementation._features);var s=n.parentWindow,o=i.parentWindow;o.parent=s,o.top=s.top,core.resourceLoader.load(e,r,function(e,t){i.write(e),i.close()})}var core=require("./core").dom.level2.core,events=require("./core").dom.level2.events,applyDocumentFeatures=require("../browser/documentfeatures").applyDocumentFeatures,URL=require("url"),Path=require("path"),fs=require("fs"),http=require("http"),https=require("https");core=Object.create(core),core.languageProcessors={javascript:require("./languages/javascript").javascript},core.resourceLoader={load:function(e,t,n){var r=e._ownerDocument.implementation;if(r.hasFeature("FetchExternalResources",e.tagName.toLowerCase())){var i=this.resolve(e._ownerDocument,t),s=URL.parse(i);if(r.hasFeature("SkipExternalResources",i))return!1;s.hostname?this.download(s,this.baseUrl(e._ownerDocument),this.enqueue(e,n,i)):this.readFile(s.pathname,this.enqueue(e,n,i))}},enqueue:function(e,t,n){var r=this,i=e.nodeType===core.Node.DOCUMENT_NODE?e:e._ownerDocument;return i._queue?i._queue.push(function(r,s){var o=i.createEvent("HTMLEvents");if(!r)try{t.call(e,s,n||i.URL),o.initEvent("load",!1,!1)}catch(u){r=u}r&&(o.initEvent("error",!1,!1),o.error=r),e.dispatchEvent(o)}):function(){}},baseUrl:function(e){var t=e.getElementsByTagName("base"),n=e.URL;return t.length>0&&(n=t.item(0).href||n),n},resolve:function(e,t){if(t.match(/^\w+:\/\//))return t;var n=this.baseUrl(e);return t.match(/^\/\//)?n?n.match(/^(\w+:)\/\//)[1]+t:null:(t.match(/^\/[^\/]/)||(t=t.replace(/^\//,"")),URL.resolve(n,t))},download:function(e,t,n){var r=e.pathname+(e.search||""),i={method:"GET",host:e.hostname,path:r},s;e.protocol==="https:"?(i.port=e.port||443,s=https.request(i)):(i.port=e.port||80,s=http.request(i)),t&&s.setHeader("Referer",t),s.on("response",function(r){function s(){if([301,302,303,307].indexOf(r.statusCode)>-1){var s=URL.resolve(e,r.headers.location);core.resourceLoader.download(URL.parse(s),t,n)}else n(null,i)}var i="";r.setEncoding("utf8"),r.on("data",function(e){i+=e.toString()}),r.on("end",function(){r.removeAllListeners("close"),s()}),r.on("close",function(e){e?n(e):s()})}),s.on("error",n),s.end()},readFile:function(e,t){fs.readFile(e.replace(/^file:\/\//,"").replace(/^\/([a-z]):\//i,"$1:/"),"utf8",t)}},core.HTMLCollection=function(t,n){core.NodeList.call(this,t,n)},core.HTMLCollection.prototype={namedItem:function(e){var t=this.toArray(),n=t.length,r,i=null;for(var s=0;s<n;s++){r=t[s];if(r.getAttribute("id")===e)return r;r.getAttribute("name")===e&&(i=r)}return i},toString:function(){return"[ jsdom HTMLCollection ]: contains "+this.length+" items"}},core.HTMLCollection.prototype.__proto__=core.NodeList.prototype,core.HTMLOptionsCollection=core.HTMLCollection,ResourceQueue.prototype={push:function(e){var t=this,n={prev:t.tail,check:function(){!t.paused&&!this.prev&&this.fired&&(e(this.err,this.data),this.next?(this.next.prev=null,this.next.check()):t.tail=null)}};return t.tail&&(t.tail.next=n),t.tail=n,function(e,t){n.fired=1,n.err=e,n.data=t,n.check()}},resume:function(){if(!this.paused)return;this.paused=!1;var e=this.tail;while(e&&e.prev)e=e.prev;e&&e.check()}},core.HTMLDocument=function(t){t=t||{},t.contentType||(t.contentType="text/html"),core.Document.call(this,t),this._referrer=t.referrer,this._cookie=t.cookie,this._URL=t.url||"/",this._documentRoot=t.documentRoot||Path.dirname(this._URL),this._queue=new ResourceQueue(t.deferClose),this.readyState="loading",this.implementation.addFeature("core","2.0"),this.implementation.addFeature("html","2.0"),this.implementation.addFeature("xhtml","2.0"),this.implementation.addFeature("xml","2.0")},core.HTMLDocument.prototype={_referrer:"",get referrer(){return this._referrer||""},get domain(){return""},_URL:"",get URL(){return this._URL},get images(){return this.getElementsByTagName("IMG")},get applets(){return new core.HTMLCollection(this,core.mapper(this,function(e){if(e&&e.tagName){var t=e.tagName.toUpperCase();if(t==="APPLET")return!0;if(t==="OBJECT"&&e.getElementsByTagName("APPLET").length>0)return!0}}))},get links(){return new core.HTMLCollection(this,core.mapper(this,function(e){if(e&&e.tagName){var t=e.tagName.toUpperCase();if(t==="AREA"||t==="A"&&e.href)return!0}}))},get forms(){return this.getElementsByTagName("FORM")},get anchors(){return this.getElementsByTagName("A")},open:function(){this._childNodes=[],this._documentElement=null,this._modified()},close:function(){this._queue.resume(),core.resourceLoader.enqueue(this,function(){this.readyState="complete";var e=this.createEvent("HTMLEvents");e.initEvent("DOMContentLoaded",!1,!1),this.dispatchEvent(e)})(null,!0)},write:function(e){if(this.readyState==="loading"){var t=this;while(t.lastChild&&t.lastChild.nodeType===this.ELEMENT_NODE)t=t.lastChild;t.innerHTML=e}else this.innerHTML=e},writeln:function(e){this.write(e+"\n")},getElementsByName:function(e){return new core.HTMLCollection(this,core.mapper(this,function(t){return t.getAttribute&&t.getAttribute("name")===e}))},get title(){var e=this.head,t=e?firstChild(e,"TITLE"):null;return t?t.textContent:""},set title(e){var t=firstChild(this.head,"TITLE");if(!t){t=this.createElement("TITLE");var n=this.head;n||(n=this.createElement("HEAD"),this.documentElement.insertBefore(n,this.documentElement.firstChild)),n.appendChild(t)}t.textContent=e},get head(){return firstChild(this.documentElement,"HEAD")},set head(){},get body(){var e=firstChild(this.documentElement,"BODY");return e||(e=firstChild(this.documentElement,"FRAMESET")),e},get documentElement(){return this._documentElement||(this._documentElement=firstChild(this,"HTML")),this._documentElement},_cookie:"",get cookie(){return this._cookie||""},set cookie(e){this._cookie=e}},core.HTMLDocument.prototype.__proto__=core.Document.prototype,define("HTMLElement",{parentClass:core.Element,proto:{dispatchEvent:function(e){var t=core.Node.prototype.dispatchEvent.call(this,e);return!e._preventDefault&&e.target._eventDefaults[e.type]&&typeof e.target._eventDefaults[e.type]=="function"&&e.target._eventDefaults[e.type](e),t},_eventDefaults:{}},attributes:["id","title","lang","dir",{prop:"className",attr:"class",normalize:function(e){return e||""}}]}),core.Document.prototype._defaultElementBuilder=function(e,t){return new core.HTMLElement(e,t)};var listedElements=/button|fieldset|input|keygen|object|select|textarea/i;define("HTMLFormElement",{tagName:"FORM",proto:{get elements(){return new core.HTMLCollection(this._ownerDocument,core.mapper(this,function(e){return listedElements.test(e.nodeName)}))},get length(){return this.elements.length},_dispatchSubmitEvent:function(){var e=this._ownerDocument.createEvent("HTMLEvents");e.initEvent("submit",!0,!0),this.dispatchEvent(e)||this.submit()},submit:function(){},reset:function(){this.elements.toArray().forEach(function(e){e.value=e.defaultValue})}},attributes:["name",{prop:"acceptCharset",attr:"accept-charset"},"action","enctype","method","target"]}),define("HTMLLinkElement",{tagName:"LINK",proto:{get href(){return core.resourceLoader.resolve(this._ownerDocument,this.getAttribute("href"))}},attributes:[{prop:"disabled",type:"boolean"},"charset","href","hreflang","media","rel","rev","target","type"]}),define("HTMLMetaElement",{tagName:"META",attributes:["content",{prop:"httpEquiv",attr:"http-equiv"},"name","scheme"]}),define("HTMLHtmlElement",{tagName:"HTML",attributes:["version"]}),define("HTMLHeadElement",{tagName:"HEAD",attributes:["profile"]}),define("HTMLTitleElement",{tagName:"TITLE",proto:{get text(){return this.innerHTML},set text(e){this.innerHTML=e}}}),define("HTMLBaseElement",{tagName:"BASE",attributes:["href","target"]}),define("HTMLIsIndexElement",{tagName:"ISINDEX",parentClass:core.Element,proto:{get form(){return closest(this,"FORM")}},attributes:["prompt"]}),define("HTMLStyleElement",{tagName:"STYLE",attributes:[{prop:"disabled",type:"boolean"},"media","type"]}),define("HTMLBodyElement",{proto:function(){var e={};return["onafterprint","onbeforeprint","onbeforeunload","onblur","onerror","onfocus","onhashchange","onload","onmessage","onoffline","ononline","onpagehide","onpageshow","onpopstate","onresize","onscroll","onstorage","onunload"].forEach(function(t){e.__defineSetter__(t,function(e){this._ownerDocument.parentWindow[t]=e}),e.__defineGetter__(t,function(){return this._ownerDocument.parentWindow[t]})}),e}(),tagName:"BODY",attributes:["aLink","background","bgColor","link","text","vLink"]}),define("HTMLSelectElement",{tagName:"SELECT",proto:{get options(){return new core.HTMLOptionsCollection(this,core.mapper(this,function(e){return e.nodeName==="OPTION"}))},get length(){return this.options.length},get selectedIndex(){return this.options.toArray().reduceRight(function(e,t,n){return t.selected?n:e},-1)},set selectedIndex(e){this.options.toArray().forEach(function(t,n){t.selected=n===e})},get value(){var e=this.selectedIndex;return this.options.length&&e===-1&&(e=0),e===-1?"":this.options[e].value},set value(e){var t=this;this.options.toArray().forEach(function(n){n.value===e?n.selected=!0:t.hasAttribute("multiple")||(n.selected=!1)})},get form(){return closest(this,"FORM")},get type(){return this.multiple?"select-multiple":"select-one"},add:function(e,t){t?this.insertBefore(e,t):this.appendChild(e)},remove:function(e){var t=this.options.toArray();if(e>=0&&e<t.length){var n=t[e];n._parentNode.removeChild(n)}},blur:function(){},focus:function(){}},attributes:[{prop:"disabled",type:"boolean"},{prop:"multiple",type:"boolean"},"name",{prop:"size",type:"long"},{prop:"tabIndex",type:"long"}]}),define("HTMLOptGroupElement",{tagName:"OPTGROUP",attributes:[{prop:"disabled",type:"boolean"},"label"]}),define("HTMLOptionElement",{tagName:"OPTION",proto:{_attrModified:function(e,t){e==="selected"&&(this.selected=this.defaultSelected),core.HTMLElement.prototype._attrModified.call(this,arguments)},get form(){return closest(this,"FORM")},get defaultSelected(){return!!this.getAttribute("selected")},set defaultSelected(e){e?this.setAttribute("selected","selected"):this.removeAttribute("selected")},get text(){return this.innerHTML},get value(){return this.hasAttribute("value")?this.getAttribute("value"):this.innerHTML},set value(e){this.setAttribute("value",e)},get index(){return closest(this,"SELECT").options.toArray().indexOf(this)},get selected(){return this._selected===undefined&&(this._selected=this.defaultSelected),this._selected},set selected(e){this._selected=!!e;if(e){var t=this._parentNode;if(!t)return;if(t.nodeName!=="SELECT"){t=t._parentNode;if(!t)return;if(t.nodeName!=="SELECT")return}if(!t.multiple){var n=t.options;for(var r=0;r<n.length;r++)n[r]!==this&&(n[r].selected=!1)}}}},attributes:[{prop:"disabled",type:"boolean"},"label"]}),define("HTMLInputElement",{tagName:"INPUT",proto:{_initDefaultValue:function(){if(this._defaultValue===undefined){var e=this.getAttributeNode("value");this._defaultValue=e?e.value:null}return this._defaultValue},_initDefaultChecked:function(){return this._defaultChecked===undefined&&(this._defaultChecked=!!this.getAttribute("checked")),this._defaultChecked},get form(){return closest(this,"FORM")},get defaultValue(){return this._initDefaultValue()},get defaultChecked(){return this._initDefaultChecked()},get checked(){return!!this._attributes.getNamedItem("checked")},set checked(e){this._initDefaultChecked(),e?this.setAttribute("checked","checked"):this.removeAttribute("checked")},get value(){return this.getAttribute("value")},set value(e){this._initDefaultValue(),e===null?this.removeAttribute("value"):this.setAttribute("value",e)},blur:function(){},focus:function(){},select:function(){},click:function(){if(this.type==="checkbox"||this.type==="radio")this.checked=!this.checked;else if(this.type==="submit"){var e=this.form;e&&e._dispatchSubmitEvent()}}},attributes:["accept","accessKey","align","alt",{prop:"disabled",type:"boolean"},{prop:"maxLength",type:"long"},"name",{prop:"readOnly",type:"boolean"},{prop:"size",type:"long"},"src",{prop:"tabIndex",type:"long"},{prop:"type",normalize:function(e){return e?e.toLowerCase():"text"}},"useMap"]}),define("HTMLTextAreaElement",{tagName:"TEXTAREA",proto:{_initDefaultValue:function(){return this._defaultValue===undefined&&(this._defaultValue=this.textContent),this._defaultValue},get form(){return closest(this,"FORM")},get defaultValue(){return this._initDefaultValue()},get value(){return this.textContent},set value(e){this._initDefaultValue(),this.textContent=e},get type(){return"textarea"},blur:function(){},focus:function(){},select:function(){}},attributes:["accessKey",{prop:"cols",type:"long"},{prop:"disabled",type:"boolean"},{prop:"maxLength",type:"long"},"name",{prop:"readOnly",type:"boolean"},{prop:"rows",type:"long"},{prop:"tabIndex",type:"long"}]}),define("HTMLButtonElement",{tagName:"BUTTON",proto:{get form(){return closest(this,"FORM")}},attributes:["accessKey",{prop:"disabled",type:"boolean"},"name",{prop:"tabIndex",type:"long"},"type","value"]}),define("HTMLLabelElement",{tagName:"LABEL",proto:{get form(){return closest(this,"FORM")}},attributes:["accessKey",{prop:"htmlFor",attr:"for"}]}),define("HTMLFieldSetElement",{tagName:"FIELDSET",proto:{get form(){return closest(this,"FORM")}}}),define("HTMLLegendElement",{tagName:"LEGEND",proto:{get form(){return closest(this,"FORM")}},attributes:["accessKey","align"]}),define("HTMLUListElement",{tagName:"UL",attributes:[{prop:"compact",type:"boolean"},"type"]}),define("HTMLOListElement",{tagName:"OL",attributes:[{prop:"compact",type:"boolean"},{prop:"start",type:"long"},"type"]}),define("HTMLDListElement",{tagName:"DL",attributes:[{prop:"compact",type:"boolean"}]}),define("HTMLDirectoryElement",{tagName:"DIR",attributes:[{prop:"compact",type:"boolean"}]}),define("HTMLMenuElement",{tagName:"MENU",attributes:[{prop:"compact",type:"boolean"}]}),define("HTMLLIElement",{tagName:"LI",attributes:["type",{prop:"value",type:"long"}]}),define("HTMLDivElement",{tagName:"DIV",attributes:["align"]}),define("HTMLParagraphElement",{tagName:"P",attributes:["align"]}),define("HTMLHeadingElement",{tagNames:["H1","H2","H3","H4","H5","H6"],attributes:["align"]}),define("HTMLQuoteElement",{tagNames:["Q","BLOCKQUOTE"],attributes:["cite"]}),define("HTMLPreElement",{tagName:"PRE",attributes:[{prop:"width",type:"long"}]}),define("HTMLBRElement",{tagName:"BR",attributes:["clear"]}),define("HTMLBaseFontElement",{tagName:"BASEFONT",attributes:["color","face",{prop:"size",type:"long"}]}),define("HTMLFontElement",{tagName:"FONT",attributes:["color","face","size"]}),define("HTMLHRElement",{tagName:"HR",attributes:["align",{prop:"noShade",type:"boolean"},"size","width"]}),define("HTMLModElement",{tagNames:["INS","DEL"],attributes:["cite","dateTime"]}),define("HTMLAnchorElement",{tagName:"A",proto:{blur:function(){},focus:function(){},get href(){return core.resourceLoader.resolve(this._ownerDocument,this.getAttribute("href"))},get hostname(){return URL.parse(this.href).hostname},get pathname(){return URL.parse(this.href).pathname}},attributes:["accessKey","charset","coords",{prop:"href",type:"string",read:!1},"hreflang","name","rel","rev","shape",{prop:"tabIndex",type:"long"},"target","type"]}),define("HTMLImageElement",{tagName:"IMG",attributes:["name","align","alt","border",{prop:"height",type:"long"},{prop:"hspace",type:"long"},{prop:"isMap",type:"boolean"},"longDesc","src","useMap",{prop:"vspace",type:"long"},{prop:"width",type:"long"}]}),define("HTMLObjectElement",{tagName:"OBJECT",proto:{get form(){return closest(this,"FORM")},get contentDocument(){return null}},attributes:["code","align","archive","border","codeBase","codeType","data",{prop:"declare",type:"boolean"},{prop:"height",type:"long"},{prop:"hspace",type:"long"},"name","standby",{prop:"tabIndex",type:"long"},"type","useMap",{prop:"vspace",type:"long"},{prop:"width",type:"long"}]}),define("HTMLParamElement",{tagName:"PARAM",attributes:["name","type","value","valueType"]}),define("HTMLAppletElement",{tagName:"APPLET",attributes:["align","alt","archive","code","codeBase","height",{prop:"hspace",type:"long"},"name","object",{prop:"vspace",type:"long"},"width"]}),define("HTMLMapElement",{tagName:"MAP",proto:{get areas(){return this.getElementsByTagName("AREA")}},attributes:["name"]}),define("HTMLAreaElement",{tagName:"AREA",attributes:["accessKey","alt","coords","href",{prop:"noHref",type:"boolean"},"shape",{prop:"tabIndex",type:"long"},"target"]}),define("HTMLScriptElement",{tagName:"SCRIPT",init:function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(this.src)core.resourceLoader.load(this,this.src,this._eval);else{var e=this.sourceLocation||{},t=e.file||this._ownerDocument.URL;e&&(t+=":"+e.line+":"+e.col),t+="<script>",core.resourceLoader.enqueue(this,this._eval,t)(null,this.text)}})},proto:{_eval:function(e,t){this._ownerDocument.implementation.hasFeature("ProcessExternalResources","script")&&this.language&&core.languageProcessors[this.language]&&core.languageProcessors[this.language](this,e,t)},get language(){var e=this.type||"text/javascript";return e.split("/").pop().toLowerCase()},get text(){var e=0,t=this.childNodes,n=t.length,r=[];for(e;e<n;e++)r.push(t.item(e).nodeValue);return r.join("")},set text(e){while(this.childNodes.length)this.removeChild(this.childNodes[0]);this.appendChild(this._ownerDocument.createTextNode(e))}},attributes:[{prop:"defer",type:"boolean"},"htmlFor","event","charset","type","src"]}),define("HTMLTableElement",{tagName:"TABLE",proto:{get caption(){return firstChild(this,"CAPTION")},get tHead(){return firstChild(this,"THEAD")},get tFoot(){return firstChild(this,"TFOOT")},get rows(){if(!this._rows){var e=this;this._rows=new core.HTMLCollection(this._ownerDocument,function(){var t=[e.tHead].concat(e.tBodies.toArray(),e.tFoot).filter(function(e){return!!e});return t.length===0?core.mapDOMNodes(e,!1,function(e){return e.tagName==="TR"}):t.reduce(function(e,t){return e.concat(t.rows.toArray())},[])})}return this._rows},get tBodies(){return this._tBodies||(this._tBodies=descendants(this,"TBODY",!1)),this._tBodies},createTHead:function(){var e=this.tHead;return e||(e=this._ownerDocument.createElement("THEAD"),this.appendChild(e)),e},deleteTHead:function(){var e=this.tHead;e&&e._parentNode.removeChild(e)},createTFoot:function(){var e=this.tFoot;return e||(e=this._ownerDocument.createElement("TFOOT"),this.appendChild(e)),e},deleteTFoot:function(){var e=this.tFoot;e&&e._parentNode.removeChild(e)},createCaption:function(){var e=this.caption;return e||(e=this._ownerDocument.createElement("CAPTION"),this.appendChild(e)),e},deleteCaption:function(){var e=this.caption;e&&e._parentNode.removeChild(e)},insertRow:function(e){var t=this._ownerDocument.createElement("TR");this.childNodes.length===0&&this.appendChild(this._ownerDocument.createElement("TBODY"));var n=this.rows.toArray();if(e<-1||e>n.length)throw new core.DOMException(core.INDEX_SIZE_ERR);if(e===-1||e===0&&n.length===0)this.tBodies.item(0).appendChild(t);else if(e===n.length){var r=n[e-1];r._parentNode.appendChild(t)}else{var r=n[e];r._parentNode.insertBefore(t,r)}return t},deleteRow:function(e){var t=this.rows.toArray(),n=t.length;e===-1&&(e=n-1);if(e<0||e>=n)throw new core.DOMException(core.INDEX_SIZE_ERR);var r=t[e];r._parentNode.removeChild(r)}},attributes:["align","bgColor","border","cellPadding","cellSpacing","frame","rules","summary","width"]}),define("HTMLTableCaptionElement",{tagName:"CAPTION",attributes:["align"]}),define("HTMLTableColElement",{tagNames:["COL","COLGROUP"],attributes:["align",{prop:"ch",attr:"char"},{prop:"chOff",attr:"charoff"},{prop:"span",type:"long"},"vAlign","width"]}),define("HTMLTableSectionElement",{tagNames:["THEAD","TBODY","TFOOT"],proto:{get rows(){return this._rows||(this._rows=descendants(this,"TR",!1)),this._rows},insertRow:function(e){var t=this._ownerDocument.createElement("TR"),n=this.rows.toArray();if(e<-1||e>n.length)throw new core.DOMException(core.INDEX_SIZE_ERR);if(e===-1||e===n.length)this.appendChild(t);else{var r=n[e];this.insertBefore(t,r)}return t},deleteRow:function(e){var t=this.rows.toArray();e===-1&&(e=t.length-1);if(e<0||e>=t.length)throw new core.DOMException(core.INDEX_SIZE_ERR);var n=this.rows[e];this.removeChild(n)}},attributes:["align",{prop:"ch",attr:"char"},{prop:"chOff",attr:"charoff"},{prop:"span",type:"long"},"vAlign","width"]}),define("HTMLTableRowElement",{tagName:"TR",proto:{get cells(){return this._cells||(this._cells=new core.HTMLCollection(this,core.mapper(this,function(e){return e.nodeName==="TD"||e.nodeName==="TH"},!1))),this._cells},get rowIndex(){return closest(this,"TABLE").rows.toArray().indexOf(this)},get sectionRowIndex(){return this._parentNode.rows.toArray().indexOf(this)},insertCell:function(e){var t=this._ownerDocument.createElement("TD"),n=this.cells.toArray();if(e<-1||e>n.length)throw new core.DOMException(core.INDEX_SIZE_ERR);if(e===-1||e===n.length)this.appendChild(t);else{var r=n[e];this.insertBefore(t,r)}return t},deleteCell:function(e){var t=this.cells.toArray();e===-1&&(e=t.length-1);if(e<0||e>=t.length)throw new core.DOMException(core.INDEX_SIZE_ERR);var n=this.cells[e];this.removeChild(n)}},attributes:["align","bgColor",{prop:"ch",attr:"char"},{prop:"chOff",attr:"charoff"},"vAlign"]}),define("HTMLTableCellElement",{tagNames:["TH","TD"],proto:{_headers:null,set headers(e){if(e===""){this._headers=null;return}e instanceof Array||(e=[e]),this._headers=e},get headers(){if(this._headers)return this._headers.join(" ");var e=this.cellIndex,t=[],n=this._parentNode.getElementsByTagName(this.tagName);for(var r=0;r<n.length;r++){if(n.item(r).cellIndex>=e)break;t.push(n.item(r).id)}return this._headers=t,t.join(" ")},get cellIndex(){return closest(this,"TR").cells.toArray().indexOf(this)}},attributes:["abbr","align","axis","bgColor",{prop:"ch",attr:"char"},{prop:"chOff",attr:"charoff"},{prop:"colSpan",type:"long"},"height",{prop:"noWrap",type:"boolean"},{prop:"rowSpan",type:"long"},"scope","vAlign","width"]}),define("HTMLFrameSetElement",{tagName:"FRAMESET",attributes:["cols","rows"]}),define("HTMLFrameElement",{tagName:"FRAME",init:function(){var e=this._ownerDocument.parentWindow,t=e._length++,n=this;e.__defineGetter__(t,function(){return n.contentWindow}),this._initInsertListener=this.addEventListener("DOMNodeInsertedIntoDocument",function(){var t=n._ownerDocument,r=n.contentDocument;applyDocumentFeatures(r,t.implementation._features);var i=n.contentWindow;i.parent=e,i.top=e.top},!1)},proto:{setAttribute:function(e,t){core.HTMLElement.prototype.setAttribute.call(this,e,t);var n=this;e==="name"?this._ownerDocument.parentWindow.__defineGetter__(t,function(){return n.contentWindow}):e==="src"&&(this._attachedToDocument?loadFrame(n):this._waitingOnInsert||(this.removeEventListener("DOMNodeInsertedIntoDocument",this._initInsertListener,!1),this.addEventListener("DOMNodeInsertedIntoDocument",function r(){n.removeEventListener("DOMNodeInsertedIntoDocument",r,!1),this._waitingOnInsert=!1,loadFrame(n)},!1),this._waitingOnInsert=!0))},_contentDocument:null,get contentDocument(){return this._contentDocument==null&&(this._contentDocument=new core.HTMLDocument),this._contentDocument},get contentWindow(){return this.contentDocument.parentWindow}},attributes:["frameBorder","longDesc","marginHeight","marginWidth","name",{prop:"noResize",type:"boolean"},"scrolling",{prop:"src",type:"string",write:!1}]}),define("HTMLIFrameElement",{tagName:"IFRAME",parentClass:core.HTMLFrameElement,attributes:["align","frameBorder","height","longDesc","marginHeight","marginWidth","name","scrolling","src","width"]}),exports.define=define,exports.dom={level2:{html:core}}