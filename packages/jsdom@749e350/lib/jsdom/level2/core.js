var core=require("../level1/core").dom.level1.core;core=Object.create(core);var INVALID_STATE_ERR=core.INVALID_STATE_ERR=11,SYNTAX_ERR=core.SYNTAX_ERR=12,INVALID_MODIFICATION_ERR=core.INVALID_MODIFICATION_ERR=13,NAMESPACE_ERR=core.NAMESPACE_ERR=14,INVALID_ACCESS_ERR=core.INVALID_ACCESS_ERR=15,ns={validate:function(e,t){if(!e)throw new core.DOMException(core.INVALID_CHARACTER_ERR,"namespace is undefined");if(e.match(/[^0-9a-z\.:\-_]/i)!==null)throw new core.DOMException(core.INVALID_CHARACTER_ERR,e);var n=!1,r=e.split(":");e==="xmlns"&&t!=="http://www.w3.org/2000/xmlns/"?n="localName is 'xmlns' but the namespaceURI is invalid":e==="xml"&&t!=="http://www.w3.org/XML/1998/namespace"?n="localName is 'xml' but the namespaceURI is invalid":e[e.length-1]===":"?n="Namespace seperator found with no localName":e[0]===":"?n="Namespace seperator found, without a prefix":r.length>2&&(n="Too many namespace seperators");if(n)throw new core.DOMException(NAMESPACE_ERR,n+" ("+e+"@"+t+")")}};core.exceptionMessages.NAMESPACE_ERR="Invalid namespace",core.DOMImplementation.prototype.createDocumentType=function(e,t,n){ns.validate(e);var r=new core.DocumentType(null,e);return r._publicId=t?t:"",r._systemId=n?n:"",r},core.DOMImplementation.prototype.createDocument=function(e,t,n){(t||e)&&ns.validate(t,e);if(n&&n._ownerDocument!==null)throw new core.DOMException(core.WRONG_DOCUMENT_ERR);if(t&&t.indexOf(":")>-1&&!e)throw new core.DOMException(NAMESPACE_ERR);var r=new core.Document;n?(r.doctype=n,n._ownerDocument=r,r.appendChild(n)):r.doctype=null,n&&!n.entities&&(n.entities=new dom.EntityNodeMap),r._ownerDocument=r;if(t){var i=r.createElementNS(e,t);r.appendChild(i)}return r},core.Node.prototype.__defineGetter__("ownerDocument",function(){return this._ownerDocument||null}),core.Node.prototype.isSupported=function(e,t){return this._ownerDocument.implementation.hasFeature(e,t)},core.Node.prototype._namespaceURI=null,core.Node.prototype.__defineGetter__("namespaceURI",function(){return this._namespaceURI||null}),core.Node.prototype.__defineSetter__("namespaceURI",function(e){this._namespaceURI=e}),core.Node.prototype.__defineGetter__("prefix",function(){return this._prefix||null}),core.Node.prototype.__defineSetter__("prefix",function(e){if(this.readonly)throw new core.DOMException(core.NO_MODIFICATION_ALLOWED_ERR);ns.validate(e,this._namespaceURI);if(this._created&&!this._namespaceURI||this._prefix==="xmlns"||!this._prefix&&this._created)throw new core.DOMException(core.NAMESPACE_ERR);this._localName&&(this._nodeName=e+":"+this._localName),this._prefix=e}),core.Node.prototype.__defineGetter__("localName",function(){return this._localName||null}),core.Node.prototype.hasAttributes=function(){return this.nodeType===this.ELEMENT_NODE&&this._attributes&&this._attributes.length>0},core.NamedNodeMap.prototype.getNamedItemNS=function(e,t){return this._nsStore[e]&&this._nsStore[e][t]?this._nsStore[e][t]:null},core.AttrNodeMap.prototype.setNamedItemNS=function(e){if(e.nodeType!==this._ownerDocument.ATTRIBUTE_NODE)throw new core.DOMException(core.HIERARCHY_REQUEST_ERR);return core.NamedNodeMap.prototype.setNamedItemNS.call(this,e)};var prevSetNamedItem=core.AttrNodeMap.prototype.setNamedItem;core.AttrNodeMap.prototype.setNamedItem=function(e){if(e.nodeType!==this._ownerDocument.ATTRIBUTE_NODE)throw new core.DOMException(core.HIERARCHY_REQUEST_ERR);return prevSetNamedItem.call(this,e)},core.NamedNodeMap.prototype.setNamedItemNS=function(e){if(this._readonly)throw new core.DOMException(core.NO_MODIFICATION_ALLOWED_ERR);var t=this._ownerDocument;if(this._parentNode&&this._parentNode._parentNode&&this._parentNode._parentNode.nodeType===t.ENTITY_NODE)throw new core.DOMException(core.NO_MODIFICATION_ALLOWED_ERR);if(this._ownerDocument!==e.ownerDocument)throw new core.DOMException(core.WRONG_DOCUMENT_ERR);if(e._ownerElement)throw new core.DOMException(core.INUSE_ATTRIBUTE_ERR);if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);this._nsStore[e.namespaceURI]||(this._nsStore[e.namespaceURI]={});var n=null;if(this._nsStore[e.namespaceURI][e.localName])var n=this._nsStore[e.namespaceURI][e.localName];return this._nsStore[e.namespaceURI][e.localName]=e,e._specified=!0,e._ownerDocument=this._ownerDocument,this.setNamedItem(e)},core.NamedNodeMap.prototype.removeNamedItemNS=function(e,t){if(this.readonly)throw new core.DOMException(core.NO_MODIFICATION_ALLOWED_ERR);var n=this._parentNode,r=null,i,s,o,u;if(this._parentNode&&this._parentNode._parentNode&&this._parentNode._parentNode.nodeType===this._ownerDocument.ENTITY_NODE)throw new core.DOMException(core.NO_MODIFICATION_ALLOWED_ERR);this._nsStore[e]&&this._nsStore[e][t]&&(r=this._nsStore[e][t],this.removeNamedItem(r.qualifiedName),delete this._nsStore[e][t]);if(!r)throw new core.DOMException(core.NOT_FOUND_ERR);return n.ownerDocument.doctype&&n.ownerDocument.doctype._attributes&&(i=n.ownerDocument.doctype._attributes,o=i.getNamedItemNS(n._namespaceURI,n._localName)),o&&(u=o._attributes.getNamedItemNS(e,t),u&&(s=u.cloneNode(!0),s._created=!1,s._namespaceURI=r._namespaceURI,s._nodeName=r.name,s._localName=r._localName,s._prefix=r._prefix,this.setNamedItemNS(s),s._created=!0,s._specified=!1)),r},core.Attr.prototype.__defineGetter__("ownerElement",function(){return this._ownerElement||null}),core.Node.prototype._prefix=!1,core.Node.prototype.__defineSetter__("qualifiedName",function(e){ns.validate(e,this._namespaceURI),e=e||"",this._localName=e.split(":")[1]||null,this.prefix=e.split(":")[0]||null,this._nodeName=e}),core.Node.prototype.__defineGetter__("qualifiedName",function(){return this._nodeName}),core.NamedNodeMap.prototype._map=function(e){var t=[],n=this.length,r=0,i;for(r;r<n;r++)i=this.item(r),e&&e(i)&&t.push(i);return t},core.Element.prototype.getAttributeNS=function(e,t){var n=this._attributes.getNamedItemNS(e,t);return n?n.nodeValue:""},core.Element.prototype.setAttributeNS=function(e,t,n){var r=t.split(":"),i=r.pop(),s=r.pop()||null,o;ns.validate(t,e);if(t.split(":").shift()==="xml"&&e!=="http://www.w3.org/XML/1998/namespace")throw new core.DOMException(core.NAMESPACE_ERR);if(s==="xmlns"&&e!=="http://www.w3.org/2000/xmlns/")throw new core.DOMException(core.NAMESPACE_ERR);if(t.split(":").length>1&&!e)throw new core.DOMException(core.NAMESPACE_ERR);o=this._attributes.getNamedItemNS(e,i),o||(o=this.ownerDocument.createAttributeNS(e,t,n),this._attributes.setNamedItemNS(o)),o._namespaceURI=e,o._prefix=s,o._created=!0,o.value=n,o._localName=i},core.Element.prototype.removeAttributeNS=function(e,t){if(this.readonly)throw new core.DOMException(core.NO_MODIFICATION_ALLOWED_ERR);var n=this.ownerDocument,r,i,s,o,i,t;n.doctype&&n.doctype._attributes&&(r=n.doctype._attributes,s=r.getNamedItemNS(e,this.localName)),s&&(o=s.getAttributeNodeNS(e,t)),this._attributes.removeNamedItemNS(e,t),o&&(this.setAttributeNS(o.namespaceURI,o.name,o.value),t=o.name.split(":").pop(),i=this.getAttributeNS(o.namespaceURI,t),i._specified=!1)},core.Element.prototype.getAttributeNodeNS=function(e,t){return this._attributes.getNamedItemNS(e,t)},core.Element.prototype._created=!1,core.Element.prototype.setAttributeNodeNS=function(e){if(e.ownerElement)throw new core.DOMException(core.INUSE_ATTRIBUTE_ERR);var t=null;try{t=this._attributes.removeNamedItemNS(e.namespaceURI,e.localName)}catch(n){}return this._attributes.setNamedItemNS(e)||t},core.Element.prototype.getElementsByTagNameNS=function(e,t){function r(n){n.nodeType&&n.nodeType===this.ENTITY_REFERENCE_NODE&&(n=n._entity);var r=n.localName===t,i=n.namespaceURI===e;return!r&&t!=="*"||!i&&e!=="*"||n.nodeType!==n.ELEMENT_NODE?!1:!0}var n={};return new core.NodeList(this.ownerDocument||this,core.mapper(this,r))},core.Element.prototype.hasAttribute=function(e){return this._attributes?this._attributes.exists(e):!1},core.Element.prototype.hasAttributeNS=function(e,t){return this._attributes.getNamedItemNS(e,t)?!0:this.hasAttribute(t)?!0:!1},core.DocumentType.prototype.__defineGetter__("publicId",function(){return this._publicId||""}),core.DocumentType.prototype.__defineGetter__("systemId",function(){return this._systemId||""}),core.DocumentType.prototype.__defineGetter__("internalSubset",function(){return this._internalSubset||null}),core.Document.prototype.importNode=function(e,t){function o(e){var t,r;e._ownerDocument=n,e.id&&(n._ids||(n._ids={}),n._ids[e.id]||(n._ids[e.id]=[]),n._ids[e.id].push(e));if(e._attributes){e._attributes._ownerDocument=n;for(var s=0,o=e._attributes.length;s<o;s++)t=e._attributes.item(s),t._ownerDocument=n,t._specified=!0}i&&(r=i.getNamedItemNS(e._namespaceURI,e._localName),r&&r._attributes._map(function(t){if(!e.hasAttributeNS(t.namespaceURL,t.localName)){var n=t.cloneNode(!0);n._namespaceURI=t._namespaceURI,n._prefix=t._prefix,n._localName=t._localName,e.setAttributeNodeNS(n),n._specified=!1}}))}if(e&&e.nodeType)if(e.nodeType===this.DOCUMENT_NODE||e.nodeType===this.DOCUMENT_TYPE_NODE)throw new core.DOMException(core.NOT_SUPPORTED_ERR);var n=this,r=e.cloneNode(t,function(e,t){t._namespaceURI=e._namespaceURI,t._nodeName=e._nodeName,t._localName=e._localName}),i=!1,s;return this.doctype&&this.doctype._attributes&&(i=this.doctype._attributes),t?core.visitTree(r,o):o(r),r.nodeType==r.ATTRIBUTE_NODE&&(r._specified=!0),r},core.Document.prototype.createElementNS=function(e,t){var n=t.split(":"),r,i;if(n.length>1&&!e)throw new core.DOMException(core.NAMESPACE_ERR);return ns.validate(t,e),r=this.createElement(t),r._created=!1,r._namespaceURI=e,r._nodeName=t,r._localName=n.pop(),n.length>0&&(i=n.pop(),r.prefix=i),r._created=!0,r},core.Document.prototype.createAttributeNS=function(e,t){var n,r=t.split(":");if(r.length>1&&!e)throw new core.DOMException(core.NAMESPACE_ERR,"Prefix specified without namespaceURI ("+t+")");return ns.validate(t,e),n=this.createAttribute(t),n.namespaceURI=e,n.qualifiedName=t,n._localName=r.pop(),n._prefix=r.length>0?r.pop():null,n},core.Document.prototype.getElementsByTagNameNS=function(e,t){return core.Element.prototype.getElementsByTagNameNS.call(this,e,t)},core.Element.prototype.__defineSetter__("id",function(e){this.setAttribute("id",e)}),core.Element.prototype.__defineGetter__("id",function(){return this.getAttribute("id")}),core.Document.prototype.getElementById=function(e){return this._ids&&this._ids[e]&&this._ids[e].length>0?this._ids[e][0]:null},exports.dom={level2:{core:core}}