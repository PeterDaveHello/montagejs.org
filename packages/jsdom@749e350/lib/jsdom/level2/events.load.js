montageDefine("749e350","lib/jsdom/level2/events",{dependencies:["./core","../utils"],factory:function(e,t,n){function o(e){return e.nodeType==r.Node.DOCUMENT_NODE?e:e._ownerDocument}function u(e){return e.nodeType!=r.Node.ATTRIBUTE_NODE&&o(e).implementation.hasFeature("MutationEvents")}function a(e){return function(t,n,r){var i=this._parentNode,o=t.apply(this,n);if(u(i)){var a=i._ownerDocument,f=s.MutationEvent.prototype[e],l=o&&o.name||r.name,c=o&&o.value||null,h=e=="ADDITION"?r.value:null,p;if(!h||h!=c)p=a.createEvent("MutationEvents"),p.initMutationEvent("DOMAttrModified",!0,!1,i,c,h,l,f),i.dispatchEvent(p)}return o}}var r=e("./core").dom.level2.core,i=e("../utils");r=Object.create(r);var s={};s.EventException=function(){arguments.length>0?this._code=arguments[0]:this._code=0,arguments.length>1?this._message=arguments[1]:this._message="Unspecified event type",Error.call(this,this._message),Error.captureStackTrace&&Error.captureStackTrace(this,s.EventException)},s.EventException.prototype={UNSPECIFIED_EVENT_TYPE_ERR:0,get code(){return this._code}},s.EventException.prototype.__proto__=Error.prototype,s.Event=function(e){this._eventType=e,this._type=null,this._bubbles=null,this._cancelable=null,this._target=null,this._currentTarget=null,this._eventPhase=null,this._timeStamp=null,this._preventDefault=!1,this._stopPropagation=!1},s.Event.prototype={initEvent:function(e,t,n){this._type=e,this._bubbles=t,this._cancelable=n},preventDefault:function(){this._cancelable&&(this._preventDefault=!0)},stopPropagation:function(){this._stopPropagation=!0},CAPTURING_PHASE:1,AT_TARGET:2,BUBBLING_PHASE:3,get eventType(){return this._eventType},get type(){return this._type},get bubbles(){return this._bubbles},get cancelable(){return this._cancelable},get target(){return this._target},get currentTarget(){return this._currentTarget},get eventPhase(){return this._eventPhase},get timeStamp(){return this._timeStamp}},s.UIEvent=function(e){s.Event.call(this,e),this.view=null,this.detail=null},s.UIEvent.prototype={initUIEvent:function(e,t,n,r,i){this.initEvent(e,t,n),this.view=r,this.detail=i}},s.UIEvent.prototype.__proto__=s.Event.prototype,s.MouseEvent=function(e){s.UIEvent.call(this,e),this.screenX=null,this.screenY=null,this.clientX=null,this.clientY=null,this.ctrlKey=null,this.shiftKey=null,this.altKey=null,this.metaKey=null,this.button=null,this.relatedTarget=null},s.MouseEvent.prototype={initMouseEvent:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){this.initUIEvent(e,t,n,r,i),this.screenX=s,this.screenY=o,this.clientX=u,this.clientY=a,this.ctrlKey=f,this.shiftKey=c,this.altKey=l,this.metaKey=h,this.button=p,this.relatedTarget=d}},s.MouseEvent.prototype.__proto__=s.UIEvent.prototype,s.MutationEvent=function(e){s.Event.call(this,e),this.relatedNode=null,this.prevValue=null,this.newValue=null,this.attrName=null,this.attrChange=null},s.MutationEvent.prototype={initMutationEvent:function(e,t,n,r,i,s,o,u){this.initEvent(e,t,n),this.relatedNode=r,this.prevValue=i,this.newValue=s,this.attrName=o,this.attrChange=u},MODIFICATION:1,ADDITION:2,REMOVAL:3},s.MutationEvent.prototype.__proto__=s.Event.prototype,s.EventTarget=function(){},s.EventTarget.getListeners=function(t,n,r){var i=t._listeners&&t._listeners[n]&&t._listeners[n][r]||[];if(!r){var s=t["on"+n];if(s){var o=t._ownerDocument?t._ownerDocument.implementation:t.document.implementation;o.hasFeature("ProcessExternalResources","script")&&i.push(s)}}return i},s.EventTarget.dispatch=function(t,n,r){var i,o,u=n();while(u&&!t._stopPropagation){i=s.EventTarget.getListeners(u,t._type,r),o=i.length;while(o--){t._currentTarget=u;try{i[o].call(u,t)}catch(a){u.raise("error","Dispatching event '"+t._type+"' failed",{error:a,event:t})}}u=n()}return!t._stopPropagation},s.EventTarget.forwardIterator=function(t){var n=0,r=t.length;return function(){return n<r?t[n++]:null}},s.EventTarget.backwardIterator=function(t){var n=t.length;return function(){return n>=0?t[--n]:null}},s.EventTarget.singleIterator=function(t){var n=1;return function(){return n--?t:null}},s.EventTarget.prototype={addEventListener:function(e,t,n){this._listeners=this._listeners||{};var r=this._listeners[e]||{};n=n===!0;var i=r[n]||[];for(var s=0;s<i.length;s++)if(i[s]===t)return;i.push(t),r[n]=i,this._listeners[e]=r},removeEventListener:function(e,t,n){var r=this._listeners&&this._listeners[e];if(!r)return;var i=r[n===!0];if(!i)return;for(var s=0;s<i.length;s++)if(i[s]===t){i.splice(s,1);return}},dispatchEvent:function(e){if(e==null)throw new s.EventException(0,"Null event");if(e._type==null||e._type=="")throw new s.EventException(0,"Uninitialized event");var t=[];e._target=this;var n=this,r=n._parentNode;while(r)t.push(r),n=r,r=n._parentNode;r=n._parentWindow,r&&t.push(r);var i=s.EventTarget.backwardIterator(t);e._eventPhase=e.CAPTURING_PHASE;if(!s.EventTarget.dispatch(e,i,!0))return e._preventDefault;i=s.EventTarget.singleIterator(e._target),e._eventPhase=e.AT_TARGET;if(!s.EventTarget.dispatch(e,i,!1))return e._preventDefault;if(e._bubbles&&!e._stopPropagation){var o=0;i=s.EventTarget.forwardIterator(t),e._eventPhase=e.BUBBLING_PHASE,s.EventTarget.dispatch(e,i,!1)}return e._preventDefault}},r.Node.prototype.__proto__=s.EventTarget.prototype,i.intercept(r.Node,"insertBefore",function(e,t,n,i){var s=e.apply(this,t);if(u(this)){var a=o(this),f=a.createEvent("MutationEvents");f.initMutationEvent("DOMNodeInserted",!0,!1,this,null,null,null,null),n.dispatchEvent(f);if(this.nodeType==r.Node.DOCUMENT_NODE||this._attachedToDocument)f=a.createEvent("MutationEvents"),f.initMutationEvent("DOMNodeInsertedIntoDocument",!1,!1,null,null,null,null,null),r.visitTree(n,function(e){e.nodeType==r.Node.ELEMENT_NODE&&(e.dispatchEvent(f),e._attachedToDocument=!0)})}return s}),i.intercept(r.Node,"removeChild",function(e,t,n){if(u(this)){var i=o(this),s=i.createEvent("MutationEvents");s.initMutationEvent("DOMNodeRemoved",!0,!1,this,null,null,null,null),n.dispatchEvent(s),s=i.createEvent("MutationEvents"),s.initMutationEvent("DOMNodeRemovedFromDocument",!1,!1,null,null,null,null,null),r.visitTree(n,function(e){e.nodeType==r.Node.ELEMENT_NODE&&(e.dispatchEvent(s),e._attachedToDocument=!1)})}return e.apply(this,t)}),i.intercept(r.AttrNodeMap,"removeNamedItem",a("REMOVAL")),i.intercept(r.AttrNodeMap,"setNamedItem",a("ADDITION")),r.CharacterData.prototype.__defineGetter__("_nodeValue",function(){return this.__nodeValue}),r.CharacterData.prototype.__defineSetter__("_nodeValue",function(e){var t=this.__nodeValue;this.__nodeValue=e;if(this._ownerDocument&&this._parentNode&&u(this)){var n=this._ownerDocument.createEvent("MutationEvents");n.initMutationEvent("DOMCharacterDataModified",!0,!1,this,t,e,null,null),this.dispatchEvent(n)}}),r.Document.prototype.createEvent=function(e){switch(e){case"MutationEvents":return new s.MutationEvent(e);case"UIEvents":return new s.UIEvent(e);case"MouseEvents":return new s.MouseEvent(e);case"HTMLEvents":return new s.Event(e)}return new s.Event(e)},t.dom={level2:{core:r,events:s}}}})