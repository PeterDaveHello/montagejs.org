montageDefine("baac5fa","ui/flow.reel/flow-bezier-spline",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage,a=t.FlowBezierSpline=n.specialize({constructor:{value:function(){this._knots=[],this._densities=[]}},knots:{get:function(){return this._knots},set:function(e){this._knots=e}},previousHandlers:{get:function(){return this._previousHandlers||(this._previousHandlers=[]),this._previousHandlers},set:function(e){this._previousHandlers=e}},nextHandlers:{get:function(){return this._nextHandlers||(this._nextHandlers=[]),this._nextHandlers},set:function(e){this._nextHandlers=e}},densities:{get:function(){return this._densities},set:function(e){this._densities=e,this._densitiesLength=this._densities.length,this._maxTime=null}},_parameters:{value:{}},parameters:{get:function(){return this._parameters||(this._parameters={}),this._parameters},set:function(e){this._parameters=e,this._parametersLength=this._parameters.length}},_maxTime:{enumerable:!1,value:null},computeMaxTime:{value:function(){return this._computeDensitySummation(),this._maxTime=this._densitySummation.length?this._densitySummation[this._densitySummation.length-1]:0,this._maxTime}},_densitySummation:{enumerable:!1,value:null},_computeDensitySummation:{enumerable:!1,value:function(){var e,t=this.densities,n=t.length-1,a=0;for(this._densitySummation=[],e=0;n>e;e++)a+=(t[e]+t[e+1])/2,this._densitySummation[e]=a;this._maxTime=null}},_convertSplineTimeToBezierIndexTime:{enumerable:!1,value:function(e){if(0>e)return null;if(null===this._maxTime&&this.computeMaxTime(),e>=this._maxTime)return null;for(var t,n,a,s,i,r=this._densitySummation,o=r.length,l=o-1,p=o>>1;p;)l-p>=0&&r[l-p]>e?l-=p:p>>=1;return t=e-(l?r[l-1]:0),a=this._densities[l],s=this._densities[l+1],i=a-s,n=-1e-10>i||i>1e-10?(a-Math.sqrt(a*a+2*(s-a)*t))/i:t/a,[l,n]}},getPositionAtIndexTime:{value:function(e){var t=e[0],n=e[1],a=this._knots[t],s=this._nextHandlers[t],i=this._previousHandlers[t+1],r=this._knots[t+1],o=1-n,l=o*o*o,p=3*o*o*n,c=3*o*n*n,u=n*n*n;return[a[0]*l+s[0]*p+i[0]*c+r[0]*u,a[1]*l+s[1]*p+i[1]*c+r[1]*u,a[2]*l+s[2]*p+i[2]*c+r[2]*u]}},getRotationAtIndexTime:{value:function(e){var t,n,a,s=e[0],i=e[1],r=1-i,o=this._parameters;return t=o.rotateX!==void 0?o.rotateX.data[s]*r+o.rotateX.data[s+1]*i:0,n=o.rotateY!==void 0?o.rotateY.data[s]*r+o.rotateY.data[s+1]*i:0,a=o.rotateZ!==void 0?o.rotateZ.data[s]*r+o.rotateZ.data[s+1]*i:0,[t,n,a]}},getStyleAtIndexTime:{value:function(e){var t,n,a=e[0],s=e[1],i=this._parameters,r=1-s,o="";for(parameterKeys=Object.keys(i),parameterKeyCount=parameterKeys.length,t=0;parameterKeyCount>t;t++)n=parameterKeys[t],jParameter=i[n],jParameterData=jParameter.data,"rotateX"!==n&&"rotateY"!==n&&"rotateZ"!==n&&jParameterData[a]!==void 0&&jParameterData[a+1]!==void 0&&(o+=n+":"+1e-5*(1e5*(jParameterData[a]*r+jParameterData[a+1]*s)>>0)+jParameter.units+";");return o}},transformVectorArray:{value:function(e,t){var n,a,s=e.length,i=[];for(a=0;s>a;a++)n=e[a],n&&(i[a]=[n[0]*t[0]+n[1]*t[4]+n[2]*t[8]+t[12],n[0]*t[1]+n[1]*t[5]+n[2]*t[9]+t[13],n[0]*t[2]+n[1]*t[6]+n[2]*t[10]+t[14]]);return i}},transform:{value:function(e){var t=new a;return t._densities=this._densities,t._densitySummation=this._densitySummation,t._knots=this.transformVectorArray(this.knots,e),t._previousHandlers=this.transformVectorArray(this.previousHandlers,e),t._nextHandlers=this.transformVectorArray(this.nextHandlers,e),t}},deCasteljau:{value:function(e,t,n,a,s){var i=1-s,r=i*e[0]+s*t[0],o=i*t[0]+s*n[0],l=i*n[0]+s*a[0],p=i*r+s*o,c=i*o+s*l,u=i*p+s*c,h=i*e[1]+s*t[1],d=i*t[1]+s*n[1],m=i*n[1]+s*a[1],g=i*h+s*d,f=i*d+s*m,v=i*g+s*f,b=i*e[2]+s*t[2],y=i*t[2]+s*n[2],w=i*n[2]+s*a[2],_=i*b+s*y,E=i*y+s*w,x=i*_+s*E;return[[e,[r,h,b],[p,g,_],[u,v,x]],[[u,v,x],[c,f,E],[l,m,w],a]]}},cubic:{enumerable:!1,value:function(e,t,n,a,s){return((e*s+t)*s+n)*s+a}},cubeRoot:{enumerable:!1,value:function(e){return e>0?Math.pow(e,1/3):-Math.pow(-e,1/3)}},cubicRealRoots:{enumerable:!1,value:function(e,t,n,a){var s=1e-100,i=Math;if(-s>e||e>s){var r=1/e,o=t*r,l=n*r,p=(3*l-o*o)*(1/9),c=(4.5*o*l-13.5*a*r-o*o*o)*(1/27),u=p*p*p+c*c;if(u>s){var h=i.sqrt(u);return[this.cubeRoot(c+h)+this.cubeRoot(c-h)+o*(-1/3)]}if(u>-s){if(-s>c||c>s){var d=this.cubeRoot(c),m=2*d+o*(-1/3),g=o*(-1/3)-d;return g>m?[m,g]:[g,m]}return[o*(-1/3)]}var f=i.acos(c/i.sqrt(-p*p*p))*(1/3),v=i.sqrt(-p),b=1.7320508075688772*v*i.sin(f),y=o*(-1/3);return v*=i.cos(f),[y-v-b,y-v+b,y+2*v]}if(-s>t||t>s){var w=n*n-4*t*a;return w>=0?(w=i.sqrt(w),[(-n-w)/(2*t),(w-n)/(2*t)]):[]}return-s>n||n>s?[-a/n]:[]}},_halfPI:{enumerable:!1,value:.5*Math.PI},reflectionMatrix:{enumerable:!1,value:function(e,t,n,a){var s=Math,i=this._halfPI-s.atan2(t,e),r=s.sin(i),o=s.cos(i),l=this._halfPI-s.atan2(n,e*r+t*o),p=s.sin(l);return a[0]=p*r,a[1]=o*p,a[2]=s.cos(l),a}},reflectedY:{enumerable:!1,value:function(e,t,n,a){return e*a[0]+t*a[1]+n*a[2]}},directedPlaneBezierIntersection:{enumerable:!1,value:function(e,t,n,a,s,i,r,o,l){for(var p,c,u=this.reflectionMatrix(a[0],a[1],a[2],l),h=this.reflectedY(s[0]-e,s[1]-t,s[2]-n,u),d=this.reflectedY(i[0]-e,i[1]-t,i[2]-n,u),m=this.reflectedY(r[0]-e,r[1]-t,r[2]-n,u),g=this.reflectedY(o[0]-e,o[1]-t,o[2]-n,u),f=3*(d-m)+g-h,v=3*(h+m)-6*d,b=3*(d-h),y=this.cubicRealRoots(f,v,b,h),w=0,_=0,E=[];y.length>_&&0>=y[_];)_++;for(;y.length>_&&1>y[_];)p=w,w=y[_],c=.5*(p+w),this.cubic(f,v,b,h,c)>=0&&E.push([p,w]),_++;return c=.5*(w+1),this.cubic(f,v,b,h,c)>=0&&E.push([w,1]),E}}})}});