montageDefine("dea6a74","index",{dependencies:["net","tls","http","https","events","assert","util"],factory:function(e,t,n){"use strict";function l(e){var t=new d(e);return t.request=s.request,t}function c(e){var t=new d(e);return t.request=s.request,t.createSocket=v,t}function h(e){var t=new d(e);return t.request=o.request,t}function p(e){var t=new d(e);return t.request=o.request,t.createSocket=v,t}function d(e){var t=this;t.options=e||{},t.proxyOptions=t.options.proxy||{},t.maxSockets=t.options.maxSockets||s.Agent.defaultMaxSockets,t.requests=[],t.sockets=[],t.on("free",function(n,r,i){for(var s=0,o=t.requests.length;s<o;++s){var u=t.requests[s];if(u.host===r&&u.port===i){t.requests.splice(s,1),u.request.onSocket(n);return}}n.destroy(),t.removeSocket(n)})}function v(e,t){var n=this;d.prototype.createSocket.call(n,e,function(r){var s=i.connect(0,m({},n.options,{servername:e.host,socket:r}));t(s)})}function m(e){for(var t=1,n=arguments.length;t<n;++t){var r=arguments[t];if(typeof r=="object"){var i=Object.keys(r);for(var s=0,o=i.length;s<o;++s){var u=i[s];r[u]!==undefined&&(e[u]=r[u])}}}return e}var r=e("net"),i=e("tls"),s=e("http"),o=e("https"),u=e("events"),a=e("assert"),f=e("util");t.httpOverHttp=l,t.httpsOverHttp=c,t.httpOverHttps=h,t.httpsOverHttps=p,f.inherits(d,u.EventEmitter),d.prototype.addRequest=function(t,n,r){var i=this;if(i.sockets.length>=this.maxSockets){i.requests.push({host:n,port:r,request:t});return}i.createSocket({host:n,port:r,request:t},function(e){function s(){i.emit("free",e,n,r)}function o(t){i.removeSocket(),e.removeListener("free",s),e.removeListener("close",o),e.removeListener("agentRemove",o)}e.on("free",s),e.on("close",o),e.on("agentRemove",o),t.onSocket(e)})},d.prototype.createSocket=function(t,n){function u(e){e.upgrade=!0}function f(e,t,n){process.nextTick(function(){l(e,t,n)})}function l(e,s,u){o.removeAllListeners(),s.removeAllListeners();if(e.statusCode===200)a.equal(u.length,0),g("tunneling connection has established"),r.sockets[r.sockets.indexOf(i)]=s,n(s);else{g("tunneling socket could not be established, statusCode=%d",e.statusCode);var f=new Error("tunneling socket could not be established, statusCode="+e.statusCode);f.code="ECONNRESET",t.request.emit("error",f),r.removeSocket(i)}}function c(e){o.removeAllListeners(),g("tunneling socket could not be established, cause=%s\n",e.message,e.stack);var n=new Error("tunneling socket could not be established, cause="+e.message);n.code="ECONNRESET",t.request.emit("error",n),r.removeSocket(i)}var r=this,i={};r.sockets.push(i);var s=m({},r.proxyOptions,{method:"CONNECT",path:t.host+":"+t.port,agent:!1});s.proxyAuth&&(s.headers=s.headers||{},s.headers["Proxy-Authorization"]="Basic "+(new Buffer(s.proxyAuth)).toString("base64")),g("making CONNECT request");var o=r.request(s);o.useChunkedEncodingByDefault=!1,o.once("response",u),o.once("upgrade",f),o.once("connect",l),o.once("error",c),o.end()},d.prototype.removeSocket=function(t){var n=this.sockets.indexOf(t);if(n===-1)return;this.sockets.splice(n,1);var r=this.requests.shift();r&&this.createSocket(r,function(e){r.request.onSocket(e)})};var g;process.env.NODE_DEBUG&&/\btunnel\b/.test(process.env.NODE_DEBUG)?g=function(){var e=Array.prototype.slice.call(arguments);typeof e[0]=="string"?e[0]="TUNNEL: "+e[0]:e.unshift("TUNNEL:"),console.error.apply(console,e)}:g=function(){},t.debug=g}})