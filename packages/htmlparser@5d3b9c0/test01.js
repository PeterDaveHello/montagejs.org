function parse(e){switch(e.mode){case Mode.Text:return parseText(e);case Mode.Tags:return parseTags(e);case Mode.Attr:return parseAttr(e);case Mode.CData:return parseCData(e);case Mode.Comment:return parseComment(e)}}function parseText(e){console.log("parseText",e);var t=e.data.indexOf("<",e.pos);if(t===-1)e.pending!==null?(e.output.push(e.pending+e.data.substring(e.pos,e.data.length)),e.pending=null):e.output.push(e.data.substring(e.pos,e.data.length)),e.pos=e.data.length;else{var n="";e.pending!==null?(n=e.pending+e.data.substring(e.pos,t-1),e.pending=null):n=e.data.substring(e.pos,t-1),e.output.push({type:Mode.Text,data:n}),e.pos=t+1,e.mode=Mode.Tags}}function parseTags(e){console.log("parseTags",e),re_parseTags.lastIndex=e.pos;var t=re_parseTags.exec(e.data);t&&t[0]===">"&&console.log("Just tag name",e.data.substring(e.pos,t.index)),process.exit()}function parseAttr(e){console.log("parseAttr",e)}function parseCData(e){console.log("parseCData",e)}function parseComment(e){console.log("parseComment",e)}var data="starting text\n<htmL>\n	<body>\n		<div style=\"width:100%\"></div>\n		<div name='\"foo\"'>xxx</div>\n		<div bar=baz>xxx</div>\n		<div wrong='<foo>'>xxx</div>\n	</BODY>\n</html>\nending text";console.log(data);var Mode={Text:"text",Tags:"tag",Attr:"attr",CData:"cdata",Comment:"comment"},state={mode:Mode.Text,pos:0,data:data,pending:null,output:[]},re_parseTags=/[\s>]/g;while(state.pos<state.data.length)parse(state)