montageDefine("5d3b9c0","lib/htmlparser",{dependencies:[],factory:function(e,t,n){(function(){function r(){return typeof e=="function"&&typeof t=="object"&&typeof n=="object"&&typeof __filename=="string"&&typeof __dirname=="string"}function s(e,t){this._options=t?t:{},this._options.includeLocation==undefined&&(this._options.includeLocation=!1),this.validateHandler(e),this._handler=e,this.reset()}function o(e){o.super_.call(this,e,{ignoreWhitespace:!0,verbose:!1,enforceEmptyTags:!1})}function u(e,t){this.reset(),this._options=t?t:{},this._options.ignoreWhitespace==undefined&&(this._options.ignoreWhitespace=!1),this._options.verbose==undefined&&(this._options.verbose=!0),this._options.enforceEmptyTags==undefined&&(this._options.enforceEmptyTags=!0),typeof e=="function"&&(this._callback=e)}function f(e,t){var n=function(){};n.prototype=t.prototype,e.super_=t,e.prototype=new n,e.prototype.constructor=e}if(!r()){if(!this.Tautologistics)this.Tautologistics={};else if(this.Tautologistics.NodeHtmlParser)return;this.Tautologistics.NodeHtmlParser={},t=this.Tautologistics.NodeHtmlParser}var i={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag"};s._reTrim=/(^\s+|\s+$)/g,s._reTrimComment=/(^\!--|--$)/g,s._reWhitespace=/\s/g,s._reTagName=/^\s*(\/?)\s*([^\s\/]+)/,s._reAttrib=/([^=<>\"\'\s]+)\s*=\s*"([^"]*)"|([^=<>\"\'\s]+)\s*=\s*'([^']*)'|([^=<>\"\'\s]+)\s*=\s*([^'"\s]+)|([^=<>\"\'\s\/]+)/g,s._reTags=/[\<\>]/g,s.prototype.parseComplete=function(t){this.reset(),this.parseChunk(t),this.done()},s.prototype.parseChunk=function(t){this._done&&this.handleError(new Error("Attempted to parse chunk after parsing already done")),this._buffer+=t,this.parseTags()},s.prototype.done=function(){if(this._done)return;this._done=!0;if(this._buffer.length){var t=this._buffer;this._buffer="";var n={raw:t,data:this._parseState==i.Text?t:t.replace(s._reTrim,""),type:this._parseState};if(this._parseState==i.Tag||this._parseState==i.Script||this._parseState==i.Style)n.name=this.parseTagName(n.data);this.parseAttribs(n),this._elements.push(n)}this.writeHandler(),this._handler.done()},s.prototype.reset=function(){this._buffer="",this._done=!1,this._elements=[],this._elementsCurrent=0,this._current=0,this._next=0,this._location={row:0,col:0,charOffset:0,inBuffer:0},this._parseState=i.Text,this._prevTagSep="",this._tagStack=[],this._handler.reset()},s.prototype._options=null,s.prototype._handler=null,s.prototype._buffer=null,s.prototype._done=!1,s.prototype._elements=null,s.prototype._elementsCurrent=0,s.prototype._current=0,s.prototype._next=0,s.prototype._location=null,s.prototype._parseState=i.Text,s.prototype._prevTagSep="",s.prototype._tagStack=null,s.prototype.parseTagAttribs=function(t){var n=t.length,r=0;while(r<n){var s=t[r++];(s.type==i.Tag||s.type==i.Script||s.type==i.style)&&this.parseAttribs(s)}return t},s.prototype.parseAttribs=function(t){if(t.type!=i.Script&&t.type!=i.Style&&t.type!=i.Tag)return;var n=t.data.split(s._reWhitespace,1)[0],r=t.data.substring(n.length);if(r.length<1)return;var o;s._reAttrib.lastIndex=0;while(o=s._reAttrib.exec(r))t.attribs==undefined&&(t.attribs={}),typeof o[1]=="string"&&o[1].length?t.attribs[o[1]]=o[2]:typeof o[3]=="string"&&o[3].length?t.attribs[o[3].toString()]=o[4].toString():typeof o[5]=="string"&&o[5].length?t.attribs[o[5]]=o[6]:typeof o[7]=="string"&&o[7].length&&(t.attribs[o[7]]=o[7])},s.prototype.parseTagName=function(t){if(t==null||t=="")return"";var n=s._reTagName.exec(t);return n?(n[1]?"/":"")+n[2]:""},s.prototype.parseTags=function(){var t=this._buffer.length-1;while(s._reTags.test(this._buffer)){this._next=s._reTags.lastIndex-1;var n=this._buffer.charAt(this._next),r=this._buffer.substring(this._current,this._next),o={raw:r,data:this._parseState==i.Text?r:r.replace(s._reTrim,""),type:this._parseState},u=this.parseTagName(o.data);if(this._tagStack.length)if(this._tagStack[this._tagStack.length-1]==i.Script){if(u.toLowerCase()=="/script")this._tagStack.pop();else if(o.raw.indexOf("!--")!=0){o.type=i.Text;if(this._elements.length&&this._elements[this._elements.length-1].type==i.Text){var a=this._elements[this._elements.length-1];a.raw=a.data=a.raw+this._prevTagSep+o.raw,o.raw=o.data=""}}}else if(this._tagStack[this._tagStack.length-1]==i.Style){if(u.toLowerCase()=="/style")this._tagStack.pop();else if(o.raw.indexOf("!--")!=0){o.type=i.Text;if(this._elements.length&&this._elements[this._elements.length-1].type==i.Text){var a=this._elements[this._elements.length-1];o.raw!=""?(a.raw=a.data=a.raw+this._prevTagSep+o.raw,o.raw=o.data=""):a.raw=a.data=a.raw+this._prevTagSep}else o.raw!=""&&(o.raw=o.data=o.raw)}}else if(this._tagStack[this._tagStack.length-1]==i.Comment){var f=o.raw.length;if(o.raw.charAt(f-2)=="-"&&o.raw.charAt(f-1)=="-"&&n==">"){this._tagStack.pop();if(this._elements.length&&this._elements[this._elements.length-1].type==i.Comment){var a=this._elements[this._elements.length-1];a.raw=a.data=(a.raw+o.raw).replace(s._reTrimComment,""),o.raw=o.data="",o.type=i.Text}else o.type=i.Comment}else{o.type=i.Comment;if(this._elements.length&&this._elements[this._elements.length-1].type==i.Comment){var a=this._elements[this._elements.length-1];a.raw=a.data=a.raw+o.raw+n,o.raw=o.data="",o.type=i.Text}else o.raw=o.data=o.raw+n}}if(o.type==i.Tag){o.name=u;var l=u.toLowerCase();if(o.raw.indexOf("!--")==0){o.type=i.Comment,delete o.name;var f=o.raw.length;o.raw.charAt(f-1)=="-"&&o.raw.charAt(f-2)=="-"&&n==">"?o.raw=o.data=o.raw.replace(s._reTrimComment,""):(o.raw+=n,this._tagStack.push(i.Comment))}else o.raw.indexOf("!")==0||o.raw.indexOf("?")==0?o.type=i.Directive:l=="script"?(o.type=i.Script,o.data.charAt(o.data.length-1)!="/"&&this._tagStack.push(i.Script)):l=="/script"?o.type=i.Script:l=="style"?(o.type=i.Style,o.data.charAt(o.data.length-1)!="/"&&this._tagStack.push(i.Style)):l=="/style"&&(o.type=i.Style);o.name&&o.name.charAt(0)=="/"&&(o.data=o.name)}if(o.raw!=""||o.type!=i.Text)this._options.includeLocation&&!o.location&&(o.location=this.getLocation(o.type==i.Tag)),this.parseAttribs(o),this._elements.push(o),o.type!=i.Text&&o.type!=i.Comment&&o.type!=i.Directive&&o.data.charAt(o.data.length-1)=="/"&&this._elements.push({raw:"/"+o.name,data:"/"+o.name,name:"/"+o.name,type:o.type});this._parseState=n=="<"?i.Tag:i.Text,this._current=this._next+1,this._prevTagSep=n}this._options.includeLocation&&(this.getLocation(),this._location.row+=this._location.inBuffer,this._location.inBuffer=0,this._location.charOffset=0),this._buffer=this._current<=t?this._buffer.substring(this._current):"",this._current=0,this.writeHandler()},s.prototype.getLocation=function(t){var n,r=this._location,i=this._current-(t?1:0),s=t&&r.charOffset==0&&this._current==0;for(;r.charOffset<i;r.charOffset++)n=this._buffer.charAt(r.charOffset),n=="\n"?(r.inBuffer++,r.col=0):n!="\r"&&r.col++;return{line:r.row+r.inBuffer+1,col:r.col+(s?0:1)}},s.prototype.validateHandler=function(t){if(typeof t!="object")throw new Error("Handler is not an object");if(typeof t.reset!="function")throw new Error("Handler method 'reset' is invalid");if(typeof t.done!="function")throw new Error("Handler method 'done' is invalid");if(typeof t.writeTag!="function")throw new Error("Handler method 'writeTag' is invalid");if(typeof t.writeText!="function")throw new Error("Handler method 'writeText' is invalid");if(typeof t.writeComment!="function")throw new Error("Handler method 'writeComment' is invalid");if(typeof t.writeDirective!="function")throw new Error("Handler method 'writeDirective' is invalid")},s.prototype.writeHandler=function(t){t=!!t;if(this._tagStack.length&&!t)return;while(this._elements.length){var n=this._elements.shift();switch(n.type){case i.Comment:this._handler.writeComment(n);break;case i.Directive:this._handler.writeDirective(n);break;case i.Text:this._handler.writeText(n);break;default:this._handler.writeTag(n)}}},s.prototype.handleError=function(t){if(typeof this._handler.error!="function")throw t;this._handler.error(t)},f(o,u),o.prototype.done=function(){var t={},n,r=a.getElementsByTagName(function(e){return e=="rss"||e=="feed"},this.dom,!1);r.length&&(n=r[0]);if(n){if(n.name=="rss"){t.type="rss",n=n.children[0],t.id="";try{t.title=a.getElementsByTagName("title",n.children,!1)[0].children[0].data}catch(i){}try{t.link=a.getElementsByTagName("link",n.children,!1)[0].children[0].data}catch(i){}try{t.description=a.getElementsByTagName("description",n.children,!1)[0].children[0].data}catch(i){}try{t.updated=new Date(a.getElementsByTagName("lastBuildDate",n.children,!1)[0].children[0].data)}catch(i){}try{t.author=a.getElementsByTagName("managingEditor",n.children,!1)[0].children[0].data}catch(i){}t.items=[],a.getElementsByTagName("item",n.children).forEach(function(e,n,r){var i={};try{i.id=a.getElementsByTagName("guid",e.children,!1)[0].children[0].data}catch(s){}try{i.title=a.getElementsByTagName("title",e.children,!1)[0].children[0].data}catch(s){}try{i.link=a.getElementsByTagName("link",e.children,!1)[0].children[0].data}catch(s){}try{i.description=a.getElementsByTagName("description",e.children,!1)[0].children[0].data}catch(s){}try{i.pubDate=new Date(a.getElementsByTagName("pubDate",e.children,!1)[0].children[0].data)}catch(s){}t.items.push(i)})}else{t.type="atom";try{t.id=a.getElementsByTagName("id",n.children,!1)[0].children[0].data}catch(i){}try{t.title=a.getElementsByTagName("title",n.children,!1)[0].children[0].data}catch(i){}try{t.link=a.getElementsByTagName("link",n.children,!1)[0].attribs.href}catch(i){}try{t.description=a.getElementsByTagName("subtitle",n.children,!1)[0].children[0].data}catch(i){}try{t.updated=new Date(a.getElementsByTagName("updated",n.children,!1)[0].children[0].data)}catch(i){}try{t.author=a.getElementsByTagName("email",n.children,!0)[0].children[0].data}catch(i){}t.items=[],a.getElementsByTagName("entry",n.children).forEach(function(e,n,r){var i={};try{i.id=a.getElementsByTagName("id",e.children,!1)[0].children[0].data}catch(s){}try{i.title=a.getElementsByTagName("title",e.children,!1)[0].children[0].data}catch(s){}try{i.link=a.getElementsByTagName("link",e.children,!1)[0].attribs.href}catch(s){}try{i.description=a.getElementsByTagName("summary",e.children,!1)[0].children[0].data}catch(s){}try{i.pubDate=new Date(a.getElementsByTagName("updated",e.children,!1)[0].children[0].data)}catch(s){}t.items.push(i)})}this.dom=t}o.super_.prototype.done.call(this)},u._emptyTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1},u.reWhitespace=/^\s*$/,u.prototype.dom=null,u.prototype.reset=function(){this.dom=[],this._done=!1,this._tagStack=[],this._tagStack.last=function(){return this.length?this[this.length-1]:null}},u.prototype.done=function(){this._done=!0,this.handleCallback(null)},u.prototype.writeTag=function(t){this.handleElement(t)},u.prototype.writeText=function(t){if(this._options.ignoreWhitespace&&u.reWhitespace.test(t.data))return;this.handleElement(t)},u.prototype.writeComment=function(t){this.handleElement(t)},u.prototype.writeDirective=function(t){this.handleElement(t)},u.prototype.error=function(t){this.handleCallback(t)},u.prototype._options=null,u.prototype._callback=null,u.prototype._done=!1,u.prototype._tagStack=null,u.prototype.handleCallback=function(t){if(typeof this._callback!="function"){if(t)throw t;return}this._callback(t,this.dom)},u.prototype.isEmptyTag=function(e){var t=e.name.toLowerCase();return t.charAt(0)=="/"&&(t=t.substring(1)),this._options.enforceEmptyTags&&!!u._emptyTags[t]},u.prototype.handleElement=function(t){this._done&&this.handleCallback(new Error("Writing to the handler after done() called is not allowed without a reset()")),this._options.verbose||(delete t.raw,(t.type=="tag"||t.type=="script"||t.type=="style")&&delete t.data);if(!this._tagStack.last())t.type!=i.Text&&t.type!=i.Comment&&t.type!=i.Directive?t.name.charAt(0)!="/"&&(this.dom.push(t),this.isEmptyTag(t)||this._tagStack.push(t)):this.dom.push(t);else if(t.type!=i.Text&&t.type!=i.Comment&&t.type!=i.Directive)if(t.name.charAt(0)=="/"){var n=t.name.substring(1);if(!this.isEmptyTag(t)){var r=this._tagStack.length-1;while(r>-1&&this._tagStack[r--].name!=n);if(r>-1||this._tagStack[0].name==n)while(r<this._tagStack.length-1)this._tagStack.pop()}}else this._tagStack.last().children||(this._tagStack.last().children=[]),this._tagStack.last().children.push(t),this.isEmptyTag(t)||this._tagStack.push(t);else this._tagStack.last().children||(this._tagStack.last().children=[]),this._tagStack.last().children.push(t)};var a={testElement:function(t,n){if(!n)return!1;for(var r in t)if(r=="tag_name"){if(n.type!="tag"&&n.type!="script"&&n.type!="style")return!1;if(!t.tag_name(n.name))return!1}else if(r=="tag_type"){if(!t.tag_type(n.type))return!1}else if(r=="tag_contains"){if(n.type!="text"&&n.type!="comment"&&n.type!="directive")return!1;if(!t.tag_contains(n.data))return!1}else if(!n.attribs||!t[r](n.attribs[r]))return!1;return!0},getElements:function(t,n,r,i){function u(e){return function(t){return t==e}}r=r===undefined||r===null||!!r,i=isNaN(parseInt(i))?-1:parseInt(i);if(!n)return[];var s=[],o;for(var f in t)typeof t[f]!="function"&&(t[f]=u(t[f]));a.testElement(t,n)&&s.push(n);if(i>=0&&s.length>=i)return s;if(r&&n.children)o=n.children;else{if(!(n instanceof Array))return s;o=n}for(var l=0;l<o.length;l++){s=s.concat(a.getElements(t,o[l],r,i));if(i>=0&&s.length>=i)break}return s},getElementById:function(t,n,r){var i=a.getElements({id:t},n,r,1);return i.length?i[0]:null},getElementsByTagName:function(t,n,r,i){return a.getElements({tag_name:t},n,r,i)},getElementsByTagType:function(t,n,r,i){return a.getElements({tag_type:t},n,r,i)}};t.Parser=s,t.DefaultHandler=u,t.RssHandler=o,t.ElementType=i,t.DomUtils=a})()}})