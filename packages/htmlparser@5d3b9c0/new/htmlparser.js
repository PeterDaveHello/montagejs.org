(function(){function e(){return typeof require=="function"&&typeof exports=="object"&&typeof module=="object"&&typeof __filename=="string"&&typeof __dirname=="string"}function r(e){var r;e.isScript?(n.lastIndex=e.pos,r=n.exec(e.data),r=r?r.index:-1):r=e.data.indexOf("<",e.pos);var i=r===-1?e.data.substring(e.pos,e.data.length):e.data.substring(e.pos,r);r<0&&e.done&&(r=e.data.length);if(r<0){if(e.isScript){e.needData=!0;return}e.pendingText||(e.pendingText=[]),e.pendingText.push(e.data.substring(e.pos,e.data.length)),e.pos=e.data.length}else e.pendingText?(e.pendingText.push(e.data.substring(e.pos,r)),i=e.pendingText.join(""),e.pendingText=null):i=e.data.substring(e.pos,r),i!==""&&e.output.push({type:t.Text,data:i}),e.pos=r+1,e.mode=t.Tag}function s(e){i.lastIndex=e.pos;var n=i.exec(e.data);if(n){if(!n[1]&&n[2].substr(0,3)==="!--"){e.mode=t.Comment,e.pos+=3;return}if(!n[1]&&n[2].substr(0,8)==="![CDATA["){e.mode=t.CData,e.pos+=8;return}if(!e.done&&e.pos+n[0].length===e.data.length){e.needData=!0;return}var r;n[4]===">"?(e.mode=t.Text,r=n[0].substr(0,n[0].length-1)):(e.mode=t.Attr,r=n[0]),e.pos+=n[0].length;var s={type:t.Tag,name:n[1]+n[2],raw:r};e.mode===t.Attr&&(e.lastTag=s),s.name.toLowerCase()==="script"?e.isScript=!0:s.name.toLowerCase()==="/script"&&(e.isScript=!1),e.output.push(s)}else e.needData=!0}function u(e){o.lastIndex=e.pos;var t=o.exec(e.data);return t?e.pos+t[0].length!==o.lastIndex?null:{match:t[0],name:t[1]}:null}function l(e){a.lastIndex=e.pos;var t=a.exec(e.data);return t?e.pos+t[0].length!==a.lastIndex?null:{match:t[0],value:t[1]||t[2]||t[3]}:e.done?(f.lastIndex=e.pos,t=f.exec(e.data),t?{match:t[0],value:t[1]!==""?t[1]:null}:null):null}function p(e){var n=u(e);if(!n){h.lastIndex=e.pos;var r=h.exec(e.data);if(r&&r.index===e.pos){if(!e.done&&!r[2]&&e.pos+r[0].length===e.data.length){e.needData=!0;return}e.lastTag.raw+=r[1],e.output.push({type:t.Tag,name:"/"+e.lastTag.name,raw:null}),e.pos+=r[1].length}var i=e.data.indexOf(">",e.pos);if(i<0){if(e.done){e.lastTag.raw+=e.data.substr(e.pos),e.pos=e.data.length;return}e.needData=!0}else e.pos=i+1,e.mode=t.Text;return}if(!e.done&&e.pos+n.match.length===e.data.length)return e.needData=!0,null;e.pos+=n.match.length;var s=l(e);if(s){if(!e.done&&e.pos+s.match.length===e.data.length){e.needData=!0,e.pos-=n.match.length;return}e.pos+=s.match.length}else{c.lastIndex=e.pos;if(c.exec(e.data)){e.needData=!0,e.pos-=n.match.length;return}s={match:"",value:null}}e.lastTag.raw+=n.match+s.match,e.output.push({type:t.Attr,name:n.name,data:s.value})}function v(e){var n=e.data.indexOf("]]>",e.pos);n<0&&e.done&&(n=e.data.length);if(n<0){d.lastIndex=e.pos;var r=d.exec(e.data);if(r){e.needData=!0;return}e.pendingText||(e.pendingText=[]),e.pendingText.push(e.data.substr(e.pos,e.data.length)),e.pos=e.data.length,e.needData=!0}else{var i;e.pendingText?(e.pendingText.push(e.data.substring(e.pos,n)),i=e.pendingText.join(""),e.pendingText=null):i=e.data.substring(e.pos,n),e.output.push({type:t.CData,data:i}),e.mode=t.Text,e.pos=n+3}}function g(e){var n=e.data.indexOf("-->",e.pos);n<0&&e.done&&(n=e.data.length);if(n<0){m.lastIndex=e.pos;var r=m.exec(e.data);if(r){e.needData=!0;return}e.pendingText||(e.pendingText=[]),e.pendingText.push(e.data.substr(e.pos,e.data.length)),e.pos=e.data.length,e.needData=!0}else{var i;e.pendingText?(e.pendingText.push(e.data.substring(e.pos,n)),i=e.pendingText.join(""),e.pendingText=null):i=e.data.substring(e.pos,n),e.output.push({type:t.Comment,data:i}),e.mode=t.Text,e.pos=n+3}}function y(e){switch(e.mode){case t.Text:return r(e);case t.Tag:return s(e);case t.Attr:return p(e);case t.CData:return v(e);case t.Comment:return g(e)}}function b(e,t){this._options=t?t:{},this._options.includeLocation==undefined&&(this._options.includeLocation=!1),this.validateHandler(e);var n=this;this._handler=e,this.reset()}function w(e,t){this.reset(),this._options=e?e:{},this._options.ignoreWhitespace==undefined&&(this._options.ignoreWhitespace=!1),this._options.trackPosition==undefined&&(this._options.trackPosition=!1),this._options.verbose==undefined&&(this._options.verbose=!0),this._options.enforceEmptyTags==undefined&&(this._options.enforceEmptyTags=!0),this._options.caseSensitiveTags==undefined&&(this._options.caseSensitiveTags=!1),this._options.caseSensitiveAttr==undefined&&(this._options.caseSensitiveAttr=!1),typeof t=="function"&&(this._callback=t)}if(!e()){if(!this.Tautologistics)this.Tautologistics={};else if(this.Tautologistics.NodeHtmlParser)return;this.Tautologistics.NodeHtmlParser={},exports=this.Tautologistics.NodeHtmlParser}var t={Text:"text",Tag:"tag",Attr:"attr",CData:"cdata",Comment:"comment"},n=/<\s*\/\s*script/ig,i=/\s*(\/?)\s*([^\s>\/]+)(\s*)(>?)/g,o=/\s*([^=<>\s'"\/]+)\s*/g,a=/\s*=\s*(?:'([^']*)'|"([^"]*)"|([^'"\s\/>]+))\s*/g,f=/\s*=\s*['"]?(.*)$/g,c=/\s*=\s*['"]?/g,h=/(\s*\/\s*)(>?)/g,d=/\]{1,2}$/,m=/\-{1,2}$/;b.prototype.reset=function(){this.state={mode:t.Text,pos:0,data:null,pendingText:null,lastTag:null,isScript:!1,needData:!1,done:!1}},b.prototype.parseChunk=function(t){this.state.needData=!1,this.state.data=this.state.data!==null?this.state.data.substr(this.pos)+t:t;while(this.state.pos<this.state.data.length&&!this.state.needData)y(this.state)},b.prototype.parseComplete=function(t){this.reset(),this.parseChunk(t),this.done()},b.prototype.done=function(){this.state.done=!0,y(this.state)},b.prototype.validateHandler=function(t){if(typeof t!="object")throw new Error("Handler is not an object");if(typeof t.reset!="function")throw new Error("Handler method 'reset' is invalid");if(typeof t.done!="function")throw new Error("Handler method 'done' is invalid");if(typeof t.write!="function")throw new Error("Handler method 'write' is invalid");if(typeof t.error!="function")throw new Error("Handler method 'error' is invalid")},w._emptyTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1},w.reWhitespace=/^\s*$/,w.prototype.dom=null,w.prototype.reset=function(){this.dom=[],this._done=!1,this._tagStack=[],this._tagStack.last=function(){return this.length?this[this.length-1]:null}},w.prototype.done=function(){this._done=!0,this.handleCallback(null)},w.prototype.error=function(t){this.handleCallback(t)},w.prototype.handleCallback=function(t){if(typeof this._callback!="function"){if(t)throw t;return}this._callback(t,this.dom)},w.prototype.isEmptyTag=function(t){var n=t.name.toLowerCase();return n.charAt(0)=="/"&&(n=n.substring(1)),this._options.enforceEmptyTags&&!!w._emptyTags[n]},w.prototype._copyElement=function(n){var r={type:n.type};this._options.verbose&&n.raw!==undefined&&(r.raw=n.raw);if(n.name!==undefined)switch(n.type){case t.Tag:r.name=this._options.caseSensitiveTags?n.name:n.name.toLowerCase();break;case t.Attr:r.name=this._options.caseSensitiveAttr?n.name:n.name.toLowerCase();break;default:r.name=this._options.caseSensitiveTags?n.name:n.name.toLowerCase()}return n.data!==undefined&&(r.data=n.name),r},w.prototype.write=function(n){this._done&&this.handleCallback(new Error("Writing to the handler after done() called is not allowed without a reset()"));if(n.type===t.Text&&this._options.ignoreWhitespace&&w.reWhitespace.test(n.data))return;var r;this._options.verbose||(delete n.raw,(n.type=="tag"||n.type=="script"||n.type=="style")&&delete n.data);if(!this._tagStack.last())n.type!=t.Text&&n.type!=t.Comment&&n.type!=t.CData?n.name.charAt(0)!="/"&&(r=this._copyElement(n),this.dom.push(r),this.isEmptyTag(r)||this._tagStack.push(r)):this.dom.push(this._copyElement(n));else if(n.type!=t.Text&&n.type!=t.Comment&&n.type!=t.CData)if(n.name.charAt(0)=="/"){var i=this._options.caseSensitiveTags?n.name.substring(1):n.name.substring(1).toLowerCase();if(!this.isEmptyTag(n)){var s=this._tagStack.length-1;while(s>-1&&this._tagStack[s--].name!=i);if(s>-1||this._tagStack[0].name==i)while(s<this._tagStack.length-1)this._tagStack.pop()}}else this._tagStack.last().children||(this._tagStack.last().children=[]),r=this._copyElement(n),this._tagStack.last().children.push(r),this.isEmptyTag(r)||this._tagStack.push(r);else this._tagStack.last().children||(this._tagStack.last().children=[]),this._tagStack.last().children.push(this._copyElement(n))},w.prototype._options=null,w.prototype._callback=null,w.prototype._done=!1,w.prototype._tagStack=null,exports.Parser=b,exports.HtmlHandler=w,exports.ElementType=t})()