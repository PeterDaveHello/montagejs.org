<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    
    <title>Spec: ChangeNotification - Montage Docs</title>
    
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400,700" />
    <link rel="stylesheet" href="../stylesheets/normalize.css" />
    <link rel="stylesheet" href="../stylesheets/base.css" />
    <link rel="stylesheet" href="../stylesheets/pages.css" />
    <link rel="stylesheet" href="../stylesheets/solarized.css" />
        
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->    
</head>
<body class="docs">
  
    <header class="header header-pages pushed">
        <div class="header-container">
            <a href="/"><img class="logo" src="../images/logo-pages.png" alt="Montage" /></a>
            <nav class="nav">
                <a class="nav-item" href="/apps">Apps</a>
                <a class="nav-item active" href="/docs">Docs</a>
            </nav>
        </div>
    </header>
    
    <section id="docs">
        <article>
            <div class="markdown-body">

<p>Change Notification API Editor François Frisch</p>

<p>Index
Introduction
Functional Description
API
Examples
Integration
Dependencies
Concerns

Introduction</p>

<p>The current API based on addEventListener and handleChange</p>

<ul>
<li>minus and plus are not correct</li>
<li>change type is inconsistent</li>
<li>no hooks before the change happens.
Want to block? no, this is the job of a delegate</li>
<li>consistency because of use of third argument for capture?
use handle... callback, ignore third argument </li>
<li>collision with change event</li>
<li>no way to integrate the @... into the callback name</li>
<li>events are supposed to be immutable</li>
<li>performance optimization</li>
</ul><p>modify in property descriptor...
    We need to add a listener on the property, but it might not be obvious that this is more expensive than get / set.</p>

<p>Functional Description</p>

<p>We implement change listeners as an extension on top of the apis and concepts of the “normal” events &amp; listeners.</p>

<p>Listening to array reference or the content -- not necessary
exposing getProperty arguments in bindings -- open
remove dispatching setter when last listener is removed -- todo
API</p>

<p>PropertyListener
PropertyPath(object, “property.path”, willChange).addEventListener()</p>

<p>registration:</p>

<p>myObject.addPropertyChangeListener(“property.path”, listener | function(){}), beforeChange)
myObject.removePropertyChangeListener(“property.path”, listener | function(){}), beforeChange)</p>

<p>callback:</p>

<p>handle[Identifier]WillChange(change)
handle[Identifier]Change(change)</p>

<p>change.type : “property.path”
change.target : the object where the original change event was dispatched
change.propertyPath : “property.path”
change.currentTarget : object on which we are currently dispatching the change (myObject in this case)
change.plus : the values of the change on the target based on the splice logic, these don’t change
change.minus : the values of the change on the target based on the splice logic, these don’t change</p>

<p>If the value of the property named handle[Identifier]Change is an object we assume that it is a table of callback functions indexed by change event type. </p>

<p>handle[Identifier]Change: {
    value: {
        “property.path”: function(change) {
            this === the listener
        },
        “another.property.path”: function(change) {
            this === the listener
        }
    }
}</p>

<p>var ChangeEvent  = require(“core/event”).ChangeEvent
var WillChangeEvent  = require(“core/event”).WillChangeEvent</p>

<p>this.dispatchEvent(WillChangeEvent.create())
this.doTheChange();
this.dispatchEvent(ChangeEvent.create())</p>

<p>change.propertyPath = “bars.foo”
change.target = myObject</p>

<p>// for arrays
call splice dispatching logic for all operations.</p>

<p>splice 
    changeEvent.minus = removedMembers;
        objects removed
            changeEvent.plus = addedMembers;
        objects added
            changeEvent.changeIndex = index;
        first argument of the splice
            changeEvent.propertyChange = changeType;</p>

<pre><code>for every item in the array
    propertyChange should be tailored to each case
</code></pre>

<p>shift
changeEvent.minus = result;
    the object that was removed
            changeEvent.plus = this[0];
        the new value that replaced the object that was removed
            changeEvent.changeIndex = 0;
            changeEvent.propertyChange = ChangeTypes.REMOVAL;</p>

<pre><code>for every item in the array
    changeEvent.type = "change@" + i;
        index
                changeEvent.minus = i === 0 ? result : this[i - 1];
        old value at the index
                changeEvent.plus = this[i];
</code></pre>

<p>new value at the index
                    changeEvent.changeIndex = i;
            index of change
                    changeEvent.propertyChange = ChangeTypes.REMOVAL; ???
            should be MODIFY</p>

<p>unshift
    changeEvent.minus = undefined;
            changeEvent.plus = Array.prototype.slice.call(arguments, 0);
        Array of object added
            changeEvent.changeIndex = 0;
            changeEvent.propertyChange = ChangeTypes.ADDITION;</p>

<pre><code>for every item in the array
    changeEvent.type = "change@" + i;
        index
                changeEvent.minus = this[addedCount + i];
        old value at the index
                changeEvent.plus = this[i];
</code></pre>

<p>new value at the index
                    changeEvent.changeIndex = i;
            index of change
                    changeEvent.propertyChange = ChangeTypes.ADDITION;
            Same problem as splice</p>

<p>reverse
push
pop
sort</p>

<p>// for maps
get 
set
delete</p>

<p>change.data.changeType = ChangeTypes</p>

                </div>
        </article>
    </section>

    <section id="next" class="next">
        <article>
            <h3 class="title">More help?</h3>
            <div class="cols">
                <div class="col col-1-2">
                    <p>Can't find what you are looking for? Get in touch, we're more than happy in helping answer your questions.
                    </p>
                </div>
                <aside class="col col-1-2">
                    <p><strong>Have feedback or ideas?</strong> Let us know by creating a new <a href="https://github.com/montagejs/montage/issues" target="_blank">issue</a>, join us in <a href="http://webchat.freenode.net/?channels=montage" target="_blank">IRC</a> or post questions to our <a href="https://groups.google.com/forum/?fromgroups#!forum/montagejs" target="_blank">Google Group</a>. We're also on <a href="https://twitter.com/montage_js" target="_blank">Twitter</a> and <a href="https://plus.google.com/116915300739108010954/" target="_blank">Google+</a>.
                    </p>
                </aside>
            </div>
        </article>
    </section>

    
    <section id="social" class="social">
        <article>
            
            <div class="button-group github">
                <iframe src="http://ghbtns.com/github-btn.html?user=montagejs&amp;repo=montage&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="90px" height="20px"></iframe>
                <iframe src="http://ghbtns.com/github-btn.html?user=montagejs&amp;repo=montage&amp;type=fork&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="90px" height="20px"></iframe>
            </div>
            
            
            <div class="button-group twitter">
                <a href="https://twitter.com/share" class="twitter-share-button" data-via="montage_js" data-count="none">Tweet</a>
                <script>!function(e,t,n){var r,i=e.getElementsByTagName(t)[0];e.getElementById(n)||(r=e.createElement(t),r.id=n,r.src="//platform.twitter.com/widgets.js",i.parentNode.insertBefore(r,i))}(document,"script","twitter-wjs")</script>
                <a href="https://twitter.com/montage_js" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @montage_js</a>
                <script>!function(e,t,n){var r,i=e.getElementsByTagName(t)[0];e.getElementById(n)||(r=e.createElement(t),r.id=n,r.src="//platform.twitter.com/widgets.js",i.parentNode.insertBefore(r,i))}(document,"script","twitter-wjs")</script>
            </div>
            
            <div class="button-group g-plus">
                
                <script src="https://apis.google.com/js/plusone.js">"explicit"</script>
                
                <div class="g-plusone" data-size="medium" data-annotation="inline" data-width="200"></div>
                
                <script>gapi.plusone.go()</script>
            </div>
            
        </article>
    </section>
        
    
    <footer class="footer">
        2012 montagejs.org - <a href="https://github.com/montagejs/montagejs.org">Contributions</a> to this page are welcomed.
    </footer>
        
    
    
    <script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-35717912-1"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
    
</body>
</html>