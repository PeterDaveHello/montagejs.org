<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />

    <title>Spec: Multi window application - Montage Docs</title>

    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400,700" />
    <link rel="stylesheet" href="../stylesheets/normalize.css" />
    <link rel="stylesheet" href="../stylesheets/base.css" />
    <link rel="stylesheet" href="../stylesheets/pages.css" />
    <link rel="stylesheet" href="../stylesheets/solarized.css" />

    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body class="docs">

    <header class="header header-pages pushed">
        <div class="header-container">
            <a href="/"><img class="logo" src="../images/logo-pages.png" alt="Montage" /></a>
            <nav class="nav">
                <a class="nav-item" href="/apps">Apps</a>
                <a class="nav-item active" href="/docs">Docs</a>
                <a class="nav-item" href="/apis">APIs</a>
            </nav>
        </div>
    </header>

    <section id="docs">
        <article>
            <div class="markdown-body">

<p>*** DRAFT ***
Spec: Multi-window application  Editor JF Ducarroz</p>

<p>Index
Introduction
Functional Description
API
Examples
Integration
Dependencies
Concerns
Introduction</p>

<p>While traditionally web pages and web apps use a single browser window, complex applications might require multiple windows. The goal of this spec is to provide support for multiple windows by allowing a reel to be opened inside its own browser window and still be accessible like it was in the same window as the rest of the application by, for example, using bindings (one-way or two-way).
Functional Description</p>

<p>A single window Montage application is represented by an Application object (document.application). Internally, there is also a single root element, to which all the UI components are linked, and an events manager.</p>

<p>When using multiple windows, each window has its own application object, its own root object, and event manager. That is, each window is an application by itself. The original window is the main application while every other window is a child application from either the main application or another child application. </p>

<p>The Application object has two new properties: mainApplication and parentApplication. In the case of the main application, parentApplication is set to null.</p>

<p>To open a new window, you call Application.openWindow and provide a Reel relative path and a module name to instantiate.  In return, you will get a MontageWindow object. When the DOM window has been loaded and the module instantiated, the MontageWindow will dispatch a load event.</p>

<p>A MontageWindow object provides a pointer to the DOM window as well the reel's module instance. The MontageWindow object provides some other window management services such as setting the window title, moving or closing the window.</p>

<p>The Application also keep track of the windows it opens and in the case of the mainApplication, it tracks all child  windows open by any application and sort them either by z order or open order.</p>

<p>When a window closes (or reload), all its child windows are also closed. To prevent a child window to be closed when is parent is dismissed, you can detach the window, in that case, the detached window won't have any relation anymore with the parent or main window.</p>

<p>Note: 
1) the module is loaded into the child window asynchronously using a Loader
2) Events from a child window are propagated up to the document, then to the application and then up to the parent application chain up to the main application.</p>

<p>API</p>

<p>Application:</p>

<p>Application.openWindow(component, name, parameters) -&gt; {MontageWindow}
Open asynchronously a Reel in a new browser window. When the returned window is ready, it dispatches a load event.</p>

<p>Returns the newly created window </p>

<p>Parameters:
component {Object}: the path to the reel component to open in the new window. Can be relative to the main bundle.
name {String}: the component main class name
parameters {Object}: the new window parameters. Accept same parameters than window.open with same security restrictions. Here are the possible parameters and their default value:
                    location: false,
                    height: undefined, (in pixels)
                    width: undefined, (in pixels)
                    left: undefined ,(in pixels)
                    top: undefined, (in pixels)
                    menubar: false,
                    resizable: true,
                    scrollbars: true,
                    status: false,
                    titlebar: true,
                    toolbar: false</p>

<p>Application.detachWindow(montageWindow) -&gt; {MontageWindow}
Detach the window from its parent application. If no montageWindow is specified, the current application's windows will be detached</p>

<p>Application.attachWindow(montageWindow) -&gt; {MontageWindow}
Attach a window to a parent application. When a window open, it's automatically attach to the Application used to create the window.</p>

<p>Application.mainApplication  :Application (read only)
Provides a reference to the main application</p>

<p>Application.parentApplication  :Application
Provides a reference to the parent application</p>

<p>Application.window  :MontageWindow (read only)
Provides a reference to the MontageWindow associated to the application</p>

<p>Application.attachedWindows  :Array[MontageWindow]
An array of the child windows attached to the application</p>

<p>Application.windows  :Array<a href="read%20only">MontageWindow</a>
Provides a reference to all the windows opened by the main application or any of its descendents, including the main window itself The list is kept sorted, the sort order is determined by the Application.windowsSortOrder property</p>

<p>Application.windowsSortOrder  :String (default: reverse-z-order)
Determines the sort order for the Application.windows array.
Possible values are: z-order, reverse-z-order, open-order, reverse-open-order</p>

<p>Application.focusWindow  :MontageWindow
Return the top most window of any of the Montage Windows</p>

<p>MontageWindow:</p>

<p>MontageWindow.close()
Close the window. Note: Any descendent window will be closed as well
Parameters: none</p>

<p>MontageWindow.focus()
Set the focus on the window, move it to the front
Parameters: none</p>

<p>MontageWindow.resizeTo(width, height)
Resize the window to the specified width and height
Parameters: 
width {Integer}: The window's width desired
height {Integer}: The window's height desired</p>

<p>MontageWindow.moveTo(x, y)
Move the window to the specified screen coordinate x and y
Parameters: 
x {Integer}: The window's x screen position
y {Integer}: The window's y screen position</p>

<p>MontageWindow.application  :Application (readonly)
Provides the Application associated with the window</p>

<p>MontageWindow.window  :Window (readonly)
Provides a reference to the native window</p>

<p>MontageWindow.document  :DOM Document (readonly)
Provides a reference to the DOM Document</p>

<p>MontageWindow.component  :Object(readonly)
Provides a reference to the main Montage component loaded in the window</p>

<p>MontageWindow.title  :String
The window title. Make sure to use MontageWindow.title to access the window's title rather than directly accessing directly the title by the document, else you will not be able to use binding with the window's title.</p>

<p>MontageWindow.focused  :Boolean
True if the window is currently the topmost Montage Window and has focus</p>

<p>MontageWindow.closed  :Boolean
True is the window has been closed. Once a window has been close, the MontageWindow object still exist but you cannot use it anymore.</p>

<p>Examples</p>

<p>create a new window and listen to the load event to finish the window initialization:</p>

<p>var childWindow = document.application.openWindow("image-viewer.reel",
                      "ImageViewer", {scrollbar: false, titlebar: false});</p>

<p>childWindow.addEventListener("load", function(event) {
  childWindow.component.foo = bar;
});</p>

<p>Integration</p>

<p>There is 5 parts:</p>

<p>1) Some modification are required in EventManager in order to propagate the event up the chain of Applications</p>

<p>2) Application has been modified and extended to support the notion of parent and main application</p>

<p>3) A new component MontageWindow is added</p>

<p>4) A window-loader, a minimalist montage stub is added. This is the page that we load in the new window and who is in charge to callback the opening application when the window is ready</p>

<p>5) The loader has been modified to trigger a custom "load" event once the component has been created by the loader.</p>

                </div>
        </article>
    </section>

    <section id="next" class="next">
        <article>
            <h3 class="title">More help?</h3>
            <div class="cols">
                <div class="col col-1-2">
                    <p>Can't find what you are looking for? Get in touch, we're more than happy in helping answer your questions.
                    </p>
                </div>
                <aside class="col col-1-2">
                    <p><strong>Have feedback or ideas?</strong> Let us know by creating a new <a href="https://github.com/montagejs/montage/issues" target="_blank">issue</a>, join us in <a href="http://webchat.freenode.net/?channels=montage" target="_blank">IRC</a> or post questions to our <a href="https://groups.google.com/forum/?fromgroups#!forum/montagejs" target="_blank">Google Group</a>. We're also on <a href="https://twitter.com/montage_js" target="_blank">Twitter</a> and <a href="https://plus.google.com/116915300739108010954/" target="_blank">Google+</a>.
                    </p>
                </aside>
            </div>
        </article>
    </section>


    <section id="social" class="social">
        <article>

            <div class="button-group github">
                <iframe src="http://ghbtns.com/github-btn.html?user=montagejs&amp;repo=montage&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="90px" height="20px"></iframe>
                <iframe src="http://ghbtns.com/github-btn.html?user=montagejs&amp;repo=montage&amp;type=fork&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="90px" height="20px"></iframe>
            </div>


            <div class="button-group twitter">
                <a href="https://twitter.com/share" class="twitter-share-button" data-via="montage_js" data-count="none">Tweet</a>
                <script>!function(e,t,n){var r,i=e.getElementsByTagName(t)[0];e.getElementById(n)||(r=e.createElement(t),r.id=n,r.src="//platform.twitter.com/widgets.js",i.parentNode.insertBefore(r,i))}(document,"script","twitter-wjs")</script>
                <a href="https://twitter.com/montage_js" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @montage_js</a>
                <script>!function(e,t,n){var r,i=e.getElementsByTagName(t)[0];e.getElementById(n)||(r=e.createElement(t),r.id=n,r.src="//platform.twitter.com/widgets.js",i.parentNode.insertBefore(r,i))}(document,"script","twitter-wjs")</script>
            </div>

            <div class="button-group g-plus">
                
                <script src="https://apis.google.com/js/plusone.js">"explicit"</script>
                
                <div class="g-plusone" data-size="medium" data-annotation="inline" data-width="200"></div>
                
                <script>gapi.plusone.go()</script>
            </div>

        </article>
    </section>


    <footer class="footer">
        2013 montagejs.org - <a href="https://github.com/montagejs/montagejs.org">Contributions</a> to this page are welcomed.
    </footer>


    
    <script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-35717912-1"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>

</body>
</html>