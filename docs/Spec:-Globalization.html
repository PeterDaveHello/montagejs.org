<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    
    <title>Spec: Globalization - Montage Docs</title>
    
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400,700" />
    <link rel="stylesheet" href="../stylesheets/normalize.css" />
    <link rel="stylesheet" href="../stylesheets/base.css" />
    <link rel="stylesheet" href="../stylesheets/pages.css" />
    <link rel="stylesheet" href="../stylesheets/solarized.css" />
        
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->    
</head>
<body class="docs">
  
    <header class="header header-pages pushed">
        <div class="header-container">
            <a href="/"><img class="logo" src="../images/logo-pages.png" alt="Montage" /></a>
            <nav class="nav">
                <a class="nav-item" href="/apps">Apps</a>
                <a class="nav-item active" href="/docs">Docs</a>
            </nav>
        </div>
    </header>
    
    <section id="docs">
        <article>
            <div class="markdown-body">

<p>Globalization   Editor Stuart Knightley and António Afonso</p>

<p>Index
Introduction
Language
Locale
Functional Description
Manifest
montage_manifest_version
files
...and back to the Functional Description
API
String Format
strings.json
Javascript
Serialization
Considerations
Resources
Alternative serializations

Introduction</p>

<p>The goal of this specification is to detail a solution for JS Framework localization. The localization is needed at a Component’s level for user visible UI with localized HTML templates, and for other resources with localized strings per locale. The Locale class will encapsulate the current locale used in a page and the locale level constants such as units, currencies, date or number formats.</p>

<p>The goal is to provide a structure that enforces good practices and encapsulate all Components’ resources in the same place, while being efficient when deploying code in production.
Language</p>

<p>The term "language" indicates a collection of properties used in spoken and written communication.</p>

<p>A neutral language is indicated by a name such as "en" for English. A more geographically specific language can be indicated by a name that includes both locale and country/region information. For example, the locale English (United States) has the language name "en-US".
Locale</p>

<p>Locales encapsulate information about linguistic, cultural, and technological conventions and standards. Examples of information encapsulated by a locale include the symbol used for the decimal separator in numbers and the way dates are formatted.</p>

<p>Locales are typically used to provide, format, and interpret information about and according to the user’s customs and preferences. They are frequently used in conjunction with formatters (Formatter class). Although you can use many locales, you usually use the one associated with the current user.</p>

<p>Functional Description</p>

<p>A .reel folder contains all UI related data for a component. In order to support multiple languages while providing encapsulation, we need to organize resources in locale-named directories. These directories must be under a “locales” directory next to the component’s .js file.</p>

<p>Because we cannot see the contents of the server filesystem a manifest must be provided, either in a manifest.json file next to the component or in the package.json. The boolean property “hasManifest” on the component specifies whether manifest.json exists. Any manifest.json files in subdirectories should be loaded if needed and take precedence for that directory.
Manifest</p>

<p>The manifest file takes the following format (if we decide this is the way to go this should be split into a separate spec. This also applied to package.json. I’ve written a prototype manifest generator.):
montage_manifest_version</p>

<p>Number. The version of the manifest file. Currently 1.
files</p>

<p>Object. Each key is a file name that maps to the following:
Object | Null. If null then the file exists, but no other information has been provided. Alternatively the object can have the following keys:</p>

<p>directory: Boolean. Whether this file is a directory.
files: “files” Object. If the file is a directory this contains its children.
size: Number. The size of the file in bytes. [It would be great for the loader to have this information, so that it can have a proper progress bar]
we can expand this if we want more file metadata. </p>

<p>Example:
{
    "montage_manifest_version": 1,
    "files": {
        "button.html": {"size": 423},
        "button.js": null,
        "locales": {
            "directory": true,
            "files": {
                "en-US": {
                    "directory": true,
                    "files": {
                        "strings.json": {"size": 42}
                    }
                },
                "fr": {
                    "directory": true,
                    "files": {
                        "strings.json": {"size": 143}
                    }
                }
            }
        }
    }
}</p>

<p>...and back to the Functional Description</p>

<p>Using the data loaded from the manifest the logic will look for resources matching the most specific language code to the least specific, if none is found then use the resources available at the root level.</p>

<p>An example: if the language code is set to "hz-hans-cn" (Simplified Han Chinese) resources will be first looked up in "hz-hans-cn" then "hz-hans" and finally "hz", if it is not found on any of these folders (either the file or the folder doesn’t exist) then it will default to the resource found at the root of the component.</p>

<p>Language codes are case-sensitive and are listed here: <a href="http://tools.ietf.org/html/rfc5646#section-2.1">http://tools.ietf.org/html/rfc5646#section-2.1</a></p>

<p>Where the files are stored, how they will be loaded will be based on further ResourceManager discussions </p>

<p>Here’s the proposed layout on disk:</p>

<p>my-project/
    package.json
    index.html
    locale/
        en/
            strings.json
        fr/
            strings.json
    my-component.reel/
        manifest.json
        my-component.css
        my-component.html
        my-component.js
        flag.png
        locales/
            en/
                strings.json 
            fr/
                strings.json
                flag.png</p>

<p>Load my-component.reel/my-component.js (same as currently)
If hasManifest is true on the component load manifest.json
otherwise use the manifest from package.json if it has one
otherwise stop these localization steps.
Assert which languages and files are available from 2.
Make a list of 
If the template is available in the current language then load my-component.reel//my-component.html and go to step 7.
Compute the best match and if found load my-component.reel//my-component.html and go to step 7.
Use my-component.reel/my-component.html
Repeat steps 4-6 for any CSS files found in the HTML template
Repeat steps 4-6 for a strings.json file</p>

<p>It's also important to notice that a change in the preferred language will only come into effect after an application reload (restart).
API</p>

<p>String Format</p>

<p><a href="http://site.icu-project.org/">http://site.icu-project.org/</a>
strings.json</p>

<p>The strings.json contains localized values for known strings structured as an anonymous object. Each string maps to an object containing “message” and, optionally,  “description” properties.</p>

<p>{
"title": {
"message": "Reproductor Multimedia",
},
"play": {
"message": "Reproducir",
"description": "Label for a button to start playing the media"
},
"pause": {
"message": "Pausa"
},
"num_videos": {
    "message": "{num_videos, plural, one {1 vídeo} other {# vídeos}}"
    "description": "How many pieces of video media there are available"
}
}</p>

<p>The available strings files must be added to the manifest at build time.
Javascript</p>

<p>var _ = require("core/i18n").localizer;</p>

<p>var Alert = {
    _alert: {
        value: _("Alert")
    },
    _ok: {
        value: _("OK")
    },
    _xAlerts: {
        value: _("{num_alerts, plural, one (1 alert} other {# alerts}}")
    },</p>

<pre><code>draw: {
    value: function() {
        this._titleEl.textContent = this._alert;
        this._buttonEl.textContent = this._ok;
        this._statusEl.textContent = this._xAlerts({num_alerts: this._num_alerts});
    }
}
</code></pre>

<p>};</p>

<p>Serialization</p>

<p>A new deserialization unit is added: “localizations”. This unit contains mappings from a property name to a object containing a translation string or key (marked with “_”, and bindings for the arguments. Example: </p>

<p>"deleteButton": {
    "prototype": "montage/ui/button.reel",
    "properties": {
        "element": {"#": "deleteButton"}
    },
    "localizations": {
        "value": {"_": "OK"}
        "label": {<br />
            "_": "delete_albums",
    "_default": "Delete {num_albums, plural, one {album} other {all albums}}",
            "num_albums": "@albums.objects.count()"
        },
        "title": {
            "_": "{num_albums, plural, one {1 album} other {# albums}}",
            "num_albums": "@albums.objects.count()"
        }
    }
},</p>

<p>To translate elements without needing to create a component for each, you can use a localizer object. This will do a one-time localization of the properties on any object.</p>

<p>If you give “true” as a value to any of the properties then the existing value of the property will be translated.</p>

<p>"translate": {
    "object": "montage/core/localizer",
    "localizations": [
        {
            "object": {"@": "action_ok"},
            "properties": {
                "label": "OK"
            }
        },
        {
            "object": {"#": "link"},
            "properties": {
                "title": true,
                "textContent": true
            }
        }
    ]
}</p>

<p><a href="%E2%80%9Dmore.html%E2%80%9D" title="”More">More</a>
Considerations</p>

<p>Resources</p>

<p>Components such as the Image will need to be made localization-aware, so the they can load images from the correct locale directory if available.</p>

<p>Alternative serializations</p>

<p>"deleteButton": {<br />
"localizations": {
        "label": "Delete {num_albums, plural, one {album} other {all albums}}",
"title": "{num_albums, plural, one {1 album} other {# albums}}"
    },
"bindings": {
        "_.num_albums": {"&lt;-": "@albums.objects.count()"}
    }
}</p>

<p>"deleteButton": {
    "bindings": {
        "_.num_albums": {"&lt;-": "@albums.objects.count()"}
        "label" {"&lt;-": "@_.Delete {num_albums, plural, one {album} other {all albums}}"},
        "title" {"&lt;-": "@_.{num_albums, plural, one {1 album} other {# albums}}"}
    }
},</p>

                </div>
        </article>
    </section>

    <section id="next" class="next">
        <article>
            <h3 class="title">More help?</h3>
            <div class="cols">
                <div class="col col-1-2">
                    <p>Can't find what you are looking for? Get in touch, we're more than happy in helping answer your questions.
                    </p>
                </div>
                <aside class="col col-1-2">
                    <p><strong>Have feedback or ideas?</strong> Let us know by creating a new <a href="https://github.com/montagejs/montage/issues" target="_blank">issue</a>, join us in <a href="http://webchat.freenode.net/?channels=montage" target="_blank">IRC</a> or post questions to our <a href="https://groups.google.com/forum/?fromgroups#!forum/montagejs" target="_blank">Google Group</a>. We're also on <a href="https://twitter.com/montage_js" target="_blank">Twitter</a> and <a href="https://plus.google.com/116915300739108010954/" target="_blank">Google+</a>.
                    </p>
                </aside>
            </div>
        </article>
    </section>

    
    <section id="social" class="social">
        <article>
            
            <div class="button-group github">
                <iframe src="http://ghbtns.com/github-btn.html?user=montagejs&amp;repo=montage&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="90px" height="20px"></iframe>
                <iframe src="http://ghbtns.com/github-btn.html?user=montagejs&amp;repo=montage&amp;type=fork&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="90px" height="20px"></iframe>
            </div>
            
            
            <div class="button-group twitter">
                <a href="https://twitter.com/share" class="twitter-share-button" data-via="montage_js" data-count="none">Tweet</a>
                <script>!function(e,t,n){var r,i=e.getElementsByTagName(t)[0];e.getElementById(n)||(r=e.createElement(t),r.id=n,r.src="//platform.twitter.com/widgets.js",i.parentNode.insertBefore(r,i))}(document,"script","twitter-wjs")</script>
                <a href="https://twitter.com/montage_js" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @montage_js</a>
                <script>!function(e,t,n){var r,i=e.getElementsByTagName(t)[0];e.getElementById(n)||(r=e.createElement(t),r.id=n,r.src="//platform.twitter.com/widgets.js",i.parentNode.insertBefore(r,i))}(document,"script","twitter-wjs")</script>
            </div>
            
            <div class="button-group g-plus">
                
                <script src="https://apis.google.com/js/plusone.js">"explicit"</script>
                
                <div class="g-plusone" data-size="medium" data-annotation="inline" data-width="200"></div>
                
                <script>gapi.plusone.go()</script>
            </div>
            
        </article>
    </section>
        
    
    <footer class="footer">
        2012 montagejs.org - <a href="https://github.com/montagejs/montagejs.org">Contributions</a> to this page are welcomed.
    </footer>
        
    
    
    <script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-35717912-1"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
    
</body>
</html>