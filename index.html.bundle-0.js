BUNDLE=[],"undefined"!=typeof window&&(document._montageTiming={},document._montageTiming.loadStartTime=Date.now(),window.addEventListener("DOMContentLoaded",function(){var e=1e3;document._montageStartBootstrappingTimeout=setTimeout(function(){document._montageStartBootstrappingTimeout=null;var e=document.documentElement;e.classList?e.classList.add("montage-app-bootstrapping"):e.className=e.className+" montage-app-bootstrapping",document._montageTiming.bootstrappingStartTime=Date.now()},e)})),function(e){"undefined"!=typeof require?e.call("undefined"!=typeof global?global:this,require,exports,module):e({},{},{})}(function(e,t){global=this,t.initMontage=function(){var e=t.getPlatform();e.bootstrap(function(n,a,s){var r=e.getParams(),o=e.getConfig(),l=s.resolve(n.getLocation(),r.montageLocation);o.makeLoader=function(e){return t.ReelLoader(e,n.makeLoader(e))},o.makeCompiler=function(e){return t.MetaCompiler(e,t.SerializationCompiler(e,t.TemplateCompiler(e,n.makeCompiler(e))))};var c=s.resolve(o.location,r["package"]||"."),p=r.applicationHash;if("object"==typeof BUNDLE){var u={},h=function(e){return u[e]=u[e]||a.defer()};global.bundleLoaded=function(e){h(e).resolve()};var d=a.defer();o.preloaded=d.promise;var m=a.resolve();BUNDLE.forEach(function(e){m=m.then(function(){return a.all(e.map(function(e){return i.load(e),h(e).promise}))})}),d.resolve(m.then(function(){delete BUNDLE,delete bundleLoaded}))}var g;if("remoteTrigger"in r){var f=a.defer();window.postMessage({type:"montageReady"},"*");var v=function(e){if(r.remoteTrigger===e.origin&&(e.source===window||e.source===window.parent))switch(e.data.type){case"montageInit":window.removeEventListener("message",v),f.resolve([e.data.location,e.data.injections]);break;case"isMontageReady":window.postMessage({type:"montageReady"},"*")}};window.addEventListener("message",v),g=f.promise.spread(function(e,t){var a=n.loadPackage({location:e,hash:p},o);return t&&(a=a.then(function(n){e=s.resolve(e,".");var a,r,i=t.packageDescriptions,o=t.packageDescriptionLocations,l=t.mappings,c=t.dependencies;if(i)for(r=i.length,a=0;r>a;a++)n.injectPackageDescription(i[a].location,i[a].description);if(o)for(r=o.length,a=0;r>a;a++)n.injectPackageDescriptionLocation(o[a].location,o[a].descriptionLocation);if(l)for(r=l.length,a=0;r>a;a++)n.injectMapping(l[a].dependency,l[a].name);if(c)for(r=c.length,a=0;r>a;a++)n.injectDependency(c[a].name,c[a].version);return n})),a})}else{if("autoPackage"in r)n.injectPackageDescription(c,{dependencies:{montage:"*"}},o);else if(".json"===c.slice(c.length-5)){var b=c;c=s.resolve(c,"."),n.injectPackageDescriptionLocation(c,b,o)}g=n.loadPackage({location:c,hash:p},o)}g.then(function(t){t.loadPackage({location:l,hash:r.montageHash}).then(function(e){var t;return t=r.promiseLocation?s.resolve(n.getLocation(),r.promiseLocation):s.resolve(l,"packages/mr/packages/q"),[e,e.loadPackage({location:t,hash:r.promiseHash})]}).spread(function(n,i){n.inject("core/mini-url",s),n.inject("core/promise",{Promise:a}),i.inject("q",a),o.lint=function(e){n.async("core/jshint").then(function(t){t.JSHINT(e.text)||(console.warn("JSHint Error: "+e.location),t.JSHINT.errors.forEach(function(e){e&&(console.warn("Problem at line "+e.line+" character "+e.character+": "+e.reason),e.evidence&&console.warn("    "+e.evidence))}))}).done()},global.require=t,global.montageRequire=n,e.initMontage(n,t,r)})}).done()})};var n=/((.*)\.reel)\/\2$/,a=function(e,t){return t};t.SerializationCompiler=function(e,t){return function(e){if(t(e),e.factory){var s=e.factory;return e.factory=function(e,t,r){s.call(this,e,t,r);for(var i in t){var o=t[i];if(o instanceof Object)if(o.hasOwnProperty("_montage_metadata")&&!o._montage_metadata.isInstance)o._montage_metadata.aliases.push(i),o._montage_metadata.objectName=i;else if(!Object.isSealed(o)){var l=r.id.replace(n,a);Object.defineProperty(o,"_montage_metadata",{value:{require:e,module:l,moduleId:l,property:i,objectName:i,aliases:[i],isInstance:!1}})}}},e}}};var s=/([^\/]+)\.reel$/;t.ReelLoader=function(e,t){return function(e,n){var a=s.exec(e);return a?(n.redirect=e+"/"+a[1],n):t(e,n)}};var r=/\.meta/;t.MetaCompiler=function(e,t){return function(e){var n=(e.location||"").match(r);return n?(e.exports=JSON.parse(e.text),e):t(e)}},t.TemplateCompiler=function(e,t){return function(e){if(e.location){var n=e.location.match(/(.*\/)?(?=[^\/]+\.html(?:\.load\.js)?$)/);return n?(e.dependencies=e.dependencies||[],e.exports={directory:n[1],content:e.text},Object.defineProperty(e.exports,"root",{get:function(){return"object"==typeof console&&console.warn("'root' property is deprecated on template modules.  Use 'directory' instead of root[1]"),n}}),e):(t(e),void 0)}}},t.getPlatform=function(){if("undefined"!=typeof window&&window&&window.document)return i;if("undefined"!=typeof process)return e("./node.js");throw Error("Platform not supported.")};var i={makeResolve:function(){var e=document.querySelector("base"),t=e;t||(e=document.createElement("base"),e.href="");var n=document.querySelector("head"),a=document.createElement("a");return function(s,r){if(t||n.appendChild(e),s+="",!/^[\w\-]+:/.test(s))throw Error("Can't resolve from a relative location: "+JSON.stringify(s)+" "+JSON.stringify(r));var i=e.href;e.href=s,a.href=r;var o=a.href;return e.href=i,t||n.removeChild(e),o}},load:function(e){var t=document.createElement("script");t.src=e,t.onload=function(){t.parentNode.removeChild(t)},document.getElementsByTagName("head")[0].appendChild(t)},getConfig:function(){return{location:""+window.location}},getParams:function(){var e,t,n,a,s,r,i;if(!this._params){this._params={};var o=document.getElementsByTagName("script");for(e=0;o.length>e;e++)if(a=o[e],s=!1,a.src&&(n=a.src.match(/^(.*)montage.js(?:[\?\.]|$)/i))&&(this._params.montageLocation=n[1],s=!0),a.hasAttribute("data-montage-location")&&(this._params.montageLocation=a.getAttribute("data-montage-location"),s=!0),s){if(a.dataset)for(i in a.dataset)this._params[i]=a.dataset[i];else if(a.attributes){var l=/-([a-z])/g,c=function(e,t){return t.toUpperCase()};for(t=0;a.attributes.length>t;t++)r=a.attributes[t],n=r.name.match(/^data-(.*)$/),n&&(this._params[n[1].replace(l,c)]=r.value)}a.parentNode.removeChild(a);break}}return this._params},bootstrap:function(e){function t(){document.removeEventListener("DOMContentLoaded",t,!0),o=!0,s()}function n(e){if(!f[e]&&g[e]){var t=f[e]={};f[e]=g[e](n,t)||t}return f[e]}function a(){c=n("mini-url"),l=n("promise"),r=n("require"),delete global.bootstrap,s()}function s(){o&&r&&e(r,l,c)}var r,o,l,c,p=this.getParams(),u=this.makeResolve();/interactive|complete/.test(document.readyState)?t():document.addEventListener("DOMContentLoaded",t,!0);var h={require:"packages/mr/require.js","require/browser":"packages/mr/browser.js",promise:"packages/mr/packages/q/q.js"};if("undefined"==typeof BUNDLE){var d=u(window.location,p.montageLocation);for(var m in h)i.load(u(d,h[m]))}var g={};global.bootstrap=function(e,t){g[e]=t,delete h[e];for(var e in h)return;delete global.bootstrap,a()},global.bootstrap("mini-url",function(e,t){t.resolve=u});var f={}},initMontage:function(e,t,n){var a=["core/core","core/event/event-manager","core/serialization/deserializer/montage-reviver","core/logger"],s=e("core/promise").Promise;return s.all(a.map(e.deepLoad)).then(function(){a.forEach(e);var r,i,o=e("core/core").Montage,l=e("core/event/event-manager").EventManager,c=e("core/serialization/deserializer/montage-reviver").MontageReviver,p=e("core/logger").logger;p("Promise stacktrace support",function(e){s.longStackJumpLimit=e?1:0}),r=(new l).initWithWindow(window),"function"==typeof global.montageWillLoad&&global.montageWillLoad();var u,h,d=t.packageDescription.applicationPrototype;return d?(u=c.parseObjectLocationId(d),h=t.async(u.moduleId)):h=e.async("core/application"),h.then(function(e){var a=e[u?u.objectName:"Application"];i=new a,Object.defineProperty(window.document,"application",{get:o.deprecate(null,function(){return e.application},'document.application is deprecated, use require("montage/core/application").application instead.')}),r.application=i,i.eventManager=r,i._load(t,function(){n.module&&t.async(n.module).done(),"function"==typeof global.montageDidLoad&&global.montageDidLoad()})})}).done()}};"undefined"!=typeof window?global.__MONTAGE_LOADED__?console.warn("Montage already loaded!"):(global.__MONTAGE_LOADED__=!0,t.initMontage()):t.getPlatform()}),function(e){if("undefined"!=typeof bootstrap)"undefined"!=typeof window?bootstrap("require",function(t,n){var a=t("promise"),s=t("mini-url");e(n,a,s),t("require/browser")}):bootstrap("require",function(t,n){var a=t("promise").Promise,s=t("mini-url");e(n,a,s)});else{if("undefined"==typeof process)throw Error("Can't support require on this platform");var t=require("q"),n=require("url");e(exports,t,n),require("./node")}}(function(e,t,n){function a(t,a){if(a=a||{},"string"==typeof t&&(t={location:t}),t.main&&(t.location=a.mainPackageLocation),t.name&&a.registry&&a.registry[t.name]&&(t.location=a.registry[t.name]),!t.location&&a.packagesDirectory&&t.name&&(t.location=n.resolve(a.packagesDirectory,t.name+"/")),!t.location)return t;if(/\/$/.test(t.location)||(t.location+="/"),!e.isAbsolute(t.location)){if(!a.location)throw Error("Dependency locations must be fully qualified: "+JSON.stringify(t));t.location=n.resolve(a.location,t.location)}return t.name&&(a.registry[t.name]=t.location),t}function s(t,s,r){/\/$/.test(t)||(t+="/");var i=Object.create(r);i.name=s.name,i.location=t||e.getLocation(),i.packageDescription=s,i.useScriptInjection=s.useScriptInjection,void 0!==s.production&&(i.production=s.production);var l=i.modules=i.modules||{},c=i.registry;void 0===i.name||c[i.name]||(c[i.name]=i.location);var p=s.overlay||{};(i.overlays||e.overlays).forEach(function(e){if(p[e]){var t=p[e];for(var n in t)s[n]=t[n]}}),delete s.overlay,s.directories=s.directories||{},s.directories.lib=void 0===s.directories.lib?"./":s.directories.lib;var u=s.directories.lib;i.lib=n.resolve(t,"./"+u);var h=s.directories.packages||"node_modules";h=n.resolve(t,h+"/"),i.packagesDirectory=h,void 0!==s.main&&(l[""]={id:"",redirect:o(s.main),location:i.location},s.name!==l[""].redirect&&(l[s.name]={id:s.name,redirect:"",location:n.resolve(t,s.name)}));var d=s.redirects;void 0!==d&&Object.keys(d).forEach(function(e){l[e]={id:e,redirect:d[e],location:n.resolve(t,e)}});var m=s.mappings||{};return[s.dependencies,i.production?null:s.devDependencies].forEach(function(e){e&&Object.keys(e).forEach(function(t){m[t]||(m[t]={name:t,version:e[t]})})}),Object.keys(m).forEach(function(e){m[e]=a(m[e],i,e)}),i.mappings=m,i}function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function i(e,t){e+="";var n=e.split("/"),a=[];if(n.length&&"."===n[0]||".."===n[0]){var s=t.split("/");s.pop(),n.unshift.apply(n,s)}for(var r=0,i=n.length;i>r;r++){var o=n[r];""===o||"."===o||(".."===o?a.length&&a.pop():a.push(o))}return a.join("/")}if(!this)throw Error("Require does not work in strict mode.");e.makeRequire=function(s){function c(e){var t=e.toLowerCase();return r(f,t)||(f[t]={id:e,display:(s.name||s.location)+"#"+e,require:g}),f[t]}function p(e,t){var a=c(e);a.exports=t,a.location=n.resolve(s.location,e),a.directory=n.resolve(a.location,"./"),a.injected=!0,delete a.redirect,delete a.mappingRedirect}function u(e,n,a){var s=c(e);return a=a||{},r(a,e)?void 0:(a[e]=!0,v(e,n).then(function(){return t.all(s.dependencies.map(function(t){t=i(t,e);var n=c(t),s=n.dependees=n.dependees||{};return s[e]=!0,u(t,e,a)}))},function(e){s.error=e}))}function h(e,t){var a=c(e);if(a.id!==e)throw Error("Can't require module "+JSON.stringify(a.id)+" by alternate spelling "+JSON.stringify(e));if(a.error){var s=Error("Can't require module "+JSON.stringify(a.id)+" via "+JSON.stringify(t)+" because "+a.error.message);throw s.cause=a.error,s}if(void 0!==a.redirect)return h(a.redirect,t);if(void 0!==a.mappingRedirect)return a.mappingRequire(a.mappingRedirect,t);if(void 0!==a.exports)return a.exports;if(void 0===a.factory)throw Error("Can't require module "+JSON.stringify(e)+" via "+JSON.stringify(t));a.directory=n.resolve(a.location,"./"),a.exports={};var r=a.factory.call(void 0,m(e),a.exports,a);return void 0!==r&&(a.exports=r),a.exports}function d(e,t,n){if(t.location===s.location)return e;for(var a in s.mappings){var r=s.mappings[a],i=r.location;if(s.hasPackage(i)){var o=s.getPackage(i),l=o.identify(e,t,!0);if(null!==l)return""===l?a:a+"/"+l}}if(n)return null;throw Error("Can't identify "+e+" from "+t.location)}function m(t){var n=function(e){var n=i(e,t);return h(n,t)};return n.async=function(e){var a=i(e,t);return c(e),u(a,t).then(function(){return n(a)})},n.resolve=function(e){return o(i(e,t))},n.getModule=c,n.getModuleDescriptor=c,n.load=v,n.deepLoad=u,n.loadPackage=function(t,n){return n?e.loadPackage(t,n):s.loadPackage(t,s)},n.hasPackage=function(e){return s.hasPackage(e)},n.getPackage=function(e){return s.getPackage(e)},n.isMainPackage=function(){return n.location===s.mainPackageLocation},n.injectPackageDescription=function(t,n){e.injectPackageDescription(t,n,s)},n.injectPackageDescriptionLocation=function(t,n){e.injectPackageDescriptionLocation(t,n,s)},n.injectMapping=function(e,t){e=a(e,s,t),t=t||e.name,s.mappings[t]=e},n.injectDependency=function(e){n.injectMapping({name:e},e)},n.identify=d,n.inject=p,s.exposedConfigs.forEach(function(e){n[e]=s[e]}),n.config=s,n.read=e.read,n}var g;s=s||{},s.location=n.resolve(s.location||e.getLocation(),"./"),s.lib=n.resolve(s.location,s.lib||"./"),s.paths=s.paths||[s.lib],s.mappings=s.mappings||{},s.exposedConfigs=s.exposedConfigs||e.exposedConfigs,s.makeLoader=s.makeLoader||e.makeLoader,s.load=s.load||s.makeLoader(s),s.makeCompiler=s.makeCompiler||e.makeCompiler,s.compile=s.compile||s.makeCompiler(s),s.parseDependencies=s.parseDependencies||e.parseDependencies,s.read=s.read||e.read;var f=s.modules=s.modules||{},v=l(function(e){var n=c(e);return t.fcall(function(){return void 0===n.factory&&void 0===n.exports&&void 0===n.redirect?t.fcall(s.load,e,n):void 0}).then(function(){s.compile(n);var e=n.dependencies=n.dependencies||[];void 0!==n.redirect&&e.push(n.redirect),void 0!==n.extraDependencies&&Array.prototype.push.apply(n.dependencies,n.extraDependencies)})});return g=m("")},e.injectPackageDescription=function(e,n,a){var s=a.descriptions=a.descriptions||{};s[e]=t.resolve(n)},e.injectPackageDescriptionLocation=function(e,t,n){var a=n.descriptionLocations=n.descriptionLocations||{};a[e]=t},e.loadPackageDescription=function(t,a){var s=t.location,r=a.descriptions=a.descriptions||{};if(void 0===r[s]){var i,o=a.descriptionLocations=a.descriptionLocations||{};i=o[s]?o[s]:n.resolve(s,"package.json"),r[s]=e.read(i).then(function(e){try{return JSON.parse(e)}catch(t){throw t.message=t.message+" in "+JSON.stringify(i),t}})}return r[s]},e.loadPackage=function(t,n){if(t=a(t,n),!t.location)throw Error("Can't find dependency: "+JSON.stringify(t));var r=t.location;n=Object.create(n||null);var i=n.loadingPackages=n.loadingPackages||{},o=n.packages={};n.registry=n.registry||Object.create(null),n.mainPackageLocation=r,n.hasPackage=function(e){if(e=a(e,n),!e.location)return!1;var t=e.location;return!!o[t]},n.getPackage=function(e){if(e=a(e,n),!e.location)throw Error("Can't find dependency: "+JSON.stringify(e)+" from "+n.location);var t=e.location;if(!o[t])throw i[t]?Error("Dependency has not finished loading: "+JSON.stringify(e)):Error("Dependency was not loaded: "+JSON.stringify(e));return o[t]},n.loadPackage=function(t,r){if(t=a(t,r),!t.location)throw Error("Can't find dependency: "+JSON.stringify(t)+" from "+n.location);var l=t.location;return i[l]||(i[l]=e.loadPackageDescription(t,n).then(function(t){var a=s(l,t,n),r=e.makeRequire(a);return o[l]=r,r})),i[l]};var l=n.loadPackage(t);return l.location=r,l.async=function(e,t){return l.then(function(n){return n.async(e,t)})},l},e.resolve=i,e.base=function(e){return(e+"").replace(/(.+?)\/+$/,"$1").match(/([^\/]+$|^\/$|^$)/)[1]},e.isAbsolute=function(e){return/^[\w\-]+:/.test(e)},e.parseDependencies=function(e){var t={};return(e+"").replace(/(?:^|[^\w\$_.])require\s*\(\s*["']([^"']*)["']\s*\)/g,function(e,n){t[n]=!0}),Object.keys(t)},e.DependenciesCompiler=function(t,n){return function(a){return a.dependencies||void 0===a.text||(a.dependencies=t.parseDependencies(a.text)),n(a),a&&!a.dependencies&&(a.dependencies=a.text||a.factory?e.parseDependencies(a.text||a.factory):[]),a}},e.ShebangCompiler=function(e,t){return function(e){e.text&&(e.text=e.text.replace(/^#!/,"//#!")),t(e)}},e.LintCompiler=function(e,n){return function(a){try{n(a)}catch(s){throw e.lint&&t.nextTick(function(){e.lint(a)}),s}}},e.exposedConfigs=["paths","mappings","location","packageDescription","packages","modules"],e.makeCompiler=function(t){return e.JsonCompiler(t,e.ShebangCompiler(t,e.DependenciesCompiler(t,e.LintCompiler(t,e.Compiler(t)))))},e.JsonCompiler=function(e,t){return function(e){var n=(e.location||"").match(/\.json$/);return n?(e.exports=JSON.parse(e.text),e):t(e)}},e.MappingsLoader=function(t,n){return t.mappings=t.mappings||{},t.name=t.name,function(a,s){var r=t.mappings,i=Object.keys(r),o=i.length;if(e.isAbsolute(a))return n(a,s);void 0!==t.name&&0===a.indexOf(t.name)&&"/"===a.charAt(t.name.length)&&console.warn("Package reflexive module ignored:",a);var l,c;for(l=0;o>l;l++)if(c=i[l],a===c||0===a.indexOf(c)&&"/"===a.charAt(c.length)){var p=r[c],u=a.slice(c.length+1);return t.loadPackage(p,t).then(function(e){return s.mappingRedirect=u,s.mappingRequire=e,e.deepLoad(u,t.location)})}return n(a,s)}},e.ExtensionsLoader=function(t,n){var a=t.extensions||["js"],s=a.reduceRight(function(e,t){return function(a,s){return n(a+"."+t,s).fail(function(t){if(/^Can't find /.test(t.message))return e(a,s);throw t})}},function(e){throw Error("Can't find "+JSON.stringify(e)+" with extensions "+JSON.stringify(a)+" in package at "+JSON.stringify(t.location))});return function(t,a){return-1!==e.base(t).indexOf(".")?n(t,a):s(t,a)}},e.PathsLoader=function(t,a){var s=t.paths.reduceRight(function(e,t){return function(s,r){var i=n.resolve(t,s);return a(i,r).fail(function(t){if(/^Can't find /.test(t.message))return e(s,r);throw t})}},function(e){throw Error("Can't find "+JSON.stringify(e)+" from paths "+JSON.stringify(t.paths)+" in package at "+JSON.stringify(t.location))});return function(t,n){return e.isAbsolute(t)?a(t,n):s(t,n)}},e.MemoizedLoader=function(e,t){var n=e.cache=e.cache||{};return l(t,n)};var o=function(e){var t=/^(.*)\.js$/.exec(e);return t&&(e=t[1]),e},l=function(e,n){return n=n||{},function(a,s){return r(n,a)||(n[a]=t.fcall(e,a,s)),n[a]}}}),bootstrap("require/browser",function(e){function t(e){return 200===e.status||0===e.status&&e.responseText}var n=e("require"),a=e("promise"),s=e("mini-url"),r="GET",i="application/javascript",o="file:",l=void 0!==l?l:window;n.getLocation=function(){return s.resolve(window.location,".")},n.overlays=["window","browser","montage"],n.read=function(e){function n(){t(c)?p.resolve(c.responseText):l()}function l(){p.reject(Error("Can't XHR "+JSON.stringify(e)))}if(0===s.resolve(window.location,e).indexOf(o))throw Error("XHR does not function for file: protocol");var c=new XMLHttpRequest,p=a.defer();try{c.open(r,e,!0),c.overrideMimeType&&c.overrideMimeType(i),c.onreadystatechange=function(){4===c.readyState&&n()},c.onload=c.load=n,c.onerror=c.error=l}catch(u){p.reject(u.message,u)}return c.send(),p.promise};var c=eval;l.navigator&&l.navigator.userAgent.indexOf("Firefox")>=0&&(c=Function("_","return eval(_)"));var p="__FILE__",u="__",h="(function ",d="(require, exports, module) {",m="//*/\n})\n//@ sourceURL=";n.Compiler=function(e){return function(t){if(t.factory||void 0===t.text)return t;if(e.useScriptInjection)throw Error("Can't use eval.");var n=p+t.location.replace(/\.\w+$|\W/g,u);try{t.factory=c(h+n+d+t.text+m+t.location)}catch(a){throw a.message=a.message+" in "+t.location,a}t.factory.displayName=n}},n.XhrLoader=function(e){return function(t,n){return e.read(t).then(function(e){n.type="javascript",n.text=e,n.location=t})}};var g={},f=function(e,t){return g[e]=g[e]||{},g[e][t]=g[e][t]||a.defer(),g[e][t]};montageDefine=function(e,t,n){f(e,t).resolve(n)},n.loadScript=function(e){var t=document.createElement("script");t.onload=function(){t.parentNode.removeChild(t)},t.onerror=function(){t.parentNode.removeChild(t)},t.src=e,t.defer=!0,document.getElementsByTagName("head")[0].appendChild(t)},n.ScriptLoader=function(e){var t=e.packageDescription.hash;return function(e,r){return a.fcall(function(){return g[t]&&g[t][r.id]?g[t][r.id].promise:(/\.js$/.test(e)?e=e.replace(/\.js/,".load.js"):e+=".load.js",n.loadScript(e),f(t,r.id).promise)}).then(function(n){delete g[t][r.id];for(var a in n)r[a]=n[a];r.location=e,r.directory=s.resolve(e,".")})}};var v=n.loadPackageDescription;n.loadPackageDescription=function(e,t){if(e.hash){var a=f(e.hash,"package.json").promise,r=s.resolve(e.location,"package.json.load.js");return t.preloaded&&t.preloaded.isPending()?t.preloaded.then(function(){a.isPending()&&n.loadScript(r)}).done():a.isPending()&&n.loadScript(r),a.get("exports")}return v(e,t)},n.makeLoader=function(e){var t;return t=e.useScriptInjection?n.ScriptLoader:n.XhrLoader,n.MappingsLoader(e,n.ExtensionsLoader(e,n.PathsLoader(e,n.MemoizedLoader(e,t(e)))))}}),function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){"use strict";function e(e){var t=Function.call;return function(){return t.apply(e,arguments)}}function t(e){return"[object StopIteration]"===ot(e)||e instanceof Q}function n(e,t){t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(lt)&&(e.stack=a(e.stack)+"\n"+lt+"\n"+a(t.stack))}function a(e){for(var t=e.split("\n"),n=[],a=0;t.length>a;++a){var i=t[a];r(i)||s(i)||n.push(i)}return n.join("\n")}function s(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function r(e){var t=/at .+ \((.*):(\d+):\d+\)/.exec(e);if(!t)return!1;var n=t[1],a=t[2];return n===X&&a>=J&&dt>=a}function i(){if(Error.captureStackTrace){var e,t,n=Error.prepareStackTrace;return Error.prepareStackTrace=function(n,a){e=a[1].getFileName(),t=a[1].getLineNumber()},Error().stack,Error.prepareStackTrace=n,X=e,t}}function o(e){return w(e)}function l(){function e(e){n&&(t=w(e),tt(n,function(e,n){Z(function(){t.promiseDispatch.apply(t,n)})},void 0),n=void 0,a=void 0)}var t,n=[],a=[],s=st(l.prototype),r=st(p.prototype);return r.promiseDispatch=function(e,s,r){var i=et(arguments);n?(n.push(i),"when"===s&&r[1]&&a.push(r[1])):Z(function(){t.promiseDispatch.apply(t,i)})},r.valueOf=function(){if(n)return r;var e=u(t);return h(e)&&(t=e),e},Error.captureStackTrace&&o.longStackJumpLimit>0&&(Error.captureStackTrace(r,l),r.stack=r.stack.substring(r.stack.indexOf("\n")+1)),s.promise=r,s.resolve=e,s.fulfill=function(t){e(y(t))},s.reject=function(t){e(b(t))},s.notify=function(e){n&&tt(a,function(t,n){Z(function(){n(e)})},void 0)},s}function c(e){var t=l();return O(e,t.resolve,t.reject,t.notify).fail(t.reject),t.promise}function p(e,t,n,a,s){void 0===t&&(t=function(e){return b(Error("Promise does not support operation: "+e))});var r=st(p.prototype);return r.promiseDispatch=function(n,a,s){var i;try{i=e[a]?e[a].apply(r,s):t.call(r,a,s)}catch(o){i=b(o)}n&&n(i)},n&&(r.valueOf=n),s&&(r.exception=a),r}function u(e){return h(e)?e.valueOf():e}function h(e){return e&&"function"==typeof e.promiseDispatch}function d(e){return e&&"function"==typeof e.then}function m(e){return!g(e)&&!f(e)}function g(e){return!d(u(e))}function f(e){return e=u(e),h(e)&&"exception"in e}function v(){ct||"undefined"==typeof window||window.Touch||!window.console||console.log("Should be empty:",ut),ct=!0}function b(e){var t=p({when:function(t){if(t){var n=nt(pt,this);-1!==n&&(ut.splice(n,1),pt.splice(n,1))}return t?t(e):this}},function(){return b(e)},function(){return this},e,!0);return v(),pt.push(t),ut.push(e),t}function y(e){return p({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return it(e)}},void 0,function(){return e})}function w(e){return h(e)?e:(e=u(e),d(e)?_(e):y(e))}function _(e){var t=l();return Z(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function L(e){return p({isDef:function(){}},function(t,n){return E(e,t,n)},function(){return u(e)})}function x(e,t,a,s){function r(e){try{return"function"==typeof t?t(e):e}catch(n){return b(n)}}function i(e){if("function"==typeof a){n(e,h);try{return a(e)}catch(t){return b(t)}}return b(e)}function c(e){return"function"==typeof s?s(e):e}var p=l(),u=!1,h=w(e);return Z(function(){h.promiseDispatch(function(e){u||(u=!0,p.resolve(r(e)))},"when",[function(e){u||(u=!0,p.resolve(i(e)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=c(e)}catch(a){if(n=!0,!o.onerror)throw a;o.onerror(a)}n||p.notify(t)}]),p.promise}function C(e,t,n){return x(e,function(e){return D(e).then(function(e){return t.apply(void 0,e)},n)},n)}function M(e){return function(){function n(e,n){var i;try{i=a[e](n)}catch(o){return t(o)?o.value:b(o)}return x(i,s,r)}var a=e.apply(this,arguments),s=n.bind(n,"send"),r=n.bind(n,"throw");return s()}}function z(e){throw new Q(e)}function S(e){return function(){return C([this,D(arguments)],function(t,n){return e.apply(t,n)})}}function E(e,t,n){var a=l();return Z(function(){w(e).promiseDispatch(a.resolve,t,n)}),a.promise}function k(e){return function(t){var n=et(arguments,1);return E(t,e,n)}}function T(e,t){var n=et(arguments,2);return ht(e,t,n)}function j(e,t){return E(e,"apply",[void 0,t])}function O(e){var t=et(arguments,1);return j(e,t)}function B(e){var t=et(arguments,1);return function(){var n=t.concat(et(arguments));return E(e,"apply",[this,n])}}function D(e){return x(e,function(e){var t=0,n=l();return tt(e,function(a,s,r){g(s)?e[r]=u(s):(++t,x(s,function(a){e[r]=a,0===--t&&n.resolve(e)},n.reject))},void 0),0===t&&n.resolve(e),n.promise})}function P(e){return x(e,function(e){return e=at(e,w),x(D(at(e,function(e){return x(e,$,$)})),function(){return e})})}function A(e,t){return x(e,void 0,t)}function I(e,t){return x(e,void 0,void 0,t)}function R(e,t){return x(e,function(e){return x(t(),function(){return e})},function(e){return x(t(),function(){return b(e)})})}function N(e,t,a,s){var r=function(t){Z(function(){if(n(t,e),!o.onerror)throw t;o.onerror(t)})},i=t||a||s?x(e,t,a,s):e;"object"==typeof process&&process&&process.domain&&(r=process.domain.bind(r)),A(i,r)}function q(e,t){var n=l(),a=setTimeout(function(){n.reject(Error("Timed out after "+t+" ms"))},t);return x(e,function(e){clearTimeout(a),n.resolve(e)},function(e){clearTimeout(a),n.reject(e)},n.notify),n.promise}function F(e,t){void 0===t&&(t=e,e=void 0);var n=l();return x(e,void 0,void 0,n.notify),setTimeout(function(){n.resolve(e)},t),n.promise}function W(e,t){var n=et(t),a=l();return n.push(a.makeNodeResolver()),j(e,n).fail(a.reject),a.promise}function U(e){var t=et(arguments,1),n=l();return t.push(n.makeNodeResolver()),j(e,t).fail(n.reject),n.promise}function H(e){var t=et(arguments,1);return function(){var n=t.concat(et(arguments)),a=l();return n.push(a.makeNodeResolver()),j(e,n).fail(a.reject),a.promise}}function V(e,t){var n=et(arguments,2);return function(){function a(){return e.apply(t,arguments)}var s=n.concat(et(arguments)),r=l();return s.push(r.makeNodeResolver()),j(a,s).fail(r.reject),r.promise}}function Y(e,t,n){var a=et(n||[]),s=l();return a.push(s.makeNodeResolver()),ht(e,t,a).fail(s.reject),s.promise}function G(e,t){var n=et(arguments,2),a=l();return n.push(a.makeNodeResolver()),ht(e,t,n).fail(a.reject),a.promise}function K(e,t){return t?(e.then(function(e){Z(function(){t(null,e)})},function(e){Z(function(){t(e)})}),void 0):e}var X,Z,J=i(),$=function(){};"undefined"!=typeof process?Z=process.nextTick:"function"==typeof setImmediate?Z="undefined"!=typeof window?setImmediate.bind(window):setImmediate:function(){function e(){if(--r,++o>=s){o=0,s*=4;for(var e=i&&Math.min(i-1,s);e>r;)++r,t()}for(;i;){--i,n=n.next;var a=n.task;n.task=void 0,a()}o=0}var t,n={task:void 0,next:null},a=n,s=2,r=0,i=0,o=0;if(Z=function(e){a=a.next={task:e,next:null},++i>r&&s>r&&(++r,t())},"undefined"!=typeof MessageChannel){var l=new MessageChannel;l.port1.onmessage=e,t=function(){l.port2.postMessage(0)}}else t=function(){setTimeout(e,0)}}();var Q,et=e(Array.prototype.slice),tt=e(Array.prototype.reduce||function(e,t){var n=0,a=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=a)throw new TypeError}for(;a>n;n++)n in this&&(t=e(t,this[n],n));return t}),nt=e(Array.prototype.indexOf||function(e){for(var t=0;this.length>t;t++)if(this[t]===e)return t;return-1}),at=e(Array.prototype.map||function(e,t){var n=this,a=[];return tt(n,function(s,r,i){a.push(e.call(t,r,i,n))},void 0),a}),st=Object.create||function(e){function t(){}return t.prototype=e,new t},rt=e(Object.prototype.hasOwnProperty),it=Object.keys||function(e){var t=[];for(var n in e)rt(e,n)&&t.push(n);return t},ot=e(Object.prototype.toString);Q="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e},o.longStackJumpLimit=1;var lt="From previous event:";o.nextTick=Z,o.defer=l,l.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(et(arguments,1)):e.resolve(n)}},o.promise=c,o.makePromise=p,p.prototype.then=function(e,t,n){return x(this,e,t,n)},p.prototype.thenResolve=function(e){return x(this,function(){return e})},p.prototype.thenReject=function(e){return x(this,function(){throw e})},tt(["isFulfilled","isRejected","isPending","dispatch","when","spread","get","put","set","del","delete","post","send","invoke","keys","fapply","fcall","fbind","all","allResolved","timeout","delay","catch","finally","fail","fin","progress","done","nfcall","nfapply","nfbind","denodeify","nbind","ncall","napply","nbind","npost","nsend","ninvoke","nodeify"],function(e,t){p.prototype[t]=function(){return o[t].apply(o,[this].concat(et(arguments)))}},void 0),p.prototype.toSource=function(){return""+this},p.prototype.toString=function(){return"[object Promise]"},o.nearer=u,o.isPromise=h,o.isPromiseAlike=d,o.isPending=m,o.isFulfilled=g,o.isRejected=f;var ct,pt=[],ut=[];"undefined"!=typeof process&&process.on&&process.on("exit",function(){for(var e=0;ut.length>e;e++){var t=ut[e];t&&void 0!==t.stack?console.warn("Unhandled rejected promise:",t.stack):console.warn("Unhandled rejected promise (no stack):",t)}}),o.reject=b,o.fulfill=y,o.resolve=w,o.master=L,o.when=x,o.spread=C,o.async=M,o["return"]=z,o.promised=S,o.dispatch=E,o.dispatcher=k,o.get=k("get"),o.set=k("set"),o["delete"]=o.del=k("delete");var ht=o.post=k("post");o.send=T,o.invoke=T,o.fapply=j,o["try"]=O,o.fcall=O,o.fbind=B,o.keys=k("keys"),o.all=D,o.allResolved=P,o["catch"]=o.fail=A,o.progress=I,o["finally"]=o.fin=R,o.done=N,o.timeout=q,o.delay=F,o.nfapply=W,o.nfcall=U,o.nfbind=H,o.denodeify=o.nfbind,o.nbind=V,o.npost=Y,o.nsend=G,o.ninvoke=o.nsend,o.nodeify=K;var dt=i();return o}),montageDefine("d8747a3","package.json",{exports:{name:"montagejs.org",version:"0.0.0","private":!0,dependencies:{montage:"0.13.0",digit:"0.2.0-alpha"},devDependencies:{mop:"0.13.0"},directories:{lib:"./"},hash:"d8747a3",mappings:{montage:{name:"montage",hash:"b8d1a32",location:"packages/montage@b8d1a32/"},digit:{name:"digit",hash:"33e5fbc",location:"packages/digit@33e5fbc/"}},production:!0,useScriptInjection:!0}}),montageDefine("b8d1a32","package.json",{exports:{name:"montage",version:"0.13.0",description:"A UI Framework",repository:{type:"git",url:"https://github.com/montagejs/montage.git"},main:"core/core",bin:{montage:"bin/montage"},dependencies:{collections:"~0.1.17",frb:"~0.2.3",mousse:"~0.1.2",htmlparser2:"~3.0.5"},devDependencies:{"montage-testing":"~0.2.0",mr:"~0.12.6",q:"~0.8.12","q-io":"~1.3.2",jshint:"~2.0.1"},scripts:{test:"node test/node/node-spec.js"},exclude:["bin","etc","lab","node.js","test","tools"],readme:'## Montage\n\nMontage is an application framework powered by standard web technologies.\n\nMontage simplifies the development of rich HTML5 applications by providing modular components, real-time two-way data binding, CommonJS dependency management, and many more conveniences.\n\nMontage opens a world of opportunity that is only just now available for web developers.\n\n#### Components and Templates\n\nMontage has a clean interface for creating custom user interface components. Each component can stand alone or be composed from other components.  Each component is modeled as a stand-alone web application, with its own HTML template, JavaScript, CSS, serialized component object model, and resources.  With few exceptions, a component can stand on the web platform like any other web page.  There are no fully JavaScript driven templates in Montage. This separation of concerns allows designers to use the technologies they are comfortable with, without having to dig into the JavaScript, and allows developers to isolate and test individual components using familiar techniques.\n\n#### Two-way Data binding\n\nMontage makes it easier to manage your application and UI state with data bindings. A UI component or Montage object can establish a one way or bi-directional binding with another component or object. When the bound property, or deeper property path, of the bound object is updated then the source object is kept in sync.\n\n### Prerequisites\n\nTo get started with Montage, you will need the following:\n\n-   A Git client, and public SSH key. For details on installing Git and creating your key, see the setup guides on github.com.\n-   A local web server to serve Montage application. Montage applications can only be served from an HTTP address, not from a local file URL.\n-   A recent stable release of Chrome, Safari or Firefox.\n\n### Quick setup\n\nIf you’re already familiar with using Git, GitHub, and how to configure a local web server,\n\n1.  In a terminal window, create a new projects folder (eg. ~/Projects).\n    ``mkdir Projects``\n    ``cd Projects``\n2.  Clone Montage into ~/Projects\n    ``git clone git@github.com:montagejs/montage.git``\n3.  Configure your local web server to serve the ~/Projects folder over HTTP.\n    Please refer to the suggested Apache configuration found at ``etc/apache-montage.conf``.  This\n    will need to be configured and installed wherever your Apache installation will load other configuration files (eg /etc/apache2/other).\n4.  Verify your setup by browsing to [http://localhost:8081/montage/test/run.html](http://localhost:8081/montage/test/run.html).\n\n--------\n\n### CommonJS\n\nMontage fully supports CommonJS Modules 1.1.1, Packages 1.0, and a\nsubset of Package Mappings proposal C.  It also supports some extensions\nexemplified by NodeJS and NPM.\n\n-   **module.exports**: Modules that do not have cyclic dependencies\n    (modules with dependencies that in turn ultimately depend their own\n    exports) can redefine their exports object by assigning to\n    ``module.exports``.  Montage itself uses this feature sparingly.\n-   **dependencies**: If a package declares a package dependency\n    using NPM’s ``dependencies`` property, Montage looks for that\n    package in the package’s ``node_modules`` subdirectory.  Montage\n    does not presently support cases where a dependency is in a common\n    dependency’s ``node_modules`` directory.  Unlike NPM, with Montage\n    packages, you can override the location of the ``node_modules``\n    directory with the ``directories.packages`` property, or use\n    mappings to find individual packages in alternate locations or give\n    them different local names.\n-   **mappings**: Packages can declare some or all of their package\n    dependencies with the URL ``location`` of the package, particularly\n    a URL relative to the depending package.  Mappings override\n    dependencies if there are conflicts.\n-   **require.packageDescription**: Packages expose the parsed\n    contents of the ``package.json`` file.\n-   **module.path**: Packages expose the URL of the corresponding\n    source.\n-   **module.directory**: Packages expose the URL of the directory\n    containing the corresponding source.\n-   **overlay**: Packages may contain platform-specific overlays.\n    Montage applies the ``browser`` overlay on the root of the package\n    description.\n-   **reels**: Montage permits components to be loaded from a directory\n    with a ``.reel`` extension.  The module system redirects\n    ``require("x.reel")`` to ``require("x.reel/x")``.\n-   **metadata**: Montage hides data on each object exported by a module\n    to permit the serialization system to implicitly discover the module\n    and package that can reinstantiate an object.\n\nThe Montage modules debug-mode run-time loads modules asynchronously and\ncalculates their transitive dependencies heuristically--by statically\nscanning for ``require`` calls using a simple regular expression.\nMontage can load cross-origin scripts in debug-mode if the CORS headers\nare set on the remote server.\n\nTake a look at the Montage Optimizer, tools/mop, to optimize applications for production.  The optimizer can bundle packages with all of the dependent modules, can preload bundles of progressive enhancements in phases, and can generate HTML5 application cache manifests.',readmeFilename:"README.md",_id:"montage@0.13.0",_from:"montage@0.13.0",mappings:{mr:{name:"mr",hash:"f9c294b",location:"../mr@f9c294b/"},q:{name:"q",hash:"0b8cfe2",location:"../q@0b8cfe2/"},collections:{name:"collections",hash:"febb707",location:"../collections@febb707/"},frb:{name:"frb",hash:"1bc5415",location:"../frb@1bc5415/"},mousse:{name:"mousse",hash:"5b57d38",location:"../mousse@5b57d38/"},htmlparser2:{name:"htmlparser2",hash:"22e98aa",location:"../htmlparser2@22e98aa/"}},directories:{lib:"./"},hash:"b8d1a32",production:!0,useScriptInjection:!0}}),montageDefine("febb707","package.json",{exports:{name:"collections",version:"0.1.20",description:"data structures with idiomatic JavaScript collection interfaces",homepage:"http://github.com/montagejs/collections",author:{name:"Kris Kowal",email:"kris@cixar.com",url:"http://github.com/kriskowal"},keywords:["collections","data structures","observable","list","set","map","splay"],bugs:{mail:"kris@cixar.com",url:"http://github.com/montagejs/collections/issues"},licenses:[{type:"MIT",url:"https://raw.github.com/montagejs/collections/master/LICENSE.md"}],repository:{type:"git",url:"http://github.com/montagejs/collections.git"},dependencies:{},devDependencies:{"jasmine-node":"*",istanbul:"*",opener:"*"},scripts:{test:"jasmine-node spec",cover:"istanbul cover node_modules/jasmine-node/bin/jasmine-node spec && istanbul report html && opener coverage/index.html"},readme:'[![Build Status](https://travis-ci.org/montagejs/collections.png?branch=master)](http://travis-ci.org/montagejs/collections)\n\n# Collections\n\nThis package contains JavaScript implementations of common data\nstructures with idiomatic iterfaces, including extensions for Array and\nObject.\n\n-   **List(values, equals, getDefault)**\n\n    An ordered collection of values with fast insertion and deletion and\n    forward and backward traversal, backed by a cyclic doubly linked\n    list with a head node.  Lists support most of the Array interface,\n    except that they use and return nodes instead of integer indicies in\n    analogous functions.\n\n    Lists have a `head` `Node`. The node type is available as `Node` on\n    the list prototype and can be overridden by inheritors.  Each node\n    has `prev` and `next` properties.\n\n-   **Set(values, equals, hash, getDefault)**\n\n    A collection of unique values.  The set can be iterated in the order\n    of insertion.  With a good hash function for the stored values,\n    insertion and removal are fast regardless of the size of the\n    collection.  Values may be objects.  The `equals` and `hash`\n    functions can be overridden to provide alternate definitions of\n    "unique".  `Set` is backed by `FastSet` and `List`.\n\n-   **Map(map, equals, hash, getDefault)**\n\n    A collection of key and value items with unique keys.  Keys may be\n    objects.  The collection iterates in the order of insertion.  `Map`\n    is backed by `Set`.\n\n-   **MultiMap(map, getDefault, equals, hash)**\n\n    A collection of keys mapped to collections of values.  The default\n    `getDefault` collection is an `Array`, but it can be a `List` or any\n    other array-like object.  `MultiMap` inherits `Map` but overrides\n    the `getDefault(key)` provider.\n\n-   **WeakMap()**\n\n    A non-iterable collection of key value pairs.  Keys must objects and\n    do not benefit from `hash` functions.  Some engines already\n    implement `WeakMap`.  The non-iterable requirement makes it possible\n    for weak maps to collect garbage when the key is no longer\n    available, without betraying when the key is collected.  The shimmed\n    implementation undetectably annotates the given key and thus does\n    not necessarily leak memory, but cannot collect certain reference\n    graphs.  This WeakMap shim was implemented by Mark Miller of Google.\n\n-   **SortedSet(values, equals, compare, getDefault)**\n\n    A collection of unique values stored in stored order, backed by a\n    splay tree.  The `equals` and `compare` functions can be overridden\n    to provide alternate definitions of "unique".\n\n    The `compare` method *must* provide a total order of all unique\n    values.  That is, if `compare(a, b) === 0`, it *must* follow that\n    `equals(a, b)`.\n\n-   **SortedMap(map, equals, compare, getDefault)**\n\n    A collection of key value pairs stored in sorted order.  `SortedMap`\n    is backed by `SortedSet` and the `GenericMap` mixin.\n\n-   **LruSet(values, maxLength, equals, hash, getDefault)**\n\n    A cache with the Least-Recently-Used strategy for truncating its\n    content when it’s length exceeds `maxLength`.  `LruSet` is backed by\n    a `Set` and takes advantage of the already tracked insertion order.\n    Both getting and setting a value constitute usage, but checking\n    whether the set has a value and iterating values do not.\n\n-   **LruMap(map, maxLength, equals, hash, getDefault)**\n\n    A cache of items backed by an `LruSet`.\n\n-   **SortedArray(values, equals, compare, getDefault)**\n\n    A collection of values stored in a stable sorted order, backed by an\n    array.\n\n-   **SortedArraySet(values, equals, compare, getDefault)**\n\n    A collection of unique values stored in sorted order, backed by a\n    plain array.  If the given values are an actual array, the sorted\n    array set takes ownership of that array and retains its content.  A\n    sorted array set performs better than a sorted set when it has\n    roughly less than 100 values.\n\n-   **SortedArrayMap(values, equals, compare, getDefault)**\n\n    A collection of key value pairs stored in sorted order, backed by a\n    sorted array set.\n\n-   **FastSet(values, equals, hash, getDefault)**\n\n    A collection of unique values stored like a hash table.  The\n    underlying storage is a `Dict` that maps hashes to lists of values\n    that share the same hash.  Values may be objects.  The `equals` and\n    `hash` functions can be overridden to provide alternate definitions\n    of "unique".\n\n-   **FastMap(map, equals, hash, getDefault)**\n\n    A collection of key and value items with unique keys, backed by a\n    set.  Keys may be objects.  `FastMap` is backed by `FastSet` and the\n    `GenericMap` mixin.\n\n-   **Dict(values, getDefault)**\n\n    A collection of string to value mappings backed by a plain\n    JavaScript object.  The keys are mangled to prevent collisions with\n    JavaScript properties.\n\n-   **Heap(values, equals, compare)**\n\n    A collection that can always quickly (constant time) report its\n    largest value, with reasonable performance for incremental changes\n    (logarithmic), using a contiguous array as its backing storage.\n    However, it does not track the sorted order of its elements.\n\n-   **Iterator(iterable)**\n\n    A wrapper for any iterable that implements `iterate` or iterator the\n    implements `next`, providing a rich lazy traversal interface.\n\n-   **Array**\n\n    An ordered collection of values with fast random access, push, and\n    pop, but slow splice. The `array` module provides extensions so it\n    hosts all the expressiveness of other collections.  The `array-shim`\n    module shims EcmaScript 5 methods onto the array prototype if they\n    are not natively implemented.\n\n-   **Object**\n\n    Can be used as a mapping of owned string keys to arbitrary values.\n    The `object` module provides extensions for the `Object` constructor\n    that support the map collection interface and can delegate to\n    methods of collections, allowing them to gracefully handle both\n    object literals and collections.\n\n## Constructor Arguments\n\nFor all of these constructors, the argument `values` is an optional\ncollection of initial values, and may be an array.  If the `values` are\nin a map collection, the the values are taken, but the keys are ignored.\n\n-   **map**\n\n    The `map` argument is an optional collection to copy shallowly into\n    the new mapping.  The `map` may be an object literal.  If `map`\n    implements `keys`, it is treated as a mapping itself and copied.\n    Otherwise, if `map` implements `forEach`, it may be any collection\n    of `[key, value]` pairs.\n\n`equals(x, y)`, `compare(x, y)`, and `hash(value)` are all optional\narguments overriding the meaning of equality, comparability, and\nconsistent hashing for the purposes of the collection.  `equals` must\nreturn a boolean.  `compare` must return an integer with the same\nrelationship to zero as x to y.  `hash` should consistently return the\nsame string for any given object.\n\n-   **equals(x, y)**\n\n    The default `equals` operator is implemented in terms of `===`, but\n    treats `NaN` as equal to itself and `-0` as distinct from `+0`.  It\n    also delegates to an `equals` method of either the left or right\n    argument if one exists.  The default equality operator is shimmed as\n    `Object.equals`.\n\n-   **compare(x, y)**\n\n    The default `compare` operator is implemented in terms of `<` and\n    `>`.  It delegates to the `compare` method of either the left or\n    right argument if one exists.  It inverts the result if it uses the\n    falls to the right argument.  The default comparator is shimmed as\n    `Object.compare`.\n\n-   **hash(value)**\n\n    The default `hash` operator uses `toString` for values and provides\n    a [Unique Label][] for arbitrary objects.  The default hash is\n    shimmed as `Object.hash`.\n\n[Unique Label]: (http://wiki.ecmascript.org/doku.php?id=harmony:weak_maps#unique_labeler)\n\n-   **getDefault(key or value)**\n\n    The default `getDefault` function is `Function.noop`, which returns\n    `undefined`.  The fallback function is used when you `get` a\n    nonexistant value from any collection.  The `getDefault` function\n    becomes a member of the collection object, so `getDefault` is called\n    with the collection as `this`, so you can also use it to guarantee\n    that default values in a collection are retained, as in `MultiMap`.\n\n\n## Collection Methods\n\nWhere these methods coincide with the specification of an existing\nmethod of Array, Array is noted as an implementation.  `Array+` refers\nto shimmed arrays, as installed with the `array` module.  `Object`\nrefers to methods implemented on the `Object` constructor function, as\nopposed to the `Object.prototype`.  `Object+` in turn refers to methods\nshimmed on the object constructor by the `object` module.  These\nfunctions accept the object as the first argument instead of the `this`\nimplied argument.  ~~Strikethrough~~ indicates an implementation that\nshould exist but has not yet been made (Send a pull request!).\n\nThese are all of the collections:\n\n(Array, Array+, Object+, Iterator, List, Set, Map, MultiMap, WeakMap,\nSortedSet, SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\nSortedArrayMap, FastSet, FastMap, Dict)\n\n-   **has(key)**\n\n    Whether a value for the given key exists.\n\n    (Object+, Map, MultiMap, SortedMap, LruMap, SortedArrayMap, FastMap,\n    Dict)\n\n    **has(value, opt_equals)**\n\n    Whether a value exists in this collection.  This is slow for list\n    (linear), but fast (logarithmic) for SortedSet and SortedArraySet,\n    and very fast (constant) for Set.\n\n    (Array+, List, Set, SortedSet, LruSet, SortedArray, SortedArraySet,\n    FastSet)\n\n-   **get(key or index)**\n\n    The value for a key.  If a Map or SortedMap lacks a key, returns\n    `getDefault(key)`.\n\n    (Array+, Map, SortedMap, SortedArrayMap, WeakMap, Object+)\n\n    **get(value)**\n\n    Gets the equivalent value, or falls back to `getDefault(value)`.\n\n    (List, Set, SortedSet, LruSet, SortedArray, SortedArraySet, FastSet)\n\n-   **set(key or index, value)**\n\n    Sets the value for a key.\n\n    (Map, MultiMap, WeakMap, SortedMap, LruMap, SortedArrayMap, FastMap,\n    Dict)\n\n-   **add(value)**\n\n    Adds a value.  Ignores the operation and returns false if an\n    equivalent value already exists.\n\n    (Array+, List, Set, SortedSet, LruSet, SortedArray, SortedArraySet,\n    FastSet, Heap)\n\n    **add(value, key)**\n\n    Aliases `set(key, value)`, to assist generic methods used for maps,\n    sets, and other collections.\n\n-   **addEach(values)**\n\n    Copies values from another collection to this one.\n\n    (Array+, List, Set, SortedSet, LruSet, SortedArray, SortedArraySet,\n    FastSet, Heap)\n\n    **addEach(mapping)**\n\n    Copies items from another collection to this map.  If the mapping\n    implements `keys` (indicating that it is a mapping) and `forEach`,\n    all of the key value pairs are copied.  If the mapping only\n    implements `forEach`, it is assumed to contain `[key, value]` arrays\n    which are copied instead.\n\n    (Object+, Map, MultiMap, SortedMap, LruMap, SortedArrayMap, FastMap,\n    Dict)\n\n-   **delete(key)**\n\n    Deletes the value for a given key.  Returns whether the key was\n    found.\n\n    (Map, MultiMap, WeakMap, SortedMap, LruMap, SortedArrayMap, FastMap,\n    Dict)\n\n    **delete(value)**\n\n    Deletes a value.  Returns whether the value was found.\n\n    (Set, SortedSet, LruSet, SortedArray, SortedArraySet, FastSet, Heap)\n\n    **delete(value, equals)**\n\n    Deletes the equivalent value.  Returns whether the value was found.\n\n    (Array+, List)\n\n-   **deleteEach(values or keys)**\n\n    Deletes every value or every value for each key.\n\n    (Array+, List, Set, Map, MultiMap, SortedSet, SortedMap,\n    LruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\n    FastSet, FastMap, Dict, Heap)\n\n-   **indexOf(value)**\n\n    Returns the position in the collection of a value, or `-1` if it is\n    not found.  Returns the position of the first of equivalent values.\n    For an Array this takes linear time.  For a SortedArray and\n    SortedArraySet, it takes logarithmic time to perform a binary\n    search.  For a SortedSet, this takes ammortized logarithmic time\n    since it incrementally updates the number of nodes under each\n    subtree as it rotates.\n\n    (Array, ~~List~~, SortedSet, SortedArray, SortedArraySet)\n\n-   **lastIndexOf(value)**\n\n    Returns the position in the collection of a value, or `-1` if it is\n    not found.  Returns the position of the last of equivalent values.\n\n    (Array, ~~List~~, SortedArray, SortedArraySet)\n\n-   **find(value, opt_equals)**\n\n    Finds a value.  For List and SortedSet, returns the node at which\n    the value was found.  For SortedSet, the optional `equals` argument\n    is ignored.\n\n    (Array+, List, SortedSet)\n\n-   **findLast(value, opt_equals)**\n\n    Finds the last equivalent value, returning the node at which the\n    value was found.\n\n    (Array+, List, SortedArray, SortedArraySet)\n\n-   **findLeast()**\n\n    Finds the smallest value, returning the node at which it was found,\n    or undefined.  This is fast (logarithmic) and performs no rotations.\n\n    (SortedSet)\n\n-   **findLeastGreaterThan(value)**\n\n    Finds the smallest value greater than the given value.  This is fast\n    (logarithic) but does cause rotations.\n\n    (SortedSet)\n\n-   **findLeastGreaterThanOrEqual(value)**\n\n    Finds the smallest value greater than or equal to the given value.\n    This is fast (logarithmic) but does cause rotations.\n\n    (SortedSet)\n\n-   **findGreatest()**\n\n    (SortedSet)\n\n-   **findGreatestLessThan(value)**\n\n    (SortedSet)\n\n-   **findGreatestLessThanOrEqual(value)**\n\n    (SortedSet)\n\n-   **push(...values)**\n\n    Adds values to the end of a collection.\n\n    (Array, List)\n\n    **push(...values)** for non-dequeues\n\n    Adds values to their proper places in a collection.\n    This method exists only to have the same interface as other\n    collections.\n\n    (Set, SortedSet, LruSet, SortedArray, SortedArraySet, FastSet, Heap)\n\n-   **unshift(...values)**\n\n    Adds values to the beginning of a collection.\n\n    (Array, List)\n\n    **unshift(...values)** for non-dequeues\n\n    Adds values to their proper places in a collection.\n    This method exists only to have the same interface as other\n    collections.\n\n    (Set, SortedSet, LruSet, SortedArray, SortedArraySet, FastSet)\n\n-   **pop()**\n\n    Removes and returns the value at the end of a collection.  For a\n    Heap, this means the greatest contained value, as defined by the\n    comparator.\n\n    (Array, List, Set, SortedSet, LruSet, SortedArray, SortedArraySet,\n    Heap)\n\n-   **shift()**\n\n    Removes and returns the value at the beginning of a collection.\n\n    (Array, List, Set, SortedSet, LruSet, SortedArray, SortedArraySet)\n\n-   **peek()**\n\n    Returns the last value in an ordered collection.\n\n    (List)\n\n-   **poke(value)**\n\n    Replaces the last value in an ordered collection.\n\n    (List)\n\n-   **slice(start, end)**\n\n    Returns an array of the values contained in the\n    half-open interval [start, end), that is, including the start and\n    excluding the end.  For lists and arrays, both terms may be numeric\n    positive or negative indicies.  For a list, either term may be a\n    node.\n\n    (Array, List, SortedSet, SortedArray, SortedArraySet)\n\n-   **splice(start, length, ...values)**\n\n    Works as with an array, but for a list, the start may be an index or\n    a node.\n\n    (Array, List, SortedArray, SortedSet, SortedArraySet)\n\n-   **swap(start, length, values)**\n\n    Performs a splice without variadic arguments.\n\n    (Array+, List, SortedArray, SortedSet, SortedArraySet)\n\n-   **clear()**\n\n    Deletes the all values.\n\n    (Array+, Object+, List, Set, Map, MultiMap, SortedSet,\n    SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\n    SortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n-   **sort(compare)**\n\n    Sorts a collection in place.  The comparator by only be a function.\n    The default comparator coerces unlike types rather than fail to\n    compare.\n\n    (Array)\n\n-   **sorted(compare, by, order)**\n\n    Returns a collection as an array in sorted order.  Accepts an\n    optional `compare(x, y)` function, `by(property(x))` function, and\n    `order` indicator, `-1` for descending, `1` for ascending, `0` for\n    stable.\n\n    Instead of a `compare` function, the comparator can be an object\n    with `compare` and `by` functions.  The default `compare` value is\n    `Object.compare`.\n\n    The `by` function must be a function that accepts a value from the\n    collection and returns a representative value on which to sort.\n\n    (Array+, List, Set, Map, SortedSet, LruSet, SortedArray,\n    SortedArraySet, FastSet, Heap)\n\n-   **group(callback, thisp, equals)**\n\n    Returns an array of [key, equivalence class] pairs where every\n    element from the collection is placed into an equivalence class\n    if they have the same corresponding return value from the given\n    callback.\n\n    (Array+, Object+, List, Set, Map, MultiMap, SortedSet,\n    SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\n    SortedArrayMap, FastSet, FastMap, Dict, Heap, Iterator)\n\n-   **reverse()**\n\n    Reverses a collection in place.\n\n    (Array, List)\n\n-   **reversed()**\n\n    Returns a collection of the same type with this collection\'s\n    contents in reverse order.\n\n    (Array, List)\n\n-   **enumerate(start=0)**\n\n    Returns an array of [index, value] pairs from the source collection,\n    starting with the given index.\n\n-   **concat(...iterables)**\n\n    Produces a new collection of the same type containing all the values\n    of itself and the values of any number of other collections.  Favors\n    the last of duplicate values.  For map-like objects, the given\n    iterables are treated as map-like objects and each successively\n    updates the result.  Array is like a map from index to value.  List,\n    Set, and SortedSet are like maps from nodes to values.\n\n    (Array, ~~Object+~~, Iterator, List, Set, Map, MultiMap,\n    SortedSet, SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\n    SortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n-   **keys()**\n\n    Returns an array of the keys.\n\n    (Object, Map, MultiMap, SortedMap, LruMap, SortedArrayMap, FastMap,\n    Dict)\n\n-   **values()**\n\n    Returns an array of the values\n\n    (Object+, Map, MultiMap, SortedMap, LruMap, SortedArrayMap, FastMap,\n    Dict)\n\n-   **items()**\n\n    Returns an array of `[key, value]` pairs for each item\n\n    (Object+, Map, MultiMap, SortedMap, LruMap, SortedArrayMap, FastMap,\n    Dict)\n\n-   **reduce(callback(result, value, key, object, depth), basis,\n    thisp)**:\n\n    (Array, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\n    LruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\n    FastSet, FastMap, Dict, Heap)\n\n-   **reduceRight(callback(result, value, key, object, depth), basis,\n    thisp)**:\n\n    (Array, List, SortedSet, ~~SortedMap~~, SortedArray, SortedArraySet,\n    ~~SortedArrayMap~~, Heap)\n\n-   **forEach(callback(value, key, object, depth), thisp)**\n\n    Calls the callback for each value in the collection.  The iteration\n    of lists is resilient to changes to the list.  Particularly, nodes\n    added after the current node will be visited and nodes added before\n    the current node will be ignored, and no node will be visited twice.\n\n    (Array, Object+, Iterator, List, Set, Map, MultiMap, WeakMap,\n    SortedSet, SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\n    SortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n-   **map(callback(value, key, object, depth), thisp)**\n\n    (Array, Object+, Iterator, List, Set, Map, MultiMap, WeakMap,\n    SortedSet, SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\n    SortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n-   **toArray()**\n\n    (Array+, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\n    LruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\n    FastSet, FastMap, Dict, Heap)\n\n-   **toObject()**\n\n    Converts any collection to an object, treating this collection as a\n    map-like object.  Array is like a map from index to value.\n\n    (Array+ Iterator, List, Map, MultiMap, SortedMap, LruMap,\n    SortedArrayMap, FastMap, Dict, Heap)\n\n-   **filter(callback(value, key, object, depth), thisp)**\n\n    (Array, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\n    LruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\n    FastSet, FastMap, Dict, Heap)\n\n-   **every(callback(value, key, object, depth), thisp)**\n\n    Whether every value passes a given guard.  Stops evaluating the\n    guard after the first failure.  Iterators stop consuming after the\n    the first failure.\n\n    (Array, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\n    LruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\n    FastSet, FastMap, Dict, Heap)\n\n-   **some(callback(value, key, object, depth), thisp)**\n\n    Whether there is a value that passes a given guard.  Stops\n    evaluating the guard after the first success.  Iterators stop\n    consuming after the first success.\n\n    (Array, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\n    LruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\n    FastSet, FastMap, Dict, Heap)\n\n-   **any()**\n\n    Whether any value is truthy.\n\n    (Array+, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\n    LruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\n    FastSet, FastMap, Dict, Heap)\n\n-   **all()**\n\n    Whether all values are truthy.\n\n    (Array+, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\n    LruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\n    FastSet, FastMap, Dict, Heap)\n\n-   **min()**\n\n    The smallest value.  This is fast for sorted collections (logarithic\n    for SortedSet, constant for SortedArray, SortedArraySet, and\n    SortedArrayMap), but slow for everything else (linear).\n\n    (Array+, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\n    LruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\n    FastSet, FastMap, Dict)\n\n-   **max()**\n\n    The largest value.  This is fast for sorted collections (logarithic\n    for SortedSet, constant for SortedArray, SortedArraySet, and\n    SortedArrayMap), but slow for everything else (linear).\n\n    (Array+, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\n    LruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\n    FastSet, FastMap, Dict, Heap)\n\n-   **one()**\n\n    Any single value, or throws an exception if there are no values.\n    This is very fast (constant) for all collections.  For a sorted set,\n    the value is not deterministic and depends on what value was most\n    recently accessed.\n\n    (Array+, List, Set, Map, MultiMap, SortedSet, SortedMap, LruSet,\n    LruMap, SortedArray, SortedArray, SortedArraySet, SortedArrayMap,\n    FastSet, FastMap, Dict, Heap)\n\n-   **only()**\n\n    The one and only value, or throws an exception if there are no\n    values or more than one value.\n\n    (Array+, List, Set, Map, MultiMap, SortedSet, SortedMap, LruSet,\n    LruMap, SortedArray, SortedArray, SortedArraySet, SortedArrayMap,\n    FastSet, FastMap, Dict, Heap)\n\n-   **sum()**\n\n    (Array+, Iterator, List, Set, Map, MultiMap, SortedSet,\n    SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\n    SortedArrayMap, FastSet, FastMap, Dict)\n\n-   **average()**\n\n    (Array+, Iterator, List, Set, Map, MultiMap, SortedSet,\n    SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\n    SortedArrayMap, FastSet, FastMap, Dict)\n\n-   **flatten()**\n\n    (Array+, Iterator, List, Set, Map, MultiMap, SortedSet,\n    SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\n    SortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n-   **zip(...collections)**\n\n    (Array+, Iterator, List, Set, Map, MultiMap, SortedSet,\n    SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\n    SortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n-   **enumrate(zero)**\n\n    (Array+, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\n    LruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\n    FastSet, FastMap, Dict, Heap)\n\n-   **clone(depth, memo)**\n\n    Replicates the collection.  Clones the values deeply, to the\n    specified depth, using the memo to resolve reference cycles.  (which\n    must the `has` and `set` parts of the Map interface, allowing\n    objects for keys)  The default depth is infinite and the default\n    memo is a WeakMap.\n\n    `Object.clone` can replicate object literals inheriting directly\n    from `Object.prototype` or `null`, or any object that implements\n    `clone` on its prototype.  Any other object causes `clone` to throw\n    an exception.\n\n    The `clone` method on any other objects is not intended to be used\n    directly since they do not necessarily supply a default depth and\n    memo.\n\n    (Array+, Object+, List, Set, Map, MultiMap, SortedSet,\n    SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\n    SortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n-   **constructClone(values)**\n\n    Replicates a collection shallowly.  This is used by each `clone`\n    implementation to create a new collection of the same type, with the\n    same options (`equals`, `compare`, `hash` options), but it leaves\n    the job of deeply cloning the values to the more general `clone`\n    method.\n\n    (Array+, Object+, List, Set, Map, MultiMap, SortedSet,\n    SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\n    SortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n-   **equals(that, equals)**\n\n    (Array+, Object+, List, Set, Map, MultiMap, SortedSet, SortedMap,\n    LruSet, LruMap, ~~SortedArray~~, SortedArraySet, SortedArrayMap,\n    FastSet, FastMap, Dict)\n\n-   **compare(that)**\n\n    (Array+, Object+, List, ~~SortedArray~~, ~~SortedArraySet~~)\n\n-   **iterate()**\n\n    Produces an iterator with a `next` method.  You may elect to get\n    richer iterators by wrapping this iterator with an `Iterator` from\n    the `iterator` module.  Iteration order of lists is resilient to\n    changes to the list.\n\n    (Array+, Iterator, List, Set, SortedSet, LruSet, SortedArray,\n    SortedArraySet, FastSet)\n\n    **iterate(start, end)**\n\n    Returns an iterator for all values at indicies in the half-open\n    interval [start, end), that is, greater than start, and less than\n    end.\n\n    (Array+)\n\n    **iterate(start, end)**\n\n    Returns an iterator for all values in the half-open interval [start,\n    end), that is, greater than start, and less than end.  The iterator\n    is resilient against changes to the data.\n\n    (SortedSet)\n\n-   **log(charmap, callback(node, write, writeAbove), log, logger)**\n\n    Writes a tree describing the internal state of the data structure to\n    the console.\n\n    `charmap` is an object that notes which characters to use to draw\n    lines.  By default, this is the `TreeLog.unicodeRound` property from the\n    `tree-log` module.  `TreeLog.unicodeSharp` and `TreeLog.ascii` are\n    alternatives.  The properties are:\n\n    -   intersection: ╋\n    -   through: ━\n    -   branchUp: ┻\n    -   branchDown: ┳\n    -   fromBelow: ╭\n    -   fromAbove: ╰\n    -   fromBoth: ┣\n    -   strafe: ┃\n\n    `callback` is a customizable function for rendering each node of the tree.\n    By default, it just writes the value of the node.  It accepts the node and\n    a writer functions.  The `write` function produces the line on which the\n    node joins the tree, and each subsequent line.  The `writeAbove` function\n    can write lines before the branch.\n\n    `log` and `loger` default to `console.log` and `console`.  To write\n    the representation to an array instead, they can be `array.push` and\n    `array`.\n\n    (SortedSet)\n\n\n### Iterator\n\n-   **dropWhile(callback(value, index, iterator), thisp)**\n\n-   **takeWhile(callback(value, index, iterator), thisp)**\n\n-   **mapIterator(callback(value, index, iterator))**\n\n    Returns an iterator for a mapping on the source values.  Values are\n    consumed on demand.\n\n-   **filterIterator(callback(value, index, iterator))**\n\n    Returns an iterator for those values from the source that pass the\n    given guard.  Values are consumed on demand.\n\n-   **zipIterator(...iterables)**\n\n    Returns an iterator that incrementally combines the respective\n    values of the given iterations.\n\n-   **enumerateIterator(start = 0)**\n\n    Returns an iterator that provides [index, value] pairs from the\n    source iteration.\n\n\n### Iterator utilities\n\n-   **cycle(iterable, times)**\n\n-   **concat(iterables)**\n\n-   **transpose(iterables)**\n\n-   **zip(...iterables)**\n\n    Variadic transpose.\n\n-   **chain(...iterables)**\n\n    Variadic concat.\n\n-   **range(start, stop, step)**\n\n    Iterates from start to stop by step.\n\n-   **count(start, step)**\n\n    Iterates from start by step, indefinitely.\n\n-   **repeat(value, times)**\n\n    Repeats the given value either finite times or indefinitely.\n\n\n## Change Listeners\n\nAll collections support change listeners.  There are three types of\nchanges.  Property changes, map changes, and range changes.\n\n### Property Changes\n\n`PropertyChanges` from the `listen/property-changes` module can\nconfigure listeners for property changes to specific keys of any object.\n\nWith the `listen/array-changes` module required, `PropertyChanges` can\nalso listen to changes to the length and indexed properties of an array.\nThe only caveat is that watched arrays can only modify their contents\nwith method calls like `array.push`.  All methods of a watched array\nsupport change dispatch.  In addition, arrays have a `set` method to\nmake setting the value at a particular index observable.\n\n-   PropertyChanges.addOwnPropertyChangeListener(object, key, listener, before)\n-   PropertyChanges.removeOwnPropertyChangeListener(object, key, listener, before)\n-   PropertyChanges.dispatchOwnPropertyChange(object, key, value, before)\n-   PropertyChanges.addBeforeOwnPropertyChangeListener(object, key, listener)\n-   PropertyChanges.removeBeforeOwnPropertyChangeListener(object, key, listener)\n-   PropertyChanges.dispatchBeforeOwnPropertyChange(object, key, value)\n-   PropertyChanges.getOwnPropertyChangeDescriptor(object, key)\n\nAll of these functions delegate to methods of the same name if one\nexists on the object.\n\n-   object.addOwnPropertyChangeListener(key, listener, before)\n-   object.removeOwnPropertyChangeListener(key, listener, before)\n-   object.dispatchOwnPropertyChange(key, value, before)\n-   object.addBeforeOwnPropertyChangeListener(key, listener)\n-   object.removeBeforeOwnPropertyChangeListener(key, listener)\n-   object.dispatchBeforeOwnPropertyChange(key, value)\n-   object.getOwnPropertyChangeDescriptor(key)\n\nAdditionally, `PropertyChanges.prototype` can be **mixed into** other\ntypes of objects to support the property change dispatch interface.  All\ncollections support this interface.\n\nThe **listener** for a property change receives the arguments `value`,\n`key`, and `object`, just as a `forEach` or `map` callback.  The\nlistener may alternately be a delegate object that implements one of\nthese methods:\n\n-   listener.handle + **key** + Change **or** WillChange\n-   listener.handleProperty + Change **or** WillChange\n-   listener.call\n\n### Map Changes\n\nA map change listener receives notifications for the creation, removal,\nor updates for any item in a map data structure.\n\nWith the `listen/array-changes` module required, `Array` can also\ndispatch map changes for the values at each index.\n\n-   collection.addMapChangeListener(listener, token, before)\n-   collection.removeMapChangeListener(listener, token, before)\n-   collection.dispatchMapChange(key, value, before)\n-   collection.addBeforeMapChangeListener(listener)\n-   collection.removeBeforeMapChangeListener(listener)\n-   collection.dispatchBeforeMapChange(key, value)\n-   collection.getMapChangeDescriptor()\n\nThe **listener** for a map change receives the `value`, `key`, and\ncollection `object` as arguments, the same pattern as a `forEach` or\n`map` callback.  In the after change phase, a value of `undefined` may\nindicate that the value was deleted or set to `undefined`.  In the\nbefore change phase, a value of `undefined` may indicate the the value\nwas added or was previously `undefined`.\n\nThe listener may be a delegate object with one of the following methods,\nin order of precedence:\n\n-   listener.handleMap + Change **or** WillChange\n-   listener.handle + **token** + Map + Change **or** WillChange\n-   listener.call\n\nThe `listen/map-changes` module exports a map changes **mixin**.  The\nmethods of `MaxChanges.prototype` can be copied to any collection that\nneeds this interface.  Its mutation methods will then need to dispatch\nmap changes.\n\n### Range Changes\n\nA range change listener receives notifications when a range of values at\na particular position is added, removed, or replaced within an ordered\ncollection.\n\n-   collection.**add**RangeChange**Listener**(listener, token, before)\n-   collection.**remove**RangeChange**Listener**(listener, token, before)\n-   collection.**dispatch**RangeChange(plus, minus, index, before)\n-   collection.add**Before**RangeChange**Listener**(listener)\n-   collection.remove**Before**RangeChange**Listener**(listener)\n-   collection.dispatch**Before**RangeChange(plus, minus, index)\n-   collection.**get**RangeChange**Descriptor**()\n\nThe **listener** for a range change is a function that accepts `plus`,\n`minus`, and `index` arguments.  `plus` and `minus` are the values that\nwere added or removed at the `index`.  Whatever operation caused these\nchanges is equivalent to:\n\n```javascript\nvar minus = collection.splice(index, minus.length, ...plus)\n```\n\nThe listener can alternately be a delegate object with one of the\nfollowing methods in order of precedence:\n\n-   handle + **token** + Range + Change **or** WillChange\n-   handleRange + Change **or** WillChange\n-   call\n\nThe following support range change dispatch:\n\n-   `Array` with `require("collections/listen/array-changes")`\n-   `SortedSet`\n-   `SortedArray`\n-   `SortedArraySet`\n\nThe `listen/range-changes` module exports a range changes **mixin**.\nThe methods of `RangeChanges.prototype` can be copied to any collection\nthat needs this interface.  Its mutation methods will need to dispatch\nthe range changes.\n\nAll **descriptors** are objects with the properties `changeListeners`\nand `willChangeListeners`.  Both are arrays of listener functions or\nobjects, in the order in which they were added.\n\n\n## Miscellanea\n\n### Set and Map\n\nSet and map are like hash tables, but not implemented with a block of\nmemory as they would be in a lower-level language.  Most of the work of\nproviding fast insertion and lookup based on a hash is performed by the\nunderlying plain JavaScript object.  Each key of the object is a hash\nstring and each value is a List of values with that hash.  The inner\nlist resolves collisions.  With a good `hash` method, the use of the\nlist can be avoided.\n\nSets and maps both have a `log` function that displays the internal\nstructure of the bucket list in an NPM-style.\n\n```\n┣━┳ 1\n┃ ┗━━ {"key":1,"value":"a"}\n┣━┳ 2\n┃ ┣━━ {"key":2,"value":"c"}\n┃ ┗━━ {"key":2,"value":"d"}\n┗━┳ 3\n  ┗━━ {"key":3,"value":"b"}\n```\n\n\n### Sorted Set and Sorted Map\n\nA binary splay tree is a balanced binary tree that rotates the most\nfrequently used items toward the root such that they can be accessed the\nmost quickly.  `sorted-set` and `sorted-map` are backed by a splay tree.\n\nAll map implementations use an underlying set implementation.  Any map\ncan be implemented trivially atop a set by wrapping `compare`, `equals`,\nor `hash` to operate on the key of an item.\n\nThe sorted set has a `root` node.  Each node has a `left` and `right`\nproperty, which may be null.  Nodes are returned by all of the "find"\nfunctions, and provided as the `key` argument to callbacks.\n\nBoth `sorted-set` and `sorted-map` implement a `log` function which can\nproduce NPM-style visualizations of the internal state of the sorted\ntree.\n\n```\n> set.log(SortedSet.ascii)\n  .-+ -3\n  | \'-- -2\n.-+ -1\n+ 0\n| .-- 1\n\'-+ 2\n  \'-- 3\n```\n\n```\n> set.log(SortedSet.unicodeRound)\n  ╭━┳ -3\n  ┃ ╰━━ -2\n╭━┻ -1\n╋ 0\n┃ ╭━┳ 1\n┃ ┃ ╰━━ 2\n╰━┻ 3\n```\n\n\n### Object and Function Shims\n\nThe collection methods on the `Object` constructor all polymorphically\ndelegate to the corresponding method of any object that implements the\nmethod of the same name.  So, `Object.has` can be used to check whether\na key exists on an object, or in any collection that implements `has`.\nThis permits the `Object` interface to be agnostic of the input type.\n\n`Array.from` creates an array from any iterable.\n\n`Array.unzip` transposes a collection of arrays, so rows become columns.\n\n`Array.empty` is an empty array, frozen if possible.  Do not modify it.\n\n`Object.from` creates an object from any map or collection.  For arrays\nand array-like collections, uses the index for the key.\n\n`Object.empty` is an empty object literal.\n\n`Object.isObject(value)` tests whether it is safe to attempt to access\nproperties of a given value.\n\n`Object.is(x, y)` compares objects for exact identity and is a good\nalternative to `Object.equals` in many collections.\n\n`Object.getValueOf(value)` safely and idempotently returns the value of\nan object or value by only calling the `valueOf()` if the value\nimplements that method.\n\n`Object.owns` is a shorthand for `Object.prototype.hasOwnProperty.call`.\n\n`Object.can(value, name)` checks whether an object implements a method\non its prototype chain.  An owned function property does not qualify as\na method, to aid in distinguishing "static" functions.\n\n`Object.concat(...maps)` and `Object.from(items)` construct an object\nby adding the items of other objects in order.  The maps can be other\nobjects, arrays of items, or map alike collections.\n\n`Function.noop` is returns undefined.\n\n`Function.identity` returns its first argument.\n\n`Function.by(relation)` creates a comparator from a relation function.\n\n`Function.get(key)` creates a relation that returns the value for the\nproperty of a given object.\n\n\n### References\n\n- a SplayTree impementation buried in Fedor Indutny’s super-secret\n  [Callgrind](https://github.com/indutny/callgrind.js). This\n  implementation uses parent references.\n- a SplayTree implementation adapted by [Paolo\n  Fragomeni](https://github.com/hij1nx/forest) from the V8 project and\n  based on the top-down splaying algorithm from "Self-adjusting Binary\n  Search Trees" by Sleator and Tarjan. This does not use or require\n  parent references, so I favored it over Fedor Indutny’s style.\n- the interface of ECMAScript harmony [simple maps and\n  sets](http://wiki.ecmascript.org/doku.php?id=harmony:simple_maps_and_sets)\n- a SplayTree implementation from [JavaScript data\n  structures](derrickburns/Javascript-Data-Structures) mainted by\n  Derrick Burns that supports change-resilient iterators and a\n  comprehensive set of introspection functions.\n\n### Future work\n\nGoals\n\n- automate the generation of the method support tables in readme and\n  normalize declaration order\n- comprehensive specs and spec coverage tests\n- fast list splicing\n- dict map changes\n- revise map changes to use separate handlers for add/delete\n- revise tokens for range and map changes to specify complete alternate\n  delegate methods, particularly for forwarding directly to dispatch\n- implement on/once/off listeners\n- Make it easier to created a SortedSet with a criterion like\n  Function.by(Function.get(\'name\'))\n\nMore possible collections\n\n- sorted-order (sorted, can contain duplicates, perhaps backed by splay\n  tree with relaxation on the uniqueness invariant)\n- sorted-multi-map (sorted, can contain duplicate entries, backed by\n  sorted-map)\n- trie-set\n- trie-map\n- immutable-* (mutation functions return new objects that largely share\n  the previous version\'s internal state, some perhaps backed by a hash\n  trie)\n\n',readmeFilename:"README.md",_id:"collections@0.1.20",_from:"collections@~0.1.17",directories:{lib:"./"},hash:"febb707",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("5b57d38","package.json",{exports:{name:"mousse",version:"0.1.3",description:"Deserialization of JavaScript objects",keywords:["deserialization","serialization"],author:{name:"António Afonso",email:"antonio.afonso@gmail.com",url:"http://github.com/aadsm/"},contributors:[{name:"António Afonso",email:"antonio.afonso@gmail.com",url:"http://github.com/aadsm/"}],bugs:{url:"http://github.com/montagejs/mousse/issues"},licenses:[{type:"BSD",url:"http://github.com/montagejs/mousse/raw/master/LICENSE.md"}],repository:{type:"git",url:"http://github.com/montagejs/mousse.git"},main:"mousse",dependencies:{q:"~0.8.0",collections:"~0.1.14"},devDependencies:{"jasmine-node":"~1.1.0"},scripts:{test:"./node_modules/.bin/jasmine-node spec"},readme:'# Mousse\n\nA serialization library that serializes graphs of JavaScript objects.\n\nIts main purpose is to provide the features that are missing in JSON and a mechanism to easily extend the serialization format with new types or custom JavaScript objects.\n\nThis is the library used by the Montage framework to manage the serialization of objects in its templates.\n\n## What it does that JSON doesn\'t\n\n * Named objects\n * References and circular references (no more `TypeError: Converting circular structure to JSON`)\n * Regular Expressions\n * Custom Types\n * Asynchronous revivers\n\n## API Reference\n\n**`Serializer()`**\n\n-   **`serializeObject(object)`**\n\n    Serializes an object into a string.\n\n-   **`serialize(objects)`**\n\n    Serializes objects into a string, each object is passed with a label associated with it. Objects are passed in an object literal `{label1: object1, label2: object2, ..., labelN: objectN}`.\n\n-   **`setSerializationIndentation(indentation)`**\n\n    Set the indentation level of the serialization string (in number of spaces).\n\n**`Deserializer(serializationString)`**\n\n-   _**`constructor`**_\n\n    Creates a deserialization object to deserialize the objects serialized in `serializationString`.\n\n-   **`deserializeObject()`**\n\n    Returns a promise for an object that was serialized with `serializeObject`.\n\n-   **`deserialize(instances)`**\n\n    Returns a promise for the objects that were serialized with `serialize`. This result is an object literal with the deserialized objects and their respective labels: `{label1: object1, label2: object2, ..., labelN: objectN}`.\n\n    The `instances` parameter allows to override the deserialization of specific objects by using the instance passed instead, they are passed in an object literal: `{label1: object1, label2: object2, ..., labelN: objectN}`.\n\n## Serialization of JavaScript objects\n### Multiple Objects\n```javascript\nvar Serializer = require("mousse").Serializer;\n\nvar object = {\n    x: 2,\n    y: 4\n};\n\nvar array = [1, 2, 3];\n\nvar serializationString = new Serializer().serialize({foo: object, bar: array});\n```\n\n### Single Object\n\nWhen serializing a single object there\'s no need to provide a label:\n\n```javascript\nvar Serializer = require("mousse").Serializer;\n\nvar object = {\n    x: 2,\n    y: 4\n};\n\nvar serializationString = new Serializer().serializeObject(object);\n```\n\nThere\'s also a shorthand function to serialize a single object:\n\n```javascript\nvar serialize = require("mousse").serialize;\n\nvar object = {\n    x: 2,\n    y: 4\n};\n\nvar serializationString = serialize(object);\n```\n\n## Deserialization of JavaScript objects\n### Multiple Objects\n```javascript\nvar Deserializer = require("mousse").Deserializer,\n    deserializer = new Deserializer(serializationString);\n\ndeserializer.deserialize()\n.then(function(objects) {\n    // deserialized objects are in objects\n});\n```\n\n### Single Object\n```javascript\nvar Deserializer = require("mousse").Deserializer,\n    deserializer = new Deserializer(serializationString);\n\ndeserializer.deserializeObject()\n.then(function(object) {\n    //\n});\n```\n\nAgain, like for serialization, there\'s a shorthand function to deserialize a single object:\n```javascript\nvar Deserializer = require("mousse").deserialize;\n\ndeserialize(serializationString)\n.then(function(object) {\n    //\n});\n```\n\nConsecutive calls to `deserializer.deserialize()` will create a new set of objects from the serialization.\n\n## Serialization Format\n\nThe serialization format is inspired by JSON and it may even be considered as an extension. By itself the format is a JSON valid object.\n\nInstead of only serializing a single object, Mousse is able to serialize several independent objects by providing a label for each one. We can look at it as a dictionary.\n\nThe base format of the serialization is thus an object with as many entries as labeled objects:\n```javascript\n{\n    "label1": {\n        "value": <object1 serialization>\n    },\n\n    "label2": {\n        "value": <object2 serialization>\n    },\n\n    ...,\n\n    "labelN": {\n        "value": <objectN serialization>\n    }\n}\n```\nThe following JavaScript objects are supported:\n\n    * string\n    * number\n    * boolean\n    * null\n    * array\n    * object literal\n    * regular expression\n    * references\n\nNative JavaScript objects are stored just like their JSON representation with the exception of regular expressions (which are not supported by JSON).\n\n### String\n```javascript\nserialize({string: "a string"})\n\n{\n    "string": {\n        "value": "a string"\n    }\n}\n```\n### Number\n```javascript\nserialize({number: 42})\n\n{\n    "number": {\n        "value": 42\n    }\n}\n```\n### Boolean\n```javascript\nserialize({bool: true})\n\n{\n    "bool": {\n        "value": true\n    }\n}\n```\n### Null\n```javascript\nserialize({nil: null})\n\n{\n    "nil": {\n        "value": null\n    }\n}\n```\n### Array\n```javascript\nserialize({array: [1, 2, 3]})\n\n{\n    "array": {\n        "value": [1, 2, 3]\n    }\n}\n```\n### Object Literal\n```javascript\nserialize({object: {x: 2, y: 4}})\n\n{\n    "object": {\n        "value": {\n            "x": 2,\n            "y": 4\n        }\n    }\n}\n```\n### Regular Expression\n```javascript\nserialize({regexp: /regexp/gi})\n\n{\n    "regexp": {\n        "value": {"/": {\n            "source": "regexp",\n            "flags": "gi"\n        }}\n    }\n}\n```\n### References\n\nSince objects have labels it is possible to serialize a reference to an object instead of serializing the entire object again as it happens in JSON:\n```javascript\nvar manager = {\n    name: "Foo"\n}\n\nvar employee = {\n    name: "Bar",\n    manager: manager\n}\n\nserialize({manager: manager, employee: employee})\n\n{\n    "manager": {\n        "value": {\n            "name": "Foo"\n        }\n    },\n\n    "employee": {\n        "value": {\n            "name": "Bar",\n            "manager": {"@": "manager"}\n        }\n    }\n}\n```\nReferences also solves cycles in an object graph:\n```javascript\nvar object = {};\nobject.self = object;\n\nserialize({object: object});\n\n{\n    "object": {\n        "value": {\n            "self": {"@": "object"}\n        }\n    }\n}\n```\nWhen an object is referred more than once it will automatically be assigned a label and only references will be used to refer to it.\n```javascript\nvar array = [1, 2, 3];\nvar object = {\n    foo: array,\n    bar: array\n}\n\nserialize({object: object});\n\n{\n    "object": {\n        "value": {\n            "foo": {"@": "array"},\n            "bar": {"@": "array"}\n        }\n    },\n\n    "array": {\n        "value": [1, 2, 3]\n    }\n}\n```\n## Custom Objects\n\nRoot objects with the `value` property represent JavaScript objects. It is possible to define other types of objects by adding the necessary logic to recognize them and create them.\n\n### Serialization\n\nThe logic to serialize a custom object is handled by the Visitor object. This is the object that visits the graph of objects traversed during serialization and knows what data to store for each type.\nThe interface expects a `getTypeOf` function that returns the type of the object and a `visit<Type>` function that knows what data to store from the object. Multiple `visit<Type>` can be defined as long as `getTypeOf` returns different types.\n\n```javascript\nVisitor.addCustomObjectVisitor({\n    getTypeOf: function(value) {\n        if (value instanceof Map) {\n            return "Map";\n        }\n    },\n\n    visitMap: function(malker, visitor, object, name) {\n        var map = visitor.builder.createCustomObject();\n            mapData = object.toObject();\n\n        malker.visit("map", "type");\n        malker.visit(mapData, "object");\n\n        visitor.storeValue(map, object, name);\n    }\n});\n```\nThe result of the serialization is:\n```javascript\n{\n    "root": {\n        "type": "map",\n        "object": {/* map data */}\n    }\n}\n```\n\n### Deserialization\n\nThe logic to deserialize a custom object is handled by the `Reviver` object. This is the object that knows how to revive objects. The interface expects a `getTypeOf` function that returns the type of the object and a `revive<Type>` function that knows how to revive the object. Multiple `revive<Type>` can be defined as long as `getTypeOf` returns different types.\n\nExample to deserialize:\n```javascript\n{\n    "root": {\n        "type": "map",\n        "object": {/* map data */}\n    }\n}\n```\n```javascript\nReviver.addCustomObjectReviver({\n    getTypeOf: function(value) {\n        if (value.type === "map") {\n            return "Map";\n        }\n    },\n\n    reviveMap: function(value, context, label) {\n        var map = new Map(value.object);\n\n        if (label) {\n            context.setObjectLabel(map, label);\n        }\n\n        return map;\n    }\n});\n```\nThe result of the deserialization is:\n```javascript\n{\n    root: <Map Object>\n}\n```\n\nReviver functions can be asynchronous by returning a promise to the revived value.\n\n### Context\n\nThe `context` object is given as the second parameter to all `revive*` functions and it is used to set labels on deserialized objects, so they can be accessed after the deserialization, and to get objects that were serialized under a specific label.\n\n * `setObjectLabel(object, label)` - Defines the label of `object`.\n * `getObject(label)` - Returns the object with label `label`.\n\n## Extending the Serialization Format\n\nThe Mousse serialization format can be extended by extending the Builder and Visitor objects.\n\n### Serialization\n\nDuring serialization an AST-like object is created that holds all the data needed to be serialized. It is the role of the `Visitor` to create this AST.\n\nWhen the AST is finished it is the role of the `Builder` to generate an output format by reading the AST. The `Builder` presented in Mousse generates JSON but it should be possible to create a Builder that generates another format, for instance XML.\n\nThe `Builder` provides the necessary methods to create the AST Nodes:\n\n * `createObjectLiteral()`\n * `createArray()`\n * `createObjectReference()`\n * `createRegExp(regexp)`\n * `createString(string)`\n * `createNumber(number)`\n * `createBoolean(value)`\n * `createNull()`\n * `createCustomObject()`\n\nThese are the JavaScript objects that Mousse supports. In order to create new ones it is necessary to extend the `Builder` and the `Visitor`.\n\nTo extend the serialization format to know about DOM elements and to serialize them into `{"#" "<element id>"}` we need to:\n\n#### Create the AST node\n```javascript\nfunction ElementReference(root, id) {\n    Value.call(this, root, id);\n}\n\nElementReference.prototype = Object.create(Value.prototype, {\n    constructor: {value: ElementReference},\n\n    _getSerializationValue: {\n        value: function() {\n            return {"#": this.value};\n        }\n    }\n});\n```\n#### Extend the Builder object\n```javascript\nfunction ExtendedBuilder() {\n    Builder.call(this);\n}\n\nExtendedBuilder.prototype = Object.create(Builder.prototype, {\n    constructor: {value: ExtendedBuilder},\n\n    createElementReference: {\n        value: function(id) {\n            return new ElementReference(this._root, id);\n        }\n    }\n});\n```\n#### Extend the Visitor object\n```javascript\nfunction ExtendedVisitor(builder, labeler) {\n    Visitor.call(this, builder, labeler);\n}\n\nExtendedVisitor.prototype = Object.create(Visitor.prototype, {\n    constructor: {value: ExtendedVisitor},\n\n    getTypeOf: {\n        value: function(object) {\n            if (!!(object && 1 === object.nodeType)) {\n                return "ElementReference";\n            }\n        }\n    },\n\n    visitElementReference: {\n        value: function(malker, object, name) {\n            var elementReference,\n                id = object.id;\n\n            elementReference = this.builder.createElementReference(id);\n            this.storeValue(elementReference, object, name);\n        }\n    }\n});\n```\n### Deserialization\n\nDeserialization is handled by the `Reviver` and as such this object needs to be extended to understand the new syntax added to the serialization (`{"#": "<element id>"}`).\n```javascript\nExtendedReviver.prototype = Object.create(Reviver.prototype, {\n    constructor: {value: ExtendedReviver},\n\n    getTypeOf: {\n        value: function(value) {\n            if (value !== null && typeof value === "object"\n                && Object.keys(value).length === 1 && "#" in value) {\n                return "ElementReference";\n            } else {\n                return Reviver.prototype.getTypeOf.call(this, value);\n            }\n        }\n    },\n\n    reviveElementReference: {\n        value: function(value, context, label) {\n            var elementId = value["#"],\n                element = document.getElementById(elementId);\n\n            if (label) {\n                context.setObjectLabel(element, label);\n            }\n\n            return element;\n        }\n    }\n});\n```\n\n## Known Issues\n\nNot possible to serialize literal objects that can be mistaken as a reference or a regexp - `{"@": "label"}` and `{"/": {"source": "regexp"}}`).\n\n',readmeFilename:"README.md",_id:"mousse@0.1.3",_from:"mousse@~0.1.2",directories:{lib:"./"},hash:"5b57d38",mappings:{q:{name:"q",hash:"0b8cfe2",location:"../q@0b8cfe2/"},collections:{name:"collections",hash:"febb707",location:"../collections@febb707/"}},production:!0,useScriptInjection:!0}}),montageDefine("1bc5415","package.json",{exports:{name:"frb",version:"0.2.3",description:"Functional reactive bindings",keywords:["functional","reactive","bindings","observe","change"],author:{name:"Kris Kowal",email:"kris@cixar.com",url:"http://github.com/kriskowal/"},contributors:[{name:"Kris Kowal",email:"kris@cixar.com",url:"http://github.com/kriskowal/"}],bugs:{mail:"kris@cixar.com",url:"http://github.com/kriskowal/frb/issues"},licenses:[{type:"MIT",url:"http://github.com/kriskowal/frb/raw/master/LICENSE.md"}],repository:{type:"git",url:"http://github.com/kriskowal/frb.git"},main:"bindings",dependencies:{collections:"~0.1.15"},devDependencies:{"jasmine-node":"1.x.x",pegjs:"git://github.com/dmajda/pegjs.git"},scripts:{test:"jasmine-node spec","build-parser":"pegjs --allowed-start-rules expression,sheet grammar.pegjs"},readme:'\n<img src="frb.png" align="right" alt="FRB Logo">\n\n# Functional Reactive Bindings\n\nIn their simplest form, bindings provide the illusion that two objects\nhave the same property.  Changing the property on one object causes the\nsame change in the other.  This is useful for coordinating state between\nviews and models, among other entangled objects.  For example, if you\nenter text into a text field, the same text might be added to the\ncorresponding database record.\n\n```javascript\nbind(object, "a.b", {"<->": "c.d"});\n```\n\nFunctional Reactive Bindings go farther.  They can gracefully bind long\nproperty paths and the contents of collections.  They can also\nincrementally update the results of chains of queries including maps,\nflattened arrays, sums, and averages.  They can also add and remove\nelements from sets based on the changes to a flag.  FRB makes it easy to\nincrementally ensure consistent state.\n\n```javascript\nbind(company, "payroll", {"<-": "departments.map{employees.sum{salary}}.sum()"});\nbind(document, "body.classList.has(\'dark\')", {"<-": "darkMode", source: viewModel});\n```\n\nFRB is built from a combination of powerful functional and generic\nbuilding blocks, making it reliable, easy to extend, and easy to\nmaintain.\n\n\n## Getting Started\n\n`frb` is a CommonJS package, with JavaScript modules suitable for use\nwith [Node.js][] on the server side or [Mr][] on the client side. \n\n```\n❯ npm install frb\n```\n\n\n\n\n## Tutorial\n\nIn this example, we bind `model.content` to `document.body.innerHTML`.\n\n```javascript\nvar bind = require("frb/bind");\nvar model = {content: "Hello, World!"};\nvar cancelBinding = bind(document, "body.innerHTML", {\n    "<-": "content",\n    "source": model\n});\n```\n\nWhen a source property is bound to a target property, the target gets\nreassigned to the source any time the source changes.\n\n```javascript\nmodel.content = "Farewell.";\nexpect(document.body.innerHTML).toBe("Farewell.");\n```\n\nBindings can be recursively detached from the objects they observe with\nthe returned cancel function.\n\n```javascript\ncancelBinding();\nmodel.content = "Hello again!"; // doesn\'t take\nexpect(document.body.innerHTML).toBe("Farewell.");\n```\n\n### Two-way Bindings\n\nBindings can go one way or in both directions.  Declare one-way\nbindings with the ```<-``` property, and two-way bindings with the\n```<->``` property.\n\nIn this example, the "foo" and "bar" properties of an object will be\ninexorably intertwined.\n\n```javascript\nvar object = {};\nvar cancel = bind(object, "foo", {"<->": "bar"});\n\n// <-\nobject.bar = 10;\nexpect(object.foo).toBe(10);\n\n// ->\nobject.foo = 20;\nexpect(object.bar).toBe(20);\n```\n\n### Right-to-left\n\nNote that even with a two-way binding, the right-to-left binding\nprecedes the left-to-right.  In this example, "foo" and "bar" are bound\ntogether, but both have initial values.\n\n```javascript\nvar object = {foo: 10, bar: 20};\nvar cancel = bind(object, "foo", {"<->": "bar"});\nexpect(object.foo).toBe(20);\nexpect(object.bar).toBe(20);\n```\n\nThe right-to-left assignment of `bar` to `foo` happens first, so the\ninitial value of `foo` gets lost.\n\n### Properties\n\nBindings can follow deeply nested chains, on both the left and the right\nside.\n\nIn this example, we have two object graphs, `foo`, and `bar`, with the\nsame structure and initial values.  This binds `bar.a.b` to `foo.a.b`\nand also the other way around.\n\n```javascript\nvar foo = {a: {b: 10}};\nvar bar = {a: {b: 10}};\nvar cancel = bind(foo, "a.b", {\n    "<->": "a.b",\n    source: bar\n});\n// <-\nbar.a.b = 20;\nexpect(foo.a.b).toBe(20);\n// ->\nfoo.a.b = 30;\nexpect(bar.a.b).toBe(30);\n```\n\n### Structure changes\n\nChanges to the structure of either side of the binding are no matter.\nAll of the orphaned event listeners will automatically be canceled, and\nthe binders and observers will reattach to the new object graph.\n\nContinuing from the previous example, we store and replace the `a`\nobject from one side of the binding.  The old `b` property is now\norphaned, and the old `b` property adopted in its place.\n\n```javascript\nvar a = foo.a;\nexpect(a.b).toBe(30); // from before\n\nfoo.a = {}; // orphan a and replace\nfoo.a.b = 40;\n// ->\nexpect(bar.a.b).toBe(40); // updated\n\nbar.a.b = 50;\n// <-\nexpect(foo.a.b).toBe(50); // new one updated\nexpect(a.b).toBe(30); // from before it was orphaned\n```\n\n### Sum\n\nSome advanced queries are possible with one-way bindings from\ncollections.  FRB updates sums incrementally.  When values are added or\nremoved from the array, the sum of only those items is taken and added\nor removed from the last known sum.\n\n```javascript\nvar object = {array: [1, 2, 3]};\nbind(object, "sum", {"<-": "array.sum()"});\nexpect(object.sum).toEqual(6);\n```\n\n### Average\n\nThe arithmetic mean of a collection can be updated incrementally.  Each\ntime the array changes, the added and removed items adjust the last\nknown sum and count of values in the array.\n\n```javascript\nvar object = {array: [1, 2, 3]};\nbind(object, "average", {"<-": "array.average()"});\nexpect(object.average).toEqual(2);\n```\n\n### Map\n\nYou can also create mappings from one array to a new array and an\nexpression to evaluate on each item.  The mapped array is bound once,\nand all changes to the source array are incrementally updated in the\ntarget array.  Unaffected items in the array are not affected.\n\n```javascript\nvar object = {objects: [\n    {number: 10},\n    {number: 20},\n    {number: 30}\n]};\nbind(object, "numbers", {"<-": "objects.map{number}"});\nexpect(object.numbers).toEqual([10, 20, 30]);\nobject.objects.push({number: 40});\nexpect(object.numbers).toEqual([10, 20, 30, 40]);\n```\n\nAny function, like `sum` or `average`, can be applied to the result of a\nmapping.  The straight-forward path would be\n`objects.map{number}.sum()`, but you can use a block with any function\nas a short hand, `objects.sum{number}`.\n\n### Filter\n\nA filter block generates an incrementally updated array filter.  The\nresulting array will contain only those elements from the source array\nthat pass the test deescribed in the block.  As items of the source\narray are added, removed, or changed such that they go from passing to\nfailing or failing to passing, the filtered array gets incrementally\nupdated to include or exclude those items in their proper positions, as\nif the whole array were regenerated with `array.filter` by brute force.\n\n```javascript\nvar object = {numbers: [1, 2, 3, 4, 5, 6]};\nbind(object, "evens", {"<-": "numbers.filter{!(%2)}"});\nexpect(object.evens).toEqual([2, 4, 6]);\nobject.numbers.push(7, 8);\nobject.numbers.shift();\nobject.numbers.shift();\nexpect(object.evens).toEqual([4, 6, 8]);\n```\n\n### Some and Every\n\nA `some` block incrementally tracks whether some of the values in a\ncollection meet a criterion.\n\n```javascript\nvar object = Bindings.defineBindings({\n    options: [\n        {checked: true},\n        {checked: false},\n        {checked: false}\n    ]\n}, {\n    anyChecked: {\n        "<-": "options.some{checked}"\n    }\n});\nexpect(object.anyChecked).toBe(true);\n```\n\nAn `every` block incrementally tracks whether all of the values in a\ncollection meet a criterion.\n\n```javascript\nvar object = Bindings.defineBindings({\n    options: [\n        {checked: true},\n        {checked: false},\n        {checked: false}\n    ]\n}, {\n    allChecked: {\n        "<-": "options.every{checked}"\n    }\n});\nexpect(object.allChecked).toBe(false);\n```\n\nYou can use a two-way binding on `some` and `every` blocks.\n\n```javascript\nvar object = Bindings.defineBindings({\n    options: [\n        {checked: true},\n        {checked: false},\n        {checked: false}\n    ]\n}, {\n    allChecked: {\n        "<->": "options.every{checked}"\n    },\n    noneChecked: {\n        "<->": "!options.some{checked}"\n    }\n});\n\nobject.noneChecked = true;\nexpect(object.options.every(function (option) {\n    return !option.checked\n}));\n\nobject.allChecked = true;\nexpect(object.noneChecked).toBe(false);\n```\n\nThe caveat of an `equals` binding applies.  If the condition for every\nelement of the collection is set to true, the condition will be bound\nincrementally to true on each element.  When the condition is set to\nfalse, the binding will simply be canceled.\n\n```javascript\nobject.allChecked = false;\nexpect(object.options.every(function (option) {\n    return option.checked; // still checked\n}));\n```\n\n### Sorted\n\nA sorted block generates an incrementally updated sorted array.  The\nresulting array will contain all of the values from the source except in\nsorted order.\n\n```javascript\nvar object = {numbers: [5, 2, 7, 3, 8, 1, 6, 4]};\nbind(object, "sorted", {"<-": "numbers.sorted{}"});\nexpect(object.sorted).toEqual([1, 2, 3, 4, 5, 6, 7, 8]);\n```\n\nThe block may specify a property or expression by which to compare\nvalues.\n\n```javascript\nvar object = {arrays: [[1, 2, 3], [1, 2], [], [1, 2, 3, 4], [1]]};\nbind(object, "sorted", {"<-": "arrays.sorted{-length}"});\nexpect(object.sorted.map(function (array) {\n    return array.slice(); // to clone\n})).toEqual([\n    [1, 2, 3, 4],\n    [1, 2, 3],\n    [1, 2],\n    [1],\n    []\n]);\n```\n\nThe sorted binding responds to changes to the sorted property by\nremoving them at their former place and adding them back at their new\nposition.\n\n```javascript\nobject.arrays[0].push(4, 5);\nexpect(object.sorted.map(function (array) {\n    return array.slice(); // to clone\n})).toEqual([\n    [1, 2, 3, 4, 5], // new\n    [1, 2, 3, 4],\n    // old\n    [1, 2],\n    [1],\n    []\n]);\n```\n\n### Min and Max\n\nA binding can observe the minimum or maximum of a collection.  FRB uses\na binary heap internally to incrementally track the minimum or maximum\nvalue of the collection.\n\n```javascript\nvar object = Bindings.defineBindings({}, {\n    min: {"<-": "values.min{}"},\n    max: {"<-": "values.max{}"}\n});\n\nexpect(object.min).toBe(undefined);\nexpect(object.max).toBe(undefined);\n\nobject.values = [2, 3, 2, 1, 2];\nexpect(object.min).toBe(1);\nexpect(object.max).toBe(3);\n```\n\nMin and max blocks accept an expression on which to compare values from\nthe collection.\n\n```javascript\nvar object = Bindings.defineBindings({}, {\n    loser: {"<-": "rounds.min{score}.player"},\n    winner: {"<-": "rounds.max{score}.player"}\n});\n\nobject.rounds = [\n    {score: 0, player: "Luke"},\n    {score: 100, player: "Obi Wan"},\n    {score: 250, player: "Vader"}\n];\nexpect(object.loser).toEqual("Luke");\nexpect(object.winner).toEqual("Vader");\n\nobject.rounds[1].score = 300;\nexpect(object.winner).toEqual("Obi Wan");\n```\n\n### Group\n\nFRB can incrementally track equivalence classes within in a collection.\nThe group block accepts an expression that determines the equivalence\nclass for each object in a collection.  The result is a nested data\nstructure: an array of [key, class] pairs, where each class is itself an\narray of all members of the collection that have the corresponding key.\n\n```javascript\nvar store = Bindings.defineBindings({}, {\n    "clothingByColor": {"<-": "clothing.group{color}"}\n});\nstore.clothing = [\n    {type: \'shirt\', color: \'blue\'},\n    {type: \'pants\', color: \'red\'},\n    {type: \'blazer\', color: \'blue\'},\n    {type: \'hat\', color: \'red\'}\n];\nexpect(store.clothingByColor).toEqual([\n    [\'blue\', [\n        {type: \'shirt\', color: \'blue\'},\n        {type: \'blazer\', color: \'blue\'}\n    ]],\n    [\'red\', [\n        {type: \'pants\', color: \'red\'},\n        {type: \'hat\', color: \'red\'}\n    ]]\n]);\n```\n\nTracking the positions of every key and every value in its equivalence\nclass can be expensive.  Internally, `group` blocks are implemented with\na `groupMap` block followed by an `items()` observer.  The `groupMap`\nproduces a `Map` data structure and does not waste any time, but does\nnot produce range change events.  The `items()` observer projects the\nmap of classes into the nested array data structure.\n\nYou can use the `groupMap` block directly.\n\n```javascript\nBindings.cancelBinding(store, "clothingByColor");\nBindings.defineBindings(store, {\n    "clothingByColor": {"<-": "clothing.groupMap{color}"}\n});\nvar blueClothes = store.clothingByColor.get(\'blue\');\nexpect(blueClothes).toEqual([\n    {type: \'shirt\', color: \'blue\'},\n    {type: \'blazer\', color: \'blue\'}\n]);\n\nstore.clothing.push({type: \'gloves\', color: \'blue\'});\nexpect(blueClothes).toEqual([\n    {type: \'shirt\', color: \'blue\'},\n    {type: \'blazer\', color: \'blue\'},\n    {type: \'gloves\', color: \'blue\'}\n]);\n```\n\nThe `group` and `groupMap` blocks both respect the type of the source\ncollection.  If instead of an array you were to use a `SortedSet`, the\nequivalence classes would each be sorted sets.  This is useful because\nreplacing values in a sorted set can be performed with much less waste\nthan with a large array.\n\n### View\n\nSuppose that your source is a large data store, like a `SortedSet` from\nthe [Collections][] package.  You might need to view a sliding window\nfrom that collection as an array.  The `view` binding reacts to changes\nto the collection and the position and length of the window.\n\n```javascript\nvar SortedSet = require("collections/sorted-set");\nvar controller = {\n    index: SortedSet([1, 2, 3, 4, 5, 6, 7, 8]),\n    start: 2,\n    length: 4\n};\nvar cancel = bind(controller, "view", {\n    "<-": "index.view(start, length)"\n});\n\nexpect(controller.view).toEqual([3, 4, 5, 6]);\n\n// change the window length\ncontroller.length = 3;\nexpect(controller.view).toEqual([3, 4, 5]);\n\n// change the window position\ncontroller.start = 5;\nexpect(controller.view).toEqual([6, 7, 8]);\n\n// add content behind the window\ncontroller.index.add(0);\nexpect(controller.view).toEqual([5, 6, 7]);\n```\n\n### Enumerate\n\nAn enumeration observer produces `[index, value]` pairs.  You can bind\nto the index or the item in subsequent stages.  The prefix dot\ndistinguishes the zeroeth property from the literal zero.\n\n```javascript\nvar object = {letters: [\'a\', \'b\', \'c\', \'d\']};\nbind(object, "lettersAtEvenIndicies", {\n    "<-": "letters.enumerate().filter{!(.0 % 2)}.map{.1}"\n});\nexpect(object.lettersAtEvenIndicies).toEqual([\'a\', \'c\']);\nobject.letters.shift();\nexpect(object.lettersAtEvenIndicies).toEqual([\'b\', \'d\']);\n```\n\n### Range\n\nA range observes a given length and produces and incrementally updates\nan array of consecutive integers starting with zero with that given\nlength.\n\n```javascript\nvar object = Bindings.defineBinding({}, "stack", {\n    "<-": "&range(length)"\n});\nexpect(object.stack).toEqual([]);\n\nobject.length = 3;\nexpect(object.stack).toEqual([0, 1, 2]);\n\nobject.length = 1;\nexpect(object.stack).toEqual([0]);\n```\n\n### Flatten\n\nYou can flatten nested arrays.  In this example, we have an array of\narrays and bind it to a flat array.\n\n```javascript\nvar arrays = [[1, 2, 3], [4, 5, 6]];\nvar object = {};\nbind(object, "flat", {\n    "<-": "flatten()",\n    source: arrays\n});\nexpect(object.flat).toEqual([1, 2, 3, 4, 5, 6]);\n```\n\nNote that changes to the inner and outer arrays are both projected into\nthe flattened array.\n\n```javascript\narrays.push([7, 8, 9]);\narrays[0].unshift(0);\nexpect(object.flat).toEqual([0, 1, 2, 3, 4, 5, 6, 7, 8, 9]);\n```\n\nAlso, as with all other bindings that produce arrays, the flattened\narray is never replaced, just incrementally updated.\n\n```javascript\nvar flat = object.flat;\narrays.splice(0, arrays.length);\nexpect(object.flat).toBe(flat); // === same object\n```\n\n### Reversed\n\nYou can bind the reversal of an array.\n\n```javascript\nvar object = {forward: [1, 2, 3]};\nbind(object, "backward", {\n    "<->": "forward.reversed()"\n});\nexpect(object.backward.slice()).toEqual([3, 2, 1]);\nobject.forward.push(4);\nexpect(object.forward.slice()).toEqual([1, 2, 3, 4]);\nexpect(object.backward.slice()).toEqual([4, 3, 2, 1]);\n```\n\nNote that you can do two-way bindings, ```<->``` with reversed arrays.\nChanges to either side are updated to the opposite side.\n\n```javascript\nobject.backward.pop();\nexpect(object.backward.slice()).toEqual([4, 3, 2]);\nexpect(object.forward.slice()).toEqual([2, 3, 4]);\n```\n\n### Has\n\nYou can bind a property to always reflect whether a collection contains\na particular value.\n\n```javascript\nvar object = {\n    haystack: [1, 2, 3],\n    needle: 3\n};\nbind(object, "hasNeedle", {"<-": "haystack.has(needle)"});\nexpect(object.hasNeedle).toBe(true);\nobject.haystack.pop(); // 3 comes off\nexpect(object.hasNeedle).toBe(false);\n```\n\nThe binding also reacts to changes to the value you seek.\n\n```javascript\n// Continued from above...\nobject.needle = 2;\nexpect(object.hasNeedle).toBe(true);\n```\n\n`has` bindings are not incremental, but with the right data-structure,\nupdates are cheap.  The [Collections][] package contains Lists, Sets,\nand OrderedSets that all can send content change notifications and thus\ncan be bound.\n\n```javascript\n// Continued from above...\nvar Set = require("collections/set");\nobject.haystack = new Set([1, 2, 3]);\nexpect(object.hasNeedle).toBe(true);\n```\n\n`has` bindings can also be left-to-right and bi-directional.\n\n```javascript\nbind(object, "hasNeedle", {"<->": "haystack.has(needle)"});\nobject.hasNeedle = false;\nexpect(object.haystack.has(2)).toBe(false);\n```\n\nThe collection on the left-hand-side must implement `has` or `contains`,\n`add`, and `delete` or `remove`.  FRB shims `Array` to have `has`,\n`add`, and `delete`, just like all the collections in [Collections][].\nIt happens that the `classList` properties of DOM elements, when they\nare supported, implement `add`, `remove`, and `contains`.\n\n```javascript\nvar model = {darkMode: false};\nbind(document.body, "classList.has(\'dark\')", {\n    "<-": "darkMode",\n    source: model\n});\n```\n\nThe DOM `classList` does not however implement\n`addContentChangeListener` or `removeContentChangeListener`, so it\ncannot be used on the right-hand-side of a binding, and such bindings\ncannot be bidirectional.  With some DOM [Mutation Observers][], you\nmight be able to help FRB overcome this limitation in the future.\n\n### Get\n\nA binding can observe changes in key-to-value mappings in arrays and map\n[Collections][].\n\n```javascript\nvar object = {\n    array: [1, 2, 3],\n    second: null\n};\nvar cancel = bind(object, "second", {\n    "<->": "array.get(1)"\n});\nexpect(object.array.slice()).toEqual([1, 2, 3]);\nexpect(object.second).toBe(2);\n\nobject.array.shift();\nexpect(object.array.slice()).toEqual([2, 3]);\nexpect(object.second).toBe(3);\n\nobject.second = 4;\nexpect(object.array.slice()).toEqual([2, 4]);\n\ncancel();\nobject.array.shift();\nexpect(object.second).toBe(4); // still\n```\n\nThe source collection can be a Map, Dict, MultiMap, SortedMap,\nSortedArrayMap, or anything that implements `get` and\n`addMapChangeListener` as specified in [Collections][].  The key can\nalso be a variable.\n\n```javascript\nvar Map = require("collections/map");\nvar a = {id: 0}, b = {id: 1};\nvar object = {\n    source: Map([[a, 10], [b, 20]]),\n    key: null,\n    selected: null\n};\n\nvar cancel = bind(object, "selected", {\n    "<-": "source.get(key)"\n});\nexpect(object.selected).toBe(undefined);\n\nobject.key = a;\nexpect(object.selected).toBe(10);\n\nobject.key = b;\nexpect(object.selected).toBe(20);\n\nobject.source.set(b, 30);\nexpect(object.selected).toBe(30);\n\nvar SortedMap = require("collections/sorted-map");\nobject.source = SortedMap();\nexpect(object.selected).toBe(undefined);\n\nobject.source.set(b, 40);\nexpect(object.selected).toBe(40);\n\ncancel();\nobject.key = a; // no effect\nexpect(object.selected).toBe(40);\n```\n\nYou can also bind the entire content of a map-like collection to the\ncontent of another.  Bear in mind that the content of the source\nreplaces the content of the target initially.\n\n```javascript\nvar Map = require("collections/map");\nvar object = {\n    a: Map({a: 10}),\n    b: Map()\n};\nvar cancel = bind(object, "a.mapContent()", {"<->": "b.mapContent()"});\nexpect(object.a.toObject()).toEqual({});\nexpect(object.b.toObject()).toEqual({});\n\nobject.a.set(\'a\', 10);\nexpect(object.a.toObject()).toEqual({a: 10});\nexpect(object.b.toObject()).toEqual({a: 10});\n\nobject.b.set(\'b\', 20);\nexpect(object.a.toObject()).toEqual({a: 10, b: 20});\nexpect(object.b.toObject()).toEqual({a: 10, b: 20});\n```\n\nIn this case, the source of the binding is a different object than the\ntarget, so the binding descriptor specifies the alternate source.\n\n### Keys, Values, Items\n\nIf the source of a binding is a map, FRB can also translate changes to\nthe map into changes on an array.  The `keys`, `values`, and `items`\nobservers produce incrementally updated projections of the\nkey-value-mappings onto an array.\n\n```javascript\nvar Map = require("collections/map");\nvar object = Bindings.defineBindings({}, {\n    keys: {"<-": "map.keys()"},\n    values: {"<-": "map.values()"},\n    items: {"<-": "map.items()"}\n});\nobject.map = Map({a: 10, b: 20, c: 30});\nexpect(object.keys).toEqual([\'a\', \'b\', \'c\']);\nexpect(object.values).toEqual([10, 20, 30]);\nexpect(object.items).toEqual([[\'a\', 10], [\'b\', 20], [\'c\', 30]]);\n\nobject.map.set(\'d\', 40);\nobject.map.delete(\'a\');\nexpect(object.keys).toEqual([\'b\', \'c\', \'d\']);\nexpect(object.values).toEqual([20, 30, 40]);\nexpect(object.items).toEqual([[\'b\', 20], [\'c\', 30], [\'d\', 40]]);\n```\n\n### Equals\n\nYou can bind to whether expressions are equal.\n\n```javascript\nvar fruit = {apples: 1, oranges: 2};\nbind(fruit, "equal", {"<-": "apples == oranges"});\nexpect(fruit.equal).toBe(false);\nfruit.orange = 1;\nexpect(fruit.equal).toBe(true);\n```\n\nEquality can be bound both directions.  In this example, we do a two-way\nbinding between whether a radio button is checked and a corresponding\nvalue in our model.\n\n```javascript\nvar component = {\n    orangeElement: {checked: false},\n    appleElement: {checked: true}\n};\nBindings.defineBindings(component, {\n    "orangeElement.checked": {"<->": "fruit == \'orange\'"},\n    "appleElement.checked": {"<->": "fruit == \'apple\'"},\n});\n\ncomponent.orangeElement.checked = true;\nexpect(component.fruit).toEqual("orange");\n\ncomponent.appleElement.checked = true;\nexpect(component.fruit).toEqual("apple");\n```\n\nBecause equality and assignment are interchanged in this language, you\ncan use either `=` or `==`.\n\nFRB also supports a comparison operator, `<=>`, which uses\n`Object.compare` to determines how two operands should be sorted in\nrelation to each other.\n\n\n### Array and Map Content\n\nIn JavaScript, arrays behave both like objects (in the sense that every\nindex is a property, but also like a map collection of index-to-value\npairs.  The [Collections][] package goes so far as to patch up the\n`Array` prototype so arrays can masquerade as maps, with the caveat that\n`delete(value)` behaves like a Set instead of a Map.\n\nThis duplicity is reflected in FRB.  You can access the values in an\narray using the object property notation or the mapped key notation.\n\n```javascript\nvar object = {\n    array: [1, 2, 3]\n};\nBindings.defineBindings(object, {\n    first: {"<-": "array.0"},\n    second: {"<-": "array.get(1)"}\n});\nexpect(object.first).toBe(1);\nexpect(object.second).toBe(2);\n```\n\nTo distinguish a numeric property of the source from a number literal,\nuse a dot.  To distingish a mapped index from an array literal, use an\nempty expression.\n\n```javascript\nvar array = [1, 2, 3];\nvar object = {};\nBindings.defineBindings(object, {\n    first: {\n        "<-": ".0",\n        source: array\n    },\n    second: {\n        "<-": "get(1)",\n        source: array\n    }\n});\nexpect(object.first).toBe(1);\nexpect(object.second).toBe(2);\n```\n\nUnlike property notation, map notation can observe a variable index.\n\n```javascript\nvar object = {\n    array: [1, 2, 3],\n    index: 0\n};\nBindings.defineBinding(object, "last", {\n    "<-": "array.get(array.length - 1)"\n});\nexpect(object.last).toBe(3);\n\nobject.array.pop();\nexpect(object.last).toBe(2);\n```\n\nYou can also bind *all* of the content of an array by range or by\nmapping.  The notation for binding ranged content is `rangeContent()`.\nEvery change to an Array or SortedSet dispatches range changes and any\ncollection that implements `splice` and `swap` can be a target for such\nchanges.\n\n```javascript\nvar SortedSet = require("collections/sorted-set");\nvar object = {\n    set: SortedSet(),\n    array: []\n};\nBindings.defineBindings(object, {\n    "array.rangeContent()": {"<-": "set"}\n});\nobject.set.addEach([5, 2, 6, 1, 4, 3]);\nexpect(object.array).toEqual([1, 2, 3, 4, 5, 6]);\n```\n\nThe notation for binding the content of any mapping collection using map\nchanges is `mapContent()`.  On the target of a binding, this will note\nwhen values are added or removed on each key of the source collection\nand apply the same change to the target.  The target and source can be\narrays or map collections.\n\n```javascript\nvar Map = require("collections/map");\nvar object = {\n    map: Map(),\n    array: []\n};\nBindings.defineBinding(object, "map.mapContent()", {\n    "<-": "array"\n});\nobject.array.push(1, 2, 3);\nexpect(object.map.toObject()).toEqual({\n    0: 1,\n    1: 2,\n    2: 3\n});\n```\n\n### Value\n\nA note about the source value: an empty path implies the source value.\nUsing empty paths and empty expressions is useful in some situations.\n\nIf a value is ommitted on either side of an operator, it implies the\nsource value.  The expression `sorted{}` indicates a sorted array, where\neach value is sorted by its own numeric value.  The expression\n`filter{!!}` would filter falsy values.  The operand is implied.\nSimilarly, `filter{!(%2)}` produces only even values.\n\nThis is why you can use `.0` to get the zeroth property of an array, to\ndistingiush the form from `0` which would be a numeric literal, and why\nyou can use `()[0]` to map the zeroeth key of a map or array, to\ndistinguish the form from `[0]` which would be an array literal.\n\n### With Context Value\n\nExpressions can be evaluated in the context of another value using a\nvariant of property notation.  A parenthesized expression can follow a\npath.\n\n```javascript\nvar object = {\n    context: {a: 10, b: 20}\n};\nBindings.defineBinding(object, "sum", {\n    "<-": "context.(a + b)"\n});\nexpect(object.sum).toBe(30);\n\nBindings.cancelBinding(object, "sum");\nobject.context.a = 20;\nexpect(object.sum).toBe(30); // unchanged\n```\n\nTo observe a constructed array or object literal, the expression does\nnot need parentheses.\n\n```javascript\nvar object = {\n    context: {a: 10, b: 20}\n};\nBindings.defineBindings(object, {\n    "duple": {"<-": "context.[a, b]"},\n    "pair": {"<-": "context.{key: a, value: b}"}\n});\nexpect(object.duple).toEqual([10, 20]);\nexpect(object.pair).toEqual({key: 10, value: 20});\n\nBindings.cancelBindings(object);\n```\n\n### Operators\n\nFRB can also recognize many operators.  These are in order of precedence\nunary `-` negation, `+` numeric coercion, and `!` logical negation and\nthen binary `**` power, `//` root, `%%` logarithm, `*`, `/`, `%` modulo,\n`%%` remainder, `+`, `-`, ```<```, ```>```, ```<=```, ```>=```, `=` or\n`==`, `!=`, `&&` and `||`.\n\n```javascript\nvar object = {height: 10};\nbind(object, "heightPx", {"<-": "height + \'px\'"});\nexpect(object.heightPx).toEqual("10px");\n```\n\nThe unary `+` operator coerces a value to a number. It is handy for\nbinding a string to a number.\n\n```javascript\nvar object = {\n    number: null,\n    string: null,\n};\nBindings.defineBinding(object, "+number", {\n    "<-": "string"\n});\nobject.string = \'10\';\nexpect(object.number).toBe(10);\n```\n\n### Functions\n\nFRB supports some common functions.  `startsWith`, `endsWith`, and\n`contains` all operate on strings.  `join` concatenates an array of\nstrings with a given delimiter (or empty string).  `split` breaks a\nstring between every delimiter (or just between every character).\n\n\n### Conditional\n\nFRB supports the ternary conditional operator, if `?` then `:` else.\n\n```javascript\nvar object = Bindings.defineBindings({\n    condition: null,\n    consequent: 10,\n    alternate: 20\n}, {\n    choice: {"<->": "condition ? consequent : alternate"}\n});\n\nexpect(object.choice).toBe(undefined); // no choice made\n\nobject.condition = true;\nexpect(object.choice).toBe(10);\n\nobject.condition = false;\nexpect(object.choice).toBe(20);\n```\n\nThe ternary operator can bind in both directions.\n\n```javascript\nobject.choice = 30;\nexpect(object.alternate).toBe(30);\n\nobject.condition = true;\nobject.choice = 40;\nexpect(object.consequent).toBe(40);\n```\n\n### Algebra\n\nFRB can automatically invert algebraic operators as long as they operate\nstrictly on numbers and the left-most expressions on both the source and\ntarget are bindable properties.\n\nIn this example, the primary binding is ```notToBe <- !toBe```, and the\ninverse binding is automatically computed ```toBe <- !notToBe```.\n\n```javascript\nvar caesar = {toBe: false};\nbind(caesar, "notToBe", {"<->": "!toBe"});\nexpect(caesar.toBe).toEqual(false);\nexpect(caesar.notToBe).toEqual(true);\n\ncaesar.notToBe = false;\nexpect(caesar.toBe).toEqual(true);\n```\n\nFRB does algebra by rotating the expressions on one side of a binding to\nthe other until only one independent property remains (the left most\nexpression) on the target side of the equation.\n\n```\nconvert: y <- !x\nrevert: x <- !y\n```\n\n```\nconvert: y <- x + a\nrevert: x <- y - a\n```\n\nThe left-most independent variable on the right hand side becomes the\ndependent variable on the inverted binding.  At present, this only works\nfor numbers and when the left-most expression is a bindable property\nbecause it cannot assign a new value to the literal 10.  For example,\nFRB cannot yet implicitly revert ```y <-> 10 + x```.\n\n### Literals\n\nYou may have noticed literals in the previous examples.  String literals\ntake the form of any characters between single quotes.  Any character\ncan be escaped with a back slash.\n\n```javascript\nvar object = {};\nbind(object, "greeting", {"<-": "\'Hello, World!\'"});\nexpect(object.greeting).toBe("Hello, World!");\n```\n\nNumber literals are digits with an optional mantissa.\n\n```javascript\nbind(object, \'four\', {"<-": "2 + 2"});\n```\n\n### Tuples\n\nBindings can produce fixed-length arrays.  These are most useful in\nconjunction with mappings.  Tuples are comma-delimited and\nparantheses-enclosed.\n\n```javascript\nvar object = {array: [[1, 2, 3], [4, 5]]};\nbind(object, "summary", {"<-": "array.map{[length, sum()]}"});\nexpect(object.summary).toEqual([\n    [3, 6],\n    [2, 9]\n]);\n```\n\n### Records\n\nBindings can also produce fixed-shape objects.  The notation is\ncomma-delimited, colon-separated items, enclosed by curly-braces.\n\n```javascript\nvar object = {array: [[1, 2, 3], [4, 5]]};\nbind(object, "summary", {\n    "<-": "array.map{{length: length, sum: sum()}}"\n});\nexpect(object.summary).toEqual([\n    {length: 3, sum: 6},\n    {length: 2, sum: 9}\n]);\n```\n\nThe left hand side of an item in a record is any combination of letters\nor numbers.  The right side is any expression.\n\n### Parameters\n\nBindings can also involve parameters.  The source of parameters is by\ndefault the same as the source.  The source, in turn, defaults to the\nsame as the target object.  It can be specified on the binding\ndescriptor.  Parameters are declared by any expression following a\ndollar sign.\n\n```javascript\nvar object = {a: 10, b: 20, c: 30};\nbind(object, "foo", {\n    "<-": "[$a, $b, $c]"},\n    parameters: object\n});\n```\n\nBindings also react to changes to the parameters.\n\n```javascript\nobject.a = 0;\nobject.b = 1;\nobject.c = 2;\nexpect(object.foo).toEqual([0, 1, 2]);\n```\n\nThe degenerate case of the property language is an empty string.  This\nis a valid property path that observes the value itself.  So, as an\nemergent pattern, a `$` expression by itself corresponds to the whole\nparameters object.\n\n```javascript\nvar object = {};\nbind(object, "ten", {"<-": "$", parameters: 10});\nexpect(object.ten).toEqual(10);\n```\n\n### Elements and Components\n\nFRB provides a `#` notation for reaching into the DOM for an element.\nThis is handy for binding views and models on a controller object.\n\nThe `defineBindings` method accepts an optional final argument,\n`parameters`, which is shared by all bindings (unless shadowed by a more\nspecific parameters object on an individual descriptor).\n\nThe `parameters` can include a `document`.  The `document` may be any\nobject that implements `getElementById`.\n\nAdditionally, the `frb/dom` is an experiment that monkey-patches the DOM\nto make some properties of DOM elements observable, like the `value` or\n`checked` attribute of an `input` or `textarea element`.\n\n```javascript\nvar Bindings = require("frb");\nrequire("frb/dom");\n\nvar controller = Bindings.defineBindings({}, {\n\n    "fahrenheit": {"<->": "celsius * 1.8 + 32"},\n    "celsius": {"<->": "kelvin - 272.15"},\n\n    "#fahrenheit.value": {"<->": "+fahrenheit"},\n    "#celsius.value": {"<->": "+celsius"},\n    "#kelvin.value": {"<->": "+kelvin"}\n\n}, {\n    document: document\n});\n\ncontroller.celsius = 0;\n```\n\nOne caveat of this approach is that it can cause a lot of DOM repaint\nand reflow events.  The [Montage][] framework uses a synchronized draw\ncycle and a component object model to minimize the cost of computing CSS\nproperties on the DOM and performing repaints and reflows, deferring\nsuch operations to individual animation frames.\n\nFor a future release of Montage, FRB provides an alternate notation for\nreaching into the component object model, using its deserializer.  The\n`@` prefix refers to another component by its label.  Instead of\nproviding a `document`, Montage provides a `serialization`, which in\nturn implements `getObjectForLabel`.\n\n```javascript\nvar Bindings = require("frb");\n\nvar controller = Bindings.defineBindings({}, {\n\n    "fahrenheit": {"<->": "celsius * 1.8 + 32"},\n    "celsius": {"<->": "kelvin - 272.15"},\n\n    "@fahrenheit.value": {"<->": "+fahrenheit"},\n    "@celsius.value": {"<->": "+celsius"},\n    "@kelvin.value": {"<->": "+kelvin"}\n\n}, {\n    serializer: serializer\n});\n\ncontroller.celsius = 0;\n```\n\n### Observers\n\nFRB’s bindings use observers and binders internally.  You can create an\nobserver from a property path with the `observe` function exported by\nthe `frb/observe` module.\n\n```javascript\nvar results = [];\nvar object = {foo: {bar: 10}};\nvar cancel = observe(object, "foo.bar", function (value) {\n    results.push(value);\n});\n\nobject.foo.bar = 10;\nexpect(results).toEqual([10]);\n\nobject.foo.bar = 20;\nexpect(results).toEqual([10, 20]);\n```\n\nFor more complex cases, you can specify a descriptor instead of the\ncallback.  For example, to observe a property’s value *before it changes*, you can use the `beforeChange` flag.\n\n```javascript\nvar results = [];\nvar object = {foo: {bar: 10}};\nvar cancel = observe(object, "foo.bar", {\n    change: function (value) {\n        results.push(value);\n    },\n    beforeChange: true\n});\n\nexpect(results).toEqual([10]);\n\nobject.foo.bar = 20;\nexpect(results).toEqual([10, 10]);\n\nobject.foo.bar = 30;\nexpect(results).toEqual([10, 10, 20]);\n```\n\nIf the product of an observer is an array, that array is always updated\nincrementally.  It will only get emitted once.  If you want it to get\nemitted every time its content changes, you can use the `contentChange`\nflag.\n\n```javascript\nvar lastResult;\nvar array = [[1, 2, 3], [4, 5, 6]];\nobserve(array, "map{sum()}", {\n    change: function (sums) {\n        lastResult = sums.slice();\n        // 1. [6, 15]\n        // 2. [6, 15, 0]\n        // 3. [10, 15, 0]\n    },\n    contentChange: true\n});\n\nexpect(lastResult).toEqual([6, 15]);\n\narray.push([0]);\nexpect(lastResult).toEqual([6, 15, 0]);\n\narray[0].push(4);\nexpect(lastResult).toEqual([10, 15, 0]);\n```\n\n### Nested Observers\n\nTo get the same effect as the previous example, you would have to nest\nyour own content change observer.\n\n```javascript\nvar i = 0;\nvar array = [[1, 2, 3], [4, 5, 6]];\nvar cancel = observe(array, "map{sum()}", function (array) {\n    function contentChange() {\n        if (i === 0) {\n            expect(array.slice()).toEqual([6, 15]);\n        } else if (i === 1) {\n            expect(array.slice()).toEqual([6, 15, 0]);\n        } else if (i === 2) {\n            expect(array.slice()).toEqual([10, 15, 0]);\n        }\n        i++;\n    }\n    contentChange();\n    array.addContentChangeListener(contentChange);\n    return function cancelContentChange() {\n        array.removeContentChangeListener(contentChange);\n    };\n});\narray.push([0]);\narray[0].push(4);\ncancel();\n```\n\nThis illustrates one crucial aspect of the architecture.  Observers\nreturn cancelation functions.  You can also return a cancelation\nfunction inside a callback observer.  That canceler will get called each\ntime a new value is observed, or when the parent observer is canceled.\nThis makes it possible to nest observers.\n\n```javascript\nvar object = {foo: {bar: 10}};\nvar cancel = observe(object, "foo", function (foo) {\n    return observe(foo, "bar", function (bar) {\n        expect(bar).toBe(10);\n    });\n});\n```\n\n### Bindings\n\nFRB provides utilities for declaraing and managing multiple bindings on\nobjects.  The `frb` (`frb/bindings`) module exports this interface.\n\n```javascript\nvar Bindings = require("frb");\n```\n\nThe `Bindings` module provides `defineBindings` and `cancelBindings`,\n`defineBinding` and `cancelBinding`, as well as binding inspector\nmethods `getBindings` and `getBinding`.  All of these take a target\nobject as the first argument.\n\nThe `Bindings.defineBinding(target, descriptors)` method returns the\ntarget object for convenience.\n\n```javascript\nvar target = Bindings.defineBindings({}, {\n    "fahrenheit": {"<->": "celsius * 1.8 + 32"},\n    "celsius": {"<->": "kelvin - 272.15"}\n});\ntarget.celsius = 0;\nexpect(target.fahrenheit).toEqual(32);\nexpect(target.kelvin).toEqual(272.15);\n```\n\n`Bindings.getBindings` in that case would return an object with\n`fahrenheit` and `celsius` keys.  The values would be identical to the\ngiven binding descriptor objects, like `{"<->": "kelvin - 272.15"}`, but\nit also gets annotated with a `cancel` function and the default values\nfor any ommitted properties like `source` (same as `target`),\n`parameters` (same as `source`), and others.\n\n`Bindings.cancelBindings` cancels all bindings attached to an object and\nremoves them from the bindings descriptors object.\n\n```javascript\nBindings.cancelBindings(target);\nexpect(Bindings.getBindings(object)).toEqual({});\n```\n\n### Binding Descriptors\n\nBinding descriptors describe the source of a binding and additional\nparameters.  `Bindings.defineBindings` can set up bindings (```<-``` or\n```<->```), computed (```compute```) properties, and falls back to\ndefining ES5 properties with permissive defaults (`enumerable`,\n`writable`, and `configurable` all on by default).\n\nIf a descriptor has a ```<-``` or ```<->```, it is a binding descriptor.\nFRB creates a binding, adds the canceler to the descriptor, and adds the\ndescriptor to an internal table that tracks all of the bindings defined\non that object.\n\n```javascript\nvar object = Bindings.defineBindings({\n    darkMode: false,\n    document: document\n}, {\n    "document.body.classList.has(\'dark\')": {\n        "<-": "darkMode"\n    }\n});\n```\n\nYou can get all the binding descriptors with `Bindings.getBindings`, or a\nsingle binding descriptor with `Bindings.getBinding`.  `Bindings.cancel` cancels\nall the bindings to an object and `Bindings.cancelBinding` will cancel just\none.\n\n```javascript\n// Continued from above...\nvar bindings = Bindings.getBindings(object);\nvar descriptor = Bindings.getBinding(object, "document.body.classList.has(\'dark\')");\nBindings.cancelBinding(object, "document.body.classList.has(\'dark\')");\nBindings.cancelBindings(object);\nexpect(Object.keys(bindings)).toEqual([]);\n```\n\n### Converters\n\nA binding descriptor can have a `convert` function, a `revert` function,\nor alternately a `converter` object.  Converters are useful for\ntransformations that cannot be expressed in the property language, or\nare not reversible in the property language.\n\nIn this example, `a` and `b` are synchronized such that `a` is always\nhalf of `b`, regardless of which property gets updated.\n\n```javascript\nvar object = Bindings.defineBindings({\n    a: 10\n}, {\n    b: {\n        "<->": "a",\n        convert: function (a) {\n            return a * 2;\n        },\n        revert: function (b) {\n            return b / 2;\n        }\n    }\n});\nexpect(object.b).toEqual(20);\n\nobject.b = 10;\nexpect(object.a).toEqual(5);\n```\n\nConverter objects are useful for reusable or modular converter types and\nconverters that track additional state.\n\n```javascript\nvar object = Bindings.defineBindings({\n    a: 10\n}, {\n    b: {\n        "<->": "a",\n        converter: {\n            factor: 2,\n            convert: function (a) {\n                return a * this.factor;\n            },\n            revert: function (b) {\n                return b / this.factor;\n            }\n        }\n    }\n});\nexpect(object.b).toEqual(20);\n\nobject.b = 10;\nexpect(object.a).toEqual(5);\n```\n\n### Computed Properties\n\nA computed property is one that gets updated with a function call when\none of its arguments changes.  Like a converter, it is useful in cases\nwhere a transformation or computation cannot be expressed in the\nproperty language, but can additionally accept multiple arguments as\ninput.  A computed property can be used as the source for another\nbinding.\n\nIn this example, we create an object as the root of multiple bindings.\nThe object synchronizes the properties of a "form" object with the\nwindow’s search string, effectively navigating to a new page whenever\nthe "q" or "charset" entries of the form change.\n\n```javascript\nBindings.defineBindings({\n    window: window,\n    form: {\n        q: "",\n        charset: "utf-8"\n    }\n}, {\n    queryString: {\n        args: ["form.q", "form.charset"],\n        compute: function (q, charset) {\n            return "?" + QS.stringify({\n                q: q,\n                charset: charset\n            });\n        }\n    },\n    "window.location.search": {\n        "<-": "queryString"\n    }\n});\n```\n\n### Debugging with Traces\n\nA binding can be configured to log when it changes and why.  The `trace`\nproperty on a descriptor instructs the binder to log changes to the\nconsole.\n\n```javascript\nBindings.defineBindings({\n    a: 10\n}, {\n    b: {\n        "<-": "a + 1",\n    }\n});\n```\n\n\n## Reference\n\nFunctional Reactive Bindings is an implementation of synchronous,\nincremental object-property and collection-content bindings for\nJavaScript.  It was ripped from the heart of the [Montage][] web\napplication framework and beaten into this new, slightly magical form.\nIt must prove itself worthy before it can return.\n\n-   **functional**: The implementation uses functional building blocks\n    to compose observers and binders.\n-   **generic**: The implementation uses generic methods on collections,\n    like `addContentChangeListener`, so any object can implement the\n    same interface and be used in a binding.\n-   **reactive**: The values of properties and contents of collections\n    react to changes in the objects and collections on which they\n    depend.\n-   **synchronous**: All bindings are made consistent in the statement\n    that causes the change.  The alternative is asynchronous, where\n    changes are queued up and consistency is restored in a later event.\n-   **incremental**: If you update an array, it produces a content\n    change which contains the values you added, removed, and the\n    location of the change.  Most bindings can be updated using only\n    these values.  For example, a sum is updated by decreasing by the\n    sum of the values removed, and increasing by the sum of the values\n    added.  FRB can incrementally update `map`, `reversed`, `flatten`,\n    `sum`, and `average` observers.  It can also incrementally update\n    `has` bindings.\n-   **unwrapped**: Rather than wrap objects and arrays with observable\n    containers, FRB modifies existing arrays and objects to make them\n    dispatch property and content changes.  For objects, this involves\n    installing getters and setters using the ES5 `Object.defineProperty`\n    method.  For arrays, this involves replacing all of the mutation\n    methods, like `push` and `pop`, with variants that dispatch change\n    notifications.  The methods are either replaced by swapping the\n    `__proto__` or adding the methods to the instance with\n    `Object.defineProperties`.  These techniques should [work][Define\n    Property] starting in Internet Explorer 9, Firefox 4, Safari 5,\n    Chrome 7, and Opera 12.\n\n\n### Architecture\n\n-   [Collections][] provides **property, mapped content, and ranged\n    content change events** for objects, arrays, and other collections.\n    For objects, this adds a property descriptor to the observed object.\n    For arrays, this either swaps the prototype or mixes methods into\n    the array so that all methods dispatch change events.  \n    Caveats: you have to use a `set` method on Arrays to dispatch\n    property and content change events.  Does not work in older Internet\n    Explorers since they support neither prototype assignment or ES5\n    property setters.\n-   **observer** functions for watching an entire object graph for\n    incremental changes, and gracefully rearranging and canceling those\n    observers as the graph changes.  Observers can be constructed\n    directly or with a very small query language that compiles to a tree\n    of functions so no parsing occurs while the graph is being watched.\n-   one- and two-way **bindings** using binder and obserer functions to\n    incrementally update objects.\n-   **declarative** interface for creating an object graph with\n    bindings, properties, and computed properties with dependencies.\n\n\n### Bindings\n\nThe highest level interface for FRB resembles the ES5 Object constructor\nand can be used to declare objects and define and cancel bindings on\nthem with extended property descriptors.\n\n```javascript\nvar Bindings = require("frb");\n\n// create an object\nvar object = Bindings.defineBindings({\n    foo: 0,\n    graph: [\n        {numbers: [1,2,3]},\n        {numbers: [4,5,6]}\n    ]\n}, {\n    bar: {"<->": "foo", enumerable: false},\n    numbers: {"<-": "graph.map{numbers}.flatten()"},\n    sum: {"<-": "numbers.sum()"},\n    reversed: {"<-": "numbers.reversed()"}\n});\n\nexpect(object.bar).toEqual(object.foo);\nobject.bar = 10;\nexpect(object.bar).toEqual(object.foo);\nexpect.foo = 20;\nexpect(object.bar).toEqual(object.foo);\n\n// note that the identity of the bound numbers array never\n// changes, because all of the changes to that array are\n// incrementally updated\nvar numbers = object.numbers;\n\n// first computation\nexpect(object.sum).toEqual(21);\n\n// adds an element to graph,\n// which pushes [7, 8, 9] to "graph.map{numbers}",\n// which splices [7, 8, 9] to the end of\n//  "graph.map{numbers}.flatten()",\n// which increments "sum()" by [7, 8, 9].sum()\nobject.graph.push({numbers: [7, 8, 9]});\nexpect(object.sum).toEqual(45);\n\n// splices [1] to the beginning of [1, 2, 3],\n// which splices [1] to the beginning of "...flatten()"\n// which increments "sum()" by [1].sum()\nobject.graph[0].numbers.unshift(1);\nexpect(object.sum).toEqual(46);\n\n// cancels the entire observer hierarchy, then attaches\n//  listeners to the new one.  updates the sum.\nobject.graph = [{numbers: [1,2,3]}];\nexpect(object.sum).toEqual(6);\n\nexpect(object.reversed).toEqual([3, 2, 1]);\n\nexpect(object.numbers).toBe(numbers) // still the same object\n\nBindings.cancelBindings(object); // cancels all bindings on this object and\n// their transitive observers and event listeners as deep as\n// they go\n```\n\n-   `Bindings.defineBindings(object, name, descriptor)`\n-   `Bindings.defineBinding(object, name, descriptor)`\n-   `Bindings.getBindings(object)`\n-   `Bindings.getBinding(object, name)`\n-   `Bindings.cancelBindings(object)`\n-   `Bindings.cancelBinding(object, name)`\n\nA binding descriptor contains:\n\n-   `target`: the\n-   `targetPath`: the target\n-   `targetSyntax`: the syntax tree for the target path\n-   `source`: the source object, which defaults to `target`\n-   `sourcePath`: the source path, from either ```<-``` or ```<->```\n-   `sourceSyntax`: the syntax tree for the source path\n-   `twoWay`: whether the binding goes in both directions, if ```<->```\n    was the source path.\n-   `parameters`: the parameters, which default to `source`.\n-   `convert`: a function that converts the source value to the target\n    value, useful for coercing strings to dates, for example.\n-   `revert`: a function that converts the target value to the source\n    value, useful for two-way bindings.\n-   `converter`: an object with `convert` and optionally also a `revert`\n    method.  The implementation binds these methods to their converter\n    and stores them in `covert` and `revert`.\n-   `serializable`: a note from the Montage Deserializer, to the [Montage\n    Serializer][], indicating that the binding came from a\n    serialization, and to a serialization it must return.\n-   `cancel`: a function to cancel the binding\n\n[Montage Serializer]: https://github.com/montagejs/mousse\n\n### Bind\n\nThe `bind` module provides direct access to the `bind` function.\n\n```javascript\nvar bind = require("frb/bind");\n\nvar source = [{numbers: [1,2,3]}, {numbers: [4,5,6]}];\nvar target = {};\nvar cancel = bind(target, "summary", {\n    "<-": "map{[numbers.sum(), numbers.average()]}",\n    source: source\n});\n\nexpect(target.summary).toEqual([\n    [6, 2],\n    [15, 5]\n]);\n\ncancel();\n```\n\n`bind` is built on top of `parse`, `compileBinder`, and\n`compileObserver`.\n\n### Compute\n\nThe `compute` module provides direct access to the `compute` function,\nused by `Bindings` to make computed properties.\n\n```javascript\nvar compute = require("frb/compute");\n\nvar source = {operands: [10, 20]};\nvar target = {};\nvar cancel = compute(target, "sum", {\n    source: source,\n    args: ["operands.0", "operands.1"],\n    compute: function (a, b) {\n        return a + b;\n    }\n});\n\nexpect(target.sum).toEqual(30);\n\n// change one operand\nsource.operands.set(1, 30); // needed to dispatch change notification\nexpect(target.sum).toEqual(40);\n```\n\n### Observe\n\nThe `observe` modules provides direct access to the `observe` function.\n`observe` is built on top of `parse` and `compileObserver`.\n`compileObserver` creates a tree of observers using the methods in the\n`observers` module.\n\n```javascript\nvar observe = require("frb/observe");\n\nvar source = [1, 2, 3];\nvar sum;\nvar cancel = observe(source, "sum()", function (newSum) {\n    sum = newSum;\n});\n\nexpect(sum).toBe(6);\n\nsource.push(4);\nexpect(sum).toBe(10);\n\nsource.unshift(0); // no change\nexpect(sum).toBe(10);\n\ncancel();\nsource.splice(0, source.length); // would change\nexpect(sum).toBe(10);\n```\n\n`observe` produces a cancelation hierarchy.  Each time a value is\nremoved from an array, the underlying observers are canceled.  Each time\na property is replaced, the underlying observer is canceled.  When new\nvalues are added or replaced, the observer produces a new canceler.  The\ncancel function returned by `observe` commands the entire underlying\ntree.\n\nObservers also optional accept a descriptor argument in place of a\ncallback.\n\n-   `set`: the change handler, receives `value` for most observers, but\n    also `key` and `object` for property changes.\n-   `parameters`: the value for `$` expressions.\n-   `beforeChange`: instructs an observer to emit the previous value\n    before a change occurs.\n-   `contentChange`: instructs an observer to emit an array every time\n    its content changes.  By default, arrays are only emitted once.\n\n```javascript\nvar object = {};\nvar cancel = observe(object, "array", {\n    change: function (value) {\n        // may return a cancel function for a nested observer\n    },\n    parameters: {},\n    beforeChange: false,\n    contentChange: true\n});\n\nobject.array = []; // emits []\nobject.array.push(10); // emits [10]\n```\n\n### Evaluate\n\nThe `compile-evaluator` module returns a function that accepts a syntax\ntree and returns an evaluator function.  The evaluator accepts a scope\n(which may include a value, parent scope, parameters, a document, and\ncomponents) and returns the corresponding value without all the cost or\nbenefit of setting up incremental observers.\n\n```javascript\nvar parse = require("frb/parse");\nvar compile = require("frb/compile-evaluator");\nvar Scope = require("frb/scope");\n\nvar syntax = parse("a.b");\nvar evaluate = compile(syntax);\nvar c = evaluate(new Scope({a: {b: 10}}))\nexpect(c).toBe(10);\n```\n\nThe `evaluate` module returns a function that accepts a path or syntax\ntree, a source value, and parameters and returns the corresponding\nvalue.\n\n```javascript\nvar evaluate = require("frb/evaluate");\nvar c = evaluate("a.b", {a: {b: 10}})\nexpect(c).toBe(10);\n```\n\n\n### Stringify\n\nThe `stringify` module returns a function that accepts a syntax tree and\nreturns the corresponding path in normal form.\n\n```javascript\nvar stringify = require("frb/stringify");\n\nvar syntax = {type: "and", args: [\n    {type: "property", args: [\n        {type: "value"},\n        {type: "literal", value: "a"}\n    ]},\n    {type: "property", args: [\n        {type: "value"},\n        {type: "literal", value: "b"}\n    ]}\n]};\n\nvar path = stringify(syntax);\nexpect(path).toBe("a && b");\n```\n\n\n### Grammar\n\n-   **expression** = **logical-or-expression**\n-   **conditional-expression** = **logical-or-expression** ( `?`\n    **expression** `:` **expression** )?\n-   **logical-or-expression** = **logical-and-expression** ( `||` *(or)*\n    **relation expression** )?\n-   **logical-and-expression** = **relation-expression** ( `&&` *(and)*\n    **relation-expression** )?\n-   **relation-expression** = **arithmetic expression** (\n    **relation-operator** **arithmetic-expression** )?\n    -   **relation-operator** = `==` *(equals)* or ```<``` *(lt)* or\n        ```<=``` *(le)* or ```>``` *(gt)* or ```>=``` *(ge)* or\n        ```<=>``` *(compare)*\n-   **arithmetic-expression** = **multiplicative-expresion** delimited by **arithmetic-operator**\n    -   **arithmetic-operator** = `+` *(add)* or `-` *(sub)*\n-   **multiplicative-expression** = **exponential-expression**\n    delimited by **multiplicative-operator**\n    -   **multiplicative-operator** = `*` *(mul)* or `/` *(div)* or\n        `%` *(mod)* or `rem` *(rem)*\n-   **exponential-expression** = **unary-expression** delimited by\n    **exponential-operator**\n    -   **exponential-operator** = `**` *(pow)* or `//` *(root)* or\n        `%%` *(log)*\n-   **unary-expression** = **unary-operator** ? **path-expression**\n    -   **unary-operator** = `+` *(number)* or `-` *(neg)* or `!` *(not)*\n-   **path-expression** =\n    -   **literal** *(literal with value)* or\n    -   **array-expression** *(tuple)* or\n    -   **object-expression** *(record)* or\n    -   `(` **expression** `)` **tail-expression** or\n    -   **property-name** **tail-expression** *(property)* or\n    -   **function-call** *(piped)* **tail-expression** or\n    -   **block-call** **tail-expression** or\n    -   `#` **element-id** **tail-expression** *(element by id)* or\n    -   `@` **component-label** **tail-expression** *(component by label)*\n    -   `&` **function-call** *(bare)* **tail-expression** or\n-   **tail-expression** =\n    -   **property-expression** or\n    -   **with-expression** or\n    -   **variable-property-expression**\n-   **property-expression** = `.` **property-name** **tail-expression**\n    *(property)*\n-   **with-expression** = `.`\n    -   `(` **expression** `)` **tail-expression** or\n    -   **array-expression** **tail-expression** or\n    -   **object-expression** **tail-expression**\n-   **variable-property-expression** = `[` **expression** `]`\n    **tail-expression** *(property)*\n-   **array-expression** = `[` ( **expression** or `()` *(value)* )\n    delimited by `,` `]` *(tuple with each expression in args array)*\n-   **object-expression** = `{` (**property-name** `:` **expression**)\n    delimited by `,` `}` *(record, with each expression as a value in an\n    args object instead of array)*\n-   **property-name** = ( **non-space-character** )+\n-   **function-call** = **function-name** `(` **expression** delimited\n    by `,` `)`\n    -   **function-name** = `flatten` or `reversed` or `enumerate` or\n        `sum` or `average` or `has` or `view` or `startsWith` or\n        `endsWith` or `contains` or `join` or `split` or `range` or\n        `keys` or `values` or `items` *(eponymous syntax node types)*\n-   **block-call** = **function-name** `{` **expression** `}`\n    -   **block-name** = `map` *(mapBlock)* or `filter` *(filterBlock)*\n        or `some` *(someBlock)* or `every` *(everyBlock)* or `sorted`\n        *(sortedBlock)* or `min` *(minBlock)* or `max` *(maxBlock)* or\n        `group` *(groupBlock)* or `groupMap` *(groupMapBlock)* or\n        **function-name** *(map followed by function-call)*\n-   **literal** = **string-literal** or **number-literal**\n    -   **number-literal** = **digits** ( `.` **digits** )? *(literal\n        and value is a number)*\n    -   **string-literal** = `\'` ( **non-quote-character** or `\\`\n        **character** ) `\'` *(literal and value is a string)*\n\nLegend:\n\n-   **terms-of-the-grammar**\n-   `tokens`\n-   *(corresponding syntax node type name)*\n-   (group)\n-   definition =\n-   or\n-   delimited by\n-   optional?\n-   any*\n-   some+\n\n### Semantics\n\nAn expression is observed with a source value and emits a target\none or more times.  All expressions emit an initial value.  Array\ntargets are always updated incrementally.  Numbers and boolean are\nemited anew each time their value changes.\n\nIf any operand is `null` or `undefine`, a binding will not emit an\nupdate.  Thus, if a binding’s source becomes invalid, it does not\ncorrupt its target but waits until a valid replacement becomes\navailable.\n\n-   Literals are interpreted as their corresponding value.\n-   Value terms provide the source.\n-   Parameters terms provide the parameters.\n-   In a path-expression, the first term is evaluated with the source\n    value.\n-   Each subsequent term of a path expression uses the target of the\n    previous as its source.\n-   A property-expression or variable-property-expression observes the\n    key of the source object using `Object.addPropertyChangeListener`.\n-   An element identifier (with the `#` prefix) uses the `document`\n    property of the `parameters` object and emits\n    `document.getElementById(id)`, or dies trying.  Changes to the\n    document are not observed.\n-   A component label (with the `@` prefix) uses the `serialization`\n    property of `parameters` object and emits\n    `serialization.getObjectForLable(label)`, or dies trying.  Changes\n    to the serialization are not observed.  This syntax exists to\n    support [Montage][] serializations.\n-   A "map" block observes the source array and emits a target array.\n    The target array is emitted once and all subsequent updates are\n    reflected as content changes that can be independently observed with\n    `addContentChangeListener`.  Each element of the target array\n    corresponds to the observed value of the block expression using the\n    respective element in the source array as the source value.\n-   A "map" function call receives a function as its argument rather\n    than a block.\n-   A "filter" block observes the source array and emits a target array\n    containing only those values from the source array that actively\n    pass the predicate described in the block expression useing the\n    respective element in the source array as the source value.  As with\n    "map", filters update the target array incrementally.\n-   A "some" block observes whether any of the values in the source\n    collection meet the given criterion.\n-   A "every" block observes whether all of the values in the source\n    collection meet the given criterion.\n-   A "sorted" block observes the sorted version of an array, by a\n    property of each value described in the block, or itself if empty.\n    Sorted arrays are incrementally updating as values are added and\n    deleted from the source.\n-   A "min" block observes the which of the values in a given collection\n    produces the smallest value through the given relation.\n-   A "max" block observes the which of the values in a given collection\n    produces the largest value through the given relation.\n-   A "group" block observes which values belong to corresponding\n    equivalence classes as determined by the result of a given\n    expression on each value.  The observer is responsible for adding\n    and removing classes as they are populated and depopulated.  Each\n    class tracks the key (result of the block expression for every\n    member of a class), and an the values of the corresponding class as\n    an array.  Values are added to the end of each array as they are\n    discovered.\n-   Any function call with a "block" implies calling the function on the\n    result of a "map" block.\n-   A "flatten" function call observes a source array and produces a\n    target array.  The source array must only contain inner arrays.  The\n    target array is emitted once and all subsequent updates can be\n    independently observed with `addContentChangeListener`.  The target\n    array will always contain the concatenation of all of the source\n    arrays.  Changes to the inner and outer source arrays are reflected\n    with incremental splices to the target array in their corresponding\n    positions.\n-   A "reversed" function call observes the source array and produces a\n    target array that contains the elements of the source array in\n    reverse order.  The target is incrementally updated.\n-   An "enumerate" expression observes [key, value] pairs from an array.\n    The output array of arrays is incrementally updated with range\n    changes from the source.\n-   A "view" function call observes a sliding window from the source,\n    from a start index (first argument) of a certain length (second\n    argument).  The source can be any collection that dispatches range\n    changes and the output will be an array of the given length.\n-   A "sum" function call observes the numeric sum of the source array.\n    Each alteration to the source array causes a new sum to be emitted,\n    but the sum is computed incrementally by observing the smaller sums\n    of the spliced values, added and removed.\n-   An "average" function call observes the average of the input values,\n    much like "sum".\n-   A "has" function call observes the source collection for whether it\n    contains an observed value.\n-   A "tuple" expression observes a source value and emits a single\n    target array with elements corresponding to the respective\n    expression in the tuple.  Each inner expression is evaluated with\n    the same source value as the outer expression.\n-   A "startsWith" function call observes whether the left string\n    starts with the right string.\n-   An "endsWith" function call observes whether the right string\n    ends with the right string.\n-   A "contains" function call observes whether the left string contains\n    the right string.\n-   A "join" function observes the left array joined by the right\n    delimiter, or an empty string.   This is not an incremental\n    operation.\n-   A "split" function observes the left string broken into an array\n    between the right delimiter, or an empty string.  This is not an\n    incremental operation.\n-   A "range" function call observes an array with the given length\n    containing sequential numbers starting with zero.  The output array\n    is updated incrementally and will dispatch one range change each\n    time the size changes by any difference.\n-   A "keys" function call observes an incrementally updated array of\n    the keys that a given map contains.  The keys are maintained in\n    insertion order.\n-   A "values" function call observes an incrementally updated array of\n    the values that a given map contains.  The values are maintained in\n    insertion order.\n-   An "items" function call observes an incrementally updated array of\n    [key, value] pairs from a given mapping.  The items are retained in\n    insertion order.\n\nUnary operators:\n\n-   "number" coerces the value to a number.\n-   "neg" converts a number to its negative.\n-   "not" converts a boolean to its logical opposite.\n\nBinary operators:\n\n-   "add" adds the left to the right\n-   "sub" subtracts the right from the left\n-   "mul" multiples the left to the right\n-   "div" divides the left by the right\n-   "mod" produces the left modula the right.  This is proper modula,\n    meaning a negative number that does not divide evenly into a\n    positive number will produce the difference between that number and\n    the next evenly divisible number in direction of negative infinity.\n-   "rem" produces the remainder of dividing the left by the right.  If\n    the left does not divide evenly into the right it will produce the\n    difference between that number and the next evenly divisible number\n    in the direction of zero.  That is to say, `rem` can produce\n    negative numbers.\n-   "pow" raises the left to the power of the right.\n-   "root" produces the "righth" root of the left.\n-   "log" produces the logarithm of the left on the right base.\n-   "lt" less than, as determined with `Object.compare(left, right) <\n    0`.\n-   "le" less than or equal, as determined with `Object.compare(left,\n    right) <= 0`.\n-   "gt" greater than, as determined with `Object.compare(left, right) >\n    0`.\n-   "ge" greater than or equal, as determined with `Object.compare(left,\n    right) >= 0`.\n-   "compare" as determined by `Object.compare(left, right)`.\n-   "equals" whether the left is equal to the right as determined by\n    `Object.equals(left, right)`.\n-   *Note: there is no "not equals" syntax node. The `!=` operator gets\n    converted into a "not" node around an "equals" node.\n-   "and" logical union\n-   "or" logical intersection\n\nTernary operator:\n\n-   "if" observes the condition (first argument, expression before the\n    `?`).  If the expression is true, the result observes the consequent\n    expression (second argument, between the question mark and the\n    colon), and if it is false, the result observes the alternate (the\n    third argument, after the colon).  If the condition is null or\n    undefined, the result is null or undefined.\n\nOn the left hand side of a binding, the last term has alternate\nsemantics.  Binders receive a target as well as a source.\n\n-   A "property" observes an object and a property name from the target,\n    and a value from the source.  When any of these change, the binder\n    upates the value for the property name of the object.\n-   A "get" observes a collection and a key from the target, and a value\n    from the source.  When any of these change, the binder updates the\n    value for the key on the collection using `collection.set(key,\n    value)`.  This is suitable for arrays and custom map\n    [Collections][].\n-   A "equals" expression observes a boolean value from the source.  If\n    that boolean becomes true, the equality expression is made true by\n    assigning the right expression to the left property of the equality,\n    turning the "equals" into an "assign" conceptually.  No action is\n    taken if the boolean becomes false.\n-   A "reversed" expression observes an indexed collection and maintains\n    a mirror array of that collection.\n-   A "has" function call observes a boolean value from the source, and\n    an collection and a sought value from the target.  When the value is\n    true and the value is absent in the collection, the binder uses the\n    `add` method of the collection (provided by a shim for arrays) to\n    make it true that the collection contains the sought value.  When\n    the value is false and the value does appear in the collection one\n    or more times, the binder uses the `delete` or `remove` method of\n    the collection to remove all occurrences of the sought value.\n-   An "if" binding observes the condition and binds the target either\n    to the consequent or alternate.  If the condition is null or\n    undefined, the target is not bound.\n\nIf the target expression ends with `.*`, the content of the target is\nbound instead of the property.  This is useful for binding the content\nof a non-array collection to the content of another indexed collection.\nThe collection can be any collection that implements the "observable\ncontent" interface including `dispatchContentChange(plus, minus,\nindex)`, `addContentChangeListener`, and `removeContentChangeListener`.\n\n### Language Interface\n\n```javascript\nvar parse = require("frb/parse");\nvar compileObserver = require("frb/compile-observer");\nvar compileBinder = require("frb/compile-binder");\n```\n\n-   `parse(text)` returns a syntax tree.\n-   `compileObserver(syntax)` returns an observer function of the form\n    `observe(callback, source, parameters)` which in turn returns a\n    `cancel()` function.  `compileObserver` visits the syntax tree and\n    creates functions for each node, using the `observers` module.\n-   `compileBinder(syntax)` returns a binder function of the form\n    `bind(observeValue, source, target, parameters)` which in turn\n    returns a `cancel()` function.  `compileBinder` visits the root node\n    of the syntax tree and delegates to `compileObserver` for its terms.\n    The root node must be a `property` at this time, but could\n    conceivably be any function with a clear inverse operation like\n    `map` and `reversed`.\n\n### Syntax Tree\n\nThe syntax tree is JSON serializable and has a "type" property.  Nodes\nhave the following types:\n\n-   `value` corresponds to observing the source value\n-   `parameters` corresponds to observing the parameters object\n-   `literal` has a `value` property and observes that value\n-   `element` has an `id` property and observes an element from the\n    `parameters.document`, by way of `getElementById`.\n-   `component` has a `label` property and observes a component from the\n    `parameters.serialization`, by way of `getObjectForLabel`.  This\n    feature support\'s [Montage][]’s serialization format.\n\nAll other node types have an "args" property that is an array of syntax\nnodes (or an "args" object for `record`).\n\n-   `property`: corresponds to observing a property named by the right\n    argument of the left argument.\n-   `get`: corresponds to observing the value for a key (second\n    argument) in a collection (first argument).\n-   `with`: corresponds to observing the right expression using the left\n    expression as the source.\n-   `has`: corresponds to whether the key (second argument) exists\n    within a collection (first argument)\n-   `mapBlock`: the left is the input, the right is an expression to\n    observe on each element of the input.\n-   `filterBlock`: the left is the input, the right is an expression to\n    determine whether the result is included in the output.\n-   `someBlock`: the left is the input, the right is a criterion.\n-   `everyBlock`: the left is the input, the right is a criterion.\n-   `sortedBlock`: the left is the input, the right is a relation on\n    each value of the input on which to compare to determine the order.\n-   `minBlock`: the left is the input, the right is a relation on each\n    value of the input by which to compare the value to others.\n-   `maxBlock`: the left is the input, the right is a relation on each\n    value of the input by which to compare the value to others.\n-   `groupBlock`: the left is the input, the right is an expression that\n    provides the key for an equivalence class for each value in the\n    input.  The output is an array of items, `[key, class]`, with the\n    shared key of every value in the equivalence class.\n-   `groupMapBlock`: has the same input semantics as `groupBlock`, but\n    the output is a `Map` instance instead of an array of items.\n-   `tuple`: has any number of arguments, each an expression to observe\n    in terms of the source value.\n-   `record`: as an args object. The keys are property names for the\n    resulting object, and the values are the corresponding syntax nodes\n    for the values.\n-   `view`: the arguments are the input, the start position, and the\n    length of the sliding window to view from the input.  The input may\n    correspond to any ranged content collection, like an array or sorted\n    set.\n-   `rangeContent`: corresponds to the content of an ordered collection\n    that can dispatch indexed range changes like an array or sorted set.\n    This indicates to a binder that it should replace the content of the\n    target instead of replacing the target property with the observed\n    content of the source.  A range content node has no effect on the\n    source.\n-   `mapContent`: corresponds to the content of a map-like collection\n    including arrays and all map [Collections][].  These collections\n    dispatch map changes, which create, read, update, or delete\n    key-to-value pairs.  This indicates to a binder to replace the\n    content of the target map-like collection with the observed content\n    of the source, instead of replacing the target collection.  A map\n    change node on the source side just passes the collection forward\n    without alteration.\n\nFor all operators, the "args" property are operands.  The node types for\nunary operators are:\n\n-   ```+```: `number`, arithmetic coercion\n-   ```-```: `neg`, arithmetic negation\n-   ```!```: `not`, logical negation\n\nFor all binary operators, the node types are:\n\n-   ```**```: `pow`, exponential power\n-   ```//```: `root`, of 2 square root, of 3 cube root, etc\n-   ```%%```: `log`, logarithm with base\n-   ```*```: `mul`, multiplication\n-   ```/```: `div`, division\n-   ```%```: `mod`, modulo (toward negative infinity, always positive)\n-   ```rem```: `rem`, remainder (toward zero, negative if negative)\n-   ```+```: `add`, addition\n-   ```-```: `sub`, subtraction\n-   ```<```: `lt`, less than\n-   ```<=```: `le`, less than or equal\n-   ```>```: `gt`, greater than\n-   ```>=```: `ge`, greater than or equal\n-   ```<=>```: `compare`\n-   ```==```: ``equals``, equality comparison and assignment\n-   ```!=``` produces unary negation and equality comparison or\n    assignment so does not have a corresponding node type.  The\n    simplification makes it easier to rotate the syntax tree\n    algebraically.\n-   ```&&```, `and`, logical and\n-   ```||```, `or`, logical or\n\nFor the ternary operator:\n\n-   ```?``` and ```:```: `if`, ternary conditional\n\nFor all function calls, the right hand side is a tuple of arguments.\n\n-   `reversed`\n-   `enumerate`\n-   `flatten`\n-   `sum`\n-   `average`\n-   `startsWith`\n-   `endsWith`\n-   `contains`\n-   `join`\n-   `split`\n-   `range`\n-   `keys`\n-   `values`\n-   `items`\n\n\n### Observers and Binders\n\nThe `observers` module contains functions for making all of the\ndifferent types of observers, and utilities for creating new ones.\nAll of these functions are or return an observer function of the form\n`observe(emit, value, parameters)` which in turn returns `cancel()`.\n\n-   `observeValue`\n-   `observeParameters`\n-   `makeLiteralObserver(value)`\n-   `makeElementObserver(id)`\n-   `makeComponentObserver(label)`\n-   `makeRelationObserver(callback, thisp)` is unavailable through the\n    property binding language, translates a value through a JavaScript\n    function.\n-   `makeComputerObserver(observeArgs, compute, thisp)` applies\n    arguments to the computation function to get a new value.\n-   `makeConverterObserver(observeValue, convert, thisp)` calls the\n    converter function to transform a value to a converted value.\n-   `makePropertyObserver(observeObject, observeKey)`\n-   `makeGetObserver(observeCollection, observeKey)`\n-   `makeMapFunctionObserver(observeArray, observeFunction)`\n-   `makeMapBlockObserver(observeArray, observeRelation)`\n-   `makeFilterBlockObserver(observeArray, observePredicate)`\n-   `makeSortedBlockObserver(observeArray, observeRelation)`\n-   `makeEnumerationObserver(observeArray)`\n-   `makeFlattenObserver(observeOuterArray)`\n-   `makeTupleObserver(...observers)`\n-   `makeObserversObserver(observers)`\n-   `makeReversedObserver(observeArrayh)`\n-   `makeWindowObserver` is not presently available through the language\n    and is subject to change.  It is for watching a length from an array\n    starting at an observable index.\n-   `makeSumObserver(observeArray)`\n-   `makeAverageObserver(observeArray)`\n-   `makeParentObserver(observeExpression)`\n-   *etc*\n\nThese are utilities for making observer functions.\n\n-   `makeNonReplacing(observe)` accepts an array observer (the emitted\n    values must be arrays) and returns an array observer that will only\n    emit the target once and then incrementally update that target.  All\n    array observers use this decorator to handle the case where the\n    source value gets replaced.\n-   `makeArrayObserverMaker(setup)` generates an observer that uses an\n    array as its source and then incrementally updates a target value,\n    like `sum` and `average`.  The `setup(source, emit)` function must\n    return an object of the form `{contentChange, cancel}` and arrange\n    for `emit` to be called with new values when `contentChange(plus,\n    minus, index)` receives incremental updates.\n-   `makeUniq(callback)` wraps an emitter callback such that it only\n    forwards new values.  So, if a value is repeated, subsequent calls\n    are ignored.\n-   `autoCancelPrevious(callback)` accepts an observer callback and\n    returns an observer callback.  Observer callbacks may return\n    cancelation functions, so this decorator arranges for the previous\n    canceler to be called before producing a new one, and arranges for\n    the last canceler to be called when the whole tree is done.\n-   `once(callback)` accepts a canceler function and ensures that the\n    cancelation routine is only called once.\n\nThe `binders` module contains similar functions for binding an observed\nvalue to a bound value.  All binders are of the form `bind(observeValue,\nsource, target, parameters)` and return a `cancel()` function.\n\n-   `makePropertyBinder(observeObject, observeKey)`\n-   `makeGetBinder(observeCollection, observeKey)`\n-   `makeHasBinder(observeCollection, observeValue)`\n-   `makeEqualityBinder(observeLeft, observeRight)`\n-   `makeRangeContentBinder(observeTarget)`\n-   `makeMapContentBinder(observeTarget)`\n-   `makeReversedBinder(observeTarget)`\n\n\n[Collections]: https://github.com/kriskowal/collections\n[Define Property]: http://kangax.github.com/es5-compat-table/#define-property-webkit-note\n[Montage]: https://github.com/montagejs/montage\n[Mr]: https://github.com/kriskowal/mr\n[Mutation Observers]: https://developer.mozilla.org/en-US/docs/DOM/DOM_Mutation_Observers\n[Node.js]: http://nodejs.org/\n\n',readmeFilename:"README.md",_id:"frb@0.2.3",_from:"frb@~0.2.3",directories:{lib:"./"},hash:"1bc5415",mappings:{collections:{name:"collections",hash:"febb707",location:"../collections@febb707/"}},production:!0,useScriptInjection:!0}}),montageDefine("0b8cfe2","package.json",{exports:{name:"q",version:"0.9.2",description:"A library for promises (CommonJS/Promises/A,B,D)",homepage:"https://github.com/kriskowal/q",author:"Kris Kowal <kris@cixar.com> (https://github.com/kriskowal)",keywords:["q","promise","promises","promises-a","promises-a-plus","deferred","future","async","flow control","fluent","browser","node"],contributors:["Kris Kowal <kris@cixar.com> (https://github.com/kriskowal)","Irakli Gozalishvili <rfobic@gmail.com> (http://jeditoolkit.com)","Domenic Denicola <domenic@domenicdenicola.com> (http://domenicdenicola.com)"],bugs:{mail:"kris@cixar.com",url:"http://github.com/kriskowal/q/issues"},licenses:[{type:"MIT",url:"http://github.com/kriskowal/q/raw/master/LICENSE"}],main:"q.js",repository:{type:"git",url:"git://github.com/kriskowal/q.git"},engines:{node:">=0.6.0",teleport:">=0.2.0"},dependencies:{},devDependencies:{jshint:">=1.1.0",cover:"*","jasmine-node":"1.2.2",opener:"*","promises-aplus-tests":"1.x"},scripts:{test:"jasmine-node spec && promises-aplus-tests spec/aplus-adapter","test-browser":"opener spec/q-spec.html",lint:"jshint q.js",cover:"cover run node_modules/jasmine-node/bin/jasmine-node spec && cover report html && opener cover_html/index.html"},directories:{test:"./spec",lib:"./"},hash:"0b8cfe2",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("33e5fbc","package.json",{exports:{name:"digit",version:"0.2.0-alpha",publishConfig:{tag:"edge"},repository:{type:"git",url:"https://github.com/montagejs/digit.git"},dependencies:{montage:"0.13.0-alpha",matte:"0.1.1-alpha","native":"0.1.1-alpha"},devDependencies:{"montage-testing":"0.2.0-alpha"},exclude:["overview.html","overview","run-tests.html","test"],readme:"![digit](overview/assets/images/icon.png)\n\n# digit\nTouch-optimized [Montage](https://github.com/montagejs/montage) components for tablets and phones.\n\n## Install\nCurrently Digit is still __work in progress__. To preview the components, add a symlink that points to Montage at `/node_modules/montage` and then you should see them if you visit `/overview` on your local server.\n\n## Components\n\n![Button](ui/button.reel/screenshot.png)\n![RadioButton](ui/radio-button.reel/screenshot.png)\n![Checkbox](ui/checkbox.reel/screenshot.png)\n![Select](ui/select.reel/screenshot.png)\n![NumberField](ui/number-field.reel/screenshot.png)\n![Slider](ui/slider.reel/screenshot.png)\n\nThese are just a few examples, [see them all](overview).\n",readmeFilename:"README.md",_id:"digit@0.2.0-alpha",description:"![digit](overview/assets/images/icon.png)",_from:"digit@0.2.0-alpha",directories:{lib:"./"},hash:"33e5fbc",mappings:{montage:{name:"montage",hash:"b8d1a32",location:"../montage@b8d1a32/"},matte:{name:"matte",hash:"367a385",location:"../matte@367a385/"},"native":{name:"native",hash:"d7895c4",location:"../native@d7895c4/"}},production:!0,useScriptInjection:!0}}),montageDefine("d8747a3","index.html",{text:'<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=utf-8>\n    <meta name=viewport content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">\n    <meta http-equiv=X-UA-Compatible content="chrome=1">\n\n    <title>Montage - HTML5 framework</title>\n\n    <link rel=stylesheet href="http://fonts.googleapis.com/css?family=Open+Sans:400,700">\n    <link rel=stylesheet href="stylesheets/normalize.css">\n    <link rel=stylesheet href="stylesheets/base.css">\n    <link rel=stylesheet href="stylesheets/index.css">\n\n    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->\n\n    <script src="packages/montage@b8d1a32/montage.js"></script>\n    <script type="text/montage-serialization">{"features":{"prototype":"ui/features.reel","properties":{"element":{"#":"features"}}}}</script>\n\n  </head>\n<body>\n\n    <header class="header-index pushed">\n        <h1><img class=logo src="images/logo-montage.png" alt=Montage></h1>\n        <h2 class=tagline>An <strong>HTML5 framework</strong> for building modern <strong>Web Apps</strong>.</h2>\n    </header>\n\n    <nav class="bar links">\n        <a class="link download" href="docs/Quick-Start">Quick Start</a>\n        <a class="link docs" href="docs/">Docs</a>\n    </nav>\n\n    <section id=intro class=intro>\n        <article>\n            <h3 class=title>Introducing Montage</h3>\n            <div class=cols>\n                <div class="col col-1-2">\n                <p>MontageJS helps you built scalable and maintainable HTML5 applications optimized for today\'s and tomorrow\'s range of connected devices. With MontageJS, developers can create reusable user interface components and modules, bind properties among components and controllers, and synchronize DOM queries and updates to ensure a smooth user experience, especially on resource-constrained devices.</p>\n                </div>\n                <aside class="col col-1-2">\n                    <p>Features include</p>\n                    <ul>\n                        <li>Reusable components and HTML templates</li>\n                        <li>Declarative component model</li>\n                        <li>Declarative data binding</li>                        \n                        <li>Managed draw cycle</li>\n                        <li>Implicit event delegation</li>\n                    </ul>\n                </aside>\n            </div>\n        </article>\n    </section>\n\n    <section id=features class=features style=min-height:1050px>\n        <article>\n            <h3 class=title>Features</h3>\n\n            <div class=cols>\n                <div class="col col-1-2">\n                    <h3 class=sub-title>Reusable Components</h3>\n                    <p>MontageJS comes with a variety of self-contained, reusable, and reliable components for building native-quality HTML5 apps. You can use these components individually, nest them within others, or use our clean API to build your own. <a href="docs/component-overview" target=_blank>Learn more &gt;</a></p>\n                </div>\n                <div class="col col-1-2">\n                    <h3 class=sub-title>Declarative Component Model</h3>\n                    <p>Montage models components as standalone web pages. The HTML of a component (the "template") contains a DOM skeleton and comes to life with the inclusion of a JSON formatted block or file—a component object model, distinct but connected to the DOM—that describes how to dress up the DOM with connections among components. <a href="docs/montage-serialization-format" target=_blank>Learn more &gt;</a></p>\n                </div>\n            </div>\n            <h3 class=sub-title>Declarative Data Binding</h3>\n             <p class="col col-2-3">MontageJS supports simple and two-way data binding between components, objects, and collections. Data binding helps keep your UI and model data in sync, so you have more time to spend on your actual data and application logic than on manually tying your data into the DOM. <a href="docs/Data-binding" target=_blank>Learn more &gt;</a></p>\n            <div data-montage-id=features></div>\n\n            <div class=cols>\n                <div class="col col-1-2">\n                    <h3 class=sub-title>Implicit Event Delegation</h3>\n                    <p>MontageJS supports and extends the browser\'s native event handling mechanism using an event delegation model. This model helps improve performance, provides simple event handling logic, and adds the ability to observe property changes. <a href="docs/event-handling" target=_blank>Learn more &gt;</a></p>\n                </div>\n                <div class="col col-1-2">\n                    <h3 class=sub-title>Managed Draw Cycle</h3>\n                    <p>ontageJS components participate in a managed draw cycle that separates reading and writing operations: DOM updates and queries are batched into separate code passes, thus limiting the number of DOM reflows while maximizing application performance. <a href="docs/component-draw-cycle" target=_blank>Learn more &gt;</a></p>\n                </div>\n\n            </div>\n\n            <nav class=more>Learn more:\n                <a class=more-button href="docs/" target=_blank>Docs</a>\n                <a class=more-button href="http://montagejs.github.com/montage/samples/mfiddle/" target=_blank>M Fiddle</a>\n            </nav>\n\n\n        </article>\n    </section>\n\n	<section id=apps class="gallery apps pushed">\n	    <article>\n	        <h3 class=title>Made with Montage</h3>\n	        <p>A couple examples of Apps built with Montage.<br>\n                Check out more <a class=link href=apps>sample Apps and demos</a>.</p>\n	        <ul class=gallery>\n                <li class=gallery-item>\n   	                <a href="apps/popcorn/" target=_blank>\n   	                    <figure class=gallery-thumb><img class=gallery-img src="images/apps/popcorn.jpg" alt=Popcorn></figure>\n   	                    <figcaption class=gallery-description>Popcorn (Tablets)</figcaption>\n   	                </a>\n   	            </li>\n	            <li class=gallery-item>\n	                <a href="apps/calculator/" target=_blank>\n	                    <figure class=gallery-thumb><img class=gallery-img src="images/apps/calculator.jpg" alt=Calculator></figure>\n	                    <figcaption class=gallery-description>Calculator (Mobile)</figcaption>\n	                </a>\n	            </li>\n	            <li class=gallery-item>\n	                <a href="apps/paparazzi/" target=_blank>\n	                    <figure class=gallery-thumb><img class=gallery-img src="images/apps/paparazzi.jpg" alt=Paparazzi></figure>\n	                    <figcaption class=gallery-description>Paparazzi (Desktop)</figcaption>\n	                </a>\n	            </li>\n                <li class=gallery-item>\n   	                <a href="apps/carconfigurator/" target=_blank>\n   	                    <figure class=gallery-thumb><img class=gallery-img src="images/apps/carconfigurator.jpg" alt="Car Configurator"></figure>\n   	                    <figcaption class=gallery-description>Car Configurator (WebGL)</figcaption>\n   	                </a>\n   	            </li>\n	        </ul>\n	    </article>\n	</section>\n\n 	<section id=tools class=tools>\n        <article>\n            <h3 class=title>Tools</h3>\n            <div class=cols>\n                <div class="col col-1-2">\n                    <p><a href="https://github.com/montagejs/minit" target=_blank>Minit</a> kickstarts your Montage projects by generating prebuilt Montage application templates and components and placing the associated files inside the proper directories of your project.</p>\n                </div>\n                <div class="col col-1-2">\n                    <p><a href="https://github.com/montagejs/mop" target=_blank>Mop</a> translates y developer-optimized experience into a user-optimized experience by cleaning up an application with its deeply intertwined dependencies into a single optimized script.</p>\n                </div>\n            </div>\n        </article>\n    </section>\n\n    <section id=misc class=misc>\n        <article>\n            <div class=cols>\n                <div class="col col-1-2">\n                    <h3 class=title>Browser Support</h3>\n                    <p>Montage works best in "evergreen" browsers, including current versions of Google Chrome, Firefox, Safari, Chrome Android, Mobile Safari, and IE 10.</p>\n                </div>\n                <div class="col col-1-2">\n                    <h3 class=title>License</h3>\n                    <p>Montage is <strong>open source</strong> and licensed under <strong>BSD</strong>. For more details see <a href="https://github.com/montagejs/montage/blob/master/LICENSE.md" target=_blank>LICENSE.md</a>.</p>\n                </div>\n            </div>\n        </article>\n    </section>\n\n    <section id=next class=next>\n        <article>\n            <h3 class=title>Next steps</h3>\n            <div class=cols>\n                <div class="col col-1-2">\n                    <p>For more information <a href="docs/">explore the Montage documentation</a> or <a href="https://github.com/montagejs/montage#montage" target=_blank>dive into the code itself</a>.\n                    </p>\n                </div>\n                <aside class="col col-1-2">\n                    <p><strong>Have feedback or ideas?</strong> Let us know by creating a new <a href="https://github.com/montagejs/montage/issues" target=_blank>issue</a>, join us in <a href="http://webchat.freenode.net/?channels=montage" target=_blank>IRC</a> or post questions to our <a href="https://groups.google.com/forum/?fromgroups#!forum/montagejs" target=_blank>Google Group</a>. We\'re also on <a href="https://twitter.com/montagejs" target=_blank>Twitter</a> and <a href="https://plus.google.com/116915300739108010954/" target=_blank>Google+</a>.\n                    </p>\n                </aside>\n            </div>\n        </article>\n    </section>\n\n    <footer class=footer>\n        2013 montagejs.org - <a href="https://github.com/montagejs/montagejs.org">Contributions</a> to this page are welcomed.\n    </footer>\n\n\n    \n    <a href="https://github.com/montagejs/montage"><img style="position: absolute; top: 0; right: 0; border: 0" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>\n\n\n    \n    <script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-35717912-1"]),_gaq.push(["_trackPageview"]),function(){var s=document.createElement("script");s.type="text/javascript",s.async=!0,s.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(s,n)}();</script>\n\n</body>\n</html>'}),montageDefine("d8747a3","ui/features.reel/features",{dependencies:["montage","montage/ui/component"],factory:function(e,t){var n=e("montage").Montage,a=e("montage/ui/component").Component;
t.Features=n.create(a,{hasTemplate:{value:!0},convert:{value:function(e){return""+Number(Math.round(e))}},revert:{value:function(e){return""+Number(Math.round(e))}}})}}),montageDefine("d8747a3","ui/features.reel/features.html",{text:'<!DOCTYPE html>\n<html>\n<head>\n    <title></title>\n    <link rel=stylesheet href=features.css>\n    <script type="text/montage-serialization">{"owner":{"prototype":"ui/features.reel","properties":{"element":{"#":"component"}}},"number":{"prototype":"digit/ui/number-field.reel","properties":{"element":{"#":"number"},"min":0,"max":100,"step":1},"bindings":{"value":{"<->":"@slider.value"}}},"slider":{"prototype":"digit/ui/slider.reel","properties":{"element":{"#":"slider"},"min":0,"max":100,"step":1,"value":50}},"numberValue":{"prototype":"montage/ui/text.reel","properties":{"element":{"#":"numberValue"}},"bindings":{"value":{"<-":"@number.value","converter":{"@":"owner"}}}},"rangeValue":{"prototype":"montage/ui/text.reel","properties":{"element":{"#":"rangeValue"}},"bindings":{"value":{"<-":"@number.value","converter":{"@":"owner"}}}}}</script>\n\n</head>\n<body>\n\n    <div data-montage-id=component data-montage-skin=light>\n        <div class=cols>\n            <p class="col col-2-3">Montage data binding makes it easier to manage your application and UI state. A UI component or Montage object can establish one way or bi-directional binding with another component or object. The source object is kept in sync when you update the bound property of the bound object. Learn more about <a href="docs/Data-binding" target=_blank>data binding</a>.</p>\n            <ul class="col col-1-3">\n                <li>\n                    <input type=number data-montage-id=number value=50>\n                </li>\n                <li class=arrow>↕</li>\n                <li>\n                    <input type=range data-montage-id=slider value=50>\n                </li>\n            </ul>\n        </div>\n\n\n        <div class="block markup">\n<pre>\n&lt;input data-montage-id="<span class=hl-number>number</span>" type="number" value="<span data-montage-id=numberValue class=hl-value>0</span>" /&gt;\n&lt;input data-montage-id="<span class=hl-range>range</span>" type="range" value="<span data-montage-id=rangeValue class=hl-value>0</span>" /&gt;\n</pre>\n        </div>\n\n        <div class="block serialization">\n<pre>\n"number": {\n    "prototype": "digit/ui/number-field.reel",\n    "properties": { "element": {"#": "<span class=hl-number>number</span>"} }\n},\n"slider": {\n    "prototype": "digit/ui/slider.reel",\n    "properties": { "element": {"#": "<span class=hl-range>slider</span>"} },\n    <span class=hl-bindings>"bindings": { "value": {"&lt;-&gt;": "@number.value"} }</span>\n}\n</pre>\n        </div>\n    </div>\n\n</body>\n</html>'}),montageDefine("b8d1a32","core/core",{dependencies:["collections/shim","core/shim/object","core/shim/array","core/shim/string","core/extras/object","core/extras/date","core/extras/element","core/extras/function","core/extras/regexp","core/extras/string","core/uuid","collections/listen/property-changes","core/bindings","core/paths","core/serialization/bindings","core/promise"],factory:function(e,t){function n(e,t){var r=s+t+a;return e.hasOwnProperty(r)?e[r]:Object.defineProperty(e,r,{enumerable:!1,configurable:!1,writable:!0,value:Object.create(n(Object.getPrototypeOf(e),t))})[r]}e("collections/shim"),e("core/shim/object"),e("core/shim/array"),e("core/shim/string"),e("core/extras/object"),e("core/extras/date"),e("core/extras/element"),e("core/extras/function"),e("core/extras/regexp"),e("core/extras/string");var a="AttributeProperties",s="_",r="__proto__",i="value",o="enumerable",l="distinct",c="serializable",p=Array.prototype,u=Object.prototype,h=!0,d=t.Montage=function d(){};d.deprecate=function(e,t,n,a){var s=function(){var s=Error.stackTraceLimit;return Error.stackTraceLimit=2,"undefined"!=typeof console&&"function"==typeof console.warn&&(a?console.warn(n+" is deprecated, use "+a+" instead.",Error("").stack):console.warn(n,Error("").stack)),Error.stackTraceLimit=s,t.apply(e?e:this,arguments)};return s.deprecatedFunction=t,s},d.callDeprecatedFunction=function(e,t,n,a){var s,r,i=Error.stackTraceLimit;return Error.stackTraceLimit=2,"undefined"!=typeof console&&"function"==typeof console.warn&&(s=d.getInfoForObject(e).objectName,a?console.warn(n+" is deprecated, use "+a+" instead.",s):console.warn(n,s)),Error.stackTraceLimit=i,r=p.slice.call(arguments,4),t.apply(e?e:this,r)};var m={}.__proto__===Object.prototype,g={_montage_metadata:1,__state__:1},f=Object.getOwnPropertyNames(Function);if(Object.defineProperty(d,"specialize",{value:function(e,t){var n,a,s,r,i,o,l,c=this,p=void 0===this.specialize;if(e=e||Object.empty,t=t||Object.empty,n=e.constructor&&e.constructor.value?e.constructor.value:e.didCreate&&e.didCreate.value?d.deprecate(null,e.didCreate.value,"didCreate","constructor"):function(){return c.apply(this,arguments)||this},m)n.__proto__=c;else{s=Object.getOwnPropertyNames(c);for(var o=0;s.length>o;o++)r=s[o],g.hasOwnProperty(r)||(i=Object.getOwnPropertyDescriptor(n,r),(!i||i.configurable)&&d.defineProperty(n,r,Object.getOwnPropertyDescriptor(c,r)));n.__constructorProto__=c,d.defineProperty(n,"isPrototypeOf",{value:function(e){for(;null!==e;){if(Object.getPrototypeOf(e)===this)return!0;e=Object.getPrototypeOf(e)}return!1},enumerable:!1})}if(a=Object.create(this.prototype),p){for(s=Object.getOwnPropertyNames(d),o=0;s.length>o;o++)r=s[o],i=Object.getOwnPropertyDescriptor(n,r),(!i||i.configurable)&&d.defineProperty(n,r,Object.getOwnPropertyDescriptor(d,r));for(s=Object.getOwnPropertyNames(d.prototype),o=0;s.length>o;o++)r=s[o],i=Object.getOwnPropertyDescriptor(n,r),(!i||i.configurable)&&d.defineProperty(a,r,Object.getOwnPropertyDescriptor(d.prototype,r))}if(d.defineProperties(a,e),h){l=function(e,t,n){function a(){return this===t&&console.warn("Deprecated - "+d.getInfoForObject(t).objectName+"."+n+" should be moved to constructorProperties"),e.apply(this,arguments)}return a.deprecatedFunction=e,a};for(r in e)f.has(r)?delete e[r]:(i=e[r],i.value&&"function"==typeof i.value&&!i.value.__isConstructor__?i.value=l(i.value,n,r):(i.get&&(i.get=l(i.get,n,r)),i.set&&(i.set=l(i.set,n,r))));d.defineProperties(n,e),d.defineProperty(n,"create",{value:function(){return new n},enumerable:!1}),a.hasOwnProperty("didCreate")||d.defineProperty(a,"didCreate",{value:n,enumerable:!1}),n.hasOwnProperty("didCreate")||d.defineProperty(n,"didCreate",{value:n,enumerable:!1})}return d.defineProperties(n,t),d.defineProperty(n,"__isConstructor__",{value:!0,enumerable:!1}),n.prototype=a,d.defineProperty(a,"constructor",{value:n,enumerable:!1}),n},writable:!0,configurable:!0,enumerable:!1}),!m){var v=Object.getPrototypeOf;Object.getPrototypeOf=function(e){return"function"==typeof e&&e.__constructorProto__?e.__constructorProto__:v.apply(Object,arguments)}}Object.defineProperty(d,"create",{configurable:!0,value:function(e,t){if(void 0!==e&&"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object prototype may only be an Object or null, not '"+e+"'");if(e=void 0===e?this:e,"function"==typeof e)return t?e.specialize(t):new e;var n=Object.create(e);return t&&d.defineProperties(n,t),n}});var b=[c];b.forEach(function(e){Object.defineProperty(Object.prototype,s+e+a,{enumerable:!1,configurable:!1,writable:!0,value:{}})}),Object.defineProperty(d,"defineProperty",{value:function(e,t,a){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object must be an object, not '"+e+"'");var h=i in a;if(l in a&&!h)throw"Cannot use distinct attribute on non-value property '"+t+"'";if(r in a)a.__proto__=h?"function"==typeof a.value?_:w:y;else{var d;d=h?"function"==typeof a.value?_:w:y;for(var m in d)m in a||(a[m]=d[m])}return a.hasOwnProperty(o)||t.charAt(0)!==s||(a.enumerable=!1),a.hasOwnProperty(c)||(a.enumerable?a.get&&!a.set?a.serializable=!1:a.writable===!1&&(a.serializable=!1):a.serializable=!1),c in a&&(n(e,c)[t]=a.serializable),a.distinct!==!0||"object"!=typeof a.value?Object.defineProperty(e,t,a):(function(e,t,n,a){var s=function(e,t,n){Object.defineProperty(e,t,{enumerable:!1,configurable:!0,writable:!0,value:n})};n.constructor===Object&&Object.getPrototypeOf(n)===u?0!==Object.keys(n).length?Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[t];if(!e){var a;e={};for(a in n)e[a]=n[a];this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}return e},set:function(e){this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}}):Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[t];return e||(e={},this.hasOwnProperty(t)?this[t]=e:s(this,t,e)),e},set:function(e){this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}}):(n.__proto__||Object.getPrototypeOf(n))===p?0!==n.length?Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[t];if(!e){var a,r;for(e=[],a=0;void 0!==(r=n[a]);a++)e[a]=r;this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}return e},set:function(e){this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}}):Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[t];return e||(e=[],this.hasOwnProperty(t)?this[t]=e:s(this,t,e)),e},set:function(e){this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}}):n.constructor.prototype===Object.getPrototypeOf(n)?Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[t];if(!e){var a;e=new n.constructor;for(a in n)e[a]=n[a];this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}return e},set:function(e){this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}}):Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[t];return e||(e=Object.create(n.__proto__||Object.getPrototypeOf(n)),this.hasOwnProperty(t)?this[t]=e:s(this,t,e)),e},set:function(e){this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}})}(t,s+t,a.value,e),void 0)}}),Object.defineProperty(d,"defineProperties",{value:function(e,t){if("object"!=typeof t||null===t)throw new TypeError("Properties must be an object, not '"+t+"'");for(var n in t)"_bindingDescriptors"!==n&&this.defineProperty(e,n,t[n]);return e}});var y={enumerable:!0,configurable:!0,serializable:!0},w={writable:!0,enumerable:!0,configurable:!0,serializable:"reference"},_={writable:!0,enumerable:!1,configurable:!0,serializable:!1};d.defineProperty(d,"didCreate",{value:Function.noop});var L=function(e,t){for(var n,a,s,r,i,o,l,c;void 0===l&&null!==e;){for(n=Object.getOwnPropertyNames(e),r=0,i=n.length,r;i>r;r++)if(a=n[r],s=Object.getOwnPropertyDescriptor(e,a),null!=(o=s.value)){if(o===t||o.deprecatedFunction&&o.deprecatedFunction===t){c=Object.getPropertyDescriptor(Object.getPrototypeOf(e),a),l=c?c.value:null;break}}else if(null!=(o=s.get)){if(o===t||o.deprecatedFunction&&o.deprecatedFunction===t){c=Object.getPropertyDescriptor(Object.getPrototypeOf(e),a),l=c?c.get:null;break}}else if(null!=(o=s.set)&&(o===t||o.deprecatedFunction&&o.deprecatedFunction===t)){c=Object.getPropertyDescriptor(Object.getPrototypeOf(e),a),l=c?c.set:null;break}e=Object.getPrototypeOf(e)}return l},x=function(){var e=L(this,x.caller);return"function"==typeof e?L(this,x.caller).bind(this):Function.noop};d.defineProperty(d,"super",{get:x}),d.defineProperty(d.prototype,"super",{get:x}),d.defineProperty(d,"getSerializablePropertyNames",{value:function(e){var t=[],n=e._serializableAttributeProperties;if(n)for(var a in n)n[a]&&t.push(a);return t}}),d.defineProperty(d,"getPropertyAttribute",{value:function(e,t,n){var r=s+n+a,i=e[r];return i?i[t]:void 0}}),d.defineProperty(d,"getPropertyAttributes",{value:function(e,t){var n={},r=s+t+a,i=e[r];if(i){for(var o in i)n[o]=i[o];return n}}});var C={isInstance:{value:!0}},M={objectName:{value:"Function"},isInstance:{value:!0}};d.defineProperty(d,"getInfoForObject",{value:function(e){var t,n;if(S.call(e,"_montage_metadata"))return e._montage_metadata;t=e._montage_metadata||e.constructor&&e.constructor._montage_metadata||null,n=e.constructor===Function?M:C;try{return Object.defineProperty(e,"_montage_metadata",{enumerable:!1,writable:!0,value:Object.create(t,n)})._montage_metadata}catch(a){return e._montage_metadata=Object.create(t,n)}}});var z=e("core/uuid");"undefined"!=typeof window&&(window.uuid=z.generate());var S=Object.prototype.hasOwnProperty,E=function(){var e=z.generate(),t=d.getInfoForObject(this);try{null!==t&&t.isInstance===!1?(this._uuid=e,Object.defineProperty(this,"uuid",{get:function(){return this.hasOwnProperty("uuid")?this._uuid:E.call(this)}})):(t.isInstance&&Object.defineProperty(this,"uuid",{configurable:!0,enumerable:!1,writable:!1,value:e}),!(this instanceof Element)&&t.isInstance&&i in(Object.getOwnPropertyDescriptor(this,"uuid")||{})&&r in this||(this._uuid=e))}catch(n){this._uuid=e}return e},k=function k(){return S.call(this,"_uuid")?this._uuid:E.call(this)};Object.defineProperty(Object.prototype,"_uuid",{enumerable:!1,value:null,writable:!0}),Object.defineProperty(Object.prototype,"uuid",{configurable:!0,get:k,set:function(){}}),d.defineProperty(d,"identifier",{value:null,serializable:!0}),d.defineProperty(d.prototype,"identifier",{value:null,serializable:!0}),d.defineProperty(d.prototype,"equals",{value:function(e){return e?this===e||this.uuid===e.uuid:!1}}),d.defineProperty(d,"equals",{value:d.prototype.equals}),d.defineProperty(d.prototype,"callDelegateMethod",{value:function(e){var t,n,a=this.delegate;return"string"==typeof this.identifier&&(t=this.identifier+e.toCapitalized(),a&&"function"==typeof(n=a[t]))?(p.shift.call(arguments),n.apply(a,arguments)):a&&"function"==typeof(n=a[e])?(p.shift.call(arguments),n.apply(a,arguments)):void 0}});var T=e("collections/listen/property-changes");Object.addEach(d,T.prototype),Object.addEach(d.prototype,T.prototype),e("core/bindings"),e("core/paths"),e("core/serialization/bindings"),t._blueprintModuleIdDescriptor={serializable:!1,enumerable:!1,get:function(){var e=d.getInfoForObject(this),t=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(t,"_blueprintModuleId")||!t._blueprintModuleId){e=d.getInfoForObject(t);var n=e.moduleId,a=n.lastIndexOf("/"),s=n.lastIndexOf(".");a=-1===a?0:a+1,s=-1===s?n.length:s,s=a>s?n.length:s,d.defineProperty(t,"_blueprintModuleId",{enumerable:!1,value:n.slice(0,s)+".meta"})}return t._blueprintModuleId}},t._blueprintDescriptor={serializable:!1,enumerable:!1,get:function(){var n=d.getInfoForObject(this),a=n&&!n.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(a,"_blueprint")||!a._blueprint){var s=a.blueprintModuleId;if(""===s)throw new TypeError("Blueprint moduleId undefined for the module '"+JSON.stringify(a)+"'");t._blueprintDescriptor.BlueprintModulePromise||(t._blueprintDescriptor.BlueprintModulePromise=e.async("core/meta/blueprint").get("Blueprint")),d.defineProperty(a,"_blueprint",{enumerable:!1,value:t._blueprintDescriptor.BlueprintModulePromise.then(function(e){var t=d.getInfoForObject(a);return e.getBlueprintWithModuleId(s,t.require).fail(function(){var t=e.createDefaultBlueprintForObject(a);return t.blueprintInstanceModuleId=s,t})})})}return a._blueprint},set:function(t){var n,a=d.getInfoForObject(this),s=a&&!a.isInstance?this:this.constructor;if(null===t)n=null;else{if("function"==typeof t.then)throw new TypeError("Object blueprint should not be a promise '"+JSON.stringify(t)+"'");t.blueprintInstanceModuleId=s.blueprintModuleId,n=e("core/promise").Promise.resolve(t)}d.defineProperty(s,"_blueprint",{enumerable:!1,value:n})}}}}),montageDefine("b8d1a32","core/event/event-manager",{dependencies:["montage","core/uuid","core/event/mutable-event","core/serialization"],factory:function(e,t){var n,a=e("montage").Montage,s=e("core/uuid"),r=e("core/event/mutable-event").MutableEvent,i=e("core/serialization").Serializer,o=e("core/serialization").Deserializer;if("undefined"!=typeof window){void 0===window.Touch&&"ontouchstart"in window&&(window.Touch=function(){},function(){var e;document.addEventListener("touchstart",e=function(t){window.Touch=t.touches[0].constructor,document.nativeRemoveEventListener?document.nativeRemoveEventListener("touchstart",e,!0):document.removeEventListener("touchstart",e,!0),n&&n.isStoringPointerEvents&&(n.isStoringPointerEvents=!1,n.isStoringPointerEvents=!0)},!0)}()),a.specialize({type:{value:null},listener:{value:null},capture:{value:null}}),i.defineSerializationUnit("listeners",function(e,t){var a,s,r,i=n,o=t.uuid,l=[];for(var c in i.registeredEventListeners)if(a=i.registeredEventListeners[c],s=a&&a[o])for(var p in s.listeners)r=s.listeners[p],l.push({type:c,listener:e.addObjectReference(r.listener),capture:r.capture});return l.length>0?l:void 0}),o.defineDeserializationUnit("listeners",function(e,t,n){for(var a,s=0;a=n[s];s++)t.addEventListener(a.type,a.listener,a.capture)});var l=Event.NONE,c=Event.CAPTURING_PHASE,p=Event.AT_TARGET,u=Event.BUBBLING_PHASE,h="function";t.EventManager=a.specialize({eventDefinitions:{value:{abort:{bubbles:!1,cancelable:!1},beforeunload:{bubbles:!1},blur:{bubbles:!1,cancelable:!1},change:{bubbles:!0,cancelable:!1},click:{bubbles:!0,cancelable:!0},close:{bubbles:!1,cancelable:!1},compositionend:{bubbles:!0,cancelable:!1},compositionstart:{bubbles:!0,cancelable:!0},compositionupdate:{bubbles:!0,cancelable:!1},contextmenu:{bubbles:!0,cancelable:!0},copy:{bubbles:!0,cancelable:!0},cut:{bubbles:!0,cancelable:!0},dblclick:{bubbles:!0,cancelable:!1},DOMActivate:{bubbles:!0,cancelable:!0,deprecated:!0},DOMMouseScroll:{bubbles:!0},drag:{bubbles:!0,cancelable:!0},dragend:{bubbles:!0,cancelable:!1},dragenter:{bubbles:!0,cancelable:!0},dragleave:{bubbles:!0,cancelable:!1},dragover:{bubbles:!0,cancelable:!0},dragstart:{bubbles:!0,cancelable:!0},drop:{bubbles:!0,cancelable:!0},error:{bubbles:function(e){return!(XMLHttpRequest.prototype.isPrototypeOf(e)||e.tagName&&"VIDEO"===e.tagName.toUpperCase()||e.tagName&&"AUDIO"===e.tagName.toUpperCase())},cancelable:!1},focus:{bubbles:!1,cancelable:!1},focusin:{bubbles:!0,cancelable:!1},focusout:{bubbles:!0,cancelable:!1},input:{bubbles:!0,cancelable:!1},keydown:{bubbles:!0,cancelable:!1},keypress:{bubbles:!0,cancelable:!1},keyup:{bubbles:!0,cancelable:!1},load:{bubbles:!1,cancelable:!1},loadend:{bubbles:!1,cancelable:!1},loadstart:{bubbles:!1,cancelable:!1},message:{bubbles:!1,cancelable:!1},mousedown:{bubbles:!0,cancelable:!0},mouseenter:{bubbles:!1,cancelable:!1},mouseleave:{bubbles:!1,cancelable:!1},mousemove:{bubbles:!0,cancelable:!0},mouseout:{bubbles:!0,cancelable:!0},mouseover:{bubbles:!0,cancelable:!0},mouseup:{bubbles:!0,cancelable:!0},mousewheel:{bubbles:!0},orientationchange:{bubbles:!1},paste:{bubbles:!0,cancelable:!0},progress:{bubbles:!1,cancelable:!1},reset:{bubbles:!0,cancelable:!1},resize:{bubbles:!1,cancelable:!1},scroll:{bubbles:function(e){return!!e.defaultView},cancelable:!1},select:{bubbles:!0,cancelable:!1},submit:{bubbles:!0,cancelable:!0},touchcancel:{bubbles:!0,cancelable:!1},touchend:{bubbles:!0,cancelable:!0},touchmove:{bubbles:!0,cancelable:!0},touchstart:{bubbles:!0,cancelable:!0},unload:{bubbles:!1,cancelable:!1},wheel:{bubbles:!0,cancelable:!0}}},_DOMPasteboardElement:{value:null,enumerable:!1},_delegate:{value:null,enumerable:!1},delegate:{enumerable:!1,get:function(){return this._delegate},set:function(e){this._delegate=e}},_application:{value:null,enumerable:!1},application:{enumerable:!1,get:function(){return this._application},set:function(e){this._application=e}},_registeredWindows:{value:null,enumerable:!1},_windowsAwaitingFinalRegistration:{value:{},enumerable:!1},initWithWindow:{enumerable:!1,value:function(e){if(this._registeredWindows)throw"EventManager has already been initialized";return this.registerWindow(e),this}},registerWindow:{enumerable:!1,value:function(e){if(e.defaultEventManager&&e.defaultEventManager!==this)throw"EventManager cannot register a window already registered to another EventManager";if(this._registeredWindows&&this._registeredWindows.indexOf(e)>=0)throw"EventManager cannot register a window more than once";if(this._registeredWindows||(this._registeredWindows=[]),e.uuid&&0!==e.uuid.length||(e.uuid=s.generate()),this._windowsAwaitingFinalRegistration[e.uuid]!==e){if(e.Element.prototype.nativeAddEventListener=e.Element.prototype.addEventListener,Object.defineProperty(e,"nativeAddEventListener",{configurable:!0,value:e.addEventListener}),Object.getPrototypeOf(e.document).nativeAddEventListener=e.document.addEventListener,e.XMLHttpRequest.prototype.nativeAddEventListener=e.XMLHttpRequest.prototype.addEventListener,e.Worker&&(e.Worker.prototype.nativeAddEventListener=e.Worker.prototype.addEventListener),e.Element.prototype.nativeRemoveEventListener=e.Element.prototype.removeEventListener,Object.defineProperty(e,"nativeRemoveEventListener",{configurable:!0,value:e.removeEventListener}),Object.getPrototypeOf(e.document).nativeRemoveEventListener=e.document.removeEventListener,e.XMLHttpRequest.prototype.nativeRemoveEventListener=e.XMLHttpRequest.prototype.removeEventListener,e.Worker&&(e.Worker.prototype.nativeRemoveEventListener=e.Worker.prototype.removeEventListener),Object.defineProperty(e,"addEventListener",{configurable:!0,value:e.XMLHttpRequest.prototype.addEventListener=e.Element.prototype.addEventListener=Object.getPrototypeOf(e.document).addEventListener=function(t,n,a){return e.defaultEventManager.registerEventListener(this,t,n,!!a)}}),e.Worker&&(e.Worker.prototype.addEventListener=e.addEventListener),Object.defineProperty(e,"removeEventListener",{configurable:!0,value:e.XMLHttpRequest.prototype.removeEventListener=e.Element.prototype.removeEventListener=Object.getPrototypeOf(e.document).removeEventListener=function(t,n,a){return e.defaultEventManager.unregisterEventListener(this,t,n,!!a)}}),e.Worker&&(e.Worker.prototype.removeEventListener=e.removeEventListener),e.HTMLDivElement.prototype.addEventListener!==e.Element.prototype.nativeAddEventListener&&e.HTMLElement&&"addEventListener"in e.HTMLElement.prototype&&e.Components&&e.Components.interfaces){var r,i;for(r in Components.interfaces)r.match(/^nsIDOMHTML\w*Element$/)&&(r=r.replace(/^nsIDOM/,""),(r=window[r])&&(i=r.prototype,i.nativeAddEventListener=i.addEventListener,i.addEventListener=e.Element.prototype.addEventListener,i.nativeRemoveEventListener=i.removeEventListener,i.removeEventListener=e.Element.prototype.removeEventListener))}a.defineProperty(e.Element.prototype,"eventHandlerUUID",{value:void 0,enumerable:!1}),a.defineProperty(e.Element.prototype,"component",{get:function(){return n._elementEventHandlerByUUID[this.eventHandlerUUID]},enumerable:!1}),n=e.defaultEventManager=t.defaultEventManager=this,this._registeredWindows.push(e),this._windowsAwaitingFinalRegistration[e.uuid]=e,/loaded|complete|interactive/.test(e.document.readyState)?this._finalizeWindowRegistration(e):e.document.addEventListener("DOMContentLoaded",this,!0)}}},_finalizeWindowRegistration:{enumerable:!1,value:function(e){if(this._windowsAwaitingFinalRegistration[e.uuid]!==e)throw"EventManager wasn't expecting to register this window";delete this._windowsAwaitingFinalRegistration[e.uuid],this._listenToWindow(e)}},unregisterWindow:{enumerable:!1,value:function(e){if(0>this._registeredWindows.indexOf(e))throw"EventManager cannot unregister an unregistered window";if(this._registeredWindows=this._registeredWindows.filter(function(t){return e!==t}),delete e.defaultEventManager,e.Element.prototype.addEventListener=e.Element.prototype.nativeAddEventListener,Object.defineProperty(e,"addEventListener",{configurable:!0,value:e.nativeAddEventListener}),Object.getPrototypeOf(e.document).addEventListener=e.document.nativeAddEventListener,e.XMLHttpRequest.prototype.addEventListener=e.XMLHttpRequest.prototype.nativeAddEventListener,e.Worker&&(e.Worker.prototype.addEventListener=e.Worker.prototype.nativeAddEventListener),e.Element.prototype.removeEventListener=e.Element.prototype.nativeRemoveEventListener,Object.defineProperty(e,"removeEventListener",{configurable:!0,value:e.nativeRemoveEventListener}),Object.getPrototypeOf(e.document).removeEventListener=e.document.nativeRemoveEventListener,e.XMLHttpRequest.prototype.removeEventListener=e.XMLHttpRequest.prototype.nativeRemoveEventListener,e.Worker&&(e.Worker.prototype.removeEventListener=e.Worker.prototype.nativeRemoveEventListener),e.HTMLDivElement.prototype.nativeAddEventListener!==e.Element.prototype.addEventListener&&e.HTMLElement&&"addEventListener"in e.HTMLElement.prototype&&e.Components&&e.Components.interfaces){var t,n;for(t in Components.interfaces)t.match(/^nsIDOMHTML\w*Element$/)&&(t=t.replace(/^nsIDOM/,""),(t=window[t])&&(n=t.prototype,n.addEventListener=n.nativeAddEventListener,delete n.nativeAddEventListener,n.removeEventListener=n.nativeRemoveEventListener,delete n.nativeRemoveEventListener))}delete e.Element.prototype.nativeAddEventListener,delete e.nativeAddEventListener,delete Object.getPrototypeOf(e.document).nativeAddEventListener,delete e.XMLHttpRequest.prototype.nativeAddEventListener,e.Worker&&delete e.Worker.prototype.nativeAddEventListener,delete e.Element.prototype.nativeRemoveEventListener,delete e.nativeRemoveEventListener,delete Object.getPrototypeOf(e.document).nativeRemoveEventListener,delete e.XMLHttpRequest.prototype.nativeRemoveEventListener,e.Worker&&delete e.Worker.prototype.nativeRemoveEventListener,delete e.Element.prototype.eventHandlerUUID,delete e.Element.prototype.component,this._stopListeningToWindow(e)}},unregisterWindows:{enumerable:!1,value:function(){this._registeredWindows.forEach(this.unregisterWindow)}},registeredEventListeners:{enumerable:!1,value:{}},registeredEventListenersForEventType_:{value:function(e){var t,n,a,s,r=this.registeredEventListeners[e];if(!r)return null;s={};for(t in r){n=r[t].listeners;for(a in n)s[a]=n[a]}return s}},registeredEventListenersForEventType_onTarget_:{enumerable:!1,value:function(e,t,n){var a,s;return a=t===n?n.eventManager.registeredEventListeners[e]:this.registeredEventListeners[e],a?(s=a[t.uuid],s?s.listeners:null):null}},registeredEventListenersOnTarget_:{value:function(e){var t,n,a=[];for(t in this.registeredEventListeners)n=this.registeredEventListeners[t],e.uuid in n&&a.push(n);return a}},registerEventListener:{enumerable:!1,value:function(e,t,n,a){var s,r,i,o=this.registeredEventListeners[t],l=!1,c=!1;if(void 0===e.uuid)throw Error("EventManager cannot observe a target without a uuid: "+(e.outerHTML||e));return o?((s=o[e.uuid])||(s=o[e.uuid]={target:e,listeners:{}},l=!0),r=s.listeners[n.uuid],i=a?"capture":"bubble",r?(r[i]=!0,c=!0):(r={listener:n,capture:a,bubble:!a},s.listeners[n.uuid]=r,c=!0)):(o=this.registeredEventListeners[t]={},o[e.uuid]={target:e,listeners:{}},o[e.uuid].listeners[n.uuid]={listener:n,capture:a,bubble:!a},l=!0,c=!0),l&&"function"==typeof e.nativeAddEventListener&&this._observeTarget_forEventType_(e,t),c}},unregisterEventListener:{enumerable:!1,value:function(e,t,n,a){var s,r,i,o,l,c=this.registeredEventListeners[t];if(c&&(s=c[e.uuid])){if(r=s.listeners[n.uuid],!r){for(o in s.listeners)if(l=s.listeners[o].listener,l.originalListener&&l.originalListener.uuid===n.uuid){r=s.listeners[o],n=l;break}if(!r)return}i=a?"capture":"bubble",r[i]=!1,r.bubble||r.capture||(delete s.listeners[n.uuid],0===Object.keys(s.listeners).length&&(delete c[e.uuid],0===Object.keys(c).length&&(delete this.registeredEventListeners[t],this._stopObservingTarget_forEventType_(e,t))))}}},actualDOMTargetForEventTypeOnTarget:{value:function(e,t){if(t.nativeAddEventListener){if(t.defaultView)return t;var n,a=this.eventDefinitions[e];return a?(n=typeof a.bubbles===h?a.bubbles(t):a.bubbles,n?t.screen?t.document:t.ownerDocument:t):t}return null}},_observedTarget_byEventType_:{value:{}},_observeTarget_forEventType_:{enumerable:!1,value:function(e,t){var n;!(n=this.actualDOMTargetForEventTypeOnTarget(t,e))||this._observedTarget_byEventType_[t]&&this._observedTarget_byEventType_[t][n.uuid]||(this._observedTarget_byEventType_[t]||(this._observedTarget_byEventType_[t]={}),this._observedTarget_byEventType_[t][n.uuid]=this,n.nativeAddEventListener(t,this,!0))}},_stopObservingTarget_forEventType_:{enumerable:!1,value:function(e,t){var n;n=this.actualDOMTargetForEventTypeOnTarget(t,e),n&&(delete this._observedTarget_byEventType_[t][n.uuid],n.nativeRemoveEventListener(t,this,!0))}},_activationHandler:{enumerable:!0,value:null},_listenToWindow:{enumerable:!1,value:function(e){if(!this._activationHandler){var t=this;this._activationHandler=function(e){var n,a=e.type;if("focus"===a||"mousedown"===a||"touchstart"===a)if(e.changedTouches){n=e.changedTouches.length;for(var s=0;n>s;s++)t._prepareComponentsForActivation(e.changedTouches[s].target)}else t._prepareComponentsForActivation(e.target)}}if(e.Touch?e.document.nativeAddEventListener("touchstart",this._activationHandler,!0):e.document.nativeAddEventListener("mousedown",this._activationHandler,!0),e.document.nativeAddEventListener("focus",this._activationHandler,!0),this.application){var n,a=this.registeredEventListenersOnTarget_(this.application);for(n in a)this._observeTarget_forEventType_(e,n)}}},_stopListeningToWindow:{enumerable:!1,value:function(e){var t,n=this.registeredEventListenersOnTarget_(this.application),a=this.registeredEventListenersOnTarget_(e);for(t in n)this._stopObservingTarget_forEventType_(e,t);for(t in a)this._stopObservingTarget_forEventType_(e,t)}},reset:{enumerable:!1,value:function(){var e,t,n,a;for(e in this.registeredEventListeners){t=this.registeredEventListeners[e];for(n in t.targets)a=t.targets[n],this._stopObservingTarget_forEventType_(a.target,e)}this.registeredEventListeners={},this._claimedPointers={}}},unload:{enumerable:!1,value:function(){this._stopListening()}},methodNameForBubblePhaseOfEventType:{enumerable:!1,value:function(e){return function(t,n){var a=n?t+"+"+n:t;return e[a]||(e[a]="handle"+(n?n.toCapitalized():"")+t.toCapitalized())}}({})},_methodNameForCapturePhaseByEventType_:{value:{}},methodNameForCapturePhaseOfEventType:{enumerable:!1,value:function(e){return function(t,n){var a=n?t+"+"+n:t;return e[a]||(e[a]="capture"+(n?n.toCapitalized():"")+t.toCapitalized())}}({})},_claimedPointers:{enumerable:!1,distinct:!0,value:{}},componentClaimingPointer:{value:function(e){return this._claimedPointers[e]}},isPointerClaimedByComponent:{value:function(e,t){if(!t)throw"Must specify a valid component to see if it claims the specified pointer, '"+t+"' is not valid.";return this._claimedPointers[e]===t}},claimPointer:{value:function(e,t){if(!e&&0!==e)throw"Must specify a valid pointer to claim, '"+e+"' is not valid.";if(!t)throw"Must specify a valid component to claim a pointer, '"+t+"' is not valid.";var n=this._claimedPointers[e];return n===t?!0:n?n.surrenderPointer(e,t)?(this._claimedPointers[e]=t,!0):!1:(this._claimedPointers[e]=t,!0)}},forfeitPointer:{value:function(e,t){if(t!==this._claimedPointers[e])throw"Not allowed to forfeit pointer '"+e+"' claimed by another component";delete this._claimedPointers[e]}},forfeitAllPointers:{value:function(e){var t,n;for(t in this._claimedPointers)n=this._claimedPointers[t],e===n&&delete this._claimedPointers[t]}},_isStoringPointerEvents:{enumerable:!1,value:!1},isStoringPointerEvents:{enumerable:!0,get:function(){return this._isStoringPointerEvents},set:function(e){e===!0?this._isStoringPointerEvents||(this._isStoringPointerEvents=!0,window.Touch&&Object.defineProperty(Touch.prototype,"velocity",{get:function(){return n.pointerMotion(this.identifier).velocity},set:function(){}})):(this._isStoringPointerEvents=!1,this._pointerStorage.memory={},this._isMouseDragging=!1)}},_isStoringMouseEventsWhileDraggingOnly:{enumerable:!1,value:!0},isStoringMouseEventsWhileDraggingOnly:{enumerable:!0,get:function(){return this._isStoringMouseEventsWhileDraggingOnly},set:function(e){this._isStoringMouseEventsWhileDraggingOnly=e===!0?!0:!1}},_isMouseDragging:{enumerable:!1,value:!1},_pointerStorage:{enumerable:!1,value:{memory:{},add:function(e,t){this.memory[e]||(this.memory[e]={data:Array(32),size:0,pos:0}),this.memory[e].data[this.memory[e].pos]=t,this.memory[e].size<this.memory[e].data.length&&this.memory[e].size++,this.memory[e].pos=(this.memory[e].pos+1)%this.memory[e].data.length
},remove:function(e){delete this.memory[e]},clear:function(e){this.memory[e]&&(this.memory[e].size=0)},getMemory:function(e){return this.memory[e]},isStored:function(e){return this.memory[e]&&this.memory[e].size>0},storeEvent:function(e){var t;switch(e.type){case"mousedown":n._isMouseDragging=!0;case"mousemove":n._isStoringMouseEventsWhileDraggingOnly?n._isMouseDragging&&(this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return n.pointerMotion("mouse").velocity},set:function(){}})):(this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return n.pointerMotion("mouse").velocity},set:function(){}}));break;case"mouseup":this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return n.pointerMotion("mouse").velocity},set:function(){}});break;case"touchstart":case"touchmove":for(t=0;e.touches.length>t;t++)this.add(e.touches[t].identifier,{clientX:e.touches[t].clientX,clientY:e.touches[t].clientY,timeStamp:e.timeStamp});break;case"touchend":for(t=0;e.changedTouches.length>t;t++)this.add(e.changedTouches[t].identifier,{clientX:e.changedTouches[t].clientX,clientY:e.changedTouches[t].clientY,timeStamp:e.timeStamp})}},removeEvent:function(e){var t;switch(e.type){case"mouseup":n._isMouseDragging=!1,n._isStoringMouseEventsWhileDraggingOnly&&this.clear("mouse");break;case"touchend":for(t=0;e.changedTouches.length>t;t++)this.remove(e.changedTouches[t].identifier)}}}},_getPointerVelocityData:{enumerable:!1,value:function(e){var t,a,s,r,i,o,l,c,p,u=0,h=!0,d={x:[],y:[],time:[]};for(t=n._pointerStorage.getMemory(e),a=t.data.length,s=t.data[(t.pos-1+a)%a],r=i=o=s.timeStamp,l=s.clientX,c=s.clientY;h&&i>r-350&&t.size>u;)s=t.data[(t.pos-u-1+a)%a],i=s.timeStamp,p=l*l+c*c,p>2&&50>=o-i?(d.x.push(s.clientX),d.y.push(s.clientY),d.time.push(i),o=i,l=s.clientX,c=s.clientY,u++):h=!1;return d}},_fitPointerCurve:{enumerable:!1,value:function(e,t){var n,a,s,r,i,o,l,c,p,u,h,d,m,g,f,v,b,y,w,_,L,x,C,M,z,S,E,k,T,j,O,B,D,P,A,I,R,N,q=1e-4,F=t.length;do{for(h=0,d=0,m=0,g=0,f=0,v=0,y=0,w=0,_=0,L=0,x=0,C=0,z=0,S=0,E=0,k=0,T=0,j=0,B=0,D=0,P=0,A=0,I=0,R=0,u=0;F>u;u++)i=t[u],o=i.t,c=o*o,p=c*o,l=i.v,b=q*(6*(c-o)-p+2),M=6*q*(p-2*c+o),O=6*q*(c-p),N=2*q*p,v+=b*b,C+=M*M,j+=O*O,R+=N*N,h+=l*b,y+=l*M,z+=l*O,B+=l*N,m-=b,_-=M,E-=O,P-=N,d-=b*o,w-=M*o,S-=O*o,D-=N*o,g-=b*c,L-=M*c,k-=O*c,A-=N*c,f-=b*p,x-=M*p,T-=O*p,I-=N*p;q*=2}while(0===v||0===C||0===j||0===R);for(o=q/v,h*=o,d*=3*o,m*=o,g*=3*o,f*=o,o=q/C,y*=o,w*=3*o,_*=o,L*=3*o,x*=o,o=q/j,z*=o,S*=3*o,E*=o,k*=3*o,T*=o,o=q/R,B*=o,D*=3*o,P*=o,A*=3*o,I*=o,v=e[0],C=e[1],j=e[2],R=e[3],n=3*(C-j)+R-v,a=v+j-2*C,s=C-v,r=v,u=0;20>u;u++)o=h+r*m+s*d+a*g+n*f,v+=o,r+=o,n-=o,a+=o,s-=o,o=y+r*_+s*w+a*L+n*x,C+=o,n+=3*o,a-=o+o,s+=o,o=z+r*E+s*S+a*k+n*T,j+=o,n-=3*o,a+=o,o=B+r*P+s*D+a*A+n*I,R+=o,n+=o;e[0]=v,e[1]=C,e[2]=j,e[3]=R}},_pointerBezierValue:{enumerable:!1,value:function(e,t){var n=1-e;return n*n*n*t[0]+3*n*n*e*t[1]+3*n*e*e*t[2]+e*e*e*t[3]}},_calculatePointerVelocity:{enumerable:!1,value:function(e,t){var n,a,s=e.length,r=e[0],i=e[0],o=0;for(a=1;s>a;a++)r>e[a]&&(r=e[a],o=a);if(n=i-r){if(s>5){var l,c,p,u=[];for(a=0;s>a;a++)u[a]={v:t[a],t:(e[a]-r)/n};return l=u[o].v,c=u[0].v,p=[l,(2*l+c)/3,(l+2*c)/3,c],this._fitPointerCurve(p,u),5e3*(this._pointerBezierValue(.8,p)-this._pointerBezierValue(.6,p))/n}return s>1?1e3*(t[0]-t[o])/n:0}return 0}},pointerMotion:{value:function(e){if(n._pointerStorage.isStored(e)){var t={};return Object.defineProperties(t,{_data:{enumerable:!1,writable:!0,value:null},_x:{enumerable:!1,writable:!0,value:null},_y:{enumerable:!1,writable:!0,value:null},_speed:{enumerable:!1,writable:!0,value:null},_angle:{enumerable:!1,writable:!0,value:null},x:{get:function(){return null===this._x&&(null===this._data&&(this._data=n._getPointerVelocityData(e)),this._x=n._calculatePointerVelocity(this._data.time,this._data.x)),this._x},set:function(){}},y:{get:function(){return null===this._y&&(null===this._data&&(this._data=n._getPointerVelocityData(e)),this._y=n._calculatePointerVelocity(this._data.time,this._data.y)),this._y},set:function(){}},speed:{get:function(){return null===this._speed&&(this._speed=Math.sqrt(this.x*this.x+this.y*this.y)),this._speed},set:function(){}},angle:{get:function(){return null===this._angle&&(this._angle=Math.atan2(this.y,this.x)),this._angle},set:function(){}}}),{velocity:t}}return void 0}},monitorDOMModificationInEventHandling:{value:!1},domModificationEventHandler:{value:a.specialize({handleEvent:{value:function(){throw"DOM Modified"}},captureDOMSubtreeModified:{value:function(){throw"DOMSubtreeModified"}},captureDOMAttrModified:{value:function(){throw"DOMAttrModified"}},captureDOMCharacterDataModified:{value:function(){throw"DOMCharacterDataModified"}}})},handleEvent:{enumerable:!1,value:function(e){this.monitorDOMModificationInEventHandling&&(document.body.addEventListener("DOMSubtreeModified",this.domModificationEventHandler,!0),document.body.addEventListener("DOMAttrModified",this.domModificationEventHandler,!0),document.body.addEventListener("DOMCharacterDataModified",this.domModificationEventHandler,!0));var t,n,a,s,i,o,d,m,g,f,v,b,y,w,_=e.type,L=e.bubbles;for("DOMContentLoaded"===_&&(t=e.target.defaultView,t&&this._windowsAwaitingFinalRegistration[t.uuid]&&(this._finalizeWindowRegistration(t),e.target.removeEventListener("DOMContentLoaded",this,!0))),w="boolean"!=typeof e.propagationStopped?r.fromEvent(e):e,g=Element.isElement(w.target)||w.target instanceof Document||w.target instanceof Window?this._eventPathForDomTarget(w.target):this._eventPathForTarget(w.target),b=w.target.identifier?this.methodNameForCapturePhaseOfEventType(_,w.target.identifier):null,y=w.target.identifier?this.methodNameForBubblePhaseOfEventType(_,w.target.identifier):null,f=this.methodNameForCapturePhaseOfEventType(_),v=this.methodNameForBubblePhaseOfEventType(_),this.delegate&&typeof this.delegate.willDistributeEvent===h&&this.delegate.willDistributeEvent(w),this._isStoringPointerEvents&&this._pointerStorage.storeEvent(w),w.eventPhase=c,n=g.length-1;!w.propagationStopped&&(a=g[n]);n--)if(w.currentTarget=a,s=this.registeredEventListenersForEventType_onTarget_(_,a))for(d=Object.keys(s),i=0;s&&!w.immediatePropagationStopped&&(o=s[d[i]]);i++)o.capture&&(m=o.listener,b&&typeof m[b]===h?m[b](w):typeof m[f]===h?m[f](w):typeof m.handleEvent===h?m.handleEvent(w):typeof m!==h||m.__isConstructor__||m.call(a,w));if(!w.propagationStopped&&(w.eventPhase=p,w.currentTarget=a=w.target,s=this.registeredEventListenersForEventType_onTarget_(_,a)))for(d=Object.keys(s),i=0;s&&!w.immediatePropagationStopped&&(o=s[d[i]]);i++)m=o.listener,o.capture&&(b&&typeof m[b]===h?m[b](w):typeof m[f]===h?m[f](w):typeof m.handleEvent===h?m.handleEvent(w):typeof m===h&&m.call(a,w)),o.bubble&&(y&&typeof m[y]===h?m[y](w):typeof m[v]===h?m[v](w):typeof m.handleEvent===h?m.handleEvent(w):typeof m===h&&m.call(a,w));for(w.eventPhase=u,n=0;L&&!w.propagationStopped&&(a=g[n]);n++)if(w.currentTarget=a,s=this.registeredEventListenersForEventType_onTarget_(_,a))for(d=Object.keys(s),i=0;s&&!w.immediatePropagationStopped&&(o=s[d[i]]);i++)o.bubble&&(m=o.listener,y&&typeof m[y]===h?m[y](w):typeof m[v]===h?m[v](w):typeof m.handleEvent===h?m.handleEvent(w):typeof m===h&&m.call(a,w));w.eventPhase=l,w.currentTarget=null,this._isStoringPointerEvents&&this._pointerStorage.removeEvent(e),this.monitorDOMModificationInEventHandling&&(document.body.removeEventListener("DOMSubtreeModified",this.domModificationEventHandler,!0),document.body.removeEventListener("DOMAttrModified",this.domModificationEventHandler,!0),document.body.removeEventListener("DOMCharacterDataModified",this.domModificationEventHandler,!0))}},_prepareComponentsForActivation:{value:function(e){var t,n,a=e,s=a&&a.defaultView?a.defaultView:window,r=s.document?s.document:document,i=!1,o=null;do switch(a&&(n=this.eventHandlerForElement(a),n&&(i||(i=!0,o=this._findActiveTarget(n)),n._preparedForActivationEvents||(n._prepareForActivationEvents(),n._preparedForActivationEvents=!0))),t=a,a){case s:a=null;break;case r:a=s;break;case r.documentElement:a=r;break;default:a=a.parentNode}while(a&&t!==a);o=o||this.application,o!==this.activeTarget&&(this.activeTarget&&this.activeTarget.willSurrenderActiveTarget(o),o.willBecomeActiveTarget(this.activeTarget),this.activeTarget=o,o.didBecomeActiveTarget())}},_findActiveTarget:{value:function(e){for(var t=null,n={};!t&&e&&!(e.uuid in n);)n[e.uuid]=e,e.acceptsActiveTarget?t=e:e=e.nextTarget;return t}},_eventPathForTarget:{enumerable:!1,value:function(e){if(!e)return[];var t=e,n=this.application,a=[],s={};s[e.uuid]=e;do t.uuid in s||(a.push(t),s[t.uuid]=t),t=t.nextTarget,(!t||t.uuid in s)&&(t=n),t&&t.uuid in s&&(t=null);while(t);return a}},_eventPathForDomTarget:{enumerable:!1,value:function(e){if(!e)return[];var t,n=e,a=n&&n.defaultView?n.defaultView:window,s=a.document?a.document:document,r=this.application,i=[];do switch(n!==e&&i.push(n),t=n,n){case r:n=n.parentApplication,n&&(r=n);break;case a:n=r;break;case s:n=a;break;case s.documentElement:n=s;break;default:n=n.parentNode,n||(n=r)}while(n&&t!==n);return i}},_elementEventHandlerByUUID:{enumerable:!1,value:{}},registerEventHandlerForElement:{enumerable:!1,value:function(e,t){var n=this.eventHandlerForElement(t);n&&this.unregisterEventHandlerForElement(t),this._elementEventHandlerByUUID[t.eventHandlerUUID=e.uuid]=e}},unregisterEventHandlerForElement:{enumerable:!1,value:function(e){delete this._elementEventHandlerByUUID[e.eventHandlerUUID],delete e.eventHandlerUUID}},eventHandlerForElement:{enumerable:!1,value:function(e){return this._elementEventHandlerByUUID[e.eventHandlerUUID]}},_activeTarget:{value:null},activeTarget:{get:function(){return this._activeTarget||this.application},set:function(e){e!==this._activeTarget&&(this._activeTarget=e)}}})}}}),montageDefine("b8d1a32","core/serialization/deserializer/montage-reviver",{dependencies:["core/core","mousse/deserialization/reviver","./properties-deserializer","./self-deserializer","./unit-deserializer","core/promise"],factory:function(e,t){var n=e("core/core").Montage,a=e("mousse/deserialization/reviver").Reviver,s=e("./properties-deserializer").PropertiesDeserializer,r=e("./self-deserializer").SelfDeserializer,i=e("./unit-deserializer").UnitDeserializer,o=e("core/promise").Promise,l=n.specialize({_require:{value:null},_objectRequires:{value:null},init:{value:function(e,t){if("function"!=typeof e)throw Error("Function 'require' missing.");if("string"!=typeof e.location)throw Error("Function 'require' location is missing");if("object"!=typeof t&&void 0!==t)throw Error("Parameter 'objectRequires' should be an object.");return this._require=e,this._objectRequires=t,this}},getExports:{value:function(e,t){var n;for(t=e.resolve(t),n=e.getModuleDescriptor(t);void 0!==n.redirect;)n=e.getModuleDescriptor(n.redirect);return void 0!==n.mappingRedirect?this.getExports(n.mappingRequire,n.mappingRedirect):n.exports}},getModule:{value:function(e,t){var n,a,s=this._objectRequires;return n=s&&t in s?s[t]:this._require,a=this.getExports(n,e),a||(a=n.async(e)),a}}}),c=t.MontageReviver=n.specialize.call(a,{moduleLoader:{value:null},init:{value:function(e,t){return this.moduleLoader=(new l).init(e,t),this}},getTypeOf:{value:function(e){return null!==e&&"object"==typeof e&&1===Object.keys(e).length&&"#"in e?"Element":a.prototype.getTypeOf.call(this,e)}},reviveElement:{value:function(e,t,n){var a=e["#"],s=t.getElementById(a);return s?(n&&t.setObjectLabel(s,n),s):o.reject(Error("Element with id '"+a+"' was not found."))}},reviveCustomObject:{value:function(e,t,n){return this.reviveMontageObject(e,t,n)}},reviveMontageObject:{value:function(e,t,n){var a,s,r,i=this,l=e.prototype||e.object;return l&&(s=c.parseObjectLocationId(l),a=this.moduleLoader.getModule(s.moduleId,n),r=s.objectName),o.isPromise(a)?a.then(function(a){return i.instantiateMontageObject(e,a,r,t,n)},function(t){throw t.stack&&console.error(t.stack),Error('Error deserializing "'+n+'" when loading module "'+s.moduleId+"' from '"+e.prototype+"'")}):this.instantiateMontageObject(e,a,r,t,n)}},instantiateMontageObject:{value:function(e,t,n,a,s){var r,i,l=this;return r=this.getMontageObject(e,t,n,a,s),a.setObjectLabel(r,s),r.isDeserializing=!0,i=this.reviveObjectLiteral(e,a),o.isPromise(i)?i.then(function(e){return l.deserializeMontageObject(e,r,a,s)}):this.deserializeMontageObject(i,r,a,s)}},deserializeMontageObject:{value:function(e,t,n,a){var s;return"function"==typeof t.deserializeSelf?this.deserializeCustomMontageObject(t,e,n,a):(n.setUnitsToDeserialize(t,e,c._unitNames),s=this.deserializeMontageObjectProperties(t,e.properties,n),o.isPromise(s)?s.then(function(){return t}):t)}},deserializeMontageObjectProperties:{value:function(e,t,n){var a;if("function"==typeof e.deserializeProperties){var r=(new s).initWithReviverAndObjects(this,n);a=e.deserializeProperties(r)}else for(var i in t)e[i]=t[i];return a}},deserializeCustomMontageObject:{value:function(e,t,n,a){var s,i=(new r).initWithObjectAndObjectDescriptorAndContextAndUnitNames(e,t,n,c._unitNames);return s=e.deserializeSelf(i),o.isPromise(s)?s.then(function(e){return n.setObjectLabel(e,a),e}):void 0!==s?(n.setObjectLabel(s,a),s):e}},getMontageObject:{value:function(e,t,n,a,s){var r;if(a.hasUserObject(s))return a.getUserObject(s);if("prototype"in e){if(!(n in t))throw Error('Error deserializing "'+s+'": object named "'+n+'"'+' was not found in "'+e.prototype+'".'+" Available objects are: "+Object.keys(t)+".");return r=Object.create(t[n].prototype),r.isDeserializing=!0,"function"==typeof r.didCreate?r.didCreate():"function"==typeof r.constructor&&r.constructor(),r}if("object"in e){if(!(n in t))throw Error('Error deserializing "'+s+'": object named "'+r+"' was not found given '"+e.object+"'");return t[n]}throw Error("Error deserializing "+JSON.stringify(e)+', might need "prototype" or "object" on label '+JSON.stringify(s))}},didReviveObjects:{value:function(e,t){var n,a=this;return n=this._deserializeUnits(t),o.isPromise(n)?n.then(function(){a._invokeDeserializedFromSerialization(e,t)}):(this._invokeDeserializedFromSerialization(e,t),void 0)}},_invokeDeserializedFromSerialization:{value:function(e,t){var n;for(var a in e)n=e[a],null!=n&&delete n.isDeserializing,t.hasUserObject(a)||n&&"function"==typeof n.deserializedFromSerialization&&n.deserializedFromSerialization(a)}},_deserializeUnits:{value:function(e){for(var t,t,n=e.getUnitsToDeserialize(),a=c._unitRevivers,s=0;t=n[s];s++)for(var r,o=t.unitNames,l=0;r=o[l];l++){var p=(new i).initWithContext(e);r in t.objectDesc&&a[r](p,t.object,t.objectDesc[r])}}}},{_unitRevivers:{value:Object.create(null)},_unitNames:{value:[]},_findObjectNameRegExp:{value:/([^\/]+?)(\.reel)?$/},_toCamelCaseRegExp:{value:/(?:^|-)([^-])/g},_replaceToCamelCase:{value:function(e,t){return t.toUpperCase()}},_locationDescCache:{value:Object.create(null)},parseObjectLocationId:{value:function(e){var t,n,a,s,r=this._locationDescCache;return e in r?t=r[e]:(n=e.indexOf("["),n>0?(a=e.substr(0,n),s=e.slice(n+1,-1)):(a=e,this._findObjectNameRegExp.test(e),s=RegExp.$1.replace(this._toCamelCaseRegExp,this._replaceToCamelCase)),t={moduleId:a,objectName:s},r[e]=t),t}},defineUnitReviver:{value:function(e,t){this._unitRevivers[e]=t,this._unitNames.push(e)}},getTypeOf:{value:function(e){return this.prototype.getTypeOf.call(this,e)}}});void 0!==t&&(t.MontageReviver=c)}}),montageDefine("b8d1a32","core/logger",{dependencies:["montage"],factory:function(e,t){var n,a,s,r,i,o,l,c,p,u=e("montage").Montage;a=t.loggers={},o=function(){var e,t=o.caller.caller;return e=t.name,""===e&&(e="anonymous"),e},l=function(e){if(e.getHours){var t=e.getHours(),n=e.getMinutes(),a=e.getSeconds();return(1===t.length?"0"+t:t)+":"+(1===n.length?"0"+n:n)+":"+(1===a.length?"0"+a:a)+"."+e.getMilliseconds()}},i=function(){},s=function(){console.log(arguments)},r=function(){var e=arguments[0],t=e._montage_metadata;new Date,t?([].shift.call(arguments),[].unshift.call(arguments,t.objectName+"."+o(e)+"()"),this.buffered?this.buffer.push(arguments):console.debug.apply(console,arguments)):this.buffered?this.buffer.push(arguments):console.debug.apply(console,arguments)},n=t.Logger=u.specialize({init:{value:function(e,t,n){if(this.name=e,this._onStateChange=t,this._storeState=!n,this._storeState&&p){var a=p.getItem("_montage_logger_"+e);a&&(this.isDebug="true"===a)}return t&&this._onStateChange("true"===a),this.isError=!0,this}},name:{value:null},buffer:{value:[],distinct:!0},buffered:{value:!1},flush:{value:function(){var e,t,n=this.buffer;for(t=0;e=n[t];t++)console.debug.apply(console,e);this.buffer.length=0}},isDebug:{get:function(){return this.debug!==i},set:function(e){this.debug=e?r:i}},isError:{get:function(){return this.error!==i},set:function(e){this.error=e?r:i}},debug:{value:i},error:{value:i},toTimeString:{value:l},_storeState:{value:null},_onStateChange:{value:null}}),t.logger=function(e,t,s){var r;return null==(r=a[e])&&(r=(new n).init(e,t,s),u.defineProperty(a,e,{value:r})),r},c=u.specialize({init:{value:function(){return document.nativeAddEventListener?(document.nativeAddEventListener("keyup",this,!1),document.nativeAddEventListener("keydown",this,!1)):(document.addEventListener("keyup",this,!1),document.addEventListener("keydown",this,!1)),this}},inspectorElement:{value:null},m_dontRemove:{value:null},titleHeader:{value:null},shown:{value:!1},isCtrl:{value:!1},isAlt:{value:!1},keyup:{value:function(e){17==e.which&&(this.isCtrl=!1),18==e.which&&(this.isAlt=!1)}},keydown:{value:function(e){return 17==e.which&&(this.isCtrl=!0),18==e.which&&(this.isAlt=!0),76==e.which&&this.isCtrl===!0&&this.isAlt===!0?(this.shown?this.hideInspector():this.showInspector(),!1):void 0}},change:{value:function(e){var t=e.target.checked,n=e.target.value,s=a[n];s.isDebug=t,s._onStateChange&&s._onStateChange(t),s._storeState&&p&&p.setItem("_montage_logger_"+n,t)}},mouseup:{value:function(){this.hideInspector()}},showInspector:{value:function(){if(!this.inspectorElement){var e,t,n,s,r,i,o,l,c,u,h,d=0;for(this.m_dontRemove=document.getElementsByTagName("body")[0],this.inspectorElement=document.createElement("div"),this.inspectorElement.id="_montage_logger_inspector",t=document.createElement("div"),this.inspectorElement.appendChild(t),s=document.createElement("div"),t.appendChild(s),n=document.createElement("h1"),n.className="_montage_logger_inspector-title",n.textContent="Logger Inspector",this.titleHeader=n,s.appendChild(n),c=Object.keys(a),d=0;e=a[c[d]];d++)r=document.createElement("label"),i=document.createElement("input"),h=document.createElement("span"),r.className="_montage_logger_inspector-content",h.textContent=e.name,r.appendChild(i),r.appendChild(h),i.value=e.name,i.type="checkbox",i.checked=!!e.isDebug,l="_montage_logger_"+e.name,e._storeState&&p&&(o=p.getItem(l),null==o&&p.setItem(l,e.isDebug)),s.appendChild(r);u=document.createElement("style");var m="#_montage_logger_inspector {";m+="    border: 1px solid rgba(15,15,15,0.4);",m+="    position: fixed;",m+="    right: 25px;",m+="    top: 25px;",m+="    -webkit-border-radius: 5px;",m+="    color: #dddddd;",m+='    font: 10px "Lucida Grande","Lucida Sans", sans;',m+="    background:-webkit-gradient(linear, left top, left bottom, from(rgba(15,15,15,0.75)), to(rgba(15,15,15,0.95)) );",m+="    -webkit-box-shadow: 0 0 15px rgba(0,0,0,.3);",m+="    width: 250px;",m+="}",m+="#_montage_logger_inspector div {",m+="    -webkit-border-radius: 5px;",m+="    background: -webkit-gradient(radial, 100 -60, 0, 125 -50, 125, from(rgba(255,255,255,0.00)), to(rgba(0,0,0,.2)), color-stop(1, rgba(0,0,0,.2)));",m+="}",m+="#_montage_logger_inspector div div {",m+="    background: -webkit-gradient(linear, left top, left bottom, from(rgba(255,255,255,0.2)), to(rgba(0,0,0,.1)), color-stop(0.33, rgba(255,255,255,.01)), color-stop(0.33, rgba(50,50,50,1)) );",m+="    padding: 7px 10px;",m+="    -webkit-border-radius: 3px;",m+="    overflow-x: hidden;",m+="}",m+="._montage_logger_inspector-title {",m+="    color: rgba(255,255,255,0.9);",m+="    font-size: 13px;",m+="    margin: 0 0 11px 0;",m+="    padding: 0 0 0 5px;",m+="}",m+="._montage_logger_inspector-content {",m+="    padding: 0 0 0 20px;",m+="    margin: 0;",m+="    display: block;",m+="}",u.textContent=m,document.head.appendChild(u)}this.shown=!0,this.m_dontRemove.appendChild(this.inspectorElement),this.titleHeader.nativeAddEventListener("mouseup",this,!1),this.inspectorElement.nativeAddEventListener("change",this,!1)}},hideInspector:{value:function(){document.getElementById("_montage_logger_inspector")&&(this.shown=!1,this.m_dontRemove.removeChild(this.inspectorElement),this.titleHeader.nativeRemoveEventListener("mouseup",this,!1),this.inspectorElement.nativeRemoveEventListener("change",this,!1))}},handleEvent:{enumerable:!1,value:function(e){this[e.type]&&this[e.type](e)}}});var h=function(){(new c).init()};"undefined"!=typeof window&&(p=window.localStorage,window.loggers=a,window.localStorage&&h())}}),montageDefine("b8d1a32","core/shim/object",{dependencies:[],factory:function(){Object.create||(Object._creator=function e(){this.__proto__=e.prototype},Object.create=function(e){return this._creator.prototype=e||Object.prototype,new this._creator},Object.getPrototypeOf=function(e){return e.__proto__}),Object.isSealed||Object.defineProperty(Object,"isSealed",{value:function(){return!1},writable:!0,configurable:!0}),Object.seal||Object.defineProperty(Object,"seal",{value:function(e){return e},writable:!0,configurable:!0})}}),montageDefine("b8d1a32","core/shim/array",{dependencies:[],factory:function(){Array.isArray||Object.defineProperty(Array,"isArray",{value:function(e){return"[object Array]"===Object.prototype.toString.call(e)},writable:!0,configurable:!0})}}),montageDefine("b8d1a32","core/shim/string",{dependencies:[],factory:function(){String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e){return this.length>=e.length&&this.slice(0,e.length)===e},writable:!0,configurable:!0}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e){return this.length>=e.length&&this.slice(this.length-e.length,this.length)===e},writable:!0,configurable:!0})}}),montageDefine("b8d1a32","core/extras/object",{dependencies:["core/core","collections/weak-map","frb"],factory:function(e){e("core/core"),e("collections/weak-map"),Object.defineProperty(Object,"getPropertyDescriptor",{value:function(e,t){var n,a=e;do n=Object.getOwnPropertyDescriptor(a,t);while(!n&&(a=a.__proto__||Object.getPrototypeOf(a)));return n},writable:!0,configurable:!0}),Object.defineProperty(Object,"getPrototypeAndDescriptorDefiningProperty",{value:function(e,t){var n,a=e;if(t){do n=Object.getOwnPropertyDescriptor(a,t);while(!n&&(a=a.__proto__||Object.getPrototypeOf(a)));return{prototype:a,propertyDescriptor:n}}},writable:!0,configurable:!0}),Object.defineProperty(Object.prototype,"clear",{value:function(){for(var e=Object.keys(this),t=e.length;t;)t--,delete this[e[t]];return this},writable:!0,configurable:!0}),Object.defineProperty(Object,"defineBinding",{value:function(t,n,a){var s=Error.stackTraceLimit;Error.stackTraceLimit=2,console.warn("Object.defineBinding deprecated.  See the comment below this warning for migration instructions.",Error("deprecated").stack),Error.stackTraceLimit=s;var r=e("frb");a.source=a.boundObject,a.oneway?a["<-"]=a.boundObjectPropertyPath:a["<->"]=a.boundObjectPropertyPath,a.boundValueMutator&&(a.convert=a.boundValueMutator),r.defineBinding(t,n,a)}}),Object.defineProperty(Object,"deleteBinding",{value:function(t,n){var a=e("frb");a.cancelBinding(t,n)}})}}),montageDefine("b8d1a32","core/extras/date",{dependencies:[],factory:function(){Object.defineProperty(Date.prototype,"clone",{value:function(){return new Date(this)},writable:!0,configurable:!0})}}),montageDefine("b8d1a32","core/extras/element",{dependencies:[],factory:function(){Element&&!Element.isElement&&Object.defineProperty(Element,"isElement",{value:function(e){return!(!e||1!==e.nodeType)},writable:!0,configurable:!0})}}),montageDefine("b8d1a32","core/extras/function",{dependencies:["./object"],factory:function(e){e("./object"),Object.defineProperty(Function,"identity",{value:function(e){return e},writable:!0,configurable:!0}),Object.defineProperty(Function,"noop",{value:function(){},writable:!0,configurable:!0}),Object.defineProperty(Function,"by",{value:function(e,t){t=t||Object.compare,e=e||Function.identity;var n=function(n,a){return t(e(n),e(a))};return n.compare=t,n.by=e,n},writable:!0,configurable:!0})}}),montageDefine("b8d1a32","core/extras/regexp",{dependencies:[],factory:function(){if(!RegExp.isRegExp){var e=Object.prototype.toString;Object.defineProperty(RegExp,"isRegExp",{value:function(t){return"[object RegExp]"===e.call(t)},writable:!0,configurable:!0})}}}),montageDefine("b8d1a32","core/extras/string",{dependencies:[],factory:function(){Object.defineProperty(String.prototype,"equals",{value:function(e){return this.valueOf()===Object.getValueOf(e)},writable:!0,configurable:!0}),Object.defineProperty(String.prototype,"contains",{value:function(e){return-1!==this.indexOf(e)},writable:!0,configurable:!0}),Object.defineProperty(String.prototype,"toCapitalized",{value:function(){return this.charAt(0).toUpperCase()+this.slice(1)},writable:!0,configurable:!0}),Object.defineProperty(String.prototype,"addEventListener",{value:Function.noop,writable:!0,configurable:!0})}}),montageDefine("b8d1a32","core/uuid",{dependencies:[],factory:function(e,t){function n(){var e,t=a,n=s;return n[0]=t[15&(e=4294967296*Math.random())],n[1]=t[15&(e>>>=4)],n[2]=t[15&(e>>>=4)],n[3]=t[15&(e>>>=4)],n[4]=t[15&(e>>>=4)],n[5]=t[15&(e>>>=4)],n[6]=t[15&(e>>>=4)],n[7]=t[15&(e>>>=4)],n[9]=t[15&(e=4294967296*Math.random())],n[10]=t[15&(e>>>=4)],n[11]=t[15&(e>>>=4)],n[12]=t[15&(e>>>=4)],n[15]=t[15&(e>>>=4)],n[16]=t[15&(e>>>=4)],n[17]=t[15&(e>>>=4)],n[19]=t[8|3&(e=4294967296*Math.random())],n[20]=t[15&(e>>>=4)],n[21]=t[15&(e>>>=4)],n[22]=t[15&(e>>>=4)],n[24]=t[15&(e>>>=4)],n[25]=t[15&(e>>>=4)],n[26]=t[15&(e>>>=4)],n[27]=t[15&(e>>>=4)],n[28]=t[15&(e=4294967296*Math.random())],n[29]=t[15&(e>>>=4)],n[30]=t[15&(e>>>=4)],n[31]=t[15&(e>>>=4)],n[32]=t[15&(e>>>=4)],n[33]=t[15&(e>>>=4)],n[34]=t[15&(e>>>=4)],n[35]=t[15&(e>>>=4)],n.join("")}var a="0123456789ABCDEF".split(""),s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".split("");t.Uuid=Object.create(Object.prototype,{generate:{enumerable:!1,value:n}}),t.generate=n}}),montageDefine("b8d1a32","core/bindings",{dependencies:["core/core","frb"],factory:function(e,t){var n=e("core/core").Montage,a=t.Bindings=e("frb"),s={defineBinding:{value:function(e,t,n){return a.defineBinding(this,e,t,n)}},defineBindings:{value:function(e,t){return a.defineBindings(this,e,t)}},cancelBinding:{value:function(e){return a.cancelBinding(this,e)}},cancelBindings:{value:function(){return a.cancelBindings(this)}},getBinding:{value:function(e){return a.getBinding(this,e)}},getBindings:{value:function(){return a.getBindings(this)}}};n.defineProperties(n,s),n.defineProperties(n.prototype,s)}}),montageDefine("b8d1a32","core/paths",{dependencies:["core/core","collections/weak-map","collections/map","frb/parse","frb/evaluate","frb/assign","frb/observe","frb/bind","frb/compile-observer","frb/scope","frb/observers"],factory:function(e){var t=e("core/core").Montage,n=e("collections/weak-map"),a=e("collections/map"),s=e("frb/parse"),r=e("frb/evaluate"),i=e("frb/assign");e("frb/observe"),e("frb/bind");var o=e("frb/compile-observer"),l=e("frb/scope"),c=e("frb/observers"),p=c.autoCancelPrevious,u=new n,h={getPath:{value:function(e,t){return r(e,this,t)}},setPath:{value:function(e,t,n){return i(this,e,t,n)}},observePath:{value:function(e,t,n,a){var r=s(e),i=o(r);return i(t,this,n,a)}},addRangeAtPathChangeListener:{value:function(e,t,n){function a(e,a,s){if(t[n])t[n](e,a,s);else{if(!t.call)throw Error("Can't dispatch range change to "+t);t.call(null,e,a,s)}}n=n||"handleRangeChange";var s=[];return this.addPathChangeListener(e,function(e){return e=e||[],a(e.slice(),s.slice(),0),s=e,e.addRangeChangeListener(a)})}},getPathChangeDescriptors:{value:function(){return u.has(this)||u.set(this,{}),u.get(this)}},getPathChangeDescriptor:{value:function(e,n,s){var r=t.getPathChangeDescriptors.call(this);return Object.owns(r,e)||(r[e]={willChangeListeners:new a,changeListeners:new a}),r=r[e],r=s?r.willChangeListeners:r.changeListeners,r.has(n)||r.set(n,{path:e,handler:n,beforeChange:s,cancel:Function.noop}),r.get(n)}},addPathChangeListener:{value:function(e,n,a,r){var i=this;n=n||Function.noop;var c=t.getPathChangeDescriptor.call(this,e,n,r);c.cancel();var u,h,d,m=s(e);if(n===Function.noop)d=function(t){if(h)throw Error("Path change handler needs a handler because it emits new values when the source changes: "+JSON.stringify(e));h=!0,u=t};else if(a)d=function(t){return n[a].call(n,t,e,i)};else if(n.handlePathChange)d=function(t){return n.handlePathChange.call(n,t,e,i)};else{if("function"!=typeof n)throw Error("Can't recognize handler type: "+n+". Must be function or delegate implementing handlePathChange.");d=function(t){return n.call(i,t,e,i)}}var g=o(m),f=g(p(d),new l(this));return c.cancel=f,h?u:f}},removePathChangeListener:{value:function(e,n,a){n=n||Function.noop;var s=t.getPathChangeDescriptors.call(this),r=a?"willChangeListeners":"changeListeners";if(!Object.owns(s,e))throw Error("Can't find "+r+" for "+JSON.stringify(e));var i=s[e],o=i[r];if(!o.has(n))throw Error("Can't find "+r+" for "+JSON.stringify(e));var l=o.get(n);l.cancel(),o["delete"](n),0===i.willChangeListeners.length&&0===i.changeListeners.length&&delete s[e];for(var c in s)return;u["delete"](this)}},addBeforePathChangeListener:{value:function(e,n,a){return t.addPathChangeListener.call(this,e,n,a,!0)}},removeBeforePathChangeListener:{value:function(e,n){return t.removePathChangeListener.call(this,e,n,!0)}}};t.defineProperties(t,h),t.defineProperties(t.prototype,h)}}),montageDefine("b8d1a32","core/serialization/bindings",{dependencies:["frb","frb/parse","frb/stringify","frb/expand","frb/scope","core/serialization"],factory:function(e){var t=e("frb"),n=(e("frb/parse"),e("frb/stringify")),a=e("frb/expand"),s=e("frb/scope"),r=e("core/serialization").Serializer,i=e("core/serialization").Deserializer;r.defineSerializationUnit("bindings",function(e,r){var i,o=t.getBindings(r),l={};for(var c in o){var p=o[c],u={};if(!("serializable"in p)||p.serializable){var h=p.sourcePath,d=p.sourceSyntax;if(p.source!==r){var m=e.getObjectLabel(p.source),g=new s({type:"component",label:m});g.components=e,d=a(d,g)}var g=new s;g.components=e,h=n(d,g),p.twoWay?u["<->"]=h:u["<-"]=h,p.converter?u.converter=p.converter:(u.convert=p.convert,u.revert=p.revert),p.trace&&(u.trace=!0),l[c]=u,i=!0}}return i?l:void 0}),i.defineDeserializationUnit("bindings",function(e,n,a){for(var s in a){var r=a[s];if("object"!=typeof r)throw Error("Binding descriptor must be an object, not "+typeof r);"boundObject"in r?(r.source=e.getObjectByLabel(r.boundObject),r.oneway?r["<-"]=r.boundPropertyPath:r["<->"]=r.boundPropertyPath,delete r.boundObject,delete r.boundObjectPropertyPath,delete r.oneway):r["<<->"]&&(console.warn("WARNING: <<-> in bindings is deprectated, use <-> only, please update now."),r["<->"]=r["<<->"],delete r["<<->"])}t.defineBindings(n,a,{components:e})})}}),montageDefine("b8d1a32","core/event/mutable-event",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage;if("undefined"!=typeof window){var a={},s=function(e,t){var a="_"+t;n.defineProperty(e,a,{value:void 0}),n.defineProperty(e,t,{get:function(e,t){return function(){return this.hasOwnProperty(t)?this[t]:this._event?this._event[e]:void 0}}(t,a),set:function(e){return function(t){this[e]=t}}(a)})};t.MutableEvent=n.specialize({_initPrototypeWithEvent:{value:function(e){var t;for(t in e)this[t]||s(this,t);return s(this,"replayed"),this
}},_initWithEvent:{value:function(e){return this._event=e,this}},preventDefault:{value:function(){this._event.preventDefault()}},stopImmediatePropagation:{value:function(){this._event.stopImmediatePropagation(),this.propagationStopped=!0,this.immediatePropagationStopped=!0}},propagationStopped:{value:!1},immediatePropagationStopped:{value:!1},mutable:{value:!0},target:{value:null},stopPropagation:{value:function(){this._event.stopPropagation(),this.propagationStopped=!0}},stop:{value:function(){this.preventDefault(),this.stopPropagation()}}},{fromEvent:{value:function(e){var n,s=e.type,r=a[s];return r||(r=function(){},r.prototype=(new t.MutableEvent)._initPrototypeWithEvent(e),a[s]=r),n=new r,n._initWithEvent(e),n}},fromType:{value:function(e,t,n,a){var s=document.createEvent("CustomEvent");return s.initCustomEvent(e,t,n,a),this.fromEvent(s)}}})}}}),montageDefine("b8d1a32","core/serialization",{dependencies:["./serialization/serializer/montage-serializer","./serialization/deserializer/montage-deserializer"],factory:function(e,t){var n=e("./serialization/serializer/montage-serializer").MontageSerializer,a=e("./serialization/serializer/montage-serializer").serialize,s=e("./serialization/deserializer/montage-deserializer").MontageDeserializer,r=e("./serialization/deserializer/montage-deserializer").deserialize;t.Serializer=n,t.serialize=a,t.Deserializer=s,t.deserialize=r}}),montageDefine("b8d1a32","core/serialization/deserializer/properties-deserializer",{dependencies:["core/core","core/promise"],factory:function(e,t){var n=e("core/core").Montage;e("core/promise").Promise;var a=n.specialize({_object:{value:null},_objectDescriptor:{value:null},_context:{value:null},initWithObjectAndObjectDescriptorAndContext:{value:function(e,t,n){return this._object=e,this._objectDescriptor=t,this._context=n,this}},get:{value:function(e){return this._objectDescriptor.properties?this._objectDescriptor.properties[e]:void 0}},deserializeProperties:{value:function(e){var t,a=this._object,s=this._objectDescriptor.properties;if(s){e||(e=n.getSerializablePropertyNames(a));for(var r=0,i=e.length;i>r;r++)t=e[r],a[t]=s[t]}}},getObjectByLabel:{value:function(e){this._context.getObject(e)}}});t.PropertiesDeserializer=a}}),montageDefine("b8d1a32","core/serialization/deserializer/self-deserializer",{dependencies:["core/core","core/promise"],factory:function(e,t){var n=e("core/core").Montage;e("core/promise").Promise;var a=n.specialize({_object:{value:null},_objectDescriptor:{value:null},_context:{value:null},_unitNames:{value:null},_objectUnitNames:{value:null},create:{value:function(){return new this}},initWithObjectAndObjectDescriptorAndContextAndUnitNames:{value:function(e,t,n,a){return this._object=e,this._objectDescriptor=t,this._context=n,this._unitNames=a,this}},getProperty:{value:function(e){return this._objectDescriptor.properties?this._objectDescriptor.properties[e]:void 0}},getType:{value:function(){return"prototype"in this._objectDescriptor?"prototype":"object"in this._objectDescriptor?"object":void 0}},getTypeValue:{value:function(){return this._objectDescriptor.prototype||this._objectDescriptor.object}},getObjectByLabel:{value:function(e){this._context.getObject(e)}},deserializeProperties:{value:function(e){var t,a=this._object,s=this._objectDescriptor.properties;if(s){e||(e=n.getSerializablePropertyNames(a));for(var r=0,i=e.length;i>r;r++)t=e[r],a[t]=s[t]}}},deserializeUnit:{value:function(e){var t=this._objectUnitNames;t?-1===t.indexOf(e)&&t.push(e):(t=this._objectUnitNames=[e],this._context.setUnitsToDeserialize(this._object,this._objectDescriptor,t))}},deserializeUnits:{value:function(){var e=this._objectUnitNames;if(e)for(var t,n=0;t=e[n];n++)-1===e.indexOf(t)&&e.push(t);else e=this._objectUnitNames=this._unitNames,this._context.setUnitsToDeserialize(this._object,this._objectDescriptor,e)}}});t.SelfDeserializer=a}}),montageDefine("b8d1a32","core/serialization/deserializer/unit-deserializer",{dependencies:["core/core","core/promise"],factory:function(e,t){var n=e("core/core").Montage,a=e("core/promise").Promise,s=n.specialize({_context:{value:null},create:{value:function(){return new this}},initWithContext:{value:function(e){return this._context=e,this}},getObjectByLabel:{value:function(e){var t=this._context.getObject(e);return a.isPromise(t)?void 0:t}}});t.UnitDeserializer=s}}),montageDefine("b8d1a32","core/serialization/serializer/montage-serializer",{dependencies:["core/core","mousse/serialization/malker","mousse/serialization/serializer","./montage-builder","./montage-labeler","./montage-visitor","core/logger"],factory:function(e,t){var n=e("core/core").Montage,a=e("mousse/serialization/malker").Malker,s=e("mousse/serialization/serializer").Serializer,r=e("./montage-builder").MontageBuilder,i=e("./montage-labeler").MontageLabeler,o=e("./montage-visitor").MontageVisitor;e("core/logger").logger("montage-serializer");var l=n.specialize.call(s,{_require:{value:null},_visitor:{value:null},_units:{value:Object.create(null)},_findObjectNameRegExp:{value:/([^\/]+?)(\.reel)?$/},_toCamelCaseRegExp:{value:/(?:^|-)([^-])/g},_replaceToCamelCase:{value:function(e,t){return t.toUpperCase()}},constructor:{value:function l(){}},initWithRequire:{value:function(e){return this._require=e,this._builder=new r,this._labeler=new i,this._visitor=(new o).initWithBuilderAndLabelerAndRequireAndUnits(this._builder,this._labeler,this._require,this._units),this._malker=new a(this._visitor),this}},getExternalObjects:{value:function(){return this._visitor.getExternalObjects()}},getExternalElements:{value:function(){return this._visitor.getExternalElements()}},defineSerializationUnit:{value:function(e,t){this.constructor.defineSerializationUnit.call(this,e,t)}}},{defineSerializationUnit:{value:function(e,t){this._units[e]=t}},getDefaultObjectNameForModuleId:{value:function(e){return this._findObjectNameRegExp.test(e),RegExp.$1.replace(this._toCamelCaseRegExp,this._replaceToCamelCase)}}});t.MontageSerializer=l,t.serialize=function(e,t){return(new l).initWithRequire(t).serializeObject(e)}}}),montageDefine("b8d1a32","core/serialization/deserializer/montage-deserializer",{dependencies:["core/core","mousse/deserialization/interpreter","mousse/deserialization/deserializer","./montage-interpreter","./montage-reviver","core/promise","core/jshint","core/logger"],factory:function(e,t){var n=e("core/core").Montage;e("mousse/deserialization/interpreter").Interpreter;var a=e("mousse/deserialization/deserializer").Deserializer,s=e("./montage-interpreter").MontageInterpreter,r=e("./montage-reviver").MontageReviver,i=e("core/promise").Promise,o=e("core/jshint").JSHINT;e("core/logger").logger("montage-deserializer");var l=n.specialize.call(a,{_interpreter:{value:null},_serializationString:{value:null},_serialization:{value:null},init:{value:function(e,t,n){if(!this.isSerializationStringValid(e))throw Error(this._formatSerializationSyntaxError(e));return a.call(this,e),this._origin,this._serialization=null,this._interpreter=(new s).init(t,n),this}},serialization:{get:function(){var e=this._serialization;return e||(e=JSON.parse(this._serializationString),this._serialization=e),e}},deserialize:{value:function(e,t){var n;try{n=JSON.parse(this._serializationString)}catch(a){return i.reject(a)}return this._interpreter.instantiate(n,e,t)}},preloadModules:{value:function(){var e=JSON.parse(this._serializationString);return this._interpreter.preloadModules(e)}},getExternalObjectLabels:{value:function(){var e=this.serialization,t=[];for(var n in e)0===Object.keys(e[n]).length&&t.push(n);return t}},isSerializationStringValid:{value:function(e){try{return JSON.parse(e),!0}catch(t){return!1}}},_formatSerializationSyntaxError:{value:function(e){var t,n,a,s,r,i="   ",l=this._origin;if(o(e))t="Syntax error in the serialization but not able to find it!\n"+e;else{n=o.errors[0],a=e.split("\n"),s=(i+a.length).length,r=n.line-1;for(var c=0,p=a.length;p>c;c++)a[c]=Array(s-(c+1+"").length+1).join(c===r?">":" ")+(c+1)+" "+a[c];t="Syntax error at line "+n.line+(l?" from "+l:"")+":\n"+n.evidence+"\n"+n.reason+"\n"+a.join("\n")}return t}}},{defineDeserializationUnit:{value:function(e,t){r.defineUnitReviver(e,t)}}});t.MontageDeserializer=l,t.deserialize=function(e,t){return(new l).init(e,t).deserializeObject()}}}),montageDefine("b8d1a32","core/serialization/serializer/montage-builder",{dependencies:["montage","mousse/serialization/builder","./montage-ast"],factory:function(e,t){var n=e("montage").Montage,a=e("mousse/serialization/builder").Builder,s=e("./montage-ast"),r=n.specialize.call(a,{constructor:{value:function r(){a.call(this)}},createElementReference:{value:function(e){return(new s.ElementReference).initWithRootAndId(this._root,e)}}});t.MontageBuilder=r}}),montageDefine("b8d1a32","core/serialization/serializer/montage-labeler",{dependencies:["montage","mousse/serialization/labeler"],factory:function(e,t){var n=e("montage").Montage,a=e("mousse/serialization/labeler").Labeler;t.MontageLabeler=n.specialize.call(a,{_labelRegexp:{value:/^[a-zA-Z_$][0-9a-zA-Z_$]*$/},constructor:{value:function(){a.call(this)}},getObjectName:{value:function(e){var t,s=e.identifier;return s&&this._labelRegexp.test(s)?t=e.identifier:"getInfoForObject"in e||"getInfoForObject"in e.constructor?(t=n.getInfoForObject(e).objectName,t=t.toLowerCase()):t=a.prototype.getObjectName.call(this,e),t}}})}}),montageDefine("b8d1a32","core/serialization/serializer/montage-visitor",{dependencies:["montage","./montage-serializer","./properties-serializer","./self-serializer","./unit-serializer","mousse/serialization/visitor"],factory:function(e,t){var n=e("montage").Montage,a=e("./montage-serializer"),s=e("./properties-serializer").PropertiesSerializer,r=e("./self-serializer").SelfSerializer,i=e("./unit-serializer").UnitSerializer,o=e("mousse/serialization/visitor").Visitor,l=n.specialize.call(o,{_MONTAGE_ID_ATTRIBUTE:{value:"data-montage-id"},_require:{value:null},_units:{value:null},_elements:{value:null},constructor:{value:function l(){}},initWithBuilderAndLabelerAndRequireAndUnits:{value:function(e,t,n,a){return o.call(this,e,t),this._require=n,this._units=a,this._elements=[],this}},getTypeOf:{value:function(e){return"getInfoForObject"in e||"getInfoForObject"in e.constructor?"MontageObject":e.thisIsAReferenceCreatedByMontageSerializer?"MontageReference":"undefined"!=typeof Element&&Element.isElement(e)?"Element":void 0}},visitMontageReference:{value:function(e,t,n){this.builder.top.setProperty(n,t.reference)}},visitElement:{value:function(e,t,n){var a,s;if(s=t.getAttribute(this._MONTAGE_ID_ATTRIBUTE),!s)throw Error("Not possible to serialize a DOM element with no "+this._MONTAGE_ID_ATTRIBUTE+" assigned: "+t.outerHTML);a=this.builder.createElementReference(s),this.storeValue(a,t,n),this._elements.push(t)}},visitMontageObject:{value:function(e,t,n){this.isObjectSerialized(t)?this.serializeReferenceToMontageObject(e,t,n):this.handleMontageObject(e,t,n)}},handleMontageObject:{value:function(e,t,n){var a,s=this.builder.createCustomObject();this.setObjectSerialization(t,s),a=this.serializeMontageObject(e,t,s),a?this.serializeSubstituteObject(e,t,n,s,a):(s.setLabel(this.labeler.getObjectLabel(t)),this.builder.top.setProperty(n,s))}},serializeReferenceToMontageObject:{value:function(e,t,n){var a=this.labeler.getObjectLabel(t),s=this.builder.createObjectReference(a);this.builder.top.setProperty(n,s)}},serializeSubstituteObject:{value:function(e,t,n,a,s){var r,i,o,l;r=this.labeler.getObjectLabel(t),this.labeler.isUserDefinedLabel(r)?(i=this.labeler.getObjectLabel(s),this.labeler.setObjectLabel(s,r),this.builder.relabelReferences(i,r),l=this.getObjectSerialization(s),l&&(l.setLabel(r),this.labeler.isUserDefinedLabel(i)&&this.builder.createObjectReference(r).setLabel(i)),e.visit(s,n)):(e.visit(s,n),o=this.labeler.getObjectLabel(s),this.labeler.setObjectLabel(t,o),this.builder.relabelReferences(r,o))}},serializeMontageObject:{value:function(e,t,n){var a,s,i=this.builder.createObjectLiteral();return this.setObjectType(t,n),n.setProperty("properties",i),this.builder.push(n),"function"==typeof t.serializeSelf?(a=(new r).initWithMalkerAndVisitorAndObject(e,this,t,n),s=t.serializeSelf(a)):(this.setObjectProperties(e,t),this.setObjectCustomUnits(e,t)),this.builder.pop(),0===i.getPropertyNames().length&&n.clearProperty("properties"),s}},setObjectType:{value:function(e,t){var a=n.getInfoForObject(e).isInstance,s=this.getObjectLocationId(e),r=this.builder.createString(s);a?t.setProperty("prototype",r):t.setProperty("object",r)}},getObjectModuleId:{value:function(e){var t=n.getInfoForObject(e);return this._require.identify(t.moduleId,t.require)}},getObjectLocationId:{value:function(e){var t,s=this.getObjectModuleId(e),r=n.getInfoForObject(e),i=r.objectName;return t=a.MontageSerializer.getDefaultObjectNameForModuleId(s),t===i?s:s+"["+i+"]"}},setObjectProperties:{value:function(e,t){var n,a;a=this.builder.top.getProperty("properties"),this.builder.push(a),"function"==typeof t.serializeProperties?(n=(new s).initWithMalkerAndVisitorAndObject(e,this,t),t.serializeProperties(n)):this.setSerializableObjectProperties(e,t),this.builder.pop()}},setSerializableObjectProperties:{value:function(e,t){for(var a,s,r=n.getSerializablePropertyNames(t),i=r.length,o=0;i>o;o++)s=r[o],a=n.getPropertyAttribute(t,s,"serializable"),this.setProperty(e,s,t[s],a)}},hackIsReferenceAllowedForValue:{value:function(e){return"object"==typeof e&&null!=e&&!("undefined"!=typeof Element&&Element.isElement(e))}},setProperty:{value:function(e,t,n,a){var s;if("reference"===a&&this.hackIsReferenceAllowedForValue(n)){s=this.labeler.getObjectLabel(n);var r=this.builder.createObjectReference(s);this.builder.top.setProperty(t,r)}else e.visit(n,t)}},setObjectCustomUnits:{value:function(e,t){for(var n in this._units)this.setObjectCustomUnit(e,t,n)}},setObjectCustomUnit:{value:function(e,t,n){var a,s,r=this._units[n];r&&(s=(new i).initWithMalkerAndVisitorAndObject(e,this,t),a=r(s,t),null!=a&&e.visit(a,n))}},getExternalObjects:{value:function(){for(var e,t={},n=this.builder.getExternalReferences(),a=0;e=n[a];a++)t[e]=this.labeler.getObjectByLabel(e);return t}},getExternalElements:{value:function(){return this._elements}}});t.MontageVisitor=l}}),montageDefine("b8d1a32","core/serialization/deserializer/montage-interpreter",{dependencies:["core/core","mousse/deserialization/interpreter","mousse/deserialization/context","./montage-reviver","core/promise"],factory:function(e,t){var n=e("core/core").Montage,a=e("mousse/deserialization/interpreter").Interpreter,s=e("mousse/deserialization/context").Context,r=e("./montage-reviver").MontageReviver,i=e("core/promise").Promise,o=n.specialize.call(a,{_require:{value:null},_reviver:{value:null},init:{value:function(e,t){if("function"!=typeof e)throw Error("Function 'require' missing.");return this._reviver=(new r).init(e,t),this}},instantiate:{value:function(e,t,n){var a;return a=(new l).init(e,this._reviver,t,n),a.getObjects()}},preloadModules:{value:function(e){var t,n,a,s,o=this._reviver,l=o.moduleLoader,c=[];for(var p in e)t=e[p],n=t.prototype||t.object,n&&(a=r.parseObjectLocationId(n),s=l.getModule(a.moduleId,p),i.isPromise(s)&&c.push(s));return c.length>0?i.all(c):void 0}}}),l=n.specialize.call(s,{_ELEMENT_ID_ATTRIBUTE:{value:"data-montage-id"},_unitsToDeserialize:{value:null},_element:{value:null},constructor:{value:function(){this._unitsToDeserialize=[]}},init:{value:function(e,t,n,a){return s.call(this,e,t,n),this._element=a,this}},getElement:{value:function(){return this._element}},getElementById:{value:function(e){var t="*["+this._ELEMENT_ID_ATTRIBUTE+'="'+e+'"]';return this._element.querySelector(t)}},setUnitsToDeserialize:{value:function(e,t,n){this._unitsToDeserialize.push({object:e,objectDesc:t,unitNames:n})}},getUnitsToDeserialize:{value:function(){return this._unitsToDeserialize}}});t.MontageInterpreter=o,t.MontageContext=l}}),montageDefine("b8d1a32","core/jshint",{dependencies:[],factory:function(e,t){var n=function(e){var t,n=function(){return t||(t=e(n)),t.apply(this,arguments)};return n}(function(e){"use strict";function t(){}function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function a(e,t){var a;for(a in t)n(t,a)&&(e[a]=t[a])}function s(){ht.couch&&a(dt,St),ht.rhino&&a(dt,At),ht.prototypejs&&a(dt,Pt),ht.node&&a(dt,Dt),ht.devel&&a(dt,Et),ht.dojo&&a(dt,kt),ht.browser&&a(dt,zt),ht.jquery&&a(dt,Ot),ht.mootools&&a(dt,Bt),ht.wsh&&a(dt,Nt),ht.globalstrict&&ht.strict!==!1&&(ht.strict=!0)}function r(e,t,n){var a=Math.floor(100*(t/it.length));throw{name:"JSHintError",line:t,character:n,message:e+" ("+a+"% scanned)."}}function i(t,n,a,s,i,o){var l,c,p;return n=n||pt,"(end)"===n.id&&(n=_t),c=n.line||0,l=n.from||0,p={id:"(error)",raw:t,evidence:it[c-1]||"",line:c,character:l,a:a,b:s,c:i,d:o},p.reason=t.supplant(p),e.errors.push(p),ht.passfail&&r("Stopping. ",c,l),xt+=1,xt>=ht.maxerr&&r("Too many errors.",c,l),p}function o(e,t,n,a,s,r,o){return i(e,{line:t,from:n},a,s,r,o)}function l(e,t,n,a,s,o){var l=i(e,t,n,a,s,o);r("Stopping, unable to continue.",l.line,l.character)}function c(e,t,n,a,s,r,i){return l(e,{line:t,from:n},a,s,r,i)}function p(e,t){"hasOwnProperty"===e&&i("'hasOwnProperty' is a really bad name."),n(Q,e)&&!Q["(global)"]&&(Q[e]===!0?ht.latedef&&i("'{a}' was used before it was defined.",pt,e):ht.shadow||i("'{a}' is already defined.",pt,e)),Q[e]=t,Q["(global)"]?(tt[e]=Q,n(nt,e)&&(ht.latedef&&i("'{a}' was used before it was defined.",pt,e),delete nt[e])):ft[e]=Q}function u(){var e,t,n,a,r,i=pt.value;switch(i){case"*/":l("Unbegun comment.");break;case"/*members":case"/*member":i="/*members",ct||(ct={}),t=ct;break;case"/*jshint":case"/*jslint":t=ht,n=Mt;break;case"/*global":t=dt;break;default:l("What?")}a=Kt.token();e:for(;;){for(;;){if("special"===a.type&&"*/"===a.value)break e;if("(endline)"!==a.id&&","!==a.id)break;a=Kt.token()}"(string)"!==a.type&&"(identifier)"!==a.type&&"/*members"!==i&&l("Bad option.",a),r=Kt.token(),":"===r.id?(r=Kt.token(),t===ct&&l("Expected '{a}' and instead saw '{b}'.",a,"*/",":"),"indent"!==a.value||"/*jshint"!==i&&"/*jslint"!==i?"maxerr"!==a.value||"/*jshint"!==i&&"/*jslint"!==i?"maxlen"!==a.value||"/*jshint"!==i&&"/*jslint"!==i?"true"===r.value?t[a.value]=!0:"false"===r.value?t[a.value]=!1:l("Bad option value.",r):(e=+r.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&l("Expected a small integer and instead saw '{a}'.",r,r.value),t.maxlen=e):(e=+r.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&l("Expected a small integer and instead saw '{a}'.",r,r.value),t.maxerr=e):(e=+r.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&l("Expected a small integer and instead saw '{a}'.",r,r.value),t.white=!0,t.indent=e),a=Kt.token()):(("/*jshint"===i||"/*jslint"===i)&&l("Missing option value.",a),t[a.value]=!1,a=r)}n&&s()}function h(e){for(var t,n=e||0,a=0;n>=a;)t=ot[a],t||(t=ot[a]=Kt.token()),a+=1;return t}function d(e,t){switch(_t.id){case"(number)":"."===pt.id&&i("A dot following a number can be confused with a decimal point.",_t);break;case"-":("-"===pt.id||"--"===pt.id)&&i("Confusing minusses.");break;case"+":("+"===pt.id||"++"===pt.id)&&i("Confusing plusses.")}for(("(string)"===_t.type||_t.identifier)&&($=_t.value),e&&pt.id!==e&&(t?"(end)"===pt.id?i("Unmatched '{a}'.",t,t.id):i("Expected '{a}' to match '{b}' from line {c} and instead saw '{d}'.",pt,e,t.id,t.line,pt.value):("(identifier)"!==pt.type||pt.value!==e)&&i("Expected '{a}' and instead saw '{b}'.",pt,e,pt.value)),gt=_t,_t=pt;;){if(pt=ot.shift()||Kt.token(),"(end)"===pt.id||"(error)"===pt.id)return;if("special"===pt.type)u();else if("(endline)"!==pt.id)break}}function m(e,t){var n,a=!1;if("(end)"===pt.id&&l("Unexpected early end of program.",_t),d(),t&&($="anonymous",Q["(verb)"]=_t.value),t===!0&&_t.fud)n=_t.fud();else{if(_t.nud)n=_t.nud();else{if("(number)"===pt.type&&"."===_t.id)return i("A leading decimal point can be confused with a dot: '.{a}'.",_t,pt.value),d(),_t;l("Expected an identifier and instead saw '{a}'.",_t,_t.id)}for(;pt.lbp>e;)a="Array"==_t.value,d(),a&&"("==_t.id&&")"==pt.id&&i("Use the array literal notation [].",_t),_t.led?n=_t.led(n):l("Expected an operator and instead saw '{a}'.",_t,_t.id)}return n}function g(e,t){e=e||_t,t=t||pt,ht.white&&e.character!==t.from&&e.line===t.line&&i("Unexpected space after '{a}'.",t,e.value)}function f(e,t){e=e||_t,t=t||pt,!ht.white||e.character===t.from&&e.line===t.line||i("Unexpected space before '{a}'.",t,t.value)}function v(e,t){e=e||_t,t=t||pt,ht.white&&!e.comment&&e.line===t.line&&g(e,t)}function b(e,t){ht.white&&(e=e||_t,t=t||pt,e.line===t.line&&e.character===t.from&&i("Missing space after '{a}'.",pt,e.value))}function y(e,t){e=e||_t,t=t||pt,ht.laxbreak||e.line===t.line?ht.white&&(e=e||_t,t=t||pt,e.character===t.from&&i("Missing space after '{a}'.",pt,e.value)):i("Bad line breaking before '{a}'.",t,t.id)}function w(e){var t;ht.white&&"(end)"!==pt.id&&(t=st+(e||0),pt.from!==t&&i("Expected '{a}' to have an indentation at {b} instead at {c}.",pt,pt.value,t,pt.from))}function _(e){e=e||_t,e.line!==pt.line&&i("Line breaking error '{a}'.",e,e.value)}function L(){_t.line!==pt.line?ht.laxbreak||i("Bad line breaking before '{a}'.",_t,pt.id):_t.character!==pt.from&&ht.white&&i("Unexpected space after '{a}'.",pt,_t.value),d(","),b(_t,pt)}function x(e,t){var n=Rt[e];return n&&"object"==typeof n||(Rt[e]=n={id:e,lbp:t,value:e}),n}function C(e){return x(e,0)}function M(e,t){var n=C(e);return n.identifier=n.reserved=!0,n.fud=t,n}function z(e,t){var n=M(e,t);return n.block=!0,n}function S(e){var t=e.id.charAt(0);return(t>="a"&&"z">=t||t>="A"&&"Z">=t)&&(e.identifier=e.reserved=!0),e}function E(e,t){var n=x(e,150);return S(n),n.nud="function"==typeof t?t:function(){return this.right=m(150),this.arity="unary",("++"===this.id||"--"===this.id)&&(ht.plusplus?i("Unexpected use of '{a}'.",this,this.id):this.right.identifier&&!this.right.reserved||"."===this.right.id||"["===this.right.id||i("Bad operand.",this)),this},n}function k(e,t){var n=C(e);return n.type=e,n.nud=t,n}function T(e,t){var n=k(e,t);return n.identifier=n.reserved=!0,n}function j(e,t){return T(e,function(){return"function"==typeof t&&t(this),this})}function O(e,t,n,a){var s=x(e,n);return S(s),s.led=function(e){return a||(y(gt,_t),b(_t,pt)),"function"==typeof t?t(e,this):(this.left=e,this.right=m(n),this)},s}function B(e,t){var n=x(e,100);return n.led=function(e){y(gt,_t),b(_t,pt);var n=m(100);return e&&"NaN"===e.id||n&&"NaN"===n.id?i("Use the isNaN function to compare with NaN.",this):t&&t.apply(this,[e,n]),"!"===e.id&&i("Confusing use of '{a}'.",e,"!"),"!"===n.id&&i("Confusing use of '{a}'.",e,"!"),this.left=e,this.right=n,this},n}function D(e){return e&&("(number)"===e.type&&0===+e.value||"(string)"===e.type&&""===e.value||"null"===e.type&&!ht.eqnull||"true"===e.type||"false"===e.type||"undefined"===e.type)}function P(e){return x(e,20).exps=!0,O(e,function(e,t){if(t.left=e,dt[e.value]===!1&&ft[e.value]["(global)"]===!0?i("Read only.",e):e["function"]&&i("'{a}' is a function.",e,e.value),e){if("."===e.id||"["===e.id)return e.left&&"arguments"!==e.left.value||i("Bad assignment.",t),t.right=m(19),t;if(e.identifier&&!e.reserved)return"exception"===Q[e.value]&&i("Do not assign to the exception parameter.",e),t.right=m(19),t;e===Rt["function"]&&i("Expected an identifier in an assignment and instead saw a function invocation.",_t)}l("Bad assignment.",t)},20)}function A(e,t,n){var a=x(e,n);return S(a),a.led="function"==typeof t?t:function(e){return ht.bitwise&&i("Unexpected use of '{a}'.",this,this.id),this.left=e,this.right=m(n),this},a}function I(e){return x(e,20).exps=!0,O(e,function(e,t){return ht.bitwise&&i("Unexpected use of '{a}'.",t,t.id),b(gt,_t),b(_t,pt),e?"."===e.id||"["===e.id||e.identifier&&!e.reserved?(m(19),t):(e===Rt["function"]&&i("Expected an identifier in an assignment, and instead saw a function invocation.",_t),t):(l("Bad assignment.",t),void 0)},20)}function R(e){var t=x(e,150);return t.led=function(e){return ht.plusplus?i("Unexpected use of '{a}'.",this,this.id):e.identifier&&!e.reserved||"."===e.id||"["===e.id||i("Bad operand.",this),this.left=e,this},t}function N(e){return pt.identifier?(d(),_t.reserved&&!ht.es5&&(e&&"undefined"==_t.value||i("Expected an identifier and instead saw '{a}' (a reserved word).",_t,_t.id)),_t.value):void 0}function q(e){var t=N(e);return t?t:("function"===_t.id&&"("===pt.id?i("Missing name in function declaration."):l("Expected an identifier and instead saw '{a}'.",pt,pt.value),void 0)}function F(e){var t,n=0;if(";"===pt.id&&!ut)for(;;){if(t=h(n),t.reach)return;if("(endline)"!==t.id){if("function"===t.id){i("Inner functions should be listed at the top of the outer function.",t);break}i("Unreachable '{a}' after '{b}'.",t,t.value,e);break}n+=1}}function W(e){var t,n=st,a=ft,s=pt;return";"===s.id?(i("Unnecessary semicolon.",s),d(";"),void 0):(s.identifier&&!s.reserved&&":"===h().id&&(d(),d(":"),ft=Object.create(a),p(s.value,"label"),pt.labelled||i("Label '{a}' on {b} statement.",pt,s.value,pt.value),Yt.test(s.value+":")&&i("Label '{a}' looks like a javascript url.",s,s.value),pt.label=s.value,s=pt),e||w(),t=m(0,!0),s.block||(ht.expr||t&&t.exps?ht.nonew&&"("===t.id&&"new"===t.left.id&&i("Do not use 'new' for side effects."):i("Expected an assignment or function call and instead saw an expression.",_t),";"!==pt.id?ht.asi||ht.lastsemic&&"}"==pt.id&&pt.line==_t.line||o("Missing semicolon.",_t.line,_t.from+_t.value.length):(g(_t,pt),d(";"),b(_t,pt))),st=n,ft=a,t)}function U(){return"use strict"===pt.value?(yt&&i('Unnecessary "use strict".'),d(),d(";"),yt=!0,ht.newcap=!0,ht.undef=!0,!0):!1}function H(){for(var e=[];!pt.reach&&"(end)"!==pt.id;)";"===pt.id?(i("Unnecessary semicolon."),d(";")):e.push(W());return e}function V(e,t){var n,a,s=at,r=st,o=yt,c=ft;if(at=e,ft=Object.create(ft),b(_t,pt),a=pt,"{"===pt.id){if(d("{"),"}"!==pt.id||_t.line!==pt.line){for(st+=ht.indent;!e&&pt.from>st;)st+=ht.indent;e||U()||o||!ht.strict||!Q["(context)"]["(global)"]||i('Missing "use strict" statement.'),n=H(),yt=o,st-=ht.indent,w()}d("}",a),st=r}else e?((!t||ht.curly)&&i("Expected '{a}' and instead saw '{b}'.",pt,"{",pt.value),ut=!0,n=[W()],ut=!1):l("Expected '{a}' and instead saw '{b}'.",pt,"{",pt.value);return Q["(verb)"]=null,ft=c,at=s,!e||!ht.noempty||n&&0!==n.length||i("Empty block."),n}function Y(e){ct&&"boolean"!=typeof ct[e]&&i("Unexpected /*member '{a}'.",_t,e),"number"==typeof lt[e]?lt[e]+=1:lt[e]=1}function G(e){var t=e.value,n=e.line,a=nt[t];"function"==typeof a&&(a=!1),a?a[a.length-1]!==n&&a.push(n):(a=[n],nt[t]=a)}function K(){var e=N(!0);return e||("(string)"===pt.id?(e=pt.value,d()):"(number)"===pt.id&&(e=""+pt.value,d())),e}function X(){var e,t=pt,n=[];if(d("("),v(),")"===pt.id)return d(")"),v(gt,_t),void 0;for(;;){if(e=q(!0),n.push(e),p(e,"parameter"),","!==pt.id)return d(")",t),v(gt,_t),n;L()}}function Z(e,t){var n,a=ht,s=ft;return ht=Object.create(ht),ft=Object.create(ft),Q={"(name)":e||'"'+$+'"',"(line)":pt.line,"(context)":Q,"(breakage)":0,"(loopage)":0,"(scope)":ft,"(statement)":t},n=Q,_t.funct=Q,et.push(Q),e&&p(e,"function"),Q["(params)"]=X(),V(!1),ft=s,ht=a,Q["(last)"]=_t.line,Q=Q["(context)"],n}function J(){function e(){var e={},t=pt;if(d("{"),"}"!==pt.id)for(;;){if("(end)"===pt.id)l("Missing '}' to match '{' from line {a}.",pt,t.line);else{if("}"===pt.id){i("Unexpected comma.",_t);break}","===pt.id?l("Unexpected comma.",pt):"(string)"!==pt.id&&i("Expected a string and instead saw {a}.",pt,pt.value)}if(e[pt.value]===!0?i("Duplicate key '{a}'.",pt,pt.value):"__proto__"===pt.value?i("Stupid key '{a}'.",pt,pt.value):e[pt.value]=!0,d(),d(":"),J(),","!==pt.id)break;d(",")}d("}")}function t(){var e=pt;if(d("["),"]"!==pt.id)for(;;){if("(end)"===pt.id)l("Missing ']' to match '[' from line {a}.",pt,e.line);else{if("]"===pt.id){i("Unexpected comma.",_t);break}","===pt.id&&l("Unexpected comma.",pt)}if(J(),","!==pt.id)break;d(",")}d("]")}switch(pt.id){case"{":e();break;case"[":t();break;case"true":case"false":case"null":case"(number)":case"(string)":d();break;case"-":d("-"),_t.character!==pt.from&&i("Unexpected space after '-'.",_t),g(_t,pt),d("(number)");break;default:l("Expected a JSON value.",pt)}}var $,Q,et,tt,nt,at,st,rt,it,ot,lt,ct,pt,ut,ht,dt,mt,gt,ft,vt,bt,yt,wt,_t,Lt,xt,Ct={"<":!0,"<=":!0,"==":!0,"===":!0,"!==":!0,"!=":!0,">":!0,">=":!0,"+":!0,"-":!0,"*":!0,"/":!0,"%":!0},Mt={asi:!0,bitwise:!0,boss:!0,browser:!0,couch:!0,curly:!0,debug:!0,devel:!0,dojo:!0,eqeqeq:!0,eqnull:!0,es5:!0,evil:!0,expr:!0,forin:!0,globalstrict:!0,immed:!0,jquery:!0,latedef:!0,laxbreak:!0,loopfunc:!0,mootools:!0,newcap:!0,noarg:!0,node:!0,noempty:!0,nonew:!0,nomen:!0,onevar:!0,passfail:!0,plusplus:!0,prototypejs:!0,regexdash:!0,regexp:!0,rhino:!0,undef:!0,scripturl:!0,shadow:!0,strict:!0,sub:!0,supernew:!0,trailing:!0,white:!0,wsh:!0},zt={ArrayBuffer:!1,ArrayBufferView:!1,addEventListener:!1,applicationCache:!1,blur:!1,clearInterval:!1,clearTimeout:!1,close:!1,closed:!1,DataView:!1,defaultStatus:!1,document:!1,event:!1,FileReader:!1,Float32Array:!1,Float64Array:!1,focus:!1,frames:!1,getComputedStyle:!1,HTMLElement:!1,history:!1,Int16Array:!1,Int32Array:!1,Int8Array:!1,Image:!1,length:!1,localStorage:!1,location:!1,moveBy:!1,moveTo:!1,name:!1,navigator:!1,onbeforeunload:!0,onblur:!0,onerror:!0,onfocus:!0,onload:!0,onresize:!0,onunload:!0,open:!1,openDatabase:!1,opener:!1,Option:!1,parent:!1,print:!1,removeEventListener:!1,resizeBy:!1,resizeTo:!1,screen:!1,scroll:!1,scrollBy:!1,scrollTo:!1,setInterval:!1,setTimeout:!1,status:!1,top:!1,Uint16Array:!1,Uint32Array:!1,Uint8Array:!1,WebSocket:!1,window:!1,Worker:!1,XMLHttpRequest:!1,XPathEvaluator:!1,XPathException:!1,XPathExpression:!1,XPathNamespace:!1,XPathNSResolver:!1,XPathResult:!1},St={require:!1,respond:!1,getRow:!1,emit:!1,send:!1,start:!1,sum:!1,log:!1,exports:!1,module:!1},Et={alert:!1,confirm:!1,console:!1,Debug:!1,opera:!1,prompt:!1},kt={dojo:!1,dijit:!1,dojox:!1,define:!1,require:!1},Tt={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"/":"\\/","\\":"\\\\"},jt=["closure","exception","global","label","outer","unused","var"],Ot={$:!1,jQuery:!1},Bt={$:!1,$$:!1,Assets:!1,Browser:!1,Chain:!1,Class:!1,Color:!1,Cookie:!1,Core:!1,Document:!1,DomReady:!1,DOMReady:!1,Drag:!1,Element:!1,Elements:!1,Event:!1,Events:!1,Fx:!1,Group:!1,Hash:!1,HtmlTable:!1,Iframe:!1,IframeShim:!1,InputValidator:!1,instanceOf:!1,Keyboard:!1,Locale:!1,Mask:!1,MooTools:!1,Native:!1,Options:!1,OverText:!1,Request:!1,Scroller:!1,Slick:!1,Slider:!1,Sortables:!1,Spinner:!1,Swiff:!1,Tips:!1,Type:!1,typeOf:!1,URI:!1,Window:!1},Dt={__filename:!1,__dirname:!1,exports:!1,Buffer:!1,GLOBAL:!1,global:!1,module:!1,process:!1,require:!1},Pt={$:!1,$$:!1,$A:!1,$F:!1,$H:!1,$R:!1,$break:!1,$continue:!1,$w:!1,Abstract:!1,Ajax:!1,Class:!1,Enumerable:!1,Element:!1,Event:!1,Field:!1,Form:!1,Hash:!1,Insertion:!1,ObjectRange:!1,PeriodicalExecuter:!1,Position:!1,Prototype:!1,Selector:!1,Template:!1,Toggle:!1,Try:!1,Autocompleter:!1,Builder:!1,Control:!1,Draggable:!1,Draggables:!1,Droppables:!1,Effect:!1,Sortable:!1,SortableObserver:!1,Sound:!1,Scriptaculous:!1},At={defineClass:!1,deserialize:!1,gc:!1,help:!1,load:!1,loadClass:!1,print:!1,quit:!1,readFile:!1,readUrl:!1,runCommand:!1,seal:!1,serialize:!1,spawn:!1,sync:!1,toint32:!1,version:!1},It={Array:!1,Boolean:!1,Date:!1,decodeURI:!1,decodeURIComponent:!1,encodeURI:!1,encodeURIComponent:!1,Error:!1,eval:!1,EvalError:!1,Function:!1,hasOwnProperty:!1,isFinite:!1,isNaN:!1,JSON:!1,Math:!1,Number:!1,Object:!1,parseInt:!1,parseFloat:!1,RangeError:!1,ReferenceError:!1,RegExp:!1,String:!1,SyntaxError:!1,TypeError:!1,URIError:!1},Rt={},Nt={ActiveXObject:!0,Enumerator:!0,GetObject:!0,ScriptEngine:!0,ScriptEngineBuildVersion:!0,ScriptEngineMajorVersion:!0,ScriptEngineMinorVersion:!0,VBArray:!0,WSH:!0,WScript:!0},qt=/[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,Ft=/^\s*([(){}\[.,:;'"~\?\]#@]|==?=?|\/(\*(jshint|jslint|members?|global)?|=|\/)?|\*[\/=]?|\+(?:=|\++)?|-(?:=|-+)?|%=?|&[&=]?|\|[|=]?|>>?>?=?|<([\/=!]|\!(\[|--)?|<=?)?|\^=?|\!=?=?|[a-zA-Z_$][a-zA-Z0-9_$]*|[0-9]+([xX][0-9a-fA-F]+|\.[0-9]*)?([eE][+\-]?[0-9]+)?)/,Wt=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,Ut=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,Ht=/\*\/|\/\*/,Vt=/^([a-zA-Z_$][a-zA-Z0-9_$]*)$/,Yt=/^(?:javascript|jscript|ecmascript|vbscript|mocha|livescript)\s*:/i,Gt=/^\s*\/\*\s*falls\sthrough\s*\*\/\s*$/;
"function"!=typeof Array.isArray&&(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.apply(e)}),"function"!=typeof Object.create&&(Object.create=function(e){return t.prototype=e,new t}),"function"!=typeof Object.keys&&(Object.keys=function(e){var t,a=[];for(t in e)n(e,t)&&a.push(t);return a}),"function"!=typeof String.prototype.entityify&&(String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}),"function"!=typeof String.prototype.isAlpha&&(String.prototype.isAlpha=function(){return this>="a"&&"z￿">=this||this>="A"&&"Z￿">=this}),"function"!=typeof String.prototype.isDigit&&(String.prototype.isDigit=function(){return this>="0"&&"9">=this}),"function"!=typeof String.prototype.supplant&&(String.prototype.supplant=function(e){return this.replace(/\{([^{}]*)\}/g,function(t,n){var a=e[n];return"string"==typeof a||"number"==typeof a?a:t})}),"function"!=typeof String.prototype.name&&(String.prototype.name=function(){return Vt.test(this)?this:Wt.test(this)?'"'+this.replace(Ut,function(e){var t=Tt[e];return t?t:"\\u"+("0000"+e.charCodeAt().toString(16)).slice(-4)})+'"':'"'+this+'"'});var Kt=function Kt(){function e(){var e,t;return r>=it.length?!1:(a=1,i=it[r],r+=1,e=i.search(/ \t/),e>=0&&o("Mixed spaces and tabs.",r,e+1),i=i.replace(/\t/g,wt),e=i.search(qt),e>=0&&o("Unsafe character.",r,e),ht.maxlen&&ht.maxlen<i.length&&o("Line too long.",r,i.length),t=i.search(/\s+$/),ht.trailing&&~t&&!~i.search(/^\s+$/)&&o("Trailing whitespace.",r,t),!0)}function t(e,t){var i,l;return l="(color)"===e||"(range)"===e?{type:e}:"(punctuator)"===e||"(identifier)"===e&&n(Rt,t)?Rt[t]||Rt["(error)"]:Rt[e],l=Object.create(l),("(string)"===e||"(range)"===e)&&!ht.scripturl&&Yt.test(t)&&o("Script URL.",r,s),"(identifier)"===e&&(l.identifier=!0,"__iterator__"===t||"__proto__"===t?c("Reserved name '{a}'.",r,s,t):!ht.nomen||"_"!==t.charAt(0)&&"_"!==t.charAt(t.length-1)||o("Unexpected {a} in '{b}'.",r,s,"dangling '_'",t)),l.value=t,l.line=r,l.character=a,l.from=s,i=l.id,"(endline)"!==i&&(mt=i&&("(,=:[!&|?{};".indexOf(i.charAt(i.length-1))>=0||"return"===i)),l}var a,s,r,i;return{init:function(t){it="string"==typeof t?t.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n"):t,it[0]&&"#!"==it[0].substr(0,2)&&(it[0]=""),r=0,e(),s=1},range:function(e,n){var l,p="";for(s=a,i.charAt(0)!==e&&c("Expected '{a}' and instead saw '{b}'.",r,a,e,i.charAt(0));;){switch(i=i.slice(1),a+=1,l=i.charAt(0)){case"":c("Missing '{a}'.",r,a,l);break;case n:return i=i.slice(1),a+=1,t("(range)",p);case"\\":o("Unexpected '{a}'.",r,a,l)}p+=l}},token:function(){function n(e){var t,n=e.exec(i);return n?(v=n[0].length,t=n[1],u=t.charAt(0),i=i.substr(v),s=a+v-t.length,a+=v,t):void 0}function l(n){function l(e){var t=parseInt(i.substr(u+1,e),16);u+=e,t>=32&&126>=t&&34!==t&&92!==t&&39!==t&&o("Unnecessary escapement.",r,a),a+=e,p=String.fromCharCode(t)}var p,u,h="";for(rt&&'"'!==n&&o("Strings must use doublequote.",r,a),u=0;;){for(;u>=i.length;)u=0,e()||c("Unclosed string.",r,s);if(p=i.charAt(u),p===n)return a+=1,i=i.substr(u+1),t("(string)",h,n);if(" ">p){if("\n"===p||"\r"===p)break;o("Control character in string: {a}.",r,a+u,i.slice(0,u))}else if("\\"===p)switch(u+=1,a+=1,p=i.charAt(u)){case"\\":case'"':case"/":break;case"'":rt&&o("Avoid \\'.",r,a);break;case"b":p="\b";break;case"f":p="\f";break;case"n":p="\n";break;case"r":p="\r";break;case"t":p="	";break;case"u":l(4);break;case"v":rt&&o("Avoid \\v.",r,a),p="";break;case"x":rt&&o("Avoid \\x-.",r,a),l(2);break;default:o("Bad escapement.",r,a)}h+=p,a+=1,u+=1}}for(var p,u,h,d,m,g,f,v,b,y,w;;){if(!i)return t(e()?"(endline)":"(end)","");if(w=n(Ft)){if(u.isAlpha()||"_"===u||"$"===u)return t("(identifier)",w);if(u.isDigit())return isFinite(Number(w))||o("Bad number '{a}'.",r,a,w),i.substr(0,1).isAlpha()&&o("Missing space after '{a}'.",r,a,w),"0"===u&&(d=w.substr(1,1),d.isDigit()?"."!==_t.id&&o("Don't use extra leading zeros '{a}'.",r,a,w):!rt||"x"!==d&&"X"!==d||o("Avoid 0x-. '{a}'.",r,a,w)),"."===w.substr(w.length-1)&&o("A trailing decimal point can be confused with a dot '{a}'.",r,a,w),t("(number)",w);switch(w){case'"':case"'":return l(w);case"//":vt&&o("Unexpected comment.",r,a),i="",_t.comment=!0;break;case"/*":for(vt&&o("Unexpected comment.",r,a);f=i.search(Ht),!(f>=0);)e()||c("Unclosed comment.",r,a);a+=f+2,"/"===i.substr(f,1)&&c("Nested comment.",r,a),i=i.substr(f+2),_t.comment=!0;break;case"/*members":case"/*member":case"/*jshint":case"/*jslint":case"/*global":case"*/":return{value:w,type:"special",line:r,character:a,from:s};case"":break;case"/":if("/="===_t.id&&c("A regular expression literal can be confused with '/='.",r,s),mt){for(m=0,h=0,v=0;;){switch(p=!0,u=i.charAt(v),v+=1,u){case"":return c("Unclosed regular expression.",r,s),void 0;case"/":for(m>0&&o("Unescaped '{a}'.",r,s+v,"/"),u=i.substr(0,v-1),y={g:!0,i:!0,m:!0};y[i.charAt(v)]===!0;)y[i.charAt(v)]=!1,v+=1;return a+=v,i=i.substr(v),y=i.charAt(0),("/"===y||"*"===y)&&c("Confusing regular expression.",r,s),t("(regexp)",u);case"\\":u=i.charAt(v)," ">u?o("Unexpected control character in regular expression.",r,s+v):"<"===u&&o("Unexpected escaped character '{a}' in regular expression.",r,s+v,u),v+=1;break;case"(":if(m+=1,p=!1,"?"===i.charAt(v))switch(v+=1,i.charAt(v)){case":":case"=":case"!":v+=1;break;default:o("Expected '{a}' and instead saw '{b}'.",r,s+v,":",i.charAt(v))}else h+=1;break;case"|":p=!1;break;case")":0===m?o("Unescaped '{a}'.",r,s+v,")"):m-=1;break;case" ":for(y=1;" "===i.charAt(v);)v+=1,y+=1;y>1&&o("Spaces are hard to count. Use {{a}}.",r,s+v,y);break;case"[":u=i.charAt(v),"^"===u&&(v+=1,ht.regexp?o("Insecure '{a}'.",r,s+v,u):"]"===i.charAt(v)&&c("Unescaped '{a}'.",r,s+v,"^")),y=!1,"]"===u&&(o("Empty class.",r,s+v-1),y=!0);e:do switch(u=i.charAt(v),v+=1,u){case"[":case"^":o("Unescaped '{a}'.",r,s+v,u),y=!0;break;case"-":y?y=!1:(o("Unescaped '{a}'.",r,s+v,"-"),y=!0);break;case"]":y||ht.regexdash||o("Unescaped '{a}'.",r,s+v-1,"-");break e;case"\\":u=i.charAt(v)," ">u?o("Unexpected control character in regular expression.",r,s+v):"<"===u&&o("Unexpected escaped character '{a}' in regular expression.",r,s+v,u),v+=1,y=!0;break;case"/":o("Unescaped '{a}'.",r,s+v-1,"/"),y=!0;break;case"<":y=!0;break;default:y=!0}while(u);break;case".":ht.regexp&&o("Insecure '{a}'.",r,s+v,u);break;case"]":case"?":case"{":case"}":case"+":case"*":o("Unescaped '{a}'.",r,s+v,u)}if(p)switch(i.charAt(v)){case"?":case"+":case"*":v+=1,"?"===i.charAt(v)&&(v+=1);break;case"{":for(v+=1,u=i.charAt(v),("0">u||u>"9")&&o("Expected a number and instead saw '{a}'.",r,s+v,u),v+=1,b=+u;u=i.charAt(v),!("0">u||u>"9");)v+=1,b=+u+10*b;if(g=b,","===u&&(v+=1,g=1/0,u=i.charAt(v),u>="0"&&"9">=u))for(v+=1,g=+u;u=i.charAt(v),!("0">u||u>"9");)v+=1,g=+u+10*g;"}"!==i.charAt(v)?o("Expected '{a}' and instead saw '{b}'.",r,s+v,"}",u):v+=1,"?"===i.charAt(v)&&(v+=1),b>g&&o("'{a}' should not be greater than '{b}'.",r,s+v,b,g)}}return u=i.substr(0,v-1),a+=v,i=i.substr(v),t("(regexp)",u)}return t("(punctuator)",w);case"#":return t("(punctuator)",w);default:return t("(punctuator)",w)}}else{for(w="",u="";i&&"!">i;)i=i.substr(1);i&&c("Unexpected '{a}'.",r,a,i.substr(0,1))}}}}}();k("(number)",function(){return this}),k("(string)",function(){return this}),Rt["(identifier)"]={type:"(identifier)",lbp:0,identifier:!0,nud:function(){var e,t=this.value,n=ft[t];if("function"==typeof n?n=void 0:"boolean"==typeof n&&(e=Q,Q=et[0],p(t,"var"),n=Q,Q=e),Q===n)switch(Q[t]){case"unused":Q[t]="var";break;case"unction":Q[t]="function",this["function"]=!0;break;case"function":this["function"]=!0;break;case"label":i("'{a}' is a statement label.",_t,t)}else if(Q["(global)"])"typeof"!=$&&"delete"!=$&&ht.undef&&"boolean"!=typeof dt[t]&&i("'{a}' is not defined.",_t,t),G(_t);else switch(Q[t]){case"closure":case"function":case"var":case"unused":i("'{a}' used out of scope.",_t,t);break;case"label":i("'{a}' is a statement label.",_t,t);break;case"outer":case"global":break;default:if(n===!0)Q[t]=!0;else if(null===n)i("'{a}' is not allowed.",_t,t),G(_t);else if("object"!=typeof n)"typeof"!=$&&"delete"!=$&&ht.undef?i("'{a}' is not defined.",_t,t):Q[t]=!0,G(_t);else switch(n[t]){case"function":case"unction":this["function"]=!0,n[t]="closure",Q[t]=n["(global)"]?"global":"outer";break;case"var":case"unused":n[t]="closure",Q[t]=n["(global)"]?"global":"outer";break;case"closure":case"parameter":Q[t]=n["(global)"]?"global":"outer";break;case"label":i("'{a}' is a statement label.",_t,t)}}return this},led:function(){l("Expected an operator and instead saw '{a}'.",pt,pt.value)}},k("(regexp)",function(){return this}),C("(endline)"),C("(begin)"),C("(end)").reach=!0,C("</").reach=!0,C("<!"),C("<!--"),C("-->"),C("(error)").reach=!0,C("}").reach=!0,C(")"),C("]"),C('"').reach=!0,C("'").reach=!0,C(";"),C(":").reach=!0,C(","),C("#"),C("@"),T("else"),T("case").reach=!0,T("catch"),T("default").reach=!0,T("finally"),j("arguments",function(e){yt&&Q["(global)"]&&i("Strict violation.",e)}),j("eval"),j("false"),j("Infinity"),j("NaN"),j("null"),j("this",function(e){yt&&(Q["(statement)"]&&Q["(name)"].charAt(0)>"Z"||Q["(global)"])&&i("Strict violation.",e)}),j("true"),j("undefined"),P("=","assign",20),P("+=","assignadd",20),P("-=","assignsub",20),P("*=","assignmult",20),P("/=","assigndiv",20).nud=function(){l("A regular expression literal can be confused with '/='.")},P("%=","assignmod",20),I("&=","assignbitand",20),I("|=","assignbitor",20),I("^=","assignbitxor",20),I("<<=","assignshiftleft",20),I(">>=","assignshiftright",20),I(">>>=","assignshiftrightunsigned",20),O("?",function(e,t){return t.left=e,t.right=m(10),d(":"),t["else"]=m(10),t},30),O("||","or",40),O("&&","and",50),A("|","bitor",70),A("^","bitxor",80),A("&","bitand",90),B("==",function(e,t){var n=ht.eqnull&&("null"==e.value||"null"==t.value);return!n&&ht.eqeqeq?i("Expected '{a}' and instead saw '{b}'.",this,"===","=="):D(e)?i("Use '{a}' to compare with '{b}'.",this,"===",e.value):D(t)&&i("Use '{a}' to compare with '{b}'.",this,"===",t.value),this}),B("==="),B("!=",function(e,t){return ht.eqeqeq?i("Expected '{a}' and instead saw '{b}'.",this,"!==","!="):D(e)?i("Use '{a}' to compare with '{b}'.",this,"!==",e.value):D(t)&&i("Use '{a}' to compare with '{b}'.",this,"!==",t.value),this}),B("!=="),B("<"),B(">"),B("<="),B(">="),A("<<","shiftleft",120),A(">>","shiftright",120),A(">>>","shiftrightunsigned",120),O("in","in",120),O("instanceof","instanceof",120),O("+",function(e,t){var n=m(130);return e&&n&&"(string)"===e.id&&"(string)"===n.id?(e.value+=n.value,e.character=n.character,!ht.scripturl&&Yt.test(e.value)&&i("JavaScript URL.",e),e):(t.left=e,t.right=n,t)},130),E("+","num"),E("+++",function(){return i("Confusing pluses."),this.right=m(150),this.arity="unary",this}),O("+++",function(e){return i("Confusing pluses."),this.left=e,this.right=m(130),this},130),O("-","sub",130),E("-","neg"),E("---",function(){return i("Confusing minuses."),this.right=m(150),this.arity="unary",this}),O("---",function(e){return i("Confusing minuses."),this.left=e,this.right=m(130),this},130),O("*","mult",140),O("/","div",140),O("%","mod",140),R("++","postinc"),E("++","preinc"),Rt["++"].exps=!0,R("--","postdec"),E("--","predec"),Rt["--"].exps=!0,E("delete",function(){var e=m(0);return(!e||"."!==e.id&&"["!==e.id)&&i("Variables should not be deleted."),this.first=e,this}).exps=!0,E("~",function(){return ht.bitwise&&i("Unexpected '{a}'.",this,"~"),m(150),this}),E("!",function(){return this.right=m(150),this.arity="unary",Ct[this.right.id]===!0&&i("Confusing use of '{a}'.",this,"!"),this}),E("typeof","typeof"),E("new",function(){var e,t=m(155);if(t&&"function"!==t.id)if(t.identifier)switch(t["new"]=!0,t.value){case"Object":i("Use the object literal notation {}.",_t);break;case"Number":case"String":case"Boolean":case"Math":case"JSON":i("Do not use {a} as a constructor.",_t,t.value);break;case"Function":ht.evil||i("The Function constructor is eval.");break;case"Date":case"RegExp":break;default:"function"!==t.id&&(e=t.value.substr(0,1),ht.newcap&&("A">e||e>"Z")&&i("A constructor name should start with an uppercase letter.",_t))}else"."!==t.id&&"["!==t.id&&"("!==t.id&&i("Bad constructor.",_t);else ht.supernew||i("Weird construction. Delete 'new'.",this);return g(_t,pt),"("===pt.id||ht.supernew||i("Missing '()' invoking a constructor."),this.first=t,this}),Rt["new"].exps=!0,E("void").exps=!0,O(".",function(e,t){g(gt,_t),f();var n=q();return"string"==typeof n&&Y(n),t.left=e,t.right=n,ht.noarg&&e&&"arguments"===e.value&&("callee"===n||"caller"===n)?i("Avoid arguments.{a}.",e,n):ht.evil||!e||"document"!==e.value||"write"!==n&&"writeln"!==n||i("document.write can be a form of eval.",e),ht.evil||"eval"!==n&&"execScript"!==n||i("eval is evil."),t},160,!0),O("(",function(e,t){"}"!==gt.id&&")"!==gt.id&&f(gt,_t),v(),ht.immed&&!e.immed&&"function"===e.id&&i("Wrap an immediate function invocation in parentheses to assist the reader in understanding that the expression is the result of a function, and not the function itself.");var n=0,a=[];if(e&&"(identifier)"===e.type&&e.value.match(/^[A-Z]([A-Z0-9_$]*[a-z][A-Za-z0-9_$]*)?$/)&&"Number"!==e.value&&"String"!==e.value&&"Boolean"!==e.value&&"Date"!==e.value&&("Math"===e.value?i("Math is not a function.",e):ht.newcap&&i("Missing 'new' prefix when invoking a constructor.",e)),")"!==pt.id)for(;a[a.length]=m(10),n+=1,","===pt.id;)L();return d(")"),v(gt,_t),"object"==typeof e&&("parseInt"===e.value&&1===n&&i("Missing radix parameter.",e),ht.evil||("eval"===e.value||"Function"===e.value||"execScript"===e.value?i("eval is evil.",e):!a[0]||"(string)"!==a[0].id||"setTimeout"!==e.value&&"setInterval"!==e.value||i("Implied eval is evil. Pass a function instead of a string.",e)),e.identifier||"."===e.id||"["===e.id||"("===e.id||"&&"===e.id||"||"===e.id||"?"===e.id||i("Bad invocation.",e)),t.left=e,t},155,!0).exps=!0,E("(",function(){v(),"function"===pt.id&&(pt.immed=!0);var e=m(0);return d(")",this),v(gt,_t),ht.immed&&"function"===e.id&&("("===pt.id?i("Move the invocation into the parens that contain the function.",pt):i("Do not wrap function literals in parens unless they are to be immediately invoked.",this)),e}),O("[",function(e,t){f(gt,_t),v();var n,a=m(0);return a&&"(string)"===a.type&&(ht.evil||"eval"!==a.value&&"execScript"!==a.value||i("eval is evil.",t),Y(a.value),!ht.sub&&Vt.test(a.value)&&(n=Rt[a.value],n&&n.reserved||i("['{a}'] is better written in dot notation.",a,a.value))),d("]",t),v(gt,_t),t.left=e,t.right=a,t},160,!0),E("[",function(){var e=_t.line!==pt.line;for(this.first=[],e&&(st+=ht.indent,pt.from===st+ht.indent&&(st+=ht.indent));"(end)"!==pt.id;){for(;","===pt.id;)i("Extra comma."),d(",");if("]"===pt.id)break;if(e&&_t.line!==pt.line&&w(),this.first.push(m(10)),","!==pt.id)break;if(L(),"]"===pt.id&&!ht.es5){i("Extra comma.",_t);break}}return e&&(st-=ht.indent,w()),d("]",this),this},160),function(e){e.nud=function(){var e,t,n,a,s,r,o={};for(e=_t.line!==pt.line,e&&(st+=ht.indent,pt.from===st+ht.indent&&(st+=ht.indent));"}"!==pt.id;){if(e&&w(),"get"===pt.value&&":"!==h().id)d("get"),ht.es5||l("get/set are ES5 features."),n=K(),n||l("Missing property name."),r=pt,g(_t,pt),t=Z(),!ht.loopfunc&&Q["(loopage)"]&&i("Don't make functions within a loop.",r),s=t["(params)"],s&&i("Unexpected parameter '{a}' in get {b} function.",r,s[0],n),g(_t,pt),d(","),w(),d("set"),a=K(),n!==a&&l("Expected {a} and instead saw {b}.",_t,n,a),r=pt,g(_t,pt),t=Z(),s=t["(params)"],s&&1===s.length&&"value"===s[0]||i("Expected (value) in set {a} function.",r,n);else{if(n=K(),"string"!=typeof n)break;d(":"),b(_t,pt),m(10)}if(o[n]===!0&&i("Duplicate member '{a}'.",pt,n),o[n]=!0,Y(n),","!==pt.id)break;L(),","===pt.id?i("Extra comma.",_t):"}"!==pt.id||ht.es5||i("Extra comma.",_t)}return e&&(st-=ht.indent,w()),d("}",this),this},e.fud=function(){l("Expected to see a statement and instead saw a block.",_t)}}(C("{"));var Xt=M("var",function(e){var t,n,a;for(Q["(onevar)"]&&ht.onevar?i("Too many var statements."):Q["(global)"]||(Q["(onevar)"]=!0),this.first=[];b(_t,pt),t=q(),Q["(global)"]&&dt[t]===!1&&i("Redefinition of '{a}'.",_t,t),p(t,"unused"),!e&&(n=_t,this.first.push(_t),"="===pt.id&&(b(_t,pt),d("="),b(_t,pt),"undefined"===pt.id&&i("It is not necessary to initialize '{a}' to 'undefined'.",_t,t),"="===h(0).id&&pt.identifier&&l("Variable {a} was not declared correctly.",pt,pt.value),a=m(0),n.first=a),","===pt.id);)L();return this});Xt.exps=!0,z("function",function(){at&&i("Function declarations should not be placed in blocks. Use a function expression or move the statement to the top of the outer function.",_t);var e=q();return g(_t,pt),p(e,"unction"),Z(e,!0),"("===pt.id&&pt.line===_t.line&&l("Function declarations are not invocable. Wrap the whole function invocation in parens."),this}),E("function",function(){var e=N();return e?g(_t,pt):b(_t,pt),Z(e),!ht.loopfunc&&Q["(loopage)"]&&i("Don't make functions within a loop."),this}),z("if",function(){var e=pt;return d("("),b(this,e),v(),m(20),"="===pt.id&&(ht.boss||i("Expected a conditional expression and instead saw an assignment."),d("="),m(20)),d(")",e),v(gt,_t),V(!0,!0),"else"===pt.id&&(b(_t,pt),d("else"),"if"===pt.id||"switch"===pt.id?W(!0):V(!0,!0)),this}),z("try",function(){var e,t,n;return V(!1),"catch"===pt.id&&(d("catch"),b(_t,pt),d("("),n=ft,ft=Object.create(n),t=pt.value,"(identifier)"!==pt.type?i("Expected an identifier and instead saw '{a}'.",pt,t):p(t,"exception"),d(),d(")"),V(!1),e=!0,ft=n),"finally"===pt.id?(d("finally"),V(!1),void 0):(e||l("Expected '{a}' and instead saw '{b}'.",pt,"catch",pt.value),this)}),z("while",function(){var e=pt;return Q["(breakage)"]+=1,Q["(loopage)"]+=1,d("("),b(this,e),v(),m(20),"="===pt.id&&(ht.boss||i("Expected a conditional expression and instead saw an assignment."),d("="),m(20)),d(")",e),v(gt,_t),V(!0,!0),Q["(breakage)"]-=1,Q["(loopage)"]-=1,this}).labelled=!0,T("with"),z("switch",function(){var e=pt,t=!1;for(Q["(breakage)"]+=1,d("("),b(this,e),v(),this.condition=m(20),d(")",e),v(gt,_t),b(_t,pt),e=pt,d("{"),b(_t,pt),st+=ht.indent,this.cases=[];;)switch(pt.id){case"case":switch(Q["(verb)"]){case"break":case"case":case"continue":case"return":case"switch":case"throw":break;default:Gt.test(it[pt.line-2])||i("Expected a 'break' statement before 'case'.",_t)}w(-ht.indent),d("case"),this.cases.push(m(20)),t=!0,d(":"),Q["(verb)"]="case";break;case"default":switch(Q["(verb)"]){case"break":case"continue":case"return":case"throw":break;default:Gt.test(it[pt.line-2])||i("Expected a 'break' statement before 'default'.",_t)}w(-ht.indent),d("default"),t=!0,d(":");break;case"}":return st-=ht.indent,w(),d("}",e),(1===this.cases.length||"true"===this.condition.id||"false"===this.condition.id)&&i("This 'switch' should be an 'if'.",this),Q["(breakage)"]-=1,Q["(verb)"]=void 0,void 0;case"(end)":return l("Missing '{a}'.",pt,"}"),void 0;default:if(t)switch(_t.id){case",":return l("Each value should have its own case label."),void 0;case":":H();break;default:l("Missing ':' on a case clause.",_t)}else l("Expected '{a}' and instead saw '{b}'.",pt,"case",pt.value)}}).labelled=!0,M("debugger",function(){return ht.debug||i("All 'debugger' statements should be removed."),this}).exps=!0,function(){var e=M("do",function(){Q["(breakage)"]+=1,Q["(loopage)"]+=1,this.first=V(!0),d("while");var e=pt;return b(_t,e),d("("),v(),m(20),"="===pt.id&&(ht.boss||i("Expected a conditional expression and instead saw an assignment."),d("="),m(20)),d(")",e),v(gt,_t),Q["(breakage)"]-=1,Q["(loopage)"]-=1,this});e.labelled=!0,e.exps=!0}(),z("for",function(){var e,t=pt;if(Q["(breakage)"]+=1,Q["(loopage)"]+=1,d("("),b(this,t),v(),"in"===h("var"===pt.id?1:0).id){if("var"===pt.id)d("var"),Xt.fud.call(Xt,!0);else{switch(Q[pt.value]){case"unused":Q[pt.value]="var";break;case"var":break;default:i("Bad for in variable '{a}'.",pt,pt.value)}d()}return d("in"),m(20),d(")",t),e=V(!0,!0),ht.forin&&(e.length>1||"object"!=typeof e[0]||"if"!==e[0].value)&&i("The body of a for in should be wrapped in an if statement to filter unwanted properties from the prototype.",this),Q["(breakage)"]-=1,Q["(loopage)"]-=1,this}if(";"!==pt.id)if("var"===pt.id)d("var"),Xt.fud.call(Xt);else for(;m(0,"for"),","===pt.id;)L();if(_(_t),d(";"),";"!==pt.id&&(m(20),"="===pt.id&&(ht.boss||i("Expected a conditional expression and instead saw an assignment."),d("="),m(20))),_(_t),d(";"),";"===pt.id&&l("Expected '{a}' and instead saw '{b}'.",pt,")",";"),")"!==pt.id)for(;m(0,"for"),","===pt.id;)L();return d(")",t),v(gt,_t),V(!0,!0),Q["(breakage)"]-=1,Q["(loopage)"]-=1,this}).labelled=!0,M("break",function(){var e=pt.value;return 0===Q["(breakage)"]&&i("Unexpected '{a}'.",pt,this.value),_(this),";"!==pt.id&&_t.line===pt.line&&("label"!==Q[e]?i("'{a}' is not a statement label.",pt,e):ft[e]!==Q&&i("'{a}' is out of scope.",pt,e),this.first=pt,d()),F("break"),this}).exps=!0,M("continue",function(){var e=pt.value;return 0===Q["(breakage)"]&&i("Unexpected '{a}'.",pt,this.value),_(this),";"!==pt.id?_t.line===pt.line&&("label"!==Q[e]?i("'{a}' is not a statement label.",pt,e):ft[e]!==Q&&i("'{a}' is out of scope.",pt,e),this.first=pt,d()):Q["(loopage)"]||i("Unexpected '{a}'.",pt,this.value),F("continue"),this}).exps=!0,M("return",function(){return _(this),"(regexp)"===pt.id&&i("Wrap the /regexp/ literal in parens to disambiguate the slash operator."),";"===pt.id||pt.reach||(b(_t,pt),this.first=m(20)),F("return"),this}).exps=!0,M("throw",function(){return _(this),b(_t,pt),this.first=m(20),F("throw"),this}).exps=!0,T("class"),T("const"),T("enum"),T("export"),T("extends"),T("import"),T("super"),T("let"),T("yield"),T("implements"),T("interface"),T("package"),T("private"),T("protected"),T("public"),T("static");var Zt=function(t,n,r){var o,l,c;if(e.errors=[],dt=Object.create(It),a(dt,r||{}),n){if(o=n.predef)if(Array.isArray(o))for(l=0;o.length>l;l+=1)dt[o[l]]=!0;else if("object"==typeof o)for(c=Object.keys(o),l=0;c.length>l;l+=1)dt[c[l]]=!!o[c];ht=n}else ht={};for(ht.indent=ht.indent||4,ht.maxerr=ht.maxerr||50,wt="",l=0;ht.indent>l;l+=1)wt+=" ";st=1,tt=Object.create(dt),ft=tt,Q={"(global)":!0,"(name)":"(global)","(scope)":ft,"(breakage)":0,"(loopage)":0},et=[Q],Lt=[],vt=!1,bt=null,lt={},ct=null,nt={},at=!1,ot=[],rt=!1,xt=0,Kt.init(t),mt=!0,yt=!1,gt=_t=pt=Rt["(begin)"],s();try{switch(d(),pt.id){case"{":case"[":ht.laxbreak=!0,rt=!0,J();break;default:"use strict"===pt.value&&(ht.globalstrict||i('Use the function form of "use strict".'),U()),H("lib")}d("(end)")}catch(p){p&&e.errors.push({reason:p.message,line:p.line||pt.line,character:p.character||pt.from},null)}return 0===e.errors.length};return e.data=function(){var t,a,s,r,i,o,l,c={functions:[]},p=[],u=[],h=[];e.errors.length&&(c.errors=e.errors),rt&&(c.json=!0);for(o in nt)n(nt,o)&&p.push({name:o,line:nt[o]});for(p.length>0&&(c.implieds=p),Lt.length>0&&(c.urls=Lt),a=Object.keys(ft),a.length>0&&(c.globals=a),r=1;et.length>r;r+=1){for(s=et[r],t={},i=0;jt.length>i;i+=1)t[jt[i]]=[];for(o in s)n(s,o)&&"("!==o.charAt(0)&&(l=s[o],"unction"===l&&(l="unused"),Array.isArray(t[l])&&(t[l].push(o),"unused"===l&&h.push({name:o,line:s["(line)"],"function":s["(name)"]})));for(i=0;jt.length>i;i+=1)0===t[jt[i]].length&&delete t[jt[i]];t.name=s["(name)"],t.param=s["(params)"],t.line=s["(line)"],t.last=s["(last)"],c.functions.push(t)}h.length>0&&(c.unused=h),u=[];for(o in lt)if("number"==typeof lt[o]){c.member=lt;break}return c},e.report=function(t){function n(e,t){var n,a,s;if(t){for(g.push("<div><i>"+e+"</i> "),t=t.sort(),a=0;t.length>a;a+=1)t[a]!==s&&(s=t[a],g.push((n?", ":"")+s),n=!0);g.push("</div>")}}var a,s,r,i,o,l,c,p,u,h=e.data(),d=[],m="",g=[];if(h.errors||h.implieds||h.unused){if(r=!0,g.push("<div id=errors><i>Error:</i>"),h.errors)for(o=0;h.errors.length>o;o+=1)a=h.errors[o],a&&(s=a.evidence||"",g.push("<p>Problem"+(isFinite(a.line)?" at line "+a.line+" character "+a.character:"")+": "+a.reason.entityify()+"</p><p class=evidence>"+(s&&(s.length>80?s.slice(0,77)+"...":s).entityify())+"</p>"));if(h.implieds){for(u=[],o=0;h.implieds.length>o;o+=1)u[o]="<code>"+h.implieds[o].name+"</code>&nbsp;<i>"+h.implieds[o].line+"</i>";g.push("<p><i>Implied global:</i> "+u.join(", ")+"</p>")}if(h.unused){for(u=[],o=0;h.unused.length>o;o+=1)u[o]="<code><u>"+h.unused[o].name+"</u></code>&nbsp;<i>"+h.unused[o].line+"</i> <code>"+h.unused[o]["function"]+"</code>";g.push("<p><i>Unused variable:</i> "+u.join(", ")+"</p>")}h.json&&g.push("<p>JSON: bad.</p>"),g.push("</div>")}if(!t){for(g.push("<br><div id=functions>"),h.urls&&n("URLs<br>",h.urls,"<br>"),h.json&&!r?g.push("<p>JSON: good.</p>"):h.globals?g.push("<div><i>Global</i> "+h.globals.sort().join(", ")+"</div>"):g.push("<div><i>No new global variables introduced.</i></div>"),o=0;h.functions.length>o;o+=1)i=h.functions[o],g.push("<br><div class=function><i>"+i.line+"-"+i.last+"</i> "+(i.name||"")+"("+(i.param?i.param.join(", "):"")+")</div>"),n("<big><b>Unused</b></big>",i.unused),n("Closure",i.closure),n("Variable",i["var"]),n("Exception",i.exception),n("Outer",i.outer),n("Global",i.global),n("Label",i.label);if(h.member){if(d=Object.keys(h.member),d.length){for(d=d.sort(),m="<br><pre id=members>/*members ",c=10,o=0;d.length>o;o+=1)l=d[o],p=l.name(),c+p.length>72&&(g.push(m+"<br>"),m="    ",c=1),c+=p.length+2,1===h.member[l]&&(p="<i>"+p+"</i>"),d.length-1>o&&(p+=", "),m+=p;g.push(m+"<br>*/</pre>")}g.push("</div>")}}return g.join("")},e.jshint=Zt,e.edition="2011-04-16",Zt});"object"==typeof t&&(t.JSHINT=n),"undefined"!=typeof bootstrap&&bootstrap("core/jshint",function(e,t){"use strict";t.JSHINT=n})}}),montageDefine("b8d1a32","core/serialization/serializer/montage-ast",{dependencies:["montage","mousse/serialization/ast"],factory:function(e,t){var n=e("montage").Montage,a=e("mousse/serialization/ast").Value,s=n.specialize.call(a,{constructor:{value:function s(){}},initWithRootAndId:{value:function(e,t){return a.call(this,e,t),this}},_getSerializationValue:{value:function(){return{"#":this.value}}}});t.ElementReference=s}}),montageDefine("b8d1a32","core/serialization/serializer/properties-serializer",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage,a=n.specialize.call(Object,{_malker:{value:null},_visitor:{value:null},_object:{value:null},constructor:{value:function a(){}},initWithMalkerAndVisitorAndObject:{value:function(e,t,n){return this._malker=e,this._visitor=t,this._object=n,this}},addObject:{value:function(e){return"object"==typeof e?(this._malker.visit(e),e):void 0}},addObjectReference:{value:function(e){var t=this._visitor.builder,n=this._visitor.labeler,a=n.getObjectLabel(e),r=Object.create(s);return r.reference=t.createReference(a),r}},set:{value:function(e,t,n){this._visitor.setProperty(this._malker,e,t,n)}},setAll:{value:function(){this._visitor.setSerializableObjectProperties(this._malker,this._object)}}}),s={thisIsAReferenceCreatedByMontageSerializer:!0,reference:null};t.PropertiesSerializer=a}}),montageDefine("b8d1a32","core/serialization/serializer/self-serializer",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage,a=n.specialize.call(Object,{_malker:{value:null},_visitor:{value:null},_object:{value:null},constructor:{value:function a(){}},initWithMalkerAndVisitorAndObject:{value:function(e,t,n){return this._malker=e,this._visitor=t,this._object=n,this}},getObjectLabel:{value:function(e){return this._visitor.labeler.getObjectLabel(e)}},addObject:{value:function(e){return"object"==typeof e?(this._malker.visit(e),e):void 0}},addObjectReference:{value:function(e){var t=this._visitor.builder,n=this._visitor.labeler,a=n.getObjectLabel(e);return{thisIsAReferenceCreatedByMontageSerializer:!0,reference:t.createObjectReference(a)}}},setProperty:{value:function(e,t,n){var a,s=this._visitor.builder;a=s.top.getProperty("properties"),s.push(a),this._visitor.setProperty(this._malker,e,t,n),s.pop()}},setAllProperties:{value:function(){var e,t=this._visitor.builder;e=t.top.getProperty("properties"),t.push(e),this._visitor.setSerializableObjectProperties(this._malker,this._object),t.pop()}},setUnit:{value:function(e){this._visitor.setObjectCustomUnit(this._malker,this._object,e)}},setAllUnits:{value:function(){this._visitor.setObjectCustomUnits(this._malker,this._object)}}});t.SelfSerializer=a}}),montageDefine("b8d1a32","core/serialization/serializer/unit-serializer",{dependencies:["montage"],factory:function(e,t){function n(e,t,n){this._visitor=e,this._malker=t,this._object=n}var a=e("montage").Montage,n=a.specialize.call(Object,{_malker:{value:null},_visitor:{value:null},_object:{value:null},constructor:{value:function n(){}},initWithMalkerAndVisitorAndObject:{value:function(e,t,n){return this._malker=e,this._visitor=t,this._object=n,this}},getObjectLabel:{value:function(e){return this.addObjectReference(e),this._visitor.labeler.getObjectLabel(e)}},addObject:{value:function(e){return"object"==typeof e?(this._malker.visit(e),e):void 0}},addObjectReference:{value:function(e){var t=this._visitor.builder,n=this._visitor.labeler,a=n.getObjectLabel(e);return{thisIsAReferenceCreatedByMontageSerializer:!0,reference:t.createObjectReference(a)}}}});t.UnitSerializer=n}}),montageDefine("b8d1a32","ui/component",{dependencies:["montage","core/target","core/bindings","core/template","core/document-resources","core/gate","core/promise","core/logger","core/event/event-manager","collections/set","core/application"],factory:function(e,t){var n=e("montage").Montage,a=e("core/target").Target,s=e("core/bindings").Bindings,r=e("core/template").Template,i=e("core/document-resources").DocumentResources,o=e("core/gate").Gate,l=e("core/promise").Promise,c=e("core/logger").logger("component"),p=e("core/logger").logger("Drawing performance"),u=e("core/logger").logger("drawing"),h=e("core/event/event-manager").defaultEventManager,d=e("collections/set"),m=t.Component=a.specialize({DOM_ARG_ATTRIBUTE:{value:"data-arg"},constructor:{value:function(){n.constructor.call(this),this._isComponentExpanded=!1,this._isTemplateLoaded=!1,this._isTemplateInstantiated=!1,this._isComponentTreeLoaded=!1}},delegate:{value:null},templateObjects:{serializable:!1,value:null},_nextTarget:{value:null},nextTarget:{get:function(){return this._nextTarget||this.parentComponent},set:function(e){this._nextTarget=e}},_ownerDocumentPart:{value:null},_templateDocumentPart:{value:null},_domArguments:{value:null},_dispatchActionEvent:{value:function(){this.dispatchEvent(this.createActionEvent())},enumerable:!1},createActionEvent:{value:function(){var e=document.createEvent("CustomEvent");return e.initCustomEvent("action",!0,!0,null),e}},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new o).initWithDelegate(this),this._canDrawGate.setField("componentTreeLoaded",!1)),this._canDrawGate},enumerable:!1},_blockDrawGate:{value:null},blockDrawGate:{enumerable:!1,get:function(){return this._blockDrawGate||(this._blockDrawGate=(new o).initWithDelegate(this),this._blockDrawGate.setField("element",!1),this._blockDrawGate.setField("drawRequested",!1)),this._blockDrawGate}},_firstDraw:{enumerable:!1,value:!0},_completedFirstDraw:{enumerable:!1,value:!1},originalElement:{value:null},_element:{enumerable:!1,value:null},element:{get:function(){return this._element},set:function(e){if(null==e)return console.warn("Tried to set element of ",this," to ",e),void 0;if(this.isDeserializing)this.eventManager.registerEventHandlerForElement(this,e),this._isTemplateInstantiated?this._templateElement||(this._templateElement=e):(this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0));else{if(!this._firstDraw)return console.error("Cannot change element of ",this," after it has been set"),void 0;this.eventManager.registerEventHandlerForElement(this,e),this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0)}this._initializeClassListFromElement(e)}},getElementId:{value:function(){var e=this._element;return e?e.getAttribute("data-montage-id"):void 0}},_initDomArguments:{value:function(){var e,t,n,a={},s=this.element;e=s.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"]");
e:for(var r,i=0;r=e[i];i++){for(n=r;(n=n.parentNode)!==s;)if(n.component)continue e;this._findAndDetachComponents(r),r.parentNode.removeChild(r),t=r.getAttribute(this.DOM_ARG_ATTRIBUTE),r.removeAttribute(this.DOM_ARG_ATTRIBUTE),a[t]=r}this._domArguments=a}},getDomArgumentNames:{value:function(){return Object.keys(this._domArguments)}},extractDomArgument:{value:function(e){var t;return t=this._domArguments[e],delete this._domArguments[e],t}},_getDomArgument:{value:function(e,t){var n,a,s,r,i;n=e.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"='"+t+"']");e:for(var o,l=0;o=n[l];l++){for(a=o;(a=a.parentNode)!==e;)if(s=this._template.getElementId(a),s&&(r=this._template.getSerialization(),i=r.getSerializationLabelsWithElements(s),i.length>0))continue e;return o}}},getTemplateParameterArgument:{value:function(e,t){var n,a,s;return n=e.getElementById(this.getElementId()),"*"===t?(a=e.document.createRange(),a.selectNodeContents(n),s=a.cloneContents()):(s=this._getDomArgument(n,t).cloneNode(!0),s.removeAttribute(this.DOM_ARG_ATTRIBUTE)),s}},setElementWithParentComponent:{value:function(e,t){this._alternateParentComponent=t,this.element!==e&&(this.element=e)}},application:{enumerable:!1,get:function(){return e("core/application").application}},eventManager:{enumerable:!1,get:function(){return h}},rootComponent:{enumerable:!1,get:function(){return f}},elementControllerFromEvent:{enumerable:!1,value:function(e,t){return t}},_alternateParentComponent:{value:null},__parentComponent:{value:null},_parentComponent:{set:function(e){this.__parentComponent=e,this.dispatchOwnPropertyChange("parentComponent",e)},get:function(){return this.__parentComponent}},parentComponent:{enumerable:!1,get:function(){return this._parentComponent}},findParentComponent:{value:function(){var e,t=this.element,n=this.eventManager;if(t){for(;null!=(e=t.parentNode)&&null==n.eventHandlerForElement(e);)t=e;return e?n.eventHandlerForElement(e):this._alternateParentComponent}}},querySelectorComponent:{value:function(e){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var t=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!t)throw'querySelectorComponent: Syntax error "'+e+'"';var a,s,r,i=this.childComponents,o=t[1],l=(t[2]||" ",t[3]),c=t[4];if(o)for(c=l?"@"+l+c:"",s=0,r;r=i[s];s++){if(o===n.getInfoForObject(r).label)return c?r.querySelectorComponent(c):r;if(a=r.querySelectorComponent(e))return a}else for(s=0,r;r=i[s];s++)if(l===n.getInfoForObject(r).label)return c?r.querySelectorComponent(c):r;return null}},querySelectorAllComponent:{value:function(e,t){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var a=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!a)throw'querySelectorComponent: Syntax error "'+e+'"';var s,r,i=this.childComponents,o=a[1],l=(a[2]||" ",a[3]),c=a[4],p=[];if(o)for(c=l?"@"+l+c:"",s=0,r;r=i[s];s++)o!==n.getInfoForObject(r).label||t&&t!==r.ownerComponent?p=p.concat(r.querySelectorAllComponent(e,t)):c?p=p.concat(r.querySelectorAllComponent(c)):p.push(r);else for(s=0,r;r=i[s];s++)l!==n.getInfoForObject(r).label||t&&t!==r.ownerComponent||(c?p=p.concat(r.querySelectorAllComponent(c,t)):p.push(r));return p}},template:{enumerable:!1,value:null},hasTemplate:{enumerable:!1,value:!0},_templateModuleId:{serializable:!1,value:null},_template:{value:null},_treeLevel:{value:0},_addChildComponent:{value:function(e){return this.addChildComponent(e)}},addChildComponent:{value:function(e){-1===this.childComponents.indexOf(e)&&(this.childComponents.push(e),e._prepareForEnterDocument(),e._parentComponent=this,e.needsDraw&&e._addToParentsDrawList())}},attachToParentComponent:{value:function(){this.detachFromParentComponent(),this._parentComponent=null;var e,t,n=this.findParentComponent();if(n){e=n.childComponents;for(var a=0;t=e[a];a++){var s=t.findParentComponent();s===this&&(n.removeChildComponent(t),s.addChildComponent(t))}n.addChildComponent(this)}}},detachFromParentComponent:{value:function(){var e=this.parentComponent;e&&e.removeChildComponent(this)}},removeChildComponent:{value:function(e){var t=this.childComponents,n=t.indexOf(e);n>-1&&(t.splice(n,1),e._parentComponent=null,e._alternateParentComponent=null,e._leaveDocument(),e._addedToDrawList&&(e._addedToDrawList=!1,n=this._drawList.indexOf(e),this._drawList.splice(n,1)),this.rootComponent.removeFromCannotDrawList(e))}},childComponents:{enumerable:!1,distinct:!0,value:[]},_needsEnterDocument:{value:!1},_inDocument:{value:!1},__leaveDocument:{value:function(){this._inDocument&&"function"==typeof this.leaveDocument&&(this.leaveDocument(),this._inDocument=!1)}},_leaveDocument:{value:function(){this._needsEnterDocument?this._needsEnterDocument=!1:(this.__leaveDocument(),this.traverseComponentTree(function(e){e.__leaveDocument()}))}},_prepareForEnterDocument:{value:function(){this._needsEnterDocument=!0,this._firstDraw||(this.needsDraw=!0,this.traverseComponentTree(function(e){return e._needsEnterDocument?!1:(e._needsEnterDocument=!0,e.needsDraw=!0,void 0)}))}},ownerComponent:{enumerable:!1,value:null},components:{enumerable:!1,value:{}},_isComponentExpanded:{enumerable:!1,value:null},_isTemplateLoaded:{enumerable:!1,value:null},_isTemplateInstantiated:{enumerable:!1,value:null},cleanupDeletedComponentTree:{value:function(e){e&&s.cancelBindings(this),this.needsDraw=!1,this.traverseComponentTree(function(t){e&&s.cancelBindings(t),t.needsDraw=!1})}},_newDomContent:{enumerable:!1,value:null},domContent:{serializable:!1,get:function(){return this._element?Array.prototype.slice.call(this._element.childNodes,0):null},set:function(e){var t,n,a,s=[];for(this._newDomContent=e,this.needsDraw=!0,null===this._newDomContent&&(this._shouldClearDomContentOnNextDraw=!0),"function"==typeof this.contentWillChange&&this.contentWillChange(e),t=this.childComponents,n=0,a;a=t[n];n++)a.detachFromParentComponent();if(e instanceof Element)this._findAndDetachComponents(e,s);else if(e&&e[0])for(n=0;e.length>n;n++)this._findAndDetachComponents(e[n],s);for(n=0,a;a=s[n];n++)this.addChildComponent(a)}},_shouldClearDomContentOnNextDraw:{value:!1},_findAndDetachComponents:{value:function(e,t){var n,a=e.component;if(t||(t=[]),a)a.detachFromParentComponent(),t.push(a);else{n=e.children||e.childNodes;for(var s,r=0;s=n[r];r++)this._findAndDetachComponents(s,t)}return t}},clonesChildComponents:{writable:!1,value:!1},_innerTemplate:{value:null},innerTemplate:{serializable:!1,get:function(){var e,t,n,a,s,r,i,o=this._innerTemplate;if(!o&&(e=this._ownerDocumentPart)){t=e.template,n=this.getElementId(),o=t.createTemplateFromElementContents(n),a=o.getSerialization(),s=a.getExternalObjectLabels(),r=e.objects,i=Object.create(null);for(var l,c=0;l=s[c];c++)i[l]=r[l];o.setInstances(i),this._innerTemplate=o}return o},set:function(e){this._innerTemplate=e}},canDraw:{value:function(){return this._canDraw}},_canDraw:{get:function(){return!this._canDrawGate||this._canDrawGate.value},set:function(e){f.componentCanDraw(this,e)},enumerable:!1},_prepareCanDraw:{enumerable:!1,value:function(){this._isComponentTreeLoaded||this.loadComponentTree().done()}},_isComponentTreeLoaded:{value:null},shouldLoadComponentTree:{value:!0},_loadComponentTreeDeferred:{value:null},loadComponentTree:{value:function(){var e=this,t=this.canDrawGate,n=this._loadComponentTreeDeferred;return n||(n=l.defer(),this._loadComponentTreeDeferred=n,t.setField("componentTreeLoaded",!1),(this.needsDraw||this.hasTemplate)&&(this._canDraw=!1),this.expandComponent().then(function(){if(e.hasTemplate||e.shouldLoadComponentTree){for(var t,n=[],a=e.childComponents,s=0;t=a[s];s++)n.push(t.loadComponentTree());return l.all(n)}}).then(function(){e._isComponentTreeLoaded=!0,e._needsEnterDocument&&(e.needsDraw=!0),t.setField("componentTreeLoaded",!0),n.resolve()},n.reject).done()),n.promise}},traverseComponentTree:{value:function(e,t){function n(){var n,s,r=a.childComponents;if(e&&e(a)===!1)return t&&t(),void 0;if(0===(s=r.length))return t&&t(),void 0;for(var i=function(){0===--s&&t&&t()},o=0;n=r[o];o++)n.traverseComponentTree(e,i)}var a=this;this._isComponentExpanded?n():t&&t()}},_expandComponentDeferred:{value:null},expandComponent:{value:function(){var e=this,t=this._expandComponentDeferred;return t||(t=l.defer(),this._expandComponentDeferred=t,this.hasTemplate?this._instantiateTemplate().then(function(){e._isComponentExpanded=!0,e._addTemplateStyles(),e.needsDraw=!0,t.resolve()},t.reject):(this._isComponentExpanded=!0,t.resolve())),t.promise}},_templateObjectDescriptor:{value:{enumerable:!0,configurable:!0}},_setupTemplateObjects:{value:function(e){var t=this._templateObjectDescriptor,n=Object.create(null);for(var a in e){var s=e[a];"object"==typeof s&&null!=s&&(m.prototype.isPrototypeOf(s)&&s!==this&&s.parentComponent!==this?(t.get=this._makeTemplateObjectGetter(this,a,s),Object.defineProperty(n,a,t)):n[a]=s)}this.templateObjects=n}},_makeTemplateObjectGetter:{value:function(e,t,n){var a,s,r,i="@"+t;return function(){if(a)return e.querySelectorAllComponent(i,e);if(s=e.querySelectorAllComponent(i,e),1===s.length)for(r=s[0];r=r.parentComponent;){if(r===e)return Object.defineProperty(this,t,{value:s[0]}),s[0];if(r.clonesChildComponents)break}else if(0===s.length)return n;return a=!0,s}}},_instantiateTemplate:{value:function(){var e=this;return this._loadTemplate().then(function(t){if(!e._element)return console.error("Cannot instantiate template without an element.",e),l.reject(Error("Cannot instantiate template without an element.",e));var n=e.templateObjects,a=e._element.ownerDocument;return n?n.owner=e:n={owner:e},e._isTemplateInstantiated=!0,t.instantiateWithInstances(n,a).then(function(t){e._templateDocumentPart=t,t.fragment=null}).fail(function(e){var n=e.stack||e;throw console.error("Error in",t.getBaseUrl()+":",n),e})})}},_templateDidLoad:{value:function(e){this._setupTemplateObjects(e.objects)}},_loadTemplatePromise:{value:null},_loadTemplate:{value:function(){var e,t=this,a=this._loadTemplatePromise;return a||(e=n.getInfoForObject(this),a=this._loadTemplatePromise=r.getTemplateWithModuleId(this.templateModuleId,e.require).then(function(e){return t._template=e,t._isTemplateLoaded=!0,e})),a}},templateModuleId:{get:function(){return this._templateModuleId||this._getDefaultTemplateModuleId()}},_getDefaultTemplateModuleId:{value:function(){var e,t,a,s;return s=n.getInfoForObject(this),a=s.moduleId,t=a.lastIndexOf("/"),e=a+"/"+a.slice(-1===t?0:t+1,-5)+".html"}},deserializedFromSerialization:{value:function(){this.attachToParentComponent()}},_deserializedFromTemplate:{value:function(e,t,a){n.getInfoForObject(this).label=t,this._ownerDocumentPart=a,this.hasOwnProperty("identifier")||(this.identifier=t),this.ownerComponent||(this.ownerComponent=m.prototype.isPrototypeOf(e)?e:this.rootComponent),this._needsDrawInDeserialization&&(this.needsDraw=!0)}},blueprintModuleId:{serializable:!1,enumerable:!1,get:function(){var e=n.getInfoForObject(this),t=e&&!e.isInstance?this:Object.getPrototypeOf(this);if(!Object.getOwnPropertyDescriptor(t,"_blueprintModuleId")||!t._blueprintModuleId){e=n.getInfoForObject(t);var a=e.moduleId,s=a.lastIndexOf("/"),r=a.lastIndexOf(".");s=-1===s?0:s+1,r=-1===r?a.length:r,r=s>r?a.length:r;var i;i=a.length>r&&".reel"===a.slice(r,a.length)?a+"/"+a.slice(s,r)+".meta":a.slice(0,r)+".meta",n.defineProperty(t,"_blueprintModuleId",{value:i})}return t._blueprintModuleId}},blueprint:e("montage")._blueprintDescriptor,gateDidBecomeTrue:{value:function(e){e===this._canDrawGate?this._canDraw=!0:e===this._blockDrawGate&&(f.componentBlockDraw(this),this._prepareCanDraw())},enumerable:!1},_canDrawGate:{enumerable:!1,value:null},_preparedForActivationEvents:{enumerable:!1,value:!1},_drawIfNeeded:{enumerable:!1,value:function(e){var t,a,s,r,i=this._firstDraw;if(this._treeLevel=e,i&&(this.originalElement=this.element),this.needsDraw&&f.addToDrawCycle(this),i&&this.prepareForDraw&&n.callDeprecatedFunction(this,this.prepareForDraw,"prepareForDraw","enterDocument(firstTime)"),this._needsEnterDocument&&(this._needsEnterDocument=!1,this._inDocument=!0,"function"==typeof this.enterDocument&&this.enterDocument(i),this._enterDocument(i)),i&&(this.originalElement=null),u.isDebug&&u.debug(this,"drawList: "+(this._drawList||[]).length+" of "+this.childComponents.length),null!==this._drawList&&this._drawList.length>0)for(a=this._drawList,this._drawList=[],r=a.length,s=0;r>s;s++)t=a[s],u.isDebug&&u.debug("Parent Component "+(null!=this.element?this.element.id:"")+" drawList length: "+a.length),t._addedToDrawList=!1,u.isDebug&&u.debug(this,"childComponent: "+t.element+"; canDraw: "+t.canDraw()),t.canDraw()&&t._drawIfNeeded(e+1)}},_updateComponentDom:{value:function(){var e,t,n;if(this._firstDraw){for(this._prepareForDraw(),t=this.composerList.length,n=0;t>n;n++)e=this.composerList[n],e.lazyLoad||e._load();this._firstDraw=!1}(null!==this._newDomContent||this._shouldClearDomContentOnNextDraw)&&(u.isDebug&&c.debug("Component content changed: component ",this._montage_metadata.objectName,this.identifier," newDomContent",this._newDomContent),this._performDomContentChanges())}},_replaceElementWithTemplate:{enumerable:!1,value:function(){var e,t,n,a,s=this.element,r=this._templateElement,i=this.element.attributes;for(n=0;a=i[n];n++)e=a.nodeName,t="id"===e||"data-montage-id"===e?a.nodeValue:(r.getAttribute(e)||"")+("style"===e?"; ":" ")+a.nodeValue,r.setAttribute(e,t);this._initializeClassListFromElement(r),s.parentNode?s.parentNode.replaceChild(r,s):console.warn("Warning: Trying to replace element ",s," which has no parentNode"),this.eventManager.unregisterEventHandlerForElement(s),this.eventManager.registerEventHandlerForElement(this,r),this._element=r,this._templateElement=null,this._newDomContent&&(this._newDomContent=null,this._shouldClearDomContentOnNextDraw=!1)}},_addTemplateStyles:{value:function(){var e,t,n,a,s=this._templateDocumentPart;if(s){e=s.template.getResources(),n=this.element.ownerDocument,a=n.head,t=e.createStylesForDocument(n);for(var r,i=0;r=t[i];i++)this.rootComponent.addStylesheet(r)}}},_prepareForDraw:{value:function(){c.isDebug&&c.debug(this,"_templateElement: "+this._templateElement),this._initDomArguments(),this._templateElement&&(this._bindTemplateParametersToArguments(),this._replaceElementWithTemplate())},enumerable:!1},_bindTemplateParametersToArguments:{value:function(){var e,t,n,a,s,r,i,o,l=this._templateDocumentPart.parameters;if(t=this._domArguments,this._template.hasParameters()||1!==t.length){if(a=this._validateTemplateArguments(t,l))throw a;for(var c in l){e=l[c],n=t[c],"*"===c?(i=this._element.ownerDocument.createRange(),i.selectNodeContents(this._element),s=i.extractContents()):s=n,r=this._findAndDetachComponents(s),e.parentNode.replaceChild(s,e);for(var p=0;o=r[p];p++)o.attachToParentComponent()}}}},_validateTemplateArguments:{value:function(e,t){var n,a,s=Object.keys(t);if(0!==s.length)if(null==e){if(s.length>0)return Error("No arguments provided for "+this.templateModuleId+". Arguments needed: "+s+".")}else if("*"in t){if(n=Object.keys(e),n.length>0)return Error('Arguments "'+n+'" were given to component but no named parameters '+"are defined in "+this.templateModuleId)}else{for(a in t)if(!(a in e))return Error('"'+a+'" argument not '+"given in "+this.templateModuleId);for(a in e)if("*"!==a&&!(a in t))return Error('"'+a+'" parameter does '+"not exist in "+this.templateModuleId)}}},prepareForActivationEvents:{enumerable:!1,value:null},_prepareForActivationEvents:{value:function(){var e,t=this.composerList.length;for(t=0;this.composerList.length>t;t++)e=this.composerList[t],e.lazyLoad&&e._load();"function"==typeof this.prepareForActivationEvents&&this.prepareForActivationEvents()}},_performDomContentChanges:{value:function(){var e,t=this._newDomContent,n=this._element.childNodes[0];if(t||this._shouldClearDomContentOnNextDraw){if(e=this._element,e.innerHTML="",Element.isElement(t))e.appendChild(t);else if(null!=t)for(var a,s=0;a=t[s];s++)e.appendChild(a);this._newDomContent=null,"function"==typeof this.contentDidChange&&this.contentDidChange(this._element.childNodes[0],n),this._shouldClearDomContentOnNextDraw=!1}}},prepareForDraw:{enumerable:!1,value:null},draw:{enumerable:!1,value:function(){}},willDraw:{enumerable:!1,value:null},didDraw:{enumerable:!1,value:function(){}},_addedToDrawList:{value:!1},_addToParentsDrawList:{enumerable:!1,value:function(){if(!this._addedToDrawList){var e=this.parentComponent;e?(e._addToDrawList(this),u.isDebug&&u.debug("drawList -- childComponent",this._montage_metadata.objectName," added to ",e._montage_metadata.objectName)):u.isDebug&&u.debug(this,"parentComponent is null")}}},_needsDraw:{value:!1},_needsDrawInDeserialization:{value:!1},needsDraw:{enumerable:!1,get:function(){return!!this._needsDraw},set:function(e){return this.isDeserializing?(this._needsDrawInDeserialization=!0,void 0):(this._needsDraw!==e&&(u.isDebug&&u.debug("NEEDS DRAW TOGGLED "+e+" FOR "+this._montage_metadata.objectName),this._needsDraw=!!e,e&&(this.canDrawGate.value?this._addToParentsDrawList():this.blockDrawGate.setField("drawRequested",!0))),void 0)}},_drawList:{value:null},__addToDrawList:{enumerable:!1,value:function(e){null===this._drawList?(this._drawList=[e],e._addedToDrawList=!0):-1===this._drawList.indexOf(e)&&(this._drawList.push(e),e._addedToDrawList=!0)}},_addToDrawList:{enumerable:!1,value:function(e){this.__addToDrawList(e),this._addToParentsDrawList()}},_templateElement:{enumerable:!1,value:null},surrenderPointer:{value:function(){return!0}},composerList:{value:[],distinct:!0,serializable:!1},addComposer:{value:function(e){this.addComposerForElement(e,e.element)}},addComposerForElement:{value:function(e,t){e.component=this,e.element=t,this.composerList.push(e),this._firstDraw||(e.lazyLoad?this._preparedForActivationEvents&&e._load():e._load())}},scheduleComposer:{value:function(e){this.rootComponent.addToComposerList(e)}},removeComposer:{value:function(e){var t,n;for(n=this.composerList.length,t=0;n>t;t++)if(this.composerList[t].uuid===e.uuid){this.composerList[t].unload(),this.composerList.splice(t,1);break}}},clearAllComposers:{value:function(){var e,t,n=this.composerList;for(t=n.length,e=0;t>e;e++)n[e].unload();n.splice(0,t)}},localizer:{value:null},_waitForLocalizerMessages:{value:!1},waitForLocalizerMessages:{enumerable:!1,get:function(){return this._waitForLocalizerMessages},set:function(e){if(this._waitForLocalizerMessages!==e)if(e!==!0||this.localizer.messages)this._waitForLocalizerMessages=!1,this.canDrawGate.setField("messages",!0);else{if(!this.localizer)throw"Cannot wait for messages on localizer if it is not set";this._waitForLocalizerMessages=!0;var t=this;c.debug(this,"waiting for messages from localizer"),this.canDrawGate.setField("messages",!1),this.localizer.messagesPromise.then(function(){c.isDebug&&c.debug(t,"got messages from localizer"),t.canDrawGate.setField("messages",!0)})}}},_elementAttributeValues:{value:null},_elementAttributeDescriptors:{value:null},_getElementAttributeDescriptor:{value:function(e){for(var t,n=this;n&&n._elementAttributeDescriptors&&!(t=n._elementAttributeDescriptors[e]);)n=Object.getPrototypeOf(n);return t}},defineAttribute:{value:function(e,t){t=t||{};var a="_"+e,s={configurable:void 0===t.configurable?!0:t.configurable,enumerable:void 0===t.enumerable?!0:t.enumerable,set:function(e,t){return function(n){var a=this._getElementAttributeDescriptor(e,this);a&&"boolean"===a.dataType&&(n=n||""===n?!0:!1),void 0!==n&&this[t]!==n&&(this[t]=n,null===this._elementAttributeValues&&(this._elementAttributeValues={}),this._elementAttributeValues[e]=n,this.needsDraw=!0)}}(e,a),get:function(e,t){return function(){return this[t]}}(e,a)};n.defineProperty(this.prototype,a,{value:null}),n.defineProperty(this.prototype,e,s)}},addAttributes:{value:function(e){var t,n,a;this.prototype._elementAttributeDescriptors=e;for(n in e)e.hasOwnProperty(n)&&(a=e[n],null===a||"string"==typeof a?(t={value:a,dataType:"string"},e[n]=t):t=a,void 0===this[n]&&this.defineAttribute(n,t))}},_enterDocument:{value:function(e){var t;if(e){t=this.originalElement;var n,a,s,r,i,o,l;if(n=t.attributes)for(s=n.length,a=0;s>a;a++)r=n[a].name,i=n[a].value,l=this._getElementAttributeDescriptor(r,this),(l||void 0!==this[r])&&(null===this._elementAttributeValues&&(this._elementAttributeValues={}),void 0===this._elementAttributeValues[r]&&(this._elementAttributeValues[r]=i,(void 0===this[r]||null==this[r])&&(this[r]=i)));if(l=this._getElementAttributeDescriptor("textContent",this)){var c=t.textContent;void 0===this._elementAttributeValues.textContent&&(this._elementAttributeValues.textContent=c,null==this.textContent&&(this.textContent=c))}if(this._elementAttributeDescriptors)for(o in this._elementAttributeDescriptors){l=this._elementAttributeDescriptors[o];var p="_"+o;null===this[p]&&null!==l&&"value"in l&&(this[p]=this._elementAttributeDescriptors[o].value)}}}},_draw:{value:function(){var e,t=this.element;for(var n in this._elementAttributeValues)if(this._elementAttributeValues.hasOwnProperty(n)){var a=this[n];e=this._getElementAttributeDescriptor(n,this),e&&("boolean"===e.dataType?a===!0?(t[n]=!0,t.setAttribute(n,n.toLowerCase())):(t[n]=!1,t.removeAttribute(n)):void 0!==a&&("textContent"===n?t.textContent=a:t.setAttribute(n,a))),delete this._elementAttributeValues[n]}this._drawClassListIntoComponent()}},_classList:{value:null},_classListDirty:{value:!1},classList:{get:function(){return null===this._classList&&(this._classList=new d,this._subscribeToToClassListChanges(),this._initializeClassListFromElement(this.element)),this._classList}},_initializeClassListFromElement:{value:function(e){var t;if(e&&e.className&&(t=e.className.trim())&&0!==t.length){var n=this.classList;this._unsubscribeToClassListChanges&&this._unsubscribeToClassListChanges(),n.addEach(t.split(/\s+/)),this._subscribeToToClassListChanges()}}},_unsubscribeToClassListChanges:{value:null},_subscribeToToClassListChanges:{value:function(){this._unsubscribeToClassListChanges=this._classList.addRangeChangeListener(this,"classList")}},handleClassListRangeChange:{value:function(){this._classListDirty=!0,this.needsDraw=!0}},_drawClassListIntoComponent:{value:function(){if(this._classListDirty){for(var e,t=this.element.classList,n=this._classList,a=0,s=t.length;s>a;a++)e=t.item(a),n.has(e)||(t.remove(e),a--,s--);this._classList.forEach(function(e){t.add(e)}),this._classListDirty=!1}}},dispose:{value:function(){this.cancelBindings(),this.detachFromParentComponent(),h.unregisterEventHandlerForElement(this,this._element),this._element=null,this.childComponents.forEach(function(e){e.dispose()})}}}),g=m.specialize({init:{value:function(){return this}},needsDraw:{enumerable:!0,get:function(){return!1},set:function(e){if(this._needsDraw!==e&&(this._needsDraw=!!e,e))for(var t,n=this.childComponents,a=0;t=n[a];a++)u.isDebug&&u.debug(this,"needsDraw = true for: "+t._montage_metadata.exportedSymbol),t.needsDraw=!0}},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new o).initWithDelegate(this))}},_clearNeedsDrawTimeOut:{value:null},_needsDrawList:{value:[]},_cannotDrawList:{value:null},componentBlockDraw:{value:function(e){this._cannotDrawList=this._cannotDrawList?this._cannotDrawList:{},this._cannotDrawList[e.uuid]=e,this._clearNeedsDrawTimeOut&&(window.clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},componentCanDraw:{value:function(e,t){if(t){if(!this._cannotDrawList)return;if(delete this._cannotDrawList[e.uuid],this._needsDrawList.push(e),0===Object.keys(this._cannotDrawList).length&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut){var n=this;this._clearNeedsDrawTimeOut=window.setTimeout(function(){n._clearNeedsDrawList()},0)}}else this._clearNeedsDrawTimeOut&&(window.clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},_clearNeedsDrawList:{value:function(){var e,t,n,a=this._needsDrawList;for(n=a.length,t=0;n>t;t++)e=a[t],e.needsDraw&&e._addToParentsDrawList();this._clearNeedsDrawTimeOut=null,a.splice(0,n)}},removeFromCannotDrawList:{value:function(e){if(delete this._cannotDrawList[e.uuid],0===Object.keys(this._cannotDrawList).length&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut){var t=this;this._clearNeedsDrawTimeOut=window.setTimeout(function(){t._clearNeedsDrawList()},0)}}},_cancelDrawIfScheduled:{value:function(){var e=this.requestedAnimationFrame,t=this.cancelAnimationFrame;null!==e&&(this._frameTime||(c.isDebug&&c.debug(this,"clearing draw"),t?t.call(window,e):window.clearTimeout(e),this.requestedAnimationFrame=null))}},_addToDrawList:{value:function(e){this.__addToDrawList(e),u.isDebug&&u.debug(this,this.canDrawGate.value,this.requestedAnimationFrame),this.drawTree()},enumerable:!1},addToComposerList:{value:function(e){this.composerList.push(e),u.isDebug&&u.debug(this,e,"Added to composer list"),this._scheduleComposerRequest=!0,this.drawTree()}},composerListSwap:{value:[],distinct:!0},_scheduleComposerRequest:{value:!1},requestedAnimationFrame:{value:null,enumerable:!1},requestAnimationFrame:{value:window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame:window.mozRequestAnimationFrame,enumerable:!1},cancelAnimationFrame:{value:window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame:window.mozCancelRequestAnimationFrame,enumerable:!1},_frameTime:{value:null},_oldSource:{value:null},_diff:{value:function(e,t){for(var n={},a={},s=0;t.length>s;s++)null==n[t[s]]&&(n[t[s]]={rows:[],o:null}),n[t[s]].rows.push(s);for(s=0;e.length>s;s++)null==a[e[s]]&&(a[e[s]]={rows:[],n:null}),a[e[s]].rows.push(s);for(s in n)1===n[s].rows.length&&void 0!==a[s]&&1===a[s].rows.length&&(t[n[s].rows[0]]={text:t[n[s].rows[0]],row:a[s].rows[0]},e[a[s].rows[0]]={text:e[a[s].rows[0]],row:n[s].rows[0]});for(s=0;t.length-1>s;s++)null!=t[s].text&&null==t[s+1].text&&t[s].row+1<e.length&&null==e[t[s].row+1].text&&t[s+1]==e[t[s].row+1]&&(t[s+1]={text:t[s+1],row:t[s].row+1},e[t[s].row+1]={text:e[t[s].row+1],row:s+1});for(s=t.length-1;s>0;s--)null!=t[s].text&&null==t[s-1].text&&t[s].row>0&&null==e[t[s].row-1].text&&t[s-1]==e[t[s].row-1]&&(t[s-1]={text:t[s-1],row:t[s].row-1},e[t[s].row-1]={text:e[t[s].row-1],row:s-1});return{o:e,n:t}}},_previousDrawDate:{enumerable:!1,value:0},_documentResources:{value:null},_needsStylesheetsDraw:{value:!1},_stylesheets:{value:[]},addStylesheet:{value:function(e){this._stylesheets.push(e),this._needsStylesheetsDraw=!0}},drawStylesheets:{value:function(){for(var e,t=this._documentResources,n=this._stylesheets;e=n.shift();)t.addStyle(e);this._needsStylesheetsDraw=!1}},drawTree:{value:function(){if(null===this.requestedAnimationFrame){u.isDebug&&u.debug(this,"requesting a draw");var e=this,t=this.requestAnimationFrame,n=function(t){var n;if(e._needsStylesheetsDraw)return e.drawStylesheets(),e.requestedAnimationFrame=null,e.drawTree(),void 0;if(p.isDebug&&(n=window.performance.now()),e._frameTime=t?t:Date.now(),e._clearNeedsDrawTimeOut&&e._clearNeedsDrawList(),u.isDebug){var a=document.documentElement.innerHTML;if(e._oldSource&&a!==e._oldSource){for(var s=["DOM modified outside of the draw loop"],r=e._diff(e._oldSource.split("\n"),a.split("\n")),i=0;r.n.length>i;i++)if(null==r.n[i].text)s.push("+ "+r.n[i]);else for(var o=r.n[i].row+1;r.o.length>o&&null==r.o[o].text;o++)s.push("- "+r.o[o]);console.warn(s.join("\n"))}console.group((t?u.toTimeString(new Date(t))+" ":"")+"Draw Fired")}if(e.drawIfNeeded(),p.isDebug){var l=window.performance.now();console.log("Draw Cycle Time: ",l-n,", Components: ",e._lastDrawComponentsCount)}u.isDebug&&(console.groupEnd(),e._oldSource=document.documentElement.innerHTML),e._frameTime=null,e._scheduleComposerRequest&&e.drawTree()};if(t)this.requestedAnimationFrame=t.call(window,n);else{var a=Date.now(),s=17-a+this._previousDrawDate;0>s&&(s=0),this.requestedAnimationFrame=setTimeout(n,s),this._previousDrawDate=a+s}this._scheduleComposerRequest=!1}},enumerable:!1},_readyToDrawList:{enumerable:!1,value:[]},_readyToDrawListIndex:{enumerable:!1,value:null},addToDrawCycle:{value:function(e){var t=this._readyToDrawListIndex;return t.hasOwnProperty(e.uuid)?(u.isDebug&&u.debug("components should not be added to the draw cycle twice"),void 0):(this._readyToDrawList.push(e),this._readyToDrawListIndex[e.uuid]=!0,e._updateComponentDom(),void 0)}},_lastDrawComponentsCount:{value:null},drawIfNeeded:{value:function(){var e,t,n,a,s,r,i=this._readyToDrawList,o=0,l=this.composerList;if(i.length=0,r=l.length,this._readyToDrawListIndex={},r>0){for(this.composerList=this.composerListSwap,t=0;r>t;t++)s=l[t],s.needsFrame=!1,s.frame(this._frameTime);l.splice(0,r),this.composerListSwap=l}for(this._drawIfNeeded(0),n=i.length;n>o;){for(t=o;n>t;t++)e=i[t],"function"==typeof e.willDraw&&e.willDraw(this._frameTime),u.isDebug&&u.debug(e._montage_metadata.objectName," willDraw treeLevel ",e._treeLevel);this._drawIfNeeded(0),o=n,n=i.length}var c=function(e,t){return e._treeLevel-t._treeLevel};for(i.sort(c),t=0;n>t;t++)e=i[t],e.needsDraw=!1;for(this.requestedAnimationFrame=null,t=n-1;t>=0;t--)e=i[t],e._draw(this._frameTime),e.draw(this._frameTime),u.isDebug&&u.debug(e._montage_metadata.objectName," draw treeLevel ",e._treeLevel);for(t=0;n>t;t++)e=i[t],e.didDraw(this._frameTime),e._completedFirstDraw||(a=document.createEvent("CustomEvent"),a.initCustomEvent("firstDraw",!0,!1,null),e.dispatchEvent(a),e._completedFirstDraw=!0),u.isDebug&&u.debug(e._montage_metadata.objectName," didDraw treeLevel ",e._treeLevel);return p.isDebug&&(this._lastDrawComponentsCount=i.length),!!i.length}},element:{get:function(){return this._element},set:function(e){h.registerEventHandlerForElement(this,e),this._element=e,this._documentResources=i.getInstanceForDocument(e)}}}),f=(new g).init();t.__root__=f}}),montageDefine("b8d1a32","core/target",{dependencies:["montage","core/event/event-manager","core/event/mutable-event"],factory:function(e,t){var n=e("montage").Montage,a=e("core/event/event-manager").defaultEventManager,s=e("core/event/mutable-event").MutableEvent;t.Target=n.specialize({acceptsActiveTarget:{serializable:!1,value:!1},isActiveTarget:{get:function(){return this===a.activeTarget}},willBecomeActiveTarget:{value:Function.noop},didBecomeActiveTarget:{value:Function.noop},willSurrenderActiveTarget:{value:Function.noop},nextTarget:{serializable:!1,value:null},dispatchEvent:{value:function(e){var t=e;e instanceof s||(t=s.fromEvent(t)),t.target=this,a.handleEvent(t)}},dispatchEventNamed:{value:function(e,t,n,r){var i=s.fromType(e,t,n,r);i.target=this,a.handleEvent(i)}},addEventListener:{value:function(e,t,n){t&&a.registerEventListener(this,e,t,n)}},removeEventListener:{value:function(e,t,n){t&&a.unregisterEventListener(this,e,t,n)}}})}}),montageDefine("b8d1a32","core/template",{dependencies:["montage","core/serialization","core/document-part","core/document-resources","core/serialization/serialization","core/serialization/serializer/montage-labeler","core/promise","core/logger","core/event/event-manager","core/application"],factory:function(e,t){function n(e,t,n){var a,s,r=new u,o=e.documentElement.outerHTML,l=new i,c=e.documentElement;return a=r.createHtmlDocumentWithHtml(o),r.initWithDocument(a,t).then(function(){return r.setBaseUrl(e.location.href),s=r._createTemplateObjects(n),l.initWithTemplateAndFragment(r),r._instantiateObjects(s,c).then(function(e){return l.objects=e,r._invokeDelegates(l),l})})}var a,s=e("montage").Montage,r=e("core/serialization").Deserializer,i=e("core/document-part").DocumentPart,o=e("core/document-resources").DocumentResources,l=e("core/serialization/serialization").Serialization,c=e("core/serialization/serializer/montage-labeler").MontageLabeler,p=e("core/promise").Promise;e("core/logger").logger("template"),e("core/event/event-manager").defaultEventManager;var u=s.specialize({_SERIALIZATON_SCRIPT_TYPE:{value:"text/montage-serialization"},_ELEMENT_ID_ATTRIBUTE:{value:"data-montage-id"},PARAM_ATTRIBUTE:{value:"data-param"},_require:{value:null},_resources:{value:null},document:{value:null},_baseUrl:{value:null},_instances:{value:null},_metadata:{value:null},_objectsString:{value:null},objectsString:{get:function(){return this._objectsString
},set:function(e){this._objectsString=e,this._serialization&&this._serialization.initWithString(e),this.__deserializer=null}},__deserializer:{value:null},_deserializer:{get:function(){var e,t,n=this.__deserializer;if(!n){if(e=this._metadata){t=Object.create(null);for(var a in e)t[a]=e[a].require}n=(new r).init(this.objectsString,this._require,t),this.__deserializer=n}return n}},getDeserializer:{value:function(){return this._deserializer}},_serialization:{value:null},getSerialization:{value:function(){var e=this._serialization;return e||(e=this._serialization=new l,e.initWithString(this.objectsString)),e}},initWithRequire:{value:function(e){return this._require=e,this.document=this.createHtmlDocumentWithHtml(""),this.objectsString="",this}},initWithDocument:{value:function(e,t){var n=this;return this._require=t,this.setDocument(e),this.getObjectsString(e).then(function(e){return n.objectsString=e,n})}},initWithHtml:{value:function(e,t){var n=this;return this._require=t,this.document=this.createHtmlDocumentWithHtml(e),this.getObjectsString(this.document).then(function(e){return n.objectsString=e,n})}},initWithObjectsAndDocumentFragment:{value:function(e,t,n){return this._require=n,this.document=this.createHtmlDocumentWithHtml(""),this.document.body.appendChild(this.document.importNode(t,!0)),this.setObjects(e),this}},initWithModuleId:{value:function(e,t){var n=this;return this._require=t,this.createHtmlDocumentWithModuleId(e,t).then(function(a){var s=t(e).directory;return n.document=a,n.setBaseUrl(s),n.getObjectsString(a).then(function(e){return n.objectsString=e,n})})}},clone:{value:function(){var e=new u;return e._require=this._require,e._baseUrl=this._baseUrl,e.setDocument(this.document),e.objectsString=this.objectsString,e._instances=Object.clone(this._instances,1),e}},instantiate:{value:function(e){return this.instantiateWithInstances(null,e)}},instantiateWithInstances:{value:function(e,t){var n,a,s,r=this,o=new i;return e=e||this._instances,n=this._createMarkupDocumentFragment(t),s=this._getParameters(n),o.initWithTemplateAndFragment(this,n),o.startActingAsTopComponent(),o.parameters=s,a=this._createTemplateObjects(e),this._instantiateObjects(a,n).then(function(n){var a;return o.objects=n,r._invokeDelegates(o,e),o.stopActingAsTopComponent(),a=r.getResources(),!a.resourcesLoaded()&&a.hasResources()&&a.loadResources(t),o})}},_objectsInstantiationOptimized:{value:!1},_optimizeObjectsInstantiationPromise:{value:null},_optimizeObjectsInstantiation:{value:function(){var e,t=this;return this._objectsInstantiationOptimized?void 0:(this._optimizeObjectsInstantiationPromise||(e=this._deserializer.preloadModules(),e?this._optimizeObjectsInstantiationPromise=e.then(function(){t._objectsInstantiationOptimized=!0}):this._objectsInstantiationOptimized=!0),this._optimizeObjectsInstantiationPromise)}},setBaseUrl:{value:function(e){this._baseUrl=e}},getBaseUrl:{value:function(){return this._baseUrl}},getResources:{value:function(){var e=this._resources;return e||(e=this._resources=new h,e.initWithTemplate(this)),e}},_createTemplateObjects:{value:function(t){var n=Object.create(t||null);return void 0===a&&(a=e("core/application").application),n.application=a,n.template=this,n}},_instantiateObjects:{value:function(e,t){var n,a=this._deserializer;return n=this._optimizeObjectsInstantiation(),n?n.then(function(){return a.deserialize(e,t)}):a.deserialize(e,t)}},_createMarkupDocumentFragment:{value:function(e){for(var t=e.createDocumentFragment(),n=this.document.body.childNodes,a=0,s=n.length;s>a;a++)t.appendChild(e.importNode(n[a],!0));return t}},getParameterName:{value:function(e){return e.getAttribute(this.PARAM_ATTRIBUTE)}},getParameters:{value:function(){return this._getParameters(this.document.body)}},_getParameters:{value:function(e){for(var t,n=e.querySelectorAll("*["+this.PARAM_ATTRIBUTE+"]"),a=n.length,s={},r=0;a>r;r++){t=n[r];var i=this.getParameterName(t);if(i in s)throw Error('The parameter "'+i+'" is'+" declared more than once in "+this.getBaseUrl()+".");s[i]=t}if("*"in s&&a>1)throw Error('The star "*" template parameter was declared when other parameters were also present in '+this.getBaseUrl()+": "+Object.keys(s)+".");return s}},hasParameters:{value:function(){return!!this.document.querySelector("*["+this.PARAM_ATTRIBUTE+"]")}},_invokeDelegates:{value:function(e,t){var n,a,s=e.objects,r=s.owner;for(var i in s)t&&i in t||(n=s[i],a=this._getObjectOwner(i,r),n&&("function"==typeof n._deserializedFromTemplate&&n._deserializedFromTemplate(a,i,e),"function"==typeof n.deserializedFromTemplate&&n.deserializedFromTemplate(a,i,e)));if(r){var o=this.getSerialization();o.isExternalObject("owner")||("function"==typeof r._templateDidLoad&&r._templateDidLoad(e),"function"==typeof r.templateDidLoad&&r.templateDidLoad(e))}}},setInstances:{value:function(e){this._instances=e}},getInstances:{value:function(){return this._instances}},setObjects:{value:function(e){this.objectsString=JSON.stringify(e,null,4)}},setObjectMetadata:{value:function(e,t,n,a){var s=this._metadata;s||(this._metadata=s=Object.create(null)),s[e]={require:t,label:n,owner:a},this.__deserializer=null}},getObjectMetadata:{value:function(e){var t=this._metadata;return t&&e in t?t[e]:{require:this._require,label:e}}},_getObjectOwner:{value:function(e,t){var n,a=this._metadata;return n=a&&e in a?a[e].owner:t}},setDocument:{value:function(e){var t=e.documentElement.innerHTML;this.document=this.createHtmlDocumentWithHtml(t)}},getObjectsString:{value:function(e){var t;return t=this.getInlineObjectsString(e),null===t?this.getExternalObjectsString(e):p.resolve(t)}},getInlineObjectsString:{value:function(e){var t="script[type='"+this._SERIALIZATON_SCRIPT_TYPE+"']",n=e.querySelector(t);return n?n.textContent:null}},getExternalObjectsString:{value:function(e){var t,n,a,s,r=e.querySelector('link[rel="serialization"]');return r?(t=new XMLHttpRequest,n=r.getAttribute("href"),a=this.getBaseUrl()||"",/^https?:\/\/|^\//.test(n)?p.reject(Error("Relative link found for the objects file but the document URL is unknown: '"+n+"'.")):(n=a+n,s=p.defer(),t.open("GET",n),t.addEventListener("load",function(){200==t.status?s.resolve(t.responseText):s.reject(Error("Unable to retrive '"+n+"', code status: "+t.status))},!1),t.addEventListener("error",function(e){s.reject(Error("Unable to retrive '"+n+"' with error: "+e.error+"."))},!1),t.send(),s.promise)):p.resolve(null)}},createHtmlDocumentWithHtml:{value:function(e){var t=document.implementation.createHTMLDocument("");return t.documentElement.innerHTML=e,t}},createHtmlDocumentWithModuleId:{value:function(e,t){var n=this;return"function"!=typeof t?p.reject(Error("Missing 'require' function to load module '"+e+"'.")):t.async(e).then(function(e){return n.createHtmlDocumentWithHtml(e.content)})}},_removeObjects:{value:function(e){var t="script[type='"+this._SERIALIZATON_SCRIPT_TYPE+"'], link[rel='serialization']";Array.prototype.forEach.call(e.querySelectorAll(t),function(e){e.parentNode.removeChild(e)})}},_addObjects:{value:function(e,t){if(t){var n=e.createElement("script");n.setAttribute("type",this._SERIALIZATON_SCRIPT_TYPE),n.textContent=JSON.stringify(JSON.parse(t),null,4),e.head.appendChild(n)}}},_templateFromElementContentsCache:{value:null},clearTemplateFromElementContentsCache:{value:function(){this._templateFromElementContentsCache=null}},createTemplateFromElementContents:{value:function(e){var t,n,a,s=this._templateFromElementContentsCache;return s||(s=Object.create(null),this._templateFromElementContentsCache=s),e in s?Object.create(s[e]):(t=this.getElementById(e),a=this.document.createRange(),a.selectNodeContents(t),n=this.createTemplateFromRange(a),s[e]=n,Object.create(n))}},createTemplateFromElement:{value:function(e){var t,n;return t=this.getElementById(e),n=this.document.createRange(),n.selectNode(t),this.createTemplateFromRange(n)}},createTemplateFromRange:{value:function(e){var t,n,a,s,r,i=new l;return t=e.cloneContents(),n=this._getChildrenElementIds(t),i.initWithString(this.objectsString),a=i.getSerializationLabelsWithElements(n),r=i.extractSerialization(a,["owner"]),s=new u,s.initWithObjectsAndDocumentFragment(null,t,this._require),s.objectsString=r.getSerializationString(),s._resources=this.getResources(),s}},_createSerializationWithElementIds:{value:function(e){var t,n,a=new l;return a.initWithString(this.objectsString),t=a.getSerializationLabelsWithElements(e),n=a.extractSerialization(t,["owner"])}},expandParameters:{value:function(e,t){var n,a,s,r,i,o,l=[],c={},p=this.getSerialization(),u={};n=this.getParameters();for(var h in n)if(r=n[h],i=t.getTemplateParameterArgument(e,h),l.push.apply(l,this._getElementIds(i)),a=this.replaceNode(i,r))for(var d in a)c[d]=a[d];return u.elementIds=l,u.elementIdsCollisions=c,o=e._createSerializationWithElementIds(l),o.renameElementReferences(c),s=p.mergeSerialization(o),this.objectsString=p.getSerializationString(),u.labels=o.getSerializationLabels(),u.labelsCollisions=s,u}},_resolveElementIdCollisions:{value:function(e){var t,n,a,s,r,i=new c;a=this.getElementIds();for(var o,l=0;o=a[l];l++)i.setObjectLabel(null,o);n=this._getElements(e);for(var o in n)this.getElementById(o)&&(s=n[o],r=i.getObjectLabel(s),this.setElementId(s,r),t||(t=Object.create(null)),t[o]=r);return t}},replaceNode:{value:function(e,t){var n;return n=this._resolveElementIdCollisions(e),t.parentNode.replaceChild(e,t),n}},insertNodeBefore:{value:function(e,t){var n;return n=this._resolveElementIdCollisions(e),t.parentNode.insertBefore(e,t),n}},appendNode:{value:function(e,t){var n;return n=this._resolveElementIdCollisions(e),t.appendChild(e),n}},getElementId:{value:function(e){return e.getAttribute?e.getAttribute(this._ELEMENT_ID_ATTRIBUTE):void 0}},setElementId:{value:function(e,t){e.setAttribute(this._ELEMENT_ID_ATTRIBUTE,t)}},getElementIds:{value:function(){return this._getElementIds(this.document.body)}},_getElements:{value:function(e){var t,n,a="*["+this._ELEMENT_ID_ATTRIBUTE+"]",s={};t=e.querySelectorAll(a);for(var r,i=0;r=t[i];i++)n=this.getElementId(r),s[n]=r;return n=this.getElementId(e),n&&(s[n]=e),s}},_getChildrenElementIds:{value:function(e){var t,n="*["+this._ELEMENT_ID_ATTRIBUTE+"]",a=[];t=e.querySelectorAll(n);for(var s,r=0;s=t[r];r++)a.push(this.getElementId(s));return a}},_getElementIds:{value:function(e){var t,n=this._getChildrenElementIds(e);return t=this.getElementId(e),t&&n.push(t),n}},getElementById:{value:function(e){var t="*["+this._ELEMENT_ID_ATTRIBUTE+"='"+e+"']";return this.document.querySelector(t)}},html:{get:function(){var e=this.document;return this._removeObjects(e),this._addObjects(e,this.objectsString),this._getDoctypeString(e.doctype)+"\n"+e.documentElement.outerHTML}},_getDoctypeString:{value:function(e){return"<!DOCTYPE "+e.name+(e.publicId?' PUBLIC "'+e.publicId+'"':"")+(!e.publicId&&e.systemId?" SYSTEM":"")+(e.systemId?' "'+e.systemId+'"':"")+">"}}},{_templateCache:{value:{moduleId:Object.create(null)}},_getTemplateCacheKey:{value:function(e,t){return e=t.resolve(e),t.location+"#"+e}},getTemplateWithModuleId:{value:function(e,t){var n,a;return n=this._getTemplateCacheKey(e,t),a=this._templateCache.moduleId[n],a||(a=(new u).initWithModuleId(e,t),this._templateCache.moduleId[n]=a),a}}}),h=s.specialize({_resources:{value:null},_resourcesLoaded:{value:!1},template:{value:null},rootUrl:{value:""},constructor:{value:function(){this._resources=Object.create(null)}},initWithTemplate:{value:function(e){this.template=e}},hasResources:{value:function(){return this.getStyles().length>0||this.getScripts().length>0}},resourcesLoaded:{value:function(){return this._resourcesLoaded}},loadResources:{value:function(e){return this._resourcesLoaded=!0,p.all([this.loadScripts(e),this.loadStyles(e)])}},getScripts:{value:function(){var e,t,n,a=this._resources.scripts;if(!a){t=this.template,a=this._resources.scripts=[],n=t.document.querySelectorAll("script");for(var s=0,r=n.length;r>s;s++)e=n[s],e.type!==this.template._SERIALIZATON_SCRIPT_TYPE&&a.push(e)}return a}},loadScripts:{value:function(e){var t,n=[];t=this.getScripts();for(var a=0,s=t.length;s>a;a++)n.push(this.loadScript(t[a],e));return p.all(n)}},loadScript:{value:function(e,t){var n,a;return n=o.getInstanceForDocument(t),a=this._cloneScriptElement(e,t),n.addScript(a)}},_cloneScriptElement:{value:function(e,t){for(var n,a=t.createElement("script"),s=e.attributes,r=0,i=s.length;i>r;r++)n=s[r],a.setAttribute(n.name,n.value);return a}},getStyles:{value:function(){var e,t,n,a=this._resources.styles;return a||(n='link[rel="stylesheet"], style',e=this.template,t=e.document.querySelectorAll(n),a=Array.prototype.slice.call(t,0),this._resources.styles=a),a}},loadStyles:{value:function(e){var t,n=[];t=this.getStyles();for(var a=0,s=t.length;s>a;a++)n.push(this.loadStyle(t[a],e));return p.all(n)}},loadStyle:{value:function(e,t){var n,a,s=this.template.getBaseUrl();return n=e.getAttribute("href"),n?(a=o.getInstanceForDocument(t),n=a.normalizeUrl(n,s),a.preloadResource(n)):p.resolve()}},createStylesForDocument:{value:function(e){var t,n,a,s,r=this.getStyles(),i=[],l=this.template.getBaseUrl();n=o.getInstanceForDocument(e);for(var c,p=0;c=r[p];p++)a=c.getAttribute("href"),t=e.importNode(c,!0),i.push(t),a&&(s=n.normalizeUrl(a,l),t.setAttribute("href",s));return i}}});t.Template=u,t.TemplateResources=h,t.instantiateDocument=n}}),montageDefine("b8d1a32","core/document-resources",{dependencies:["montage","core/promise"],factory:function(e,t){var n=e("montage").Montage,a=e("core/promise").Promise,s=n.specialize({_SCRIPT_TIMEOUT:{value:5e3},_document:{value:null},_resources:{value:null},_preloaded:{value:null},initWithDocument:{value:function(e){return this.clear(),this._document=e,this._link=e.createElement("a"),this}},clear:{value:function(){this._resources=Object.create(null),this._preloaded=Object.create(null)}},_addResource:{value:function(e){this._resources[e]=!0}},hasResource:{value:function(e){return e in this._resources}},isResourcePreloaded:{value:function(e){return this._preloaded[e]===!0}},isResourcePreloading:{value:function(e){return a.isPromise(this._preloaded[e])}},setResourcePreloadedPromise:{value:function(e,t){this._preloaded[e]=t}},setResourcePreloaded:{value:function(e){this._preloaded[e]=!0}},getResourcePreloadedPromise:{value:function(e){return this._preloaded[e]}},addScript:{value:function(e){var t=this.normalizeUrl(e.src);return t?this.isResourcePreloaded(t)?a.resolve():this.isResourcePreloading(t)?this.getResourcePreloadedPromise(t):this._importScript(e):this._importScript(e)}},_importScript:{value:function(e){var t,n,s=this,r=this._document,i=r.head,o=a.defer(),l=e.src;return l?(s._addResource(l),t=function(){s.setResourcePreloaded(l),e.removeEventListener("load",t),e.removeEventListener("error",t),clearTimeout(n),o.resolve()},e.addEventListener("load",t,!1),e.addEventListener("error",t,!1),n=setTimeout(function(){s.setResourcePreloaded(l),o.resolve()},this._SCRIPT_TIMEOUT),this.setResourcePreloadedPromise(l,o.promise)):o.resolve(),i.appendChild(r.createComment("Inserted from FIXME")),i.appendChild(e),o.promise}},addStyle:{value:function(e){var t,n=e.getAttribute("href");if(n=this.normalizeUrl(n)){if(this.hasResource(n))return;this._addResource(n)}t=this._document.head,t.insertBefore(e,t.firstChild)}},_link:{value:null},normalizeUrl:{value:function(e,t){var n=this._link;return n.href=/^https?:\/\/|^\//.test(e)?e:t?t+e:e,n.href}},preloadResource:{value:function(e){return e=this.normalizeUrl(e),this.isResourcePreloaded(e)?a.resolve():this.isResourcePreloading(e)?this.getResourcePreloadedPromise(e):this._preloadResource(e)}},_preloadResource:{value:function(e){var t,n,s=this,r=new XMLHttpRequest,i=a.defer();return r.open("GET",e),t=function(){s.setResourcePreloaded(e),r.removeEventListener("load",t),r.removeEventListener("error",t),clearTimeout(n),i.resolve()},r.addEventListener("load",t,!1),r.addEventListener("error",t,!1),r.send(),n=setTimeout(function(){s.setResourcePreloaded(e),i.resolve()},this._SCRIPT_TIMEOUT),this.setResourcePreloadedPromise(e,i.promise),i.promise}}},{getInstanceForDocument:{value:function(e){var t=e.__montage_resources__;return t||(t=e.__montage_resources__=(new s).initWithDocument(e)),t}}});t.DocumentResources=s}}),montageDefine("b8d1a32","core/gate",{dependencies:["montage","core/logger"],factory:function(e,t){var n=e("montage").Montage,a=e("core/logger").logger("gate");t.Gate=n.specialize({init:{enumerable:!1,value:function(){return this.reset(),this}},initWithDelegate:{enumerable:!1,value:function(e){return this.reset(),this.delegate=e,this}},initWithDescriptor:{enumerable:!1,value:function(e){var t;this.reset();for(t in e)this.setField(t,e[t].value);return this}},count:{value:0},table:{value:null},getField:{enumerable:!1,value:function(e){var t=this.table;return!t||t[e]}},setField:{enumerable:!1,value:function(e,t){var n,s=this.table,r=this.count;s=s?s:this.table={},n=s[e],void 0!==n||t?void 0!==n&&n!==t?t?this.count--:this.count++:t&&a.error(this,e+" was not set before."):this.count++,s[e]=!!t,0===this.count&&r>0?this.callDelegateMethod(!0):0===r&&this.count>0&&this.callDelegateMethod(!1)}},removeField:{enumerable:!1,value:function(e){var t=this.table,n=t[e];void 0===n||n||this.count--,delete t[e]}},delegate:{enumerable:!1,value:null},callDelegateMethod:{value:function(e){var t;this.delegate&&"function"==typeof(t=this.delegate["gateDidBecome"+(e?"True":"False")])&&t.call(this.delegate,this)},enumerable:!1},value:{enumerable:!1,get:function(){return 0===this.count}},reset:{enumerable:!1,value:function(){this.table={},this.count=0}},toString:{value:function(){var e,t,n=this._fields,a="";for(e=0;t=n[e];e++)a+=t+"["+(this._value&n[t])+"], ";return a}}})}}),montageDefine("b8d1a32","core/application",{dependencies:["core/core","core/target","window-loader/montage-window","core/dom","core/template"],factory:function(e,t){var n,a=(e("core/core").Montage,e("core/target").Target),s=e("window-loader/montage-window").MontageWindow;e("core/dom");var r=t.Application=a.specialize({eventManager:{value:null},parentApplication:{value:null},mainApplication:{get:function(){for(var e=this;e.parentApplication;)e=e.parentApplication;return e}},_windowsSortOrder:{value:"reverse-z-order"},windowsSortOrder:{get:function(){return null==this.parentApplication?this._windowsSortOrder:this.mainApplication.windowsSortOrder},set:function(e){null==this.parentApplication?-1!==["z-order","reverse-z-order","z-order","reverse-open-order"].indexOf(e)&&(this._windowsSortOrder=e):this.mainApplication.windowsSortOrder=e}},windows:{get:function(){var e;if(null==this.parentApplication){if(!this._windows){var e=new s;e.application=this,e.window=window,this.window=e,this._windows=[this.window],this._multipleWindow=!0}return this._windows}return this.mainApplication.windows}},_window:{value:null},window:{get:function(){if(!this._window&&this==this.mainApplication){var e=new s;e.application=this,e.window=window,this._window=e}return this._window},set:function(e){this._window||(this._window=e)}},attachedWindows:{value:[]},eventManagerForWindow:{value:function(e){return e.defaultEventMananger}},focusWindow:{get:function(){var e=this.windows,t=this.windowsSortOrder;if("z-order"==t)return e[0];if("reverse-z-order"==t)return e[e.length-1];for(var n in e)if(e[n].focused)return e[n]}},addEventListener:{value:function(e,t,n){Object.getPrototypeOf(r).addEventListener.call(this,e,t,n)}},removeEventListener:{value:function(e,t,n){Object.getPrototypeOf(r).removeEventListener.call(this,e,t,n)}},delegate:{value:null},nextTarget:{get:function(){return this.delegate}},openWindow:{value:function(e,t,n){var a,r,i=this,o=new s,l={location:!1,menubar:!1,resizable:!0,scrollbars:!0,status:!1,titlebar:!0,toolbar:!1},c={module:e,name:t,parent:window,callback:function(e,t){var n;a=e.document.application,o.window=e,o.application=a,o.component=t,a.window=o,i.attachedWindows.push(o),n=i.mainApplication.windowsSortOrder,"z-order"==n||"reverse-open-order"==n?i.windows.unshift(o):i.windows.push(o),r=document.createEvent("CustomEvent"),r.initCustomEvent("load",!0,!0,null),o.dispatchEvent(r)}};if(this!==this.mainApplication||this._multipleWindow||this.window,"object"==typeof n){var p,u,h="",d="";for(p in n)n.hasOwnProperty(p)&&(l[p]=n[p])}var m=["name"];for(p in l)-1==m.indexOf(p)&&(u=l[p],"boolean"==typeof u?u=u?"yes":"no":(u+="",u.match(/[ ,"]/)&&(u='"'+u.replace(/"/g,'\\"')+'"')),d+=h+p+"="+u,h=",");return window.require.loadPackage({name:"montage"}).then(function(e){var t=window.open(e.location+"window-loader/index.html","_blank",d);t.loadInfo=c}).done(),o}},attachWindow:{value:function(e){var t,n=e.application.parentApplication;return n!==this&&(n&&n.detachWindow(e),e.parentApplication=this,this.attachedWindows.push(e),t=this.mainApplication.windowsSortOrder,"z-order"==t||"reverse-open-order"==t?this.windows.unshift(e):this.windows.push(e),e.focus()),e}},detachWindow:{value:function(e){var t,n,a=this.windows;return void 0===e&&(e=this.window),n=e.application.parentApplication,n==this?(t=this.attachedWindows.indexOf(e),-1!==t&&this.attachedWindows.splice(t,1),t=a.indexOf(e),-1!==t&&a.splice(t,1),e.application.parentApplication=null):n&&n.detachWindow(e),e}},constructor:{value:function(){window.loadInfo&&!this.parentApplication&&(this.parentApplication=window.loadInfo.parent.document.application)}},_load:{value:function(n,a){var s,r=this;t.application=r,e.async("ui/component").then(function(t){return s=t.__root__,s.element=document,e("core/template").instantiateDocument(window.document,n).then(function(){r.callDelegateMethod("willFinishLoading",r),s.needsDraw=!0,a&&a(r)})}).done()}},_alertPopup:{value:null,enumerable:!1},_confirmPopup:{value:null,enumerable:!1},_notifyPopup:{value:null,enumerable:!1},_zIndex:{value:null},_isSystemPopup:{value:function(e){return"alert"===e||"confirm"===e||"notify"===e}},_createPopupSlot:{value:function(e){var t=document.createElement("div");document.body.appendChild(t),t.style.zIndex=e,t.style.position="absolute";var a=new n;return a.element=t,a.attachToParentComponent(),a}},getPopupSlot:{value:function(t,a,s){var r=this;e.async("ui/slot.reel/slot").then(function(e){n=n||e.Slot,t=t||"custom";var i,o,l=r._isSystemPopup(t);if(r.popupSlots=r.popupSlots||{},l)switch(t){case"alert":i=9004;break;case"confirm":i=9003;break;case"notify":i=9002}else r._zIndex=r._zIndex?r._zIndex+1:7e3,i=r._zIndex;o=r.popupSlots[t],o||(o=r.popupSlots[t]=r._createPopupSlot(i)),l||(o.element.style.zIndex=i),o.content=a,s.call(this,o)}).done()}},returnPopupSlot:{value:function(e){var t=this;if(t.popupSlots&&t.popupSlots[e]){var n=t.popupSlots[e];n.content=null}}},_getActivePopupSlots:{value:function(){var e=[];if(this.popupSlots){var t=Object.keys(this.popupSlots);if(t&&t.length>0){var n,a=0,s=t.length;for(a=0;s>a;a++)n=this.popupSlots[t[a]],n&&null!==n.content&&e.push(n)}}return e}}})}}),montageDefine("b8d1a32","ui/text.reel/text",{dependencies:["montage","ui/component"],factory:function(e,t){var n=(e("montage").Montage,e("ui/component").Component);t.Text=n.specialize({hasTemplate:{value:!1},_value:{value:null},value:{get:function(){return this._value},set:function(e){this._value!==e&&(this._value=e,this.needsDraw=!0)}},converter:{value:null},defaultValue:{value:""},_valueNode:{value:null},_RANGE:{value:document.createRange()},enterDocument:{value:function(e){if(e){var t=this._RANGE;t.selectNodeContents(this.element),t.deleteContents(),this._valueNode=document.createTextNode(""),t.insertNode(this._valueNode),this.element.classList.add("montage-Text")}}},draw:{value:function(){var e=this._value,t=e||0===e?e:this.defaultValue;this.converter&&(t=this.converter.convert(t)),this._valueNode.data=t}}})}}),montageDefine("b8d1a32","core/document-part",{dependencies:["montage","core/logger","core/promise","core/event/event-manager"],factory:function(e,t){var n=e("montage").Montage,a=(e("core/logger").logger("document-part"),e("core/promise").Promise),s=e("core/event/event-manager").defaultEventManager,r=n.specialize({template:{value:null},fragment:{value:null},objects:{value:null},childComponents:{value:null},parameters:{value:null},initWithTemplateAndFragment:{value:function(e,t){this.template=e,this.fragment=t,this.objects=null,this.childComponents=[],this.parameters=null}},startActingAsTopComponent:{value:function(){this.fragment&&s.registerEventHandlerForElement(this,this.fragment)}},stopActingAsTopComponent:{value:function(){this.fragment&&s.unregisterEventHandlerForElement(this.fragment)}},addChildComponent:{value:function(e){-1==this.childComponents.indexOf(e)&&this.childComponents.push(e)}},removeChildComponent:{value:function(e){var t=this.childComponents,n=t.indexOf(e);n>-1&&(t.splice(n,1),e._parentComponent=null,e._alternateParentComponent=null)}},_addToDrawList:{value:function(){}},_componentTreeLoadedDeferred:{value:null},loadComponentTree:{value:function(){var e,t=this._componentTreeLoadedDeferred;return t||(t=a.defer(),this._componentTreeLoadedDeferred=t,e=[],this.childComponents.forEach(function(t){e.push(t.loadComponentTree())}),a.all(e).then(function(){t.resolve()},t.reject).done()),t.promise}}});t.DocumentPart=r}}),montageDefine("b8d1a32","core/serialization/serialization",{dependencies:["core/core","./serializer/montage-labeler","./deserializer/montage-reviver","frb/parse","frb/stringify"],factory:function(e,t){var n=e("core/core").Montage,a=e("./serializer/montage-labeler").MontageLabeler,s=e("./deserializer/montage-reviver").MontageReviver,r=e("frb/parse"),i=e("frb/stringify"),o=n.specialize({_serializationString:{value:null},_serializationObject:{value:null},initWithString:{value:function(e){return this._serializationString=e,this._serializationObject=null,this}},initWithObject:{value:function(e){return this._serializationString=null,this._serializationObject=e,this}},getSerializationObject:{value:function(){return this._serializationObject||(this._serializationObject=JSON.parse(this._serializationString)),this._serializationObject}},getSerializationString:{value:function(){return this._serializationString||(this._serializationString=JSON.stringify(this._serializationObject)),this._serializationString}},getSerializationLabels:{value:function(){var e=this.getSerializationObject();return Object.keys(e)}},getExternalObjectLabels:{value:function(){var e=this.getSerializationObject(),t=[];for(var n in e)0===Object.keys(e[n]).length&&t.push(n);return t}},isExternalObject:{value:function(e){var t=this.getSerializationObject();return e in t?0===Object.keys(t[e]).length:!1}},getSerializationLabelsWithElements:{value:function(e){var t=new c,n=[];return t.initWithSerialization(this),t.visitSerialization(function(t){"Element"===t.type&&e.indexOf(t.data)>=0&&(t=t.parent,t&&"properties"===t.name&&(t=t.parent,t&&"montageObject"===t.type&&n.push(t.label)))}),n}},renameElementReferences:{value:function(e){var t=new c;t.initWithSerialization(this),t.visitSerialization(function(t){"Element"===t.type&&t.data in e&&(t.data=e[t.data])})}},renameSerializationLabels:{value:function(e){var t=new c;t.initWithSerialization(this),t.visitSerialization(function(t){if(t.label){var n=t.label;n in e&&(t.label=e[n])}if("reference"===t.type){var a=t.data;a in e&&(t.data=e[a])}})}},mergeSerialization:{value:function(e){return l.mergeSerializations(this,e)}},extractSerialization:{value:function(e,t){var n=new p;return n.initWithSerialization(this),n.extractSerialization(e,t)}}}),l=n.specialize(null,{mergeSerializations:{value:function(e,t){var n,a,s,r,i,l;r=e.getSerializationLabels(),i=t.getSerializationLabels(),l=this._createCollisionTable(r,i),l&&(s=t.getSerializationString(),t=(new o).initWithString(s),t.renameSerializationLabels(l),i=t.getSerializationLabels()),n=e.getSerializationObject(),a=t.getSerializationObject();for(var c,p=0;c=i[p];p++)n[c]=a[c];return e.initWithObject(n),l}},_createCollisionTable:{value:function(e,t){for(var n=new a,s={},r=!1,i=0;e.length>i;i++)n.setObjectLabel(null,e[i]);for(var o,i=0;o=t[i];i++)e.indexOf(o)>=0&&(s[o]=n.generateObjectLabel({}),r=!0);return r?s:void 0}}}),c=n.specialize({initWithSerialization:{value:function(e){this._serialization=e}},visitSerialization:{value:function(e){var t=this._serialization.getSerializationObject();this._walkRootObjects(e,t),this._serialization.initWithObject(t)}},visitSerializationObject:{value:function(e,t){var n=this._serialization.getSerializationObject();if(!(e in n))throw Error('Object "'+e+'" does not exist in '+this._serialization.getSerializationString());this._walkRootObject(t,n,e),this._serialization.initWithObject(n)}},changeLabel:{value:function(e,t){var n,a=this._serialization.getSerializationObject();n=a[e],delete a[e],a[t]=n}},_walkRootObjects:{value:function(e,t){for(var n in t)this._walkRootObject(e,t,n)}},_walkRootObject:{value:function(e,t,n){var a=t[n];"value"in a?this._walkObject(e,a,"value",n):this._walkCustomObject(e,t,n)}},_walkObject:{value:function(e,t,n,a,r){var i,o=t[n],l=s.getTypeOf(o);if(i={type:l},a?i.label=a:i.name=n,r&&(i.parent=r),"number"===l||"string"===l||"null"===l)i.data=o,e(i),t[n]=i.data;else if("regexp"===l)i.data=o["/"],e(i),o["/"]=i.data;else if("reference"===l)i.data=o["@"],e(i),o["@"]=i.data;else if("Element"===l)i.data=o["#"],e(i),o["#"]=i.data;else if("array"===l){i.data=o,e(i),t[n]=o=i.data;for(var c=0,p=o.length;p>c;c++)this._walkObject(e,o,""+c,null,i)}else if("object"===l){i.data=o,e(i),t[n]=o=i.data;for(var n in o)this._walkObject(e,o,n,null,i)}i.label!=a&&this.changeLabel(a,i.label)}},_walkCustomObject:{value:function(e,t,n){var a,s=t[n];a={type:"montageObject",label:n,data:s},e(a),t[n]=s=a.data,a.label!=n&&this.changeLabel(n,a.label),s.properties&&this._walkObject(e,s,"properties",null,a),s.listeners&&this._walkObject(e,s,"listeners",null,a),s.bindings&&this._walkBindings(e,s,null,a),s.localizations&&this._walkLocalizations(e,s,null,a)}},_walkBindings:{value:function(e,t,n){var a,s=t.bindings;a={type:"bindings",data:s,parent:n},e(a),t.bindings=s=a.data;for(var r in s)this._walkBinding(e,s,r,a)}},_walkBinding:{value:function(e,t,n,a){var s,r=t[n];s={type:"binding",name:n,data:r,parent:a},e(s),t[n]=r=s.data,this._walkBindingData(e,r,s)}},_walkBindingData:{value:function(e,t,n){var a,s,o=!1;a=t["<-"]||t["<->"],s=r(a),this._walksBindingReferences(s,function(t){var n={type:"reference",data:t.label};e(n),t.label!==n.data&&(t.label=n.data,o=!0)}),o&&("<-"in t?t["<-"]=i(s):t["<->"]=i(s)),t.converter&&this._walkObject(e,t,"converter",null,n)}},_walkLocalizations:{value:function(e,t,n){var a,s=t.localizations;a={type:"localizations",data:s,parent:n},e(a),t.localizations=s=a.data;for(var r in s)this._walkLocalization(e,s,r,a)}},_walkLocalization:{value:function(e,t,n,a){var s,r,i=t[n];if(s={type:"localization",name:n,data:i,parent:a},e(s),t[n]=i=s.data,"object"==typeof i.key&&this._walkBindingData(e,i.key,s),"object"==typeof i.default&&this._walkBindingData(e,i.default,s),"object"==typeof i.data){r=i.data;for(var n in r)this._walkBindingData(e,r[n],s)}}},_walksBindingReferences:{value:function(e,t){var n=e.args;if("component"===e.type&&t(e),n)for(var a=0,s=n.length;s>a;a++)this._walksBindingReferences(n[a],t)}}}),p=n.specialize({_serialization:{value:null},initWithSerialization:{value:function(e){this._serialization=e}},extractSerialization:{value:function(e,t){var n,a=new c,s={},r=[];n=this._serialization.getSerializationObject(),a.initWithSerialization(this._serialization);for(var i,l=0;i=e[l];l++)s[i]=n[i],a.visitSerializationObject(i,function(t){var n;"reference"===t.type&&(n=t.data,-1===r.indexOf(n)&&-1===e.indexOf(n)&&r.push(n))});if(t)for(var i,l=0;i=t[l];l++)i in n&&!(i in s)&&(s[i]={});for(var i,l=0;i=r[l];l++)s[i]={};return(new o).initWithObject(s)}}});t.Serialization=o,t.SerializationMerger=l,t.SerializationInspector=c,t.SerializationExtractor=p}}),montageDefine("b8d1a32","window-loader/montage-window",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage;t.MontageWindow=n.specialize({_application:{value:null},application:{get:function(){return this._application
},set:function(e){null===this._application&&(this._application=e,this.focused&&this._setFocusedWindow(this))}},_window:{value:null},window:{get:function(){return this._window},set:function(e){if(null===this._window){var t=e.document.body;this._window=e,e.addEventListener("beforeunload",this,!0),e.addEventListener("focus",this,!0),e.addEventListener("mousedown",this,!0),null===t.getAttribute("tabIndex")&&(t.setAttribute("tabIndex",-1),t.focus())}}},document:{get:function(){return this._window.document}},_component:{value:null},component:{get:function(){return this._component},set:function(e){null===this._component&&(this._component=e)}},title:{get:function(){return this.document.title},set:function(e){this.document.title=e}},focused:{value:!1},focus:{value:function(){this._window&&this._window.focus()}},_setFocusedWindow:{value:function(e){var t,n,a,s=this.application;if(s._multipleWindow){t=s.windows;for(a in t)n=t[a],n.window===e?n.focused!==!0&&(n.focused=!0,"z-order"==s.windowsSortOrder?(t.splice(a,1),t.unshift(n)):"reverse-z-order"==s.windowsSortOrder&&(t.splice(a,1),t.push(n))):n.focused=!1}else this.focused=!0}},closed:{get:function(){return this._window?this._window.closed:!1}},close:{value:function(){this._window&&this._window.close()}},resizeTo:{value:function(e,t){this._window&&this._window.resizeTo(e,t)}},moveTo:{value:function(e,t){this._window&&this._window.moveTo(e,t)}},captureFocus:{value:function(e){var t=this.application;if(!this.application)return this.focused=!0,void 0;if(t.parentApplication)t.mainApplication.window.captureFocus(e);else{var n=(e.target.ownerDocument?e.target.ownerDocument.defaultView:null)||e.target.defaultView||e.target;this._setFocusedWindow(n)}}},captureMousedown:{value:function(e){this.captureFocus(e)}},captureBeforeunload:{value:function(){var e,t=this.application,n=t.windows,a=t.attachedWindows;t.attachedWindows=[];for(var e in a)a[e].close();t.parentApplication&&(a=t.parentApplication.attachedWindows,e=a.indexOf(this),-1!==e&&a.splice(e,1),e=n.indexOf(this),-1!==e&&n.splice(e,1),this.window.removeEventListener("beforeunload",this,!0),this.close())}}})}}),montageDefine("b8d1a32","core/dom",{dependencies:["core/geometry/point"],factory:function(e,t){var n=e("core/geometry/point").Point,a=Node.prototype,s=Element.prototype;Object.defineProperty(s,"set",{value:function(e,t,n){var a,s,r,i,o,l=e.indexOf(".",n);n=n||0,s=e.substring(n,-1===l?e.length:l),-1===l?this.setAttribute(s,t):(r=e.lastIndexOf("."),"style"===s?(i=e.substring(l+1,e.length),this.style[i]=t):"classList"===s?(o=e.substring(l+1,e.length),t?this.classList.add(o):this.classList.remove(o)):(a=this.get(e.substring(0,r)))&&(a[e.substring(r+1,e.length)]=t))},enumerable:!1}),a.get=function(e){return this.getAttribute(e)||this[e]},Object.getPrototypeOf(document).addRule=function(e,t){var n,a;if(null==(n=document.styleSheets[0])){var s=document.createElement("style");s.type="text/css",document.head.appendChild(s),n=document.styleSheets[0]}else a=document.getRule(e,n);a||n.insertRule(e+" "+t,n.cssRules.length)},Object.getPrototypeOf(document).getRule=function(e,t){var n;if(t.cssRules)for(var a=0;n=t.cssRules[a];a++){if(n.name&&n.name===e)return n;if(n.selectorText===e)return n}},"undefined"!=typeof Element&&function(){var e="classList";if(!Element.prototype.hasOwnProperty(e)){var t=/^\s+|\s+$/g,n=function(e,t){e.setAttribute("class",t.join(" "))},a=function(e,t){if(""===t)throw"SYNTAX_ERR";if(/\s/.test(t))throw"INVALID_CHARACTER_ERR";return e.indexOf(t)},s=function(){var e=this,s=e.getAttribute("class")||"";return s=s.replace(t,"").split(/\s+/),{length:s.length,item:function(e){return s[e]||null},contains:function(e){return-1!==a(s,e)},add:function(t){-1===a(s,t)&&(s.push(t),this.length=s.length,n(e,s))},remove:function(t){var r=a(s,t);-1!==r&&(s.splice(r,1),this.length=s.length,n(e,s))},toggle:function(e){-1===a(s,e)?this.add(e):this.remove(e)},toString:function(){return e.getAttribute("class")||""}}};Object.defineProperty?Object.defineProperty(Element.prototype,e,{get:s,enumerable:!0}):Object.prototype.__defineGetter__&&Element.prototype.__defineGetter__(e,s)}}(),a.parentOf=function(e){for(;(e=e.parentNode)&&e!==this;);return e?!0:!1};var r=function(e){var t,n,a,s,r=e.ownerDocument;if(e&&r){if(n=r.documentElement,a=r.body,s=r.defaultView,e!==a){if(t=e.getBoundingClientRect(),n.parentOf(e)){var i=n.clientTop||a.clientTop||0,o=n.clientLeft||a.clientLeft||0,l=s.pageYOffset||n.scrollTop||a.scrollTop,c=s.pageXOffset||n.scrollLeft||a.scrollLeft,p=t.top+l-i,u=t.left+c-o;return{top:p,left:u}}return{top:t.top,left:t.left}}return{top:a.offsetTop,left:a.offsetLeft}}return null},i=null;try{i=new WebKitPoint(0,0)}catch(o){}var l=function(){t.convertPointFromNodeToPage=function(e,t){return t?(i.x=t.x,i.y=t.y):(i.x=0,i.y=0),t=webkitConvertPointFromNodeToPage(e,i),t?(new n).init(t.x,t.y):null},t.convertPointFromPageToNode=function(e,t){return t?(i.x=t.x,i.y=t.y):(i.x=0,i.y=0),t=webkitConvertPointFromPageToNode(e,i),t?(new n).init(t.x,t.y):null}},c=function(){t.convertPointFromNodeToPage=function(e,t){if(!e||void 0!==e.x)return null;var a;return(a=r(e))?(new n).init((t?t.x:0)+a.left,(t?t.y:0)+a.top):(new n).init(t?t.x:0,t?t.y:0)},t.convertPointFromPageToNode=function(e,t){if(!e||void 0!==e.x)return null;var a;return(a=r(e))?(new n).init((t?t.x:0)-a.left,(t?t.y:0)-a.top):(new n).init(t?t.x:0,t?t.y:0)}};i?l():c()}}),montageDefine("b8d1a32","core/geometry/point",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage;t.Point=n.specialize({init:{enumerable:!1,value:function(e,t){return this.x=null===e?0:e,this.y=null===t?0:t,this}},x:{enumerable:!0,value:0},y:{enumerable:!0,value:0}},{interpolate:{enumerable:!1,value:function(e,n,a,s){var r,i;return r=n.x+(a.x-n.x)*e,i=n.y+(a.y-n.y)*e,s>0&&(r=Math.round(r*s)/s,i=Math.round(i*s)/s),(new t.Point).init(r,i)}}})}}),montageDefine("b8d1a32","ui/base/abstract-number-field",{dependencies:["montage","ui/base/abstract-control","composer/key-composer","collections/dict"],factory:function(e,t){"use strict";var n=(e("montage").Montage,e("ui/base/abstract-control").AbstractControl),a=e("composer/key-composer").KeyComposer;e("collections/dict");var s=t.AbstractNumberField=n.specialize({constructor:{value:function s(){if(this.constructor===s)throw Error("AbstractNumberField cannot be instantiated.");n.constructor.call(this),this._propertyNamesUsed={},this.defineBinding("classList.has('montage--disabled')",{"<-":"!enabled"})}},enterDocument:{value:function(e){if(e){var t=this._propertyNamesUsed;t.min||(this.min=this.element.getAttribute("min")||this._min),t.max||(this.max=this.element.getAttribute("max")||this._max),t.step||(this.step=this.element.getAttribute("step")||this._step),t.value||(this.value=this.element.getAttribute("value")||this._value),delete this._propertyNamesUsed,this._numberFieldTextFieldComponent.addEventListener("action",this,!1),this._numberFieldMinusComponent.addEventListener("action",this,!1),this._numberFieldPlusComponent.addEventListener("action",this,!1),this.element.addEventListener("mousedown",this,!1),this.element.tabIndex="-1",this._upKeyComposer=a.createKey(this,"up","increase"),this._downKeyComposer=a.createKey(this,"down","decrease"),this._rightKeyComposer=a.createKey(this,"right","increase"),this._leftKeyComposer=a.createKey(this,"left","decrease")}}},prepareForActivationEvents:{value:function(){this.addEventListener("keyPress",this,!1),this._upKeyComposer.addEventListener("keyPress",null,!1),this._downKeyComposer.addEventListener("keyPress",null,!1),this._leftKeyComposer.addEventListener("keyPress",null,!1),this._rightKeyComposer.addEventListener("keyPress",null,!1)}},draw:{value:function(){this.element.setAttribute("aria-valuemax",this.max),this.element.setAttribute("aria-valuemin",this.min),this.element.setAttribute("aria-valuenow",this.value)}},acceptsActiveTarget:{value:!0},handleMousedown:{value:function(){this.element.focus()}},handlePlusAction:{value:function(){var e="number"==typeof this.min?this.min:0,t=this.value-e;t%this.step?0>t?t-=t%this.step:t+=this.step-t%this.step:t+=this.step,this.value=t+e}},handleMinusAction:{value:function(){var e="number"==typeof this.min?this.min:0,t=this.value-e;t-=t%this.step?t>0?t%this.step:this.step+t%this.step:this.step,this.value=t+e}},handleKeyPress:{value:function(e){this.enabled&&("increase"===e.identifier?this.handlePlusAction():"decrease"===e.identifier&&this.handleMinusAction())}},handleAction:{value:function(e){(e.target===this._numberFieldTextFieldComponent||e.target===this._numberFieldMinusComponent||e.target===this._numberFieldPlusComponent)&&(e.stopPropagation(),this.dispatchActionEvent())}},_value:{value:0},_required:{value:!1},_min:{value:"any"},_max:{value:"any"},_step:{value:1},min:{get:function(){return this._min},set:function(e){return"any"!==e&&isNaN(e=parseFloat(e))?!1:(this._min!==e&&(this._propertyNamesUsed&&(this._propertyNamesUsed.min=!0),this._min=e,this.needsDraw=!0,"number"==typeof e&&e>this.value&&(this.value=e)),void 0)}},max:{get:function(){return this._max},set:function(e){return"any"!==e&&isNaN(e=parseFloat(e))?!1:(this._max!==e&&(this._propertyNamesUsed&&(this._propertyNamesUsed.max=!0),this._max=e,this.needsDraw=!0,"number"==typeof e&&this.value>e&&(this.value=e)),void 0)}},step:{get:function(){return this._step},set:function(e){return isNaN(e=parseFloat(e))||0>=e?!1:(this._step!==e&&(this._propertyNamesUsed&&(this._propertyNamesUsed.step=!0),this._step=e),void 0)}},_valuePattern:{value:/[^0-9\.]+/g},value:{get:function(){return this._value},set:function(e){"string"==typeof e&&(e=e.replace(/[^0-9\.]+/g,"")),isNaN(e=parseFloat(e))||("number"==typeof this.min&&this.min>e&&(e=this.min),"number"==typeof this.max&&e>this.max&&(e=this.max),this._value!==e&&(this._propertyNamesUsed&&(this._propertyNamesUsed.value=!0),this._value=e,this.needsDraw=!0)),this._numberFieldTextFieldComponent&&this._value!==this._numberFieldTextFieldComponent.value&&(this._numberFieldTextFieldComponent.value=this._value)}},enabled:{value:!0},_numberFieldTextFieldComponent:{value:null},_numberFieldMinusComponent:{value:null},_numberFieldPlusComponent:{value:null}})}}),montageDefine("b8d1a32","ui/base/abstract-slider",{dependencies:["montage","ui/base/abstract-control","composer/translate-composer","composer/key-composer","collections/dict"],factory:function(e,t){"use strict";var n=(e("montage").Montage,e("ui/base/abstract-control").AbstractControl),a=e("composer/translate-composer").TranslateComposer,s=e("composer/key-composer").KeyComposer;e("collections/dict");var r=t.AbstractSlider=n.specialize({constructor:{value:function r(){if(this.constructor===r)throw Error("AbstractSlider cannot be instantiated.");n.constructor.call(this),this._propertyNamesUsed={},this.addOwnPropertyChangeListener("_sliderMagnitude",this),this.addOwnPropertyChangeListener("_min",this),this.addOwnPropertyChangeListener("_max",this),this.addOwnPropertyChangeListener("_value",this),this.addOwnPropertyChangeListener("_step",this),this.addOwnPropertyChangeListener("axis",this),this.axis="horizontal",this.defineBinding("classList.has('montage--disabled')",{"<-":"!enabled"})}},enterDocument:{value:function(e){if(e){this._translateComposer=new a,this._translateComposer.identifier="thumb",this._translateComposer.axis=this.axis,this._translateComposer.hasMomentum=!1,this.addComposerForElement(this._translateComposer,this._sliderThumbTrackElement),this._transform="webkitTransform"in this.element.style?"webkitTransform":"MozTransform"in this.element.style?"MozTransform":"oTransform"in this.element.style?"oTransform":"transform";var t=this._propertyNamesUsed;t._min||(this.min=this.element.getAttribute("min")||this._min),t._max||(this.max=this.element.getAttribute("max")||this._max),t._step||(this.step=this.element.getAttribute("step")||this._step),t._value||(this.value=this.element.getAttribute("value")||this._value),delete this._propertyNamesUsed,this.element.setAttribute("role","slider"),this.element.tabIndex="-1",this._upKeyComposer=s.createKey(this,"up","increase"),this._downKeyComposer=s.createKey(this,"down","decrease"),this._rightKeyComposer=s.createKey(this,"right","increase"),this._leftKeyComposer=s.createKey(this,"left","decrease")}}},prepareForActivationEvents:{value:function(){this._translateComposer.addEventListener("translateStart",this,!1),this._translateComposer.addEventListener("translate",this,!1),this._translateComposer.addEventListener("translateEnd",this,!1),this._sliderThumbTrackElement.addEventListener("touchstart",this,!1),document.addEventListener("touchend",this,!1),this._sliderThumbTrackElement.addEventListener("mousedown",this,!1),document.addEventListener("mouseup",this,!1),this.addEventListener("keyPress",this,!1),this._upKeyComposer.addEventListener("keyPress",null,!1),this._downKeyComposer.addEventListener("keyPress",null,!1),this._leftKeyComposer.addEventListener("keyPress",null,!1),this._rightKeyComposer.addEventListener("keyPress",null,!1)}},willDraw:{value:function(){this._sliderMagnitude=this._calculateSliderMagnitude()}},draw:{value:function(){this._sliderThumbTrackElement.style[this._transform]="vertical"===this.axis?"translateY("+this._valuePercentage+"%)":"translateX("+this._valuePercentage+"%)",this.element.setAttribute("aria-valuemax",this.max),this.element.setAttribute("aria-valuemin",this.min),this.element.setAttribute("aria-valuenow",this.value)}},acceptsActiveTarget:{value:!0},handleTouchstart:{value:function(){this.classList.add("montage-Slider--active"),this.element.focus()}},handleTouchend:{value:function(){this.classList.remove("montage-Slider--active")}},handleMousedown:{value:function(){this.classList.add("montage-Slider--active"),this.element.focus()}},handleMouseup:{value:function(){this.classList.remove("montage-Slider--active")}},handleThumbTranslateStart:{value:function(e){this._startTranslate="vertical"===this.axis?e.translateY:e.translateX,this._startValue=this.value}},handleThumbTranslate:{value:function(e){this.value="vertical"===this.axis?this._startValue+(this._startTranslate-e.translateY)/this._sliderMagnitude*(this._max-this._min):this._startValue+(e.translateX-this._startTranslate)/this._sliderMagnitude*(this._max-this._min)}},handleThumbTranslateEnd:{value:function(){this.classList.remove("montage-Slider--active")}},_increase:{value:function(){var e="number"==typeof this.min?this.min:0,t=this.value-e,n=this.step|(this.max-this.min)/100;t%n?0>t?t-=t%n:t+=n-t%n:t+=n,this.value=t+e}},_decrease:{value:function(){var e="number"==typeof this.min?this.min:0,t=this.value-e,n=this.step|(this.max-this.min)/100;t-=t%n?t>0?t%n:n+t%n:n,this.value=t+e}},handleKeyPress:{value:function(e){this.enabled&&("increase"===e.identifier?this._increase():"decrease"===e.identifier&&this._decrease())}},surrenderPointer:{value:function(){return!1}},_value:{value:50},_min:{value:0},_max:{value:100},_step:{value:"any"},min:{get:function(){return this._min},set:function(e){isNaN(e=parseFloat(e))||this._min!==e&&(this._min=e)}},max:{get:function(){return this._max},set:function(e){isNaN(e=parseFloat(e))||this._max!==e&&(this._max=e)}},step:{get:function(){return this._step},set:function(e){!isNaN(e=parseFloat(e))&&e>=0&&this._step!==e&&(this._step=e)}},value:{get:function(){return this._value},set:function(e){isNaN(e=parseFloat(e))||this._value!==e&&(this._value=e)}},enabled:{value:!0},axis:{value:null},_sliderThumbElement:{value:null},_sliderThumbTrackElement:{value:null},_translateComposer:{value:null},_transform:{value:null},_transition:{value:null},_sliderMagnitude:{value:null},_startTranslate:{value:null},_startValue:{value:null},_valuePercentage:{value:null},_calculateSliderMagnitude:{value:function(){return"vertical"===this.axis?this._sliderThumbTrackElement.offsetHeight:this._sliderThumbTrackElement.offsetWidth}},handleAxisChange:{value:function(){this._translateComposer&&(this._translateComposer.axis=this.axis),"vertical"===this.axis?(this.classList.add("montage-Slider--vertical"),this.classList.remove("montage-Slider--horizontal")):(this.classList.remove("montage-Slider--vertical"),this.classList.add("montage-Slider--horizontal"))}},_propertyRegex:{value:/_sliderMagnitude|_min|_max|_value|_step/},handlePropertyChange:{value:function(e,t){if(null!==t.match(this._propertyRegex)){if(this._propertyNamesUsed&&(this._propertyNamesUsed[t]=!0),this.value<=this.min)this.value=this.min;else{var n=this.value-this.min,a=n%this.step;if(a){var s=a>=.5*this.step&&this.value-a+this.step<=this.max;this.value=s?this.value-a+this.step:this.value-a}}this.value>this.max&&(this.value=this.max),this._valuePercentage=100*~~((this.value-this._min)*this._sliderMagnitude/(this._max-this._min))/this._sliderMagnitude,this.needsDraw=!0}}}})}}),montageDefine("b8d1a32","ui/base/abstract-control",{dependencies:["montage","ui/component","collections/dict"],factory:function(e,t){var n=(e("montage").Montage,e("ui/component").Component),a=e("collections/dict");t.AbstractControl=n.specialize({dispatchActionEvent:{value:function(){this.dispatchEvent(this.createActionEvent())}},_detail:{value:null},detail:{get:function(){return null==this._detail&&(this._detail=new a),this._detail}},createActionEvent:{value:function(){var e,t=document.createEvent("CustomEvent");return e=this._detail,t.initCustomEvent("action",!0,!0,e),t}}})}}),montageDefine("b8d1a32","composer/key-composer",{dependencies:["montage","composer/composer"],factory:function(e,t){var n=e("montage").Montage,a=e("composer/composer").Composer,s="keyPress",r="longKeyPress",i="keyRelease",o=t.KeyComposer=a.specialize({_isLoaded:{value:!1},_shouldDispatchEvent:{value:!1},shouldDispatchLongPress:{value:!1},_longPressTimeout:{value:null},_keyRegistered:{value:!1},_keys:{value:null},keys:{get:function(){return this._keys},set:function(e){this._keyRegistered?(c.defaultKeyManager.unregisterKey(this),this._keys=e,c.defaultKeyManager.registerKey(this)):this._keys=e}},_identifier:{value:null},identifier:{get:function(){return this._identifier},set:function(e){this._identifier=e}},load:{value:function(){this._isLoaded=!0,this._shouldDispatchEvent&&!this._keyRegistered&&(c.defaultKeyManager.registerKey(this),this._keyRegistered=!0)}},unload:{value:function(){this._isLoaded=!1,c.defaultKeyManager.unregisterKey(this),this._keyRegistered=!1}},addEventListener:{value:function(e,t,n){var o=this.component;a.addEventListener.call(this,e,t,n),(e==s||e==r||e==i)&&(this._shouldDispatchEvent=!0,e==r&&(this._shouldDispatchLongPress=!0),this._isLoaded?this._keyRegistered||(c.defaultKeyManager.registerKey(this),this._keyRegistered=!0):o&&"function"!=typeof o.addComposer&&(this.element||(this.element=window),this.load()))}},constructor:{value:function(){a.constructor.call(this)}},deserializedFromTemplate:{value:function(){var e=this.component;null===this.identifier&&(this.identifier=n.getInfoForObject(this).label),e&&("function"==typeof e.addComposer?e.addComposer(this):this._isLoaded||(this.element||(this.element=window),this.load()))}}},{createKey:{value:function(e,t,n){var a=this;return this===o&&(a=new o),n||(n=e.identifier?e.identifier+t.toLowerCase().replace(/[ +]/g).toCapitalized():t.toLowerCase().replace(/[ +]/g)),a.keys=t,a.identifier=n,e.addComposer(a),a}},createGlobalKey:{value:function(e,t,n){var a=this;return this===o&&(a=new o),a.keys=t,a.identifier=n,e.addComposerForElement(a,window),a}}}),l=null,c=n.specialize({_defaultKeyManager:{value:null},_loadingDefaultKeyManager:{value:!1},_keysToRegister:{value:[]},constructor:{value:function(){}},registerKey:{value:function(t){var n=this;this._defaultKeyManager?this._defaultKeyManager.registerKey(t):(this._keysToRegister.push(t),this._loadingDefaultKeyManager||(this._loadingDefaultKeyManager=!0,e.async("core/event/key-manager").then(function(e){var t=n._defaultKeyManager=e.defaultKeyManager;n._keysToRegister.forEach(function(e){t.registerKey(e)}),n._keysToRegister.length=0}).done()))}},unregisterKey:{value:function(e){this._defaultKeyManager&&this._defaultKeyManager.unregisterKey(e)}}},{defaultKeyManager:{get:function(){return l||(l=new c),this._defaultKeyManager?this._defaultKeyManager:l}}})}}),montageDefine("b8d1a32","composer/translate-composer",{dependencies:["montage","composer/composer","core/event/event-manager"],factory:function(e,t){"use strict";var n=(e("montage").Montage,e("composer/composer").Composer),a=e("core/event/event-manager").defaultEventManager,s=t.TranslateComposer=n.specialize({_NATIVE_ELEMENTS:{value:["A","IFRAME","EMBED","OBJECT","VIDEO","AUDIO","CANVAS","LABEL","INPUT","BUTTON","SELECT","TEXTAREA","KEYGEN","DETAILS","COMMAND"]},_WHEEL_POINTER:{value:"wheel",writable:!1},_externalUpdate:{value:!0},isAnimating:{value:!1},isMoving:{value:!1},frame:{value:function(){this.isAnimating&&this._animationInterval(),this._externalUpdate=!1}},_pointerSpeedMultiplier:{value:1},pointerSpeedMultiplier:{get:function(){return this._pointerSpeedMultiplier},set:function(e){this._pointerSpeedMultiplier=e}},pointerStartEventPosition:{value:null},_shouldDispatchTranslate:{value:!1},_isSelfUpdate:{value:!1},_allowFloats:{value:!1},allowFloats:{get:function(){return this._allowFloats},set:function(e){this._allowFloats!==e&&(this._allowFloats=e,this.translateX=this._translateX,this.translateY=this._translateY)}},_translateX:{value:0},translateX:{get:function(){return this._translateX},set:function(e){if("vertical"===this._axis)this._translateX=this._minTranslateX||0;else{var t=isNaN(e)?0:this._allowFloats?parseFloat(e):e>>0;null!==this._minTranslateX&&this._minTranslateX>t&&(t=this._minTranslateX),null!==this._maxTranslateX&&t>this._maxTranslateX&&(t=this._maxTranslateX),this._isSelfUpdate||(this.isAnimating=!1),this._translateX=t}}},_translateY:{value:0},translateY:{get:function(){return this._translateY},set:function(e){if("horizontal"===this._axis)this._translateY=this._minTranslateY||0;else{var t=isNaN(e)?0:this._allowFloats?parseFloat(e):e>>0;null!==this._minTranslateY&&this._minTranslateY>t&&(t=this._minTranslateY),null!==this._maxTranslateY&&t>this._maxTranslateY&&(t=this._maxTranslateY),this._isSelfUpdate||(this.isAnimating=!1),this._translateY=t}}},_minTranslateX:{value:null},minTranslateX:{get:function(){return this._minTranslateX},set:function(e){null!==e&&(e=parseFloat(e)),this._minTranslateX!=e&&(null!==e&&e>this._translateX&&(this.translateX=e),this._minTranslateX=e)}},_maxTranslateX:{value:null},maxTranslateX:{get:function(){return this._maxTranslateX},set:function(e){null!==e&&(e=parseFloat(e)),this._maxTranslateX!=e&&(null!==e&&this._translateX>e&&(this.translateX=e),this._maxTranslateX=e)}},_minTranslateY:{value:null},minTranslateY:{get:function(){return this._minTranslateY},set:function(e){null!==e&&(e=parseFloat(e)),this._minTranslateY!=e&&(null!==e&&e>this._translateY&&(this.translateY=e),this._minTranslateY=e)}},_maxTranslateY:{value:null},maxTranslateY:{get:function(){return this._maxTranslateY},set:function(e){null!==e&&(e=parseFloat(e)),this._maxTranslateY!=e&&(null!==e&&this._translateY>e&&(this.translateY=e),this._maxTranslateY=e)}},_axis:{value:"both"},axis:{get:function(){return this._axis},set:function(e){switch(e){case"vertical":case"horizontal":this._axis=e,this.translateX=this._translateX,this.translateY=this._translateY;break;default:this._axis="both"}}},invertAxis:{depends:["invertXAxis","invertYAxis"],get:function(){return this._invertXAxis===this._invertYAxis?this._invertXAxis:null},set:function(e){this.invertXAxis=e,this.invertYAxis=e}},_invertXAxis:{value:!1},invertXAxis:{get:function(){return this._invertXAxis},set:function(e){this._invertXAxis=!!e}},_invertYAxis:{value:!1},invertYAxis:{get:function(){return this._invertYAxis},set:function(e){this._invertYAxis=!!e}},startTranslateSpeed:{value:500},startTranslateRadius:{value:8},_hasMomentum:{value:!0},hasMomentum:{get:function(){return this._hasMomentum},set:function(e){this._hasMomentum=e?!0:!1}},__momentumDuration:{value:650},_momentumDuration:{get:function(){return this.__momentumDuration},set:function(e){this.__momentumDuration=isNaN(e)?1:e>>0,1>this.__momentumDuration&&(this.__momentumDuration=1)}},_pointerX:{value:null},_pointerY:{value:null},_touchIdentifier:{value:null},_isFirstMove:{value:!1},_start:{value:function(e,t,n){this.pointerStartEventPosition={pageX:e,pageY:t,target:n},this._pointerX=e,this._pointerY=t,window.Touch?(document.addEventListener("touchend",this,!0),this._element.addEventListener("touchmove",this,!1)):(document.addEventListener("mouseup",this,!0),this._element.addEventListener("mousemove",this,!1)),this.isAnimating=!1,this._isFirstMove=!0}},_observedPointer:{value:null},_shouldPreventDefault:{value:function(e){return!!e.target.tagName&&-1===s._NATIVE_ELEMENTS.indexOf(e.target.tagName)&&!e.target.isContentEditable}},captureMousedown:{value:function(e){0===e.button&&(this._observedPointer="mouse",this._start(e.clientX,e.clientY,e.target))}},handleMousedown:{value:function(e){0!==e.button||this.eventManager.componentClaimingPointer(this._observedPointer)||this.eventManager.claimPointer(this._observedPointer,this)}},handleMousemove:{value:function(e){this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?(e.preventDefault(),this._firstMove()):("both"===this.axis||this._analyzeMovement(e))&&this._stealPointer()&&(e.preventDefault(),this._firstMove())}},captureMousemove:{value:function(e){this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?(e.preventDefault(),this._move(e.clientX,e.clientY)):("both"===this.axis||this._analyzeMovement(e))&&this._stealPointer()&&(e.preventDefault(),this._move(e.clientX,e.clientY))}},captureMouseup:{value:function(e){this._end(e)}},_releaseInterest:{value:function(){window.Touch?(document.removeEventListener("touchend",this,!0),this._isFirstMove?this._element.removeEventListener("touchmove",this,!1):document.removeEventListener("touchmove",this,!0)):(document.removeEventListener("mouseup",this,!0),this._isFirstMove?this._element.removeEventListener("mousemove",this,!1):document.removeEventListener("mousemove",this,!0)),this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this.eventManager.forfeitPointer(this._observedPointer,this),this._observedPointer=null}},captureTouchstart:{value:function(e){null!==this._observedPointer&&this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)||e.targetTouches&&1===e.targetTouches.length&&(this._observedPointer=e.targetTouches[0].identifier,this._start(e.targetTouches[0].clientX,e.targetTouches[0].clientY,e.targetTouches[0].target))}},handleTouchstart:{value:function(e){this.eventManager.componentClaimingPointer(this._observedPointer)||e.targetTouches&&1===e.targetTouches.length&&(this._shouldPreventDefault(e)&&e.preventDefault(),this.eventManager.claimPointer(this._observedPointer,this))}},handleTouchmove:{value:function(e){this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?(e.preventDefault(),this._firstMove()):("both"===this.axis||this._analyzeMovement(e))&&this._stealPointer()&&(e.preventDefault(),this._firstMove())}},captureTouchmove:{value:function(e){for(var t=0,n=e.changedTouches.length;n>t&&e.changedTouches[t].identifier!==this._observedPointer;)t++;n>t&&(this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?(e.preventDefault(),this._move(e.changedTouches[t].clientX,e.changedTouches[t].clientY)):this._analyzeMovement(e.changedTouches[t]))}},captureTouchend:{value:function(e){for(var t=0,n=e.changedTouches.length;n>t&&e.changedTouches[t].identifier!==this._observedPointer;)t++;n>t&&this._end(e.changedTouches[t])}},_analyzeMovement:{value:function(e){var t=e.velocity;if(t){var n,a,s,r,i,o,l,c,p=.7853981633974483,u=2.356194490192345,h=-2.356194490192345,d=-.7853981633974483;if(o=t.speed,0!==t.speed&&!isNaN(t.speed))if(i=t.angle,"horizontal"===this.axis){if(s=p>=i&&i>=d,r=i>=u||h>=i,s||r)return this._stealPointer()}else if("vertical"===this.axis){if(n=d>=i&&i>=h,a=i>=p&&u>=i,n||a)return this._stealPointer()}else{if(o>=this.startTranslateSpeed)return this._stealPointer();if(l=this.pointerStartEventPosition.pageX-e.pageX,c=this.pointerStartEventPosition.pageY-e.pageY,l*l+c*c>this.startTranslateRadius*this.startTranslateRadius)return this._stealPointer()}}}},_stealPointer:{value:function(){return this.eventManager.claimPointer(this._observedPointer,this)}},_translateEndTimeout:{value:null},captureMousewheel:{value:function(){this.eventManager.componentClaimingPointer(this._WHEEL_POINTER)||this.eventManager.claimPointer(this._WHEEL_POINTER,this.component)}},handleMousewheel:{value:function(e){var t=this;if(this.eventManager.isPointerClaimedByComponent(this._WHEEL_POINTER,this.component)){var n=this._translateY;this._dispatchTranslateStart(),this.translateY=this._translateY-20*e.wheelDeltaY/120,this._dispatchTranslate(),window.clearTimeout(this._translateEndTimeout),this._translateEndTimeout=window.setTimeout(function(){t._dispatchTranslateEnd()},400),n!==this._translateY&&this._shouldPreventDefault(e)&&e.preventDefault(),this.eventManager.forfeitPointer(this._WHEEL_POINTER,this.component)}}},_firstMove:{value:function(){this._isFirstMove&&(this._dispatchTranslateStart(this._translateX,this._translateY),this._isFirstMove=!1,this.isMoving=!0,window.Touch?(document.addEventListener("touchmove",this,!0),this._element.removeEventListener("touchmove",this,!1)):(document.addEventListener("mousemove",this,!0),this._element.removeEventListener("mousemove",this,!1)))}},_move:{value:function(e,t){var n;this._isSelfUpdate=!0,"vertical"!=this._axis&&(n=this._invertXAxis?this._pointerX-e:e-this._pointerX,this.translateX+=n*this._pointerSpeedMultiplier),"horizontal"!=this._axis&&(n=this._invertYAxis?this._pointerY-t:t-this._pointerY,this.translateY+=n*this._pointerSpeedMultiplier),this._isSelfUpdate=!1,this._pointerX=e,this._pointerY=t,this._shouldDispatchTranslate&&this._dispatchTranslate()}},_bezierTValue:{value:function(e,t,n,a,s){var r,i,o,l,c=1-3*a+3*t,p=3*a-6*t,u=3*t,h=.5;for(i=0;10>i;i++)l=h*h,r=3*c*l+2*p*h+u,o=1-h,h-=(3*(o*o*h*t+o*l*a)+l*h-e)/r;return l=h*h,o=1-h,3*(o*o*h*n+o*l*s)+l*h}},_dispatchTranslateStart:{value:function(e,t){var n=document.createEvent("CustomEvent");n.initCustomEvent("translateStart",!0,!0,null),n.translateX=e,n.translateY=t,this.dispatchEvent(n)}},_dispatchTranslateEnd:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateEnd",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,this.dispatchEvent(e)}},_dispatchTranslate:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translate",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,this.dispatchEvent(e)}},animateBouncingX:{value:!1,enumerable:!1},startTimeBounceX:{value:!1,enumerable:!1},animateBouncingY:{value:!1,enumerable:!1},startTimeBounceY:{value:!1,enumerable:!1},animateMomentum:{value:!1,enumerable:!1},startTime:{value:null,enumerable:!1},startX:{value:null,enumerable:!1},posX:{value:null,enumerable:!1},endX:{value:null,enumerable:!1},startY:{value:null,enumerable:!1},posY:{value:null,enumerable:!1},endY:{value:null,enumerable:!1},translateStrideX:{value:null},translateStrideY:{value:null},translateStrideDuration:{value:330},_animationInterval:{value:function(){var e,t,n,a,s=Date.now(),r=!1;this.animateMomentum&&(e=s-this.startTime,this.__momentumDuration>e?(this.posX=this.startX-(this.momentumX+this.momentumX*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this.posY=this.startY-(this.momentumY+this.momentumY*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this.translateStrideX&&null===this.startStrideXTime&&(this.__momentumDuration-e<this.translateStrideDuration||Math.abs(this.posX-this.endX)<.75*this.translateStrideX)&&(this.startStrideXTime=s),this.translateStrideY&&null===this.startStrideYTime&&(this.__momentumDuration-e<this.translateStrideDuration||Math.abs(this.posY-this.endY)<.75*this.translateStrideY)&&(this.startStrideYTime=s)):this.animateMomentum=!1),t=Math.round(this.endX/this.translateStrideX),this.startStrideXTime&&s-this.startStrideXTime>0&&(s-this.startStrideXTime<this.translateStrideDuration?(e=this._bezierTValue((s-this.startStrideXTime)/this.translateStrideDuration,.275,0,.275,1),this.posX=this.posX*(1-e)+t*this.translateStrideX*e,r=!0):this.posX=t*this.translateStrideX),t=Math.round(this.endY/this.translateStrideY),this.startStrideYTime&&s-this.startStrideYTime>0&&(s-this.startStrideYTime<this.translateStrideDuration?(e=this._bezierTValue((s-this.startStrideYTime)/this.translateStrideDuration,.275,0,.275,1),this.posY=this.posY*(1-e)+t*this.translateStrideY*e,r=!0):this.posY=t*this.translateStrideY),n=this.posX,a=this.posY,this._isSelfUpdate=!0,this.translateX=n,this.translateY=a,this._shouldDispatchTranslate&&this._dispatchTranslate(),this._isSelfUpdate=!1,this.isAnimating=this.animateMomentum||r,this.isAnimating?this.needsFrame=!0:this._dispatchTranslateEnd()
}},_end:{value:function(e){this.startTime=Date.now(),this.endX=this.posX=this.startX=this._translateX,this.endY=this.posY=this.startY=this._translateY,this._hasMomentum&&(e.velocity.speed>40||this.translateStrideX||this.translateStrideY)?(this.momentumX="vertical"!=this._axis?e.velocity.x*this._pointerSpeedMultiplier*(this._invertXAxis?1:-1):0,this.momentumY="horizontal"!=this._axis?e.velocity.y*this._pointerSpeedMultiplier*(this._invertYAxis?1:-1):0,this.endX=this.startX-this.momentumX*this.__momentumDuration/2e3,this.endY=this.startY-this.momentumY*this.__momentumDuration/2e3,this.startStrideXTime=null,this.startStrideYTime=null,this.animateMomentum=!0):this.animateMomentum=!1,this.animateMomentum?this._animationInterval():this._isFirstMove||(this.isMoving=!1,this._dispatchTranslateEnd()),this._releaseInterest()}},surrenderPointer:{value:function(){return!this.isMoving}},eventManager:{get:function(){return a}},load:{value:function(){window.Touch?(this._element.addEventListener("touchstart",this,!0),this._element.addEventListener("touchstart",this,!1)):(this._element.addEventListener("mousedown",this,!0),this._element.addEventListener("mousedown",this,!1),this._element.addEventListener("mousewheel",this,!1),this._element.addEventListener("mousewheel",this,!0)),this.eventManager.isStoringPointerEvents=!0}},addEventListener:{value:function(e,t,a){n.addEventListener.call(this,e,t,a),"translate"===e&&(this._shouldDispatchTranslate=!0)}}})}}),montageDefine("b8d1a32","composer/composer",{dependencies:["montage","core/target"],factory:function(e,t){var n=(e("montage").Montage,e("core/target").Target);t.Composer=n.specialize({_component:{value:null},component:{get:function(){return this._component},set:function(e){this._component=e}},_element:{value:null},element:{get:function(){return this._element},set:function(e){this._element=e}},lazyLoad:{value:!1},_needsFrame:{value:!1},needsFrame:{set:function(e){this._needsFrame!==e&&(this._needsFrame=e,this._component&&e&&this._component.scheduleComposer(this))},get:function(){return this._needsFrame}},frame:{value:function(){}},_resolveDefaults:{value:function(){null==this.element&&null!=this.component&&(this.element=this.component.element)}},_load:{value:function(){this.element||this._resolveDefaults(),this.load()}},load:{value:function(){}},unload:{value:function(){}},deserializedFromTemplate:{value:function(){this.component&&this.component.addComposer(this)}}})}}),montageDefine("b8d1a32","ui/base/abstract-text-field",{dependencies:["montage","ui/base/abstract-control","composer/key-composer","collections/dict"],factory:function(e,t){var n=(e("montage").Montage,e("ui/base/abstract-control").AbstractControl),a=e("composer/key-composer").KeyComposer;e("collections/dict");var s=t.AbstractTextField=n.specialize({constructor:{value:function s(){if(this.constructor===s)throw Error("AbstractTextField cannot be instantiated.");n.constructor.call(this),this._keyComposer=new a,this._keyComposer.component=this,this._keyComposer.keys="enter",this.addComposer(this._keyComposer),this.defineBindings({"classList.has('montage--disabled')":{"<-":"!enabled"}})}},hasTemplate:{value:!1},acceptsActiveTarget:{value:!0},enabled:{value:!0},_placeholderValue:{value:null},placeholderValue:{set:function(e){this._placeholderValue=e,this.needsDraw=!0},get:function(){return this._placeholderValue}},_value:{value:null},value:{set:function(e){this._value=e,this.needsDraw=!0},get:function(){return this._value}},_keyComposer:{value:null},handleKeyPress:{value:function(){this.enabled&&this.dispatchActionEvent()}},prepareForActivationEvents:{value:function(){this.addEventListener("keyPress",this,!1),this._keyComposer.addEventListener("keyPress",null,!1)}},enterDocument:{value:function(e){e&&(this.element.addEventListener("input",this,!1),this.element.addEventListener("change",this,!1))}},draw:{value:function(){this.element.value=this.value,null!=this.placeholderValue&&this.element.setAttribute("placeholder",this.placeholderValue)}},handleChange:{value:function(){this._updateValueFromDom()}},handleInput:{value:function(){this._updateValueFromDom()}},_updateValueFromDom:{value:function(){this._value!==this.element.value&&(this._value=this.element.value,this.dispatchOwnPropertyChange("value",this._value))}}})}}),montageDefine("b8d1a32","ui/base/abstract-button",{dependencies:["montage","ui/base/abstract-control","composer/press-composer"],factory:function(e,t){var n=(e("montage").Montage,e("ui/base/abstract-control").AbstractControl),a=e("composer/press-composer").PressComposer,s=t.AbstractButton=n.specialize({constructor:{value:function s(){if(this.constructor===s)throw Error("AbstractControl cannot be instantiated.");n.constructor.call(this),this._pressComposer=new a,this.addComposer(this._pressComposer),this._pressComposer.defineBinding("longPressThreshold ",{"<-":"holdThreshold",source:this}),this.defineBinding("classList.has('montage--disabled')",{"<-":"!enabled"}),this.defineBinding("classList.has('montage--active')",{"<-":"active"})}},enabled:{value:!0},_preventFocus:{value:!1},preventFocus:{get:function(){return this._preventFocus},set:function(e){this._preventFocus=!!e,this.needsDraw=!0}},acceptsActiveTarget:{value:function(){return!this._preventFocus}},willBecomeActiveTarget:{value:function(){}},_labelNode:{value:void 0,enumerable:!1},_label:{value:void 0,enumerable:!1},label:{get:function(){return this._label},set:function(e){if(void 0!==e&&this.converter)try{e=this.converter.convert(e),this.error&&(this.error=null)}catch(t){this.error=t}this._label=""+e,this.isInputElement&&(this.value=this._label),this.needsDraw=!0}},_setLabelInitialValue:{value:function(e){void 0===this._label&&(this._label=e)}},holdThreshold:{value:1e3},_pressComposer:{value:null},_active:{value:!1},active:{get:function(){return this._active},set:function(e){this._active=e,this.needsDraw=!0}},prepareForActivationEvents:{value:function(){this._pressComposer.addEventListener("pressStart",this,!1),this._pressComposer.addEventListener("press",this,!1),this._pressComposer.addEventListener("pressCancel",this,!1)}},addEventListener:{value:function(e,t,a){n.addEventListener.call(this,e,t,a),"longAction"===e&&this._pressComposer.addEventListener("longPress",this,!1)}},handlePressStart:{value:function(e){this.active=!0,e.touch&&document.addEventListener("touchmove",this,!1),this._preventFocus||this._element.focus()}},handlePress:{value:function(){this.active=!1,this.dispatchActionEvent(),document.removeEventListener("touchmove",this,!1)}},handleKeyup:{value:function(e){32===e.keyCode&&(this.active=!1,this.dispatchActionEvent())}},handleLongPress:{value:function(){this._pressComposer.cancelPress();var e=document.createEvent("CustomEvent");e.initCustomEvent("longAction",!0,!0,null),this.dispatchEvent(e)}},handlePressCancel:{value:function(){this.active=!1,document.removeEventListener("touchmove",this,!1)}},handleTouchmove:{value:function(e){e.preventDefault()}},isInputElement:{value:!1},enterDocument:{value:function(e){e&&(this.isInputElement="INPUT"===this.originalElement.tagName,this.isInputElement?(Object.defineProperty(this,"value",{get:function(){return this._label},set:function(e){this.label=e}}),void 0===this._label&&(this._label=this.originalElement.value)):(this.originalElement.firstChild||this.originalElement.appendChild(document.createTextNode("")),this._labelNode=this.originalElement.firstChild,this._setLabelInitialValue(this._labelNode.data),void 0===this._label&&(this._label=this._labelNode.data)),this.element.setAttribute("role","button"),this.element.addEventListener("keyup",this,!1))}},_drawLabel:{enumerable:!1,value:function(e){this.isInputElement?this._element.setAttribute("value",e):this._labelNode&&(this._labelNode.data=e)}},draw:{value:function(){this._elementNeedsTabIndex()&&(this._preventFocus?this.element.removeAttribute("tabindex"):this.element.setAttribute("tabindex","-1")),this._drawLabel(this.label)}},_elementNeedsTabIndexRegex:{value:/INPUT|TEXTAREA|A|SELECT|BUTTON|LABEL/},_elementNeedsTabIndex:{value:function(){return null===this.element.tagName.match(this._elementNeedsTabIndexRegex)}}})}}),montageDefine("b8d1a32","composer/press-composer",{dependencies:["montage","composer/composer","core/event/mutable-event"],factory:function(e,t){var n=e("montage").Montage,a=e("composer/composer").Composer,s=e("core/event/mutable-event").MutableEvent,r=t.PressComposer=a.specialize({load:{value:function(){window.Touch?this._element.addEventListener("touchstart",this,!0):this._element.addEventListener("mousedown",this,!0)}},unload:{value:function(){window.Touch?this._element.removeEventListener("touchstart",this):this._element.removeEventListener("mousedown",this)}},delegate:{value:null},cancelPress:{value:function(){return this._state===r.PRESSED?(this._dispatchPressCancel(),this._endInteraction(),!0):!1}},addEventListener:{value:function(e,t,n){a.addEventListener.call(this,e,t,n),"longPress"===e&&(this._shouldDispatchLongPress=!0)}},UNPRESSED:{value:0},PRESSED:{value:1},CANCELLED:{value:2},_state:{enumerable:!1,value:0},state:{get:function(){return this._state}},_shouldDispatchLongPress:{enumerable:!1,value:!1},_longPressThreshold:{enumerable:!1,value:1e3},longPressThreshold:{get:function(){return this._longPressThreshold},set:function(e){this._longPressThreshold!==e&&(this._longPressThreshold=e)}},_longPressTimeout:{enumberable:!1,value:null},_observedPointer:{enumerable:!1,value:null},_startInteraction:{enumerable:!1,value:function(e){if("enabled"in this.component&&!this.component.enabled||null!==this._observedPointer)return!1;var t,n=0;if("touchstart"===e.type){for(t=e.changedTouches.length;t>n;n++)if(!this.component.eventManager.componentClaimingPointer(e.changedTouches[n].identifier)){this._observedPointer=e.changedTouches[n].identifier;break}if(null===this._observedPointer)return!1;document.addEventListener("touchend",this,!1),document.addEventListener("touchcancel",this,!1)}else"mousedown"===e.type&&(this._observedPointer="mouse",document.addEventListener("mouseup",this,!1),document.addEventListener("click",this,!1));this._element.addEventListener("dragstart",this,!1),this.component.eventManager.claimPointer(this._observedPointer,this),this._dispatchPressStart(e)}},_interpretInteraction:{value:function(e){var t,n,a;if(null===this._observedPointer)return this._endInteraction(e),void 0;for(t=!this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this),n=e.target;n!==this._element&&n&&n.parentNode;)n=n.parentNode;if(a=n===this._element,t&&"click"===e.type)return e.preventDefault(),this._endInteraction(e),void 0;if("mouseup"===e.type){if(!t&&a)return this._dispatchPress(e),this._endInteraction(e),void 0;if(!t&&!a)return this._dispatchPressCancel(e),this._endInteraction(e),void 0;t&&!a&&this._endInteraction(e)}}},_endInteraction:{value:function(e){e&&"touchend"!==e.type&&"touchcancel"!==e.type?e&&"click"!==e.type&&"mouseup"!==e.type||(document.removeEventListener("click",this),document.removeEventListener("mouseup",this)):(document.removeEventListener("touchend",this),document.removeEventListener("touchcancel",this)),this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this.component.eventManager.forfeitPointer(this._observedPointer,this),this._observedPointer=null,this._state=r.UNPRESSED}},_changedTouchisObserved:{value:function(){if(null===this._observedPointer)return!1;for(var e=0,t=event.changedTouches.length;t>e;e++)if(event.changedTouches[e].identifier===this._observedPointer)return e;return!1}},surrenderPointer:{value:function(e,t){var n=this.callDelegateMethod("surrenderPointer",e,t);return void 0!==n&&n===!1?!1:(this._dispatchPressCancel(),!0)}},captureTouchstart:{value:function(e){this._startInteraction(e)}},handleTouchend:{value:function(e){return null===this._observedPointer?(this._endInteraction(e),void 0):(this._changedTouchisObserved(e.changedTouches)!==!1&&(this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?this._dispatchPress(e):e.preventDefault(),this._endInteraction(e)),void 0)}},handleTouchcancel:{value:function(e){(null===this._observedPointer||this._changedTouchisObserved(e.changedTouches)!==!1)&&(this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this._dispatchPressCancel(e),this._endInteraction(e))}},captureMousedown:{value:function(e){this._startInteraction(e)}},handleClick:{value:function(e){this._interpretInteraction(e)}},handleMouseup:{value:function(e){this._interpretInteraction(e)}},handleDragstart:{value:function(e){this._dispatchPressCancel(e),this._endInteraction()}},_createPressEvent:{enumerable:!1,value:function(e,t){var n,a;return t||(t=document.createEvent("CustomEvent"),t.initCustomEvent(e,!0,!0,null)),n=new i,n.event=t,n.type=e,n.pointer=this._observedPointer,n.targetElement=t.target,t.changedTouches&&(a=this._changedTouchisObserved(t.changedTouches))!==!1&&(n.touch=t.changedTouches[a]),n}},_dispatchPressStart:{enumerable:!1,value:function(e){if(this._state=r.PRESSED,this.dispatchEvent(this._createPressEvent("pressStart",e)),this._shouldDispatchLongPress){var t=this;this._longPressTimeout=setTimeout(function(){t._dispatchLongPress()},this._longPressThreshold)}}},_dispatchPress:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(clearTimeout(this._longPressTimeout),this._longPressTimeout=null),this.dispatchEvent(this._createPressEvent("press",e)),this._state=r.UNPRESSED}},_dispatchLongPress:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(this.dispatchEvent(this._createPressEvent("longPress",e)),this._longPressTimeout=null)}},_dispatchPressCancel:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(clearTimeout(this._longPressTimeout),this._longPressTimeout=null),this._state=r.CANCELLED,this.dispatchEvent(this._createPressEvent("pressCancel",e))}}}),i=function(){var e,t,a,r,i,o;for(e=s.specialize({type:{value:"press"},_event:{enumerable:!1,value:null},event:{get:function(){return this._event},set:function(e){this._event=e}},_touch:{enumerable:!1,value:null},touch:{get:function(){return this._touch},set:function(e){this._touch=e}}}),t=["altKey","ctrlKey","metaKey","shiftKey","cancelBubble","currentTarget","defaultPrevented","eventPhase","timeStamp","preventDefault","stopImmediatePropagation","stopPropagation"],a=["clientX","clientY","pageX","pageY","screenX","screenY","target"],r=function(e){return{get:function(){return this._event[e]}}},i=function(e){return{get:function(){return this._touch?this._touch[e]:this._event[e]}}},o=t.length-1;o>=0;o--)n.defineProperty(e,t[o],r(t[o]));for(o=a.length-1;o>=0;o--)n.defineProperty(e,a[o],i(a[o]));return e}()}}),montageDefine("febb707","shim",{dependencies:["./shim-array","./shim-object","./shim-function","./shim-regexp"],factory:function(e){e("./shim-array"),e("./shim-object"),e("./shim-function"),e("./shim-regexp")}}),montageDefine("febb707","listen/property-changes",{dependencies:["../shim","../weak-map"],factory:function(e,t,n){function a(){throw Error("This is an abstract interface. Mix it. Don't construct it")}e("../shim");var s=e("../weak-map"),r=Object.prototype.hasOwnProperty,i=new s,o=new s;n.exports=a,a.debug=!0,a.prototype.getOwnPropertyChangeDescriptor=function(e){i.has(this)||i.set(this,{});var t=i.get(this);return r.call(t,e)||(t[e]={willChangeListeners:[],changeListeners:[]}),t[e]},a.prototype.hasOwnPropertyChangeDescriptor=function(e){if(!i.has(this))return!1;if(!e)return!0;var t=i.get(this);return r.call(t,e)?!0:!1},a.prototype.addOwnPropertyChangeListener=function(e,t,n){this.makeObservable&&!this.isObservable&&this.makeObservable();var s,r=a.getOwnPropertyChangeDescriptor(this,e);s=n?r.willChangeListeners:r.changeListeners,a.makePropertyObservable(this,e),s.push(t);var i=this;return function(){a.removeOwnPropertyChangeListener(i,e,s,n),i=null}},a.prototype.addBeforeOwnPropertyChangeListener=function(e,t){return a.addOwnPropertyChangeListener(this,e,t,!0)},a.prototype.removeOwnPropertyChangeListener=function(e,t,n){var s,r=a.getOwnPropertyChangeDescriptor(this,e);s=n?r.willChangeListeners:r.changeListeners;var i=s.lastIndexOf(t);if(-1===i)throw Error("Can't remove listener: does not exist.");s.splice(i,1),0===r.changeListeners.length+r.willChangeListeners.length&&a.makePropertyUnobservable(this,e)},a.prototype.removeBeforeOwnPropertyChangeListener=function(e,t){return a.removeOwnPropertyChangeListener(this,e,t,!0)},a.prototype.dispatchOwnPropertyChange=function(e,t,n){var s=a.getOwnPropertyChangeDescriptor(this,e);if(!s.isActive){s.isActive=!0;var r;r=n?s.willChangeListeners:s.changeListeners;var i=(n?"Will":"")+"Change",o="handleProperty"+i,l=e+"";l=l&&l[0].toUpperCase()+l.slice(1);var c="handle"+l+i;try{r.forEach(function(n){var a=n;n=n[c]||n[o]||n,n.call(a,t,e,this)},this)}finally{s.isActive=!1}}},a.prototype.dispatchBeforeOwnPropertyChange=function(e,t){return a.dispatchOwnPropertyChange(this,e,t,!0)},a.prototype.makePropertyObservable=function(e){if(!Array.isArray(this)){if(!Object.isExtensible(this,e))throw Error("Can't make property "+JSON.stringify(e)+" observable on "+this+" because object is not extensible");var t;"object"==typeof this.__state__?t=this.__state__:(t={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:t,writable:!0,enumerable:!1})),t[e]=this[e],o.has(this)||(n={},o.set(this,n));var n=o.get(this);if(!r.call(n,e)){var s,i=this;Object.getOwnPropertyDescriptor(i,e);do{if(s=Object.getOwnPropertyDescriptor(i,e))break;i=Object.getPrototypeOf(i)}while(i);if(s=s||{value:void 0,enumerable:!0,writable:!0,configurable:!0},!s.configurable)throw Error("Can't observe non-configurable properties");if(n[e]=s,s.writable||s.set){var l;l="value"in s?{get:function(){return s.value},set:function(n){return n===s.value?n:(a.dispatchBeforeOwnPropertyChange(this,e,s.value),s.value=n,t[e]=n,a.dispatchOwnPropertyChange(this,e,n),n)},enumerable:s.enumerable,configurable:!0}:{get:function(){return s.get?s.get.apply(this,arguments):void 0},set:function(n){var r;return s.get&&(r=s.get.apply(this,arguments)),s.set&&s.set.apply(this,arguments),s.get&&(n=s.get.apply(this,arguments),t[e]=n),n===r?n:(a.dispatchBeforeOwnPropertyChange(this,e,r),a.dispatchOwnPropertyChange(this,e,n),n)},enumerable:s.enumerable,configurable:!0},Object.defineProperty(this,e,l)}}}},a.prototype.makePropertyUnobservable=function(e){if(!Array.isArray(this)){if(!o.has(this))throw Error("Can't uninstall observer on property");var t=o.get(this);if(!t[e])throw Error("Can't uninstall observer on property");var n=t[e];delete t[e];var a;"object"==typeof this.__state__?a=this.__state__:(a={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:a,writable:!0,enumerable:!1})),delete a[e],Object.defineProperty(this,e,n)}},a.getOwnPropertyChangeDescriptor=function(e,t){return e.getOwnPropertyChangeDescriptor?e.getOwnPropertyChangeDescriptor(t):a.prototype.getOwnPropertyChangeDescriptor.call(e,t)},a.hasOwnPropertyChangeDescriptor=function(e,t){return e.hasOwnPropertyChangeDescriptor?e.hasOwnPropertyChangeDescriptor(t):a.prototype.hasOwnPropertyChangeDescriptor.call(e,t)},a.addOwnPropertyChangeListener=function(e,t,n,s){return Object.isObject(e)?e.addOwnPropertyChangeListener?e.addOwnPropertyChangeListener(t,n,s):a.prototype.addOwnPropertyChangeListener.call(e,t,n,s):void 0},a.removeOwnPropertyChangeListener=function(e,t,n,s){return Object.isObject(e)?e.removeOwnPropertyChangeListener?e.removeOwnPropertyChangeListener(t,n,s):a.prototype.removeOwnPropertyChangeListener.call(e,t,n,s):void 0},a.dispatchOwnPropertyChange=function(e,t,n,s){return Object.isObject(e)?e.dispatchOwnPropertyChange?e.dispatchOwnPropertyChange(t,n,s):a.prototype.dispatchOwnPropertyChange.call(e,t,n,s):void 0},a.addBeforeOwnPropertyChangeListener=function(e,t,n){return a.addOwnPropertyChangeListener(e,t,n,!0)},a.removeBeforeOwnPropertyChangeListener=function(e,t,n){return a.removeOwnPropertyChangeListener(e,t,n,!0)},a.dispatchBeforeOwnPropertyChange=function(e,t,n){return a.dispatchOwnPropertyChange(e,t,n,!0)},a.makePropertyObservable=function(e,t){return e.makePropertyObservable?e.makePropertyObservable(t):a.prototype.makePropertyObservable.call(e,t)},a.makePropertyUnobservable=function(e,t){return e.makePropertyUnobservable?e.makePropertyUnobservable(t):a.prototype.makePropertyUnobservable.call(e,t)}}}),montageDefine("febb707","weak-map",{dependencies:[],factory:function(e,t,n){"use strict";n.exports="undefined"!=typeof WeakMap?WeakMap:function(){function e(e){return e.prototype=null,Object.freeze(e)}Object.prototype.hasOwnProperty;var t=Object.getOwnPropertyNames,n=Object.defineProperty,a={};t(Object).forEach(function(e){a[e]=Object[e]});var s="ident:"+Math.random()+"___";if("undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues&&"function"==typeof ArrayBuffer&&"function"==typeof Uint8Array){var r=new ArrayBuffer(25),i=new Uint8Array(r);crypto.getRandomValues(i),s="rand:"+Array.prototype.map.call(i,function(e){return(e%36).toString(36)}).join("")+"___"}n(Object,"getOwnPropertyNames",{value:function(e){return t(e).filter(function(e){return e!==s})}}),"getPropertyNames"in Object&&n(Object,"getPropertyNames",{value:function(e){return a.getPropertyNames(e).filter(function(e){return e!==s})}});var o=function(e){if(e!==Object(e))throw new TypeError("Not an object: "+e);var t=e[s];if(t&&t.key===e)return t;if(!a.isExtensible(e))return void 0;var r=[],i=[];return t={key:e,gets:r,vals:i},n(e,s,{value:t,writable:!1,enumerable:!1,configurable:!1}),t};(function(){var e=Object.freeze;n(Object,"freeze",{value:function(t){return o(t),e(t)}});var t=Object.seal;n(Object,"seal",{value:function(e){return o(e),t(e)}});var a=Object.preventExtensions;n(Object,"preventExtensions",{value:function(e){return o(e),a(e)}})})();var l=function(){function t(e,n){var a,s,l=o(e);return l?(a=l.gets.indexOf(t),s=l.vals):(a=r.indexOf(e),s=i),a>=0?s[a]:n}function n(e){var n,a=o(e);return n=a?a.gets.indexOf(t):r.indexOf(e),n>=0}function a(e,n){var a,s=o(e);s?(a=s.gets.indexOf(t),a>=0?s.vals[a]=n:(s.gets.push(t),s.vals.push(n))):(a=r.indexOf(e),a>=0?i[a]=n:(r.push(e),i.push(n)))}function s(e){var n,a=o(e);return a?(n=a.gets.indexOf(t),n>=0&&(a.gets.splice(n,1),a.vals.splice(n,1))):(n=r.indexOf(e),n>=0&&(r.splice(n,1),i.splice(n,1))),!0}var r=[],i=[];return Object.create(l.prototype,{get___:{value:e(t)},has___:{value:e(n)},set___:{value:e(a)},delete___:{value:e(s)}})};return l.prototype=Object.create(Object.prototype,{get:{value:function(e,t){return this.get___(e,t)},writable:!0,configurable:!0},has:{value:function(e){return this.has___(e)},writable:!0,configurable:!0},set:{value:function(e,t){this.set___(e,t)},writable:!0,configurable:!0},"delete":{value:function(e){return this.delete___(e)},writable:!0,configurable:!0}}),l}()}}),montageDefine("febb707","map",{dependencies:["./shim","./set","./generic-collection","./generic-map","./listen/property-changes"],factory:function(e,t,n){"use strict";function a(e,t,n,r){return this instanceof a?(t=t||Object.equals,n=n||Object.hash,r=r||Function.noop,this.contentEquals=t,this.contentHash=n,this.getDefault=r,this.store=new s(void 0,function(e,n){return t(e.key,n.key)},function(e){return n(e.key)}),this.length=0,this.addEach(e),void 0):new a(e,t,n,r)}e("./shim");var s=e("./set"),r=e("./generic-collection"),i=e("./generic-map"),o=e("./listen/property-changes");n.exports=a,Object.addEach(a.prototype,r.prototype),Object.addEach(a.prototype,i.prototype),Object.addEach(a.prototype,o.prototype),a.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},a.prototype.log=function(e,t,n,a){t=t||this.logNode,this.store.log(e,function(e,n,a){t(e.value.value,n,a)},n,a)},a.prototype.logNode=function(e,t){t(" key: "+e.key),t(" value: "+e.value)}}}),montageDefine("febb707","shim-array",{dependencies:["./shim-function","./generic-collection","./generic-order","./weak-map"],factory:function(e,t,n){"use strict";function a(e,t){Object.defineProperty(Array.prototype,e,{value:t,writable:!0,configurable:!0,enumerable:!1})}function s(e,t,n){this.array=e,this.start=null==t?0:t,this.end=n}e("./shim-function");var r=e("./generic-collection"),i=e("./generic-order"),o=e("./weak-map");n.exports=Array,Array.empty=[],Object.freeze&&Object.freeze(Array.empty),Array.from=function(e){var t=[];return t.addEach(e),t},Array.unzip=function(e){for(var t=[],n=1/0,a=0;e.length>a;a++){var s=e[a];e[a]=s.toArray(),n>s.length&&(n=s.length)}for(var a=0;e.length>a;a++)for(var s=e[a],r=0;s.length>r;r++)n>r&&r in s&&(t[r]=t[r]||[],t[r][a]=s[r]);return t},a("addEach",r.prototype.addEach),a("deleteEach",r.prototype.deleteEach),a("toArray",r.prototype.toArray),a("toObject",r.prototype.toObject),a("all",r.prototype.all),a("any",r.prototype.any),a("min",r.prototype.min),a("max",r.prototype.max),a("sum",r.prototype.sum),a("average",r.prototype.average),a("only",r.prototype.only),a("flatten",r.prototype.flatten),a("zip",r.prototype.zip),a("enumerate",r.prototype.enumerate),a("group",r.prototype.group),a("sorted",r.prototype.sorted),a("reversed",r.prototype.reversed),a("constructClone",function(e){var t=new this.constructor;return t.addEach(e),t}),a("has",function(e,t){return-1!==this.find(e,t)}),a("get",function(e,t){if(+e!==e)throw Error("Indicies must be numbers");return!e in this?t:this[e]}),a("set",function(e,t){return this.splice(e,1,t),!0}),a("add",function(e){return this.push(e),!0}),a("delete",function(e,t){var n=this.find(e,t);return-1!==n?(this.splice(n,1),!0):!1}),a("find",function(e,t){t=t||this.contentEquals||Object.equals;for(var n=0;this.length>n;n++)if(n in this&&t(this[n],e))return n;return-1}),a("findLast",function(e,t){t=t||this.contentEquals||Object.equals;var n=this.length;do if(n--,n in this&&t(this[n],e))return n;while(n>0);return-1}),a("swap",function(e,t,n){var a=Array.prototype.slice.call(arguments,0,2);return n&&a.push.apply(a,n),this.splice.apply(this,a)}),a("one",function(){for(var e in this)if(Object.owns(this,e))return this[e]}),a("clear",function(){return this.length=0,this}),a("compare",function(e,t){t=t||Object.compare;var n,a,s,r,o;if(this===e)return 0;if(!e||!Array.isArray(e))return i.prototype.compare.call(this,e,t);for(a=Math.min(this.length,e.length),n=0;a>n;n++)if(n in this){if(!(n in e))return-1;if(s=this[n],r=e[n],o=t(s,r))return o}else if(n in e)return 1;return this.length-e.length}),a("equals",function(e,t){t=t||Object.equals;var n,a,s=0,r=this.length;if(this===e)return!0;if(!e||!Array.isArray(e))return i.prototype.equals.call(this,e);if(r!==e.length)return!1;for(;r>s;++s)if(s in this){if(n=this[s],a=e[s],n!==a&&n&&a&&!t(n,a))return!1}else if(s in e)return!1;return!0}),a("clone",function(e,t){if(void 0===e)e=1/0;else if(0===e)return this;t=t||new o;var n=[];for(var a in this)Object.owns(this,a)&&(n[a]=Object.clone(this[a],e-1,t));return n}),a("iterate",function(e,t){return new s(this,e,t)}),a("Iterator",s),s.prototype.next=function(){if(this.start===(null==this.end?this.array.length:this.end))throw StopIteration;return this.array[this.start++]}}}),montageDefine("febb707","shim-object",{dependencies:["./weak-map"],factory:function(e,t,n){"use strict";var a=e("./weak-map");n.exports=Object,Object.empty=Object.freeze(Object.create(null)),Object.isObject=function(e){return Object(e)===e},Object.getValueOf=function(e){return Object.can(e,"valueOf")&&(e=e.valueOf()),e};var s=new a;Object.hash=function(e){return Object.can(e,"hash")?""+e.hash():Object(e)===e?(s.has(e)||s.set(e,Math.random().toString(36).slice(2)),s.get(e)):""+e};var r=Object.prototype.hasOwnProperty;Object.owns=function(e,t){return r.call(e,t)},Object.can=function(e,t){return null!=e&&"function"==typeof e[t]&&!r.call(e,t)},Object.has=function(e,t){if("object"!=typeof e)throw Error("Object.has can't accept non-object: "+typeof e);if(Object.can(e,"has"))return e.has(t);if("string"==typeof t)return t in e&&e[t]!==Object.prototype[t];throw Error("Key must be a string for Object.has on plain objects")},Object.get=function(e,t,n){if("object"!=typeof e)throw Error("Object.get can't accept non-object: "+typeof e);return Object.can(e,"get")?e.get(t,n):Object.has(e,t)?e[t]:n},Object.set=function(e,t,n){Object.can(e,"set")?e.set(t,n):e[t]=n},Object.addEach=function(e,t){return Object.can(t,"forEach")?"function"==typeof t.keys?t.forEach(function(t,n){e[n]=t}):t.forEach(function(t){e[t[0]]=t[1]}):Object.keys(t).forEach(function(n){e[n]=t[n]}),e},Object.forEach=function(e,t,n){Object.keys(e).forEach(function(a){t.call(n,e[a],a,e)})},Object.map=function(e,t,n){return Object.keys(e).map(function(a){return t.call(n,e[a],a,e)})},Object.values=function(e){return Object.map(e,Function.identity)},Object.concat=function(){for(var e={},t=0;arguments.length>t;t++)Object.addEach(e,arguments[t]);return e},Object.from=Object.concat,Object.is=function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t},Object.equals=function(e,t,n){if(n=n||Object.equals,e=Object.getValueOf(e),t=Object.getValueOf(t),e===t)return 0!==e||1/e===1/t;if(null===e||null===t)return e===t;if(Object.can(e,"equals"))return e.equals(t,n);if(Object.can(t,"equals"))return t.equals(e,n);if("object"==typeof e&&"object"==typeof t){var a=Object.getPrototypeOf(e),s=Object.getPrototypeOf(t);if(a===s&&(a===Object.prototype||null===a)){for(var r in e)if(!n(e[r],t[r]))return!1;for(var r in t)if(!n(e[r],t[r]))return!1;return!0}}return e!==e&&t!==t},Object.compare=function(e,t){e=Object.getValueOf(e),t=Object.getValueOf(t);var n=typeof e,a=typeof t;return e===t?0:n!==a?0:"number"===n?e-t:"string"===n?t>e?-1:1:Object.can(e,"compare")?e.compare(t):Object.can(t,"compare")?-t.compare(e):0},Object.clone=function(e,t,n){if(e=Object.getValueOf(e),n=n||new a,void 0===t)t=1/0;else if(0===t)return e;if(Object.isObject(e)){if(!n.has(e))if(Object.can(e,"clone"))n.set(e,e.clone(t,n));else{var s=Object.getPrototypeOf(e);if(null!==s&&s!==Object.prototype)throw Error("Can't clone "+e);var r=Object.create(s);n.set(e,r);for(var i in e)r[i]=Object.clone(e[i],t-1,n)}return n.get(e)}return e},Object.clear=function(e){if(Object.can(e,"clear"))e.clear();else for(var t=Object.keys(e),n=t.length;n;)n--,delete e[t[n]];return e}}}),montageDefine("febb707","shim-function",{dependencies:[],factory:function(e,t,n){n.exports=Function,Function.noop=function(){},Function.identity=function(e){return e},Function.by=function(e,t){t=t||Object.compare,e=e||Function.identity;var n=function(n,a){return t(e(n),e(a))};return n.compare=t,n.by=e,n},Function.get=function(e){return function(t){return Object.get(t,e)}}}}),montageDefine("febb707","shim-regexp",{dependencies:[],factory:function(){if(!RegExp.escape){var e=/[-[\]{}()*+?.\\^$|,#\s]/g;RegExp.escape=function(t){return t.replace(e,"\\$&")}}}}),montageDefine("febb707","set",{dependencies:["./shim","./list","./fast-set","./generic-collection","./generic-set","./listen/property-changes","./listen/range-changes"],factory:function(e,t,n){"use strict";function a(e,t,n,s){return this instanceof a?(t=t||Object.equals,n=n||Object.hash,s=s||Function.noop,this.contentEquals=t,this.contentHash=n,this.getDefault=s,this.order=new this.Order(void 0,t),this.store=new this.Store(void 0,function(e,n){return t(e.value,n.value)},function(e){return n(e.value)}),this.length=0,this.addEach(e),void 0):new a(e,t,n,s)}e("./shim");var s=e("./list"),r=e("./fast-set"),i=e("./generic-collection"),o=e("./generic-set"),l=e("./listen/property-changes"),c=e("./listen/range-changes");n.exports=a,Object.addEach(a.prototype,i.prototype),Object.addEach(a.prototype,o.prototype),Object.addEach(a.prototype,l.prototype),Object.addEach(a.prototype,c.prototype),a.prototype.Order=s,a.prototype.Store=r,a.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},a.prototype.has=function(e){var t=new this.order.Node(e);return this.store.has(t)},a.prototype.get=function(e){var t=new this.order.Node(e);
return t=this.store.get(t),t?t.value:this.getDefault(e)},a.prototype.add=function(e){var t=new this.order.Node(e);return this.store.has(t)?!1:(this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],0),this.order.add(e),t=this.order.head.prev,this.store.add(t),this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],0),!0)},a.prototype["delete"]=function(e){var t=new this.order.Node(e);if(this.store.has(t)){this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],0);var t=this.store.get(t);return this.store["delete"](t),t["delete"](),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],0),!0}return!1},a.prototype.pop=function(){if(this.length){var e=this.order.head.prev.value;return this["delete"](e),e}},a.prototype.shift=function(){if(this.length){var e=this.order.head.next.value;return this["delete"](e),e}},a.prototype.one=function(){return this.length>0?this.store.one().value:void 0},a.prototype.clear=function(){this.store.clear(),this.order.clear(),this.length=0},a.prototype.reduce=function(e,t){var n=arguments[2],a=this.order,s=0;return a.reduce(function(t,a){return e.call(n,t,a,s++,this)},t,this)},a.prototype.reduceRight=function(e,t){var n=arguments[2],a=this.order,s=this.length-1;return a.reduceRight(function(t,a){return e.call(n,t,a,s--,this)},t,this)},a.prototype.iterate=function(){return this.order.iterate()},a.prototype.log=function(){var e=this.store;return e.log.apply(e,arguments)}}}),montageDefine("febb707","generic-collection",{dependencies:["./shim-array"],factory:function(e,t,n){"use strict";function a(){throw Error("Can't construct. GenericCollection is a mixin.")}n.exports=a,a.prototype.addEach=function(e){if(e&&Object(e)===e)if("function"==typeof e.forEach)e.forEach(this.add,this);else if("number"==typeof e.length)for(var t=0;e.length>t;t++)this.add(e[t],t);else Object.keys(e).forEach(function(t){this.add(e[t],t)},this);return this},a.prototype.deleteEach=function(e,t){return e.forEach(function(e){this["delete"](e,t)},this),this},a.prototype.forEach=function(e){var t=arguments[1];return this.reduce(function(n,a,s,r,i){e.call(t,a,s,r,i)},void 0)},a.prototype.map=function(e){var t=arguments[1],n=[];return this.reduce(function(a,s,r,i,o){n.push(e.call(t,s,r,i,o))},void 0),n},a.prototype.enumerate=function(e){null==e&&(e=0);var t=[];return this.reduce(function(n,a){t.push([e++,a])},void 0),t},a.prototype.group=function(e,t,n){n=n||Object.equals;var a=[],s=[];return this.forEach(function(r,i,o){var l,i=e.call(t,r,i,o),c=s.indexOf(i,n);-1===c?(l=[],a.push([i,l]),s.push(i)):l=a[c][1],l.push(r)}),a},a.prototype.toArray=function(){return this.map(Function.identity)},a.prototype.toObject=function(){var e={};return this.reduce(function(t,n,a){e[a]=n},void 0),e},a.prototype.filter=function(e){var t=arguments[1],n=this.constructClone();return this.reduce(function(a,s,r,i,o){e.call(t,s,r,i,o)&&n.add(s)},void 0),n},a.prototype.every=function(e){var t=arguments[1];return this.reduce(function(n,a,s,r,i){return n&&e.call(t,a,s,r,i)},!0)},a.prototype.some=function(e){var t=arguments[1];return this.reduce(function(n,a,s,r,i){return n||e.call(t,a,s,r,i)},!1)},a.prototype.all=function(){return this.every(Boolean)},a.prototype.any=function(){return this.some(Boolean)},a.prototype.min=function(e){e=e||this.contentCompare||Object.compare;var t=!0;return this.reduce(function(n,a){return t?(t=!1,a):0>e(a,n)?a:n},void 0)},a.prototype.max=function(e){e=e||this.contentCompare||Object.compare;var t=!0;return this.reduce(function(n,a){return t?(t=!1,a):e(a,n)>0?a:n},void 0)},a.prototype.sum=function(e){return e=void 0===e?0:e,this.reduce(function(e,t){return e+t},e)},a.prototype.average=function(e){var t=void 0===e?0:e,n=void 0===e?0:e;return this.reduce(function(e,a){t+=a,n+=1},void 0),t/n},a.prototype.concat=function(){for(var e=this.constructClone(this),t=0;arguments.length>t;t++)e.addEach(arguments[t]);return e},a.prototype.flatten=function(){var e=this;return this.reduce(function(t,n){return n.forEach(function(e){this.push(e)},t,e),t},[])},a.prototype.zip=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),Array.unzip(e)},a.prototype.sorted=function(e,t,n){return e=e||this.contentCompare||Object.compare,e.by?(t=e.by,e=e.compare||this.contentCompare||Object.compare):t=t||Function.identity,void 0===n&&(n=1),this.map(function(e){return{by:t(e),value:e}}).sort(function(t,a){return e(t.by,a.by)*n}).map(function(e){return e.value})},a.prototype.reversed=function(){return this.constructClone(this).reverse()},a.prototype.clone=function(e,t){if(void 0===e)e=1/0;else if(0===e)return this;var n=this.constructClone();return this.forEach(function(a,s){n.add(Object.clone(a,e-1,t),s)},this),n},a.prototype.only=function(){return 1===this.length?this.one():void 0},a.prototype.iterator=function(){return this.iterate.apply(this,arguments)},e("./shim-array")}}),montageDefine("febb707","generic-map",{dependencies:["./shim-object","./listen/map-changes","./listen/property-changes"],factory:function(e,t,n){"use strict";function a(){throw Error("Can't construct. GenericMap is a mixin.")}function s(e,t){this.key=e,this.value=t}var r=e("./shim-object"),i=e("./listen/map-changes"),o=e("./listen/property-changes");n.exports=a,r.addEach(a.prototype,i.prototype),r.addEach(a.prototype,o.prototype),a.prototype.addEach=function(e){return e&&r(e)===e&&("function"==typeof e.forEach?"function"==typeof e.keys?e.forEach(function(e,t){this.set(t,e)},this):e.forEach(function(e){this.set(e[0],e[1])},this):r.keys(e).forEach(function(t){this.set(t,e[t])},this)),this},a.prototype.get=function(e,t){var n=this.store.get(new this.Item(e));return n?n.value:arguments.length>1?t:this.getDefault(e)},a.prototype.set=function(e,t){var n=new this.Item(e,t),a=this.store.get(n),s=!1;return a?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,a.value),a.value=t,this.dispatchesMapChanges&&this.dispatchMapChange(e,t)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,void 0),this.store.add(n)&&(this.length++,s=!0),this.dispatchesMapChanges&&this.dispatchMapChange(e,t)),s},a.prototype.add=function(e,t){return this.set(t,e)},a.prototype.has=function(e){return this.store.has(new this.Item(e))},a.prototype["delete"]=function(e){var t=new this.Item(e);if(this.store.has(t)){var n=this.store.get(t).value;return this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,n),this.store["delete"](t),this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0),!0}return!1},a.prototype.clear=function(){this.dispatchesMapChanges&&this.forEach(function(e,t){this.dispatchBeforeMapChange(t,e)},this),this.store.clear(),this.length=0,this.dispatchesMapChanges&&this.forEach(function(e,t){this.dispatchMapChange(t,e)},this)},a.prototype.reduce=function(e,t,n){return this.store.reduce(function(t,a){return e.call(n,t,a.value,a.key,this)},t,this)},a.prototype.reduceRight=function(e,t,n){return this.store.reduceRight(function(t,a){return e.call(n,t,a.value,a.key,this)},t,this)},a.prototype.keys=function(){return this.map(function(e,t){return t})},a.prototype.values=function(){return this.map(Function.identity)},a.prototype.items=function(){return this.map(function(e,t){return[t,e]})},a.prototype.equals=function(e,t){if(t=t||r.equals,this===e)return!0;if(r.can(e,"every"))return e.length===this.length&&e.every(function(e,n){return t(this.get(n),e)},this);var n=r.keys(e);return n.length===this.length&&r.keys(e).every(function(n){return t(this.get(n),e[n])},this)},a.prototype.Item=s,s.prototype.equals=function(e){return r.equals(this.key,e.key)&&r.equals(this.value,e.value)},s.prototype.compare=function(e){return r.compare(this.key,e.key)}}}),montageDefine("febb707","generic-order",{dependencies:["./shim-object"],factory:function(e,t,n){function a(){throw Error("Can't construct. GenericOrder is a mixin.")}var s=e("./shim-object");n.exports=a,a.prototype.equals=function(e,t){return t=t||this.contentEquals||s.equals,this===e?!0:e?this.length===e.length&&this.zip(e).every(function(e){return t(e[0],e[1])}):!1},a.prototype.compare=function(e,t){if(t=t||this.contentCompare||s.compare,this===e)return 0;if(!e)return 1;var n=Math.min(this.length,e.length),a=this.zip(e).reduce(function(e,a,s){return 0===e?s>=n?e:t(a[0],a[1]):e},0);return 0===a?this.length-e.length:a}}}),montageDefine("febb707","listen/array-changes",{dependencies:["../shim","../list","../weak-map","./property-changes","./range-changes","./map-changes"],factory:function(e){function t(e){for(var t in e)Object.defineProperty(Array.prototype,t,{value:e[t],writable:!0,configurable:!0,enumerable:!1})}e("../shim"),e("../list"),e("../weak-map");var n,a=e("./property-changes"),s=e("./range-changes"),r=e("./map-changes"),i=Array.prototype.splice,o=Array.prototype.slice,l=Array.prototype.reverse,c=Array.prototype.sort,p={}.__proto__===Object.prototype;n=p?function(){this.__proto__=h}:function(){Object.defineProperties(this,u)},Object.defineProperty(Array.prototype,"makeObservable",{value:n,writable:!0,configurable:!0,enumerable:!1}),t(a.prototype),t(s.prototype),t(r.prototype);var u={isObservable:{value:!0,writable:!0,configurable:!0},makeObservable:{value:Function.noop,writable:!0,configurable:!0},reverse:{value:function(){this.dispatchBeforeRangeChange(this,this,0);for(var e=0;this.length>e;e++)a.dispatchBeforeOwnPropertyChange(this,e,this[e]),this.dispatchBeforeMapChange(e,this[e]);l.call(this);for(var e=0;this.length>e;e++)a.dispatchOwnPropertyChange(this,e,this[e]),this.dispatchMapChange(e,this[e]);return this.dispatchRangeChange(this,this,0),this},writable:!0,configurable:!0},sort:{value:function(){this.dispatchBeforeRangeChange(this,this,0);for(var e=0;this.length>e;e++)a.dispatchBeforeOwnPropertyChange(this,e,this[e]),this.dispatchBeforeMapChange(e,this[e]);c.apply(this,arguments);for(var e=0;this.length>e;e++)a.dispatchOwnPropertyChange(this,e,this[e]),this.dispatchMapChange(e,this[e]);return this.dispatchRangeChange(this,this,0),this},writable:!0,configurable:!0},splice:{value:function(e,t){var n=o.call(this,e,e+t),s=o.call(arguments,2);if(!n.length&&!s.length)return s;var r=s.length-n.length,l=this.length,c=Math.max(this.length+r,e+s.length),p=Math.max(l,c);if(r&&a.dispatchBeforeOwnPropertyChange(this,"length",this.length),this.dispatchBeforeRangeChange(s,n,e),0===r)for(var u=e;e+s.length>u;u++)a.dispatchBeforeOwnPropertyChange(this,u,this[u]),this.dispatchBeforeMapChange(u,this[u]);else if(a.hasOwnPropertyChangeDescriptor(this))for(var u=e;p>u;u++)a.dispatchBeforeOwnPropertyChange(this,u,this[u]),this.dispatchBeforeMapChange(u,this[u]);e>l&&(this.length=e);var h=i.apply(this,arguments);if(0===r)for(var u=e;e+s.length>u;u++)a.dispatchOwnPropertyChange(this,u,this[u]),this.dispatchMapChange(u,this[u]);else if(a.hasOwnPropertyChangeDescriptor(this))for(var u=e;p>u;u++)a.dispatchOwnPropertyChange(this,u,this[u]),this.dispatchMapChange(u,this[u]);return this.dispatchRangeChange(s,n,e),r&&a.dispatchOwnPropertyChange(this,"length",this.length),h},writable:!0,configurable:!0},set:{value:function(e,t){return this.splice(e,1,t),this},writable:!0,configurable:!0},shift:{value:function(){return this.splice(0,1)[0]},writable:!0,configurable:!0},pop:{value:function(){return this.length?this.splice(this.length-1,1)[0]:void 0},writable:!0,configurable:!0},push:{value:function(e){if(1===arguments.length)return this.splice(this.length,0,e);var t=o.call(arguments);return this.swap(this.length,0,t)},writable:!0,configurable:!0},unshift:{value:function(e){if(1===arguments.length)return this.splice(0,0,e);var t=o.call(arguments);return this.swap(0,0,t)},writable:!0,configurable:!0},clear:{value:function(){return this.splice(0,this.length)},writable:!0,configurable:!0}},h=Object.create(Array.prototype,u)}}),montageDefine("febb707","sorted-array",{dependencies:["./shim","./generic-collection","./listen/property-changes","./listen/range-changes"],factory:function(e,t,n){"use strict";function a(e,t,n,s){return this instanceof a?(Array.isArray(e)?(this.array=e,e=e.splice(0,e.length)):this.array=[],this.contentEquals=t||Object.equals,this.contentCompare=n||Object.compare,this.getDefault=s||Function.noop,this.length=0,this.addEach(e),void 0):new a(e,t,n,s)}function s(e,t,n){for(var a=0,s=e.length-1;s>=a;){var r=a+s>>1,i=n(t,e[r]);if(i>0)a=r+1;else{if(!(0>i))return r;s=r-1}}return-(a+1)}function r(e,t,n,a){var r=s(e,t,n);if(0>r)return-1;for(;r>0&&a(t,e[r-1]);)r--;return a(t,e[r])?r:-1}function i(e,t,n,a){var r=s(e,t,n);if(0>r)return-1;for(;e.length-1>r&&a(t,e[r+1]);)r++;return a(t,e[r])?r:-1}function o(e,t,n){var a=s(e,t,n);if(0>a)return-a-1;for(var r=e.length-1;r>a&&0===n(t,e[a+1]);)a++;return a}n.exports=a,e("./shim");var l=e("./generic-collection"),c=e("./listen/property-changes"),p=e("./listen/range-changes");Object.addEach(a.prototype,l.prototype),Object.addEach(a.prototype,c.prototype),Object.addEach(a.prototype,p.prototype),a.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentCompare,this.getDefault)},a.prototype.has=function(e){var t=s(this.array,e,this.contentCompare);return t>=0&&this.contentEquals(this.array[t],e)},a.prototype.get=function(e){var t=r(this.array,e,this.contentCompare,this.contentEquals);return-1!==t?this.array[t]:this.getDefault(e)},a.prototype.add=function(e){var t=o(this.array,e,this.contentCompare);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],t),this.array.splice(t,0,e),this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],t),!0},a.prototype["delete"]=function(e){var t=r(this.array,e,this.contentCompare,this.contentEquals);return-1!==t?(this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],t),this.array.splice(t,1),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],t),!0):!1},a.prototype.indexOf=function(e){return r(this.array,e,this.contentCompare,this.contentEquals)},a.prototype.lastIndexOf=function(e){return i(this.array,e,this.contentCompare,this.contentEquals)},a.prototype.find=function(e){return r(this.array,e,this.contentCompare,this.contentEquals)},a.prototype.findLast=function(e){return i(this.array,e,this.contentCompare,this.contentEquals)},a.prototype.push=function(){this.addEach(arguments)},a.prototype.unshift=function(){this.addEach(arguments)},a.prototype.pop=function(){return this.array.pop()},a.prototype.shift=function(){return this.array.shift()},a.prototype.slice=function(){return this.array.slice.apply(this.array,arguments)},a.prototype.splice=function(e,t){return this.swap(e,t,Array.prototype.slice.call(arguments,2))},a.prototype.swap=function(e,t,n){if(void 0===e&&void 0===t)return[];e=e||0,0>e&&(e+=this.length),void 0===t&&(t=1/0);var a=this.slice(e,e+t);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange(n,a,e),this.array.splice(e,t),this.addEach(n),this.dispatchesRangeChanges&&this.dispatchRangeChange(n,a,e),a},a.prototype.reduce=function(e,t){var n=arguments[2];return this.array.reduce(function(t,a,s){return e.call(n,t,a,s,this)},t,this)},a.prototype.reduceRight=function(){var e=arguments[2];return this.array.reduceRight(function(t,n,a){return callback.call(e,t,n,a,this)},basis,this)},a.prototype.min=function(){return this.length?this.array[0]:void 0},a.prototype.max=function(){return this.length?this.array[this.length-1]:void 0},a.prototype.one=function(){return this.array.one()},a.prototype.clear=function(){var e;this.dispatchesRangeChanges&&(e=this.array.slice(),this.dispatchBeforeRangeChange([],e,0)),this.length=0,this.array.clear(),this.dispatchesRangeChanges&&this.dispatchRangeChange([],e,0)},a.prototype.equals=function(e,t){return this.array.equals(e,t)},a.prototype.compare=function(e,t){return this.array.compare(e,t)},a.prototype.iterate=function(e,t){return new this.Iterator(this.array,e,t)},a.prototype.Iterator=Array.prototype.Iterator}}),montageDefine("febb707","heap",{dependencies:["./listen/array-changes","./shim","./generic-collection","./listen/map-changes","./listen/range-changes","./listen/property-changes"],factory:function(e,t,n){function a(e,t,n){return this instanceof a?(this.contentEquals=t||Object.equals,this.contentCompare=n||Object.compare,this.content=[],this.length=0,this.addEach(e),void 0):new a(e,t,n)}e("./listen/array-changes"),e("./shim");var s=e("./generic-collection"),r=e("./listen/map-changes"),i=e("./listen/range-changes"),o=e("./listen/property-changes");n.exports=a,Object.addEach(a.prototype,s.prototype),Object.addEach(a.prototype,o.prototype),Object.addEach(a.prototype,i.prototype),Object.addEach(a.prototype,r.prototype),a.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentCompare)},a.prototype.push=function(e){this.content.push(e),this.float(this.content.length-1),this.length++},a.prototype.pop=function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content.set(0,t),this.sink(0)),this.length--,e},a.prototype.add=function(e){this.push(e)},a.prototype.indexOf=function(e){for(var t=0;this.length>t;t++)if(this.contentEquals(this.content[t],e))return t;return-1},a.prototype.delete=function(e){var t=this.indexOf(e);if(-1===t)return!1;var n=this.content.pop();if(t===this.content.length)return!0;this.content.set(t,n);var a=this.contentCompare(n,e);return a>0?this.float(t):0>a&&this.sink(t),this.length--,!0},a.prototype.peek=function(){return this.length?this.content[0]:void 0},a.prototype.max=function(){return this.peek()},a.prototype.one=function(){return this.peek()},a.prototype.float=function(e){for(var t=this.content[e];e>0;){var n=Math.floor((e+1)/2)-1,a=this.content[n];if(!(0>this.contentCompare(a,t)))break;this.content.set(n,t),this.content.set(e,a),e=n}},a.prototype.sink=function(e){for(var t,n,a,s,r,i,o=this.content.length,l=this.content[e];;){if(s=2*(e+1),a=s-1,i=!1,o>a){var t=this.content[a],c=this.contentCompare(t,l);c>0&&(r=a,i=!0)}if(o>s){var n=this.content[s],c=this.contentCompare(n,i?t:l);c>0&&(r=s,i=!0)}if(!i)break;this.content.set(e,this.content[r]),this.content.set(r,l),e=r}},a.prototype.clear=function(){this.content.clear(),this.length=0},a.prototype.reduce=function(e,t){var n=arguments[2];return this.content.reduce(function(t,a,s){return e.call(n,t,a,s,this)},t,this)},a.prototype.reduceRight=function(){var e=arguments[2];return this.content.reduceRight(function(t,n,a){return callback.call(e,t,n,a,this)},basis,this)},a.prototype.makeObservable=function(){this.content.addRangeChangeListener(this,"content"),this.content.addBeforeRangeChangeListener(this,"content"),this.content.addMapChangeListener(this,"content"),this.content.addBeforeMapChangeListener(this,"content")},a.prototype.handleContentRangeChange=function(e,t,n){this.dispatchRangeChange(e,t,n)},a.prototype.handleContentRangeWillChange=function(e,t,n){this.dispatchBeforeRangeChange(e,t,n)},a.prototype.handleContentMapChange=function(e,t){this.dispatchMapChange(t,e)},a.prototype.handleContentMapWillChange=function(e,t){this.dispatchBeforeMapChange(t,e)}}}),montageDefine("febb707","list",{dependencies:["./shim","./generic-collection","./generic-order","./listen/property-changes"],factory:function(e,t,n){"use strict";function a(e,t,n){if(!(this instanceof a))return new a(e,t,n);var s=this.head=new this.Node;s.next=s,s.prev=s,this.contentEquals=t||Object.equals,this.getDefault=n||Function.noop,this.length=0,this.addEach(e)}function s(e){this.head=e,this.at=e.next}function r(e){this.value=e,this.prev=null,this.next=null}n.exports=a,e("./shim");var i=e("./generic-collection"),o=e("./generic-order"),l=e("./listen/property-changes");Object.addEach(a.prototype,i.prototype),Object.addEach(a.prototype,o.prototype),Object.addEach(a.prototype,l.prototype),a.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.getDefault)},a.prototype.find=function(e,t){t=t||this.contentEquals;for(var n=this.head,a=n.next;a!==n;){if(t(a.value,e))return a;a=a.next}},a.prototype.findLast=function(e,t){t=t||this.contentEquals;for(var n=this.head,a=n.prev;a!==n;){if(t(a.value,e))return a;a=a.prev}},a.prototype.has=function(e,t){return!!this.find(e,t)},a.prototype.get=function(e,t){var n=this.find(e,t);return n?n.value:this.getDefault(e)},a.prototype["delete"]=function(e,t){var n=this.findLast(e,t);return n?(n["delete"](),this.length--,!0):!1},a.prototype.clear=function(){this.head.next=this.head.prev=this.head,this.length=0},a.prototype.add=function(e){return this.head.addBefore(new this.Node(e)),this.length++,!0},a.prototype.push=function(){for(var e=this.head,t=0;arguments.length>t;t++){var n=arguments[t],a=new this.Node(n);e.addBefore(a),this.length++}},a.prototype.unshift=function(){for(var e=this.head,t=0;arguments.length>t;t++){var n=arguments[t],a=new this.Node(n);e.addAfter(a),this.length++,e=a}},a.prototype.pop=function(){var e,t=this.head;return t.prev!==t&&(e=t.prev.value,t.prev["delete"](),this.length--),e},a.prototype.shift=function(){var e,t=this.head;return t.prev!==t&&(e=t.next.value,t.next["delete"](),this.length--),e},a.prototype.peek=function(){return this.head!==this.head.next?this.head.next.value:void 0},a.prototype.poke=function(e){this.head!==this.head.next?this.head.next.value=e:this.push(e)},a.prototype.one=function(){return this.peek()},a.prototype.scan=function(e,t){var n=this.head;if("number"==typeof e){var a=e;if(a>=0)for(e=n.next;a&&(a--,e=e.next,e!=n););else for(e=n;0>a&&(a++,e=e.prev,e!=n););return e}return e||t},a.prototype.slice=function(e,t){var n=[],a=this.head;for(e=this.scan(e,a.next),t=this.scan(t,a);e!==t&&e!==a;)n.push(e.value),e=e.next;return n},a.prototype.splice=function(e,t){return this.swap(e,t,Array.prototype.slice.call(arguments,2))},a.prototype.swap=function(e,t,n){var a=[],s=e;for(e=this.scan(e,this.head),void 0===t&&(t=1/0);t--&&t>=0&&e!==this.head;)a.push(e.value),e["delete"](),e=e.next,this.length--;if(n){null===s&&e===this.head&&(e=this.head.next);for(var r=0;n.length>r;r++){var i=new this.Node(n[r]);e.addBefore(i)}this.length+=n.length}return a},a.prototype.reverse=function(){var e=this.head;do{var t=e.next;e.next=e.prev,e.prev=t,e=e.next}while(e!==this.head);return this},a.prototype.reduce=function(e,t){for(var n=arguments[2],a=this.head,s=a.next;s!==a;)t=e.call(n,t,s.value,s,this),s=s.next;return t},a.prototype.reduceRight=function(e,t){for(var n=arguments[2],a=this.head,s=a.prev;s!==a;)t=e.call(n,t,s.value,s,this),s=s.prev;return t},a.prototype.iterate=function(){return new s(this.head)},s.prototype.next=function(){if(this.at===this.head)throw StopIteration;var e=this.at.value;return this.at=this.at.next,e},a.prototype.Node=r,r.prototype["delete"]=function(){this.prev.next=this.next,this.next.prev=this.prev},r.prototype.addBefore=function(e){var t=this.prev;this.prev=e,e.prev=t,t.next=e,e.next=this},r.prototype.addAfter=function(e){var t=this.next;this.next=e,e.next=t,t.prev=e,e.prev=this}}}),montageDefine("febb707","fast-set",{dependencies:["./shim","./dict","./list","./generic-collection","./generic-set","./tree-log","./listen/property-changes"],factory:function(e,t,n){"use strict";function a(e,t,n,s){return this instanceof a?(t=t||Object.equals,n=n||Object.hash,s=s||Function.noop,this.contentEquals=t,this.contentHash=n,this.getDefault=s,this.buckets=new this.Buckets(null,this.Bucket),this.length=0,this.addEach(e),void 0):new a(e,t,n,s)}e("./shim");var s=e("./dict"),r=e("./list"),i=e("./generic-collection"),o=e("./generic-set"),l=e("./tree-log"),c=e("./listen/property-changes");Object.prototype.hasOwnProperty,n.exports=a,Object.addEach(a.prototype,i.prototype),Object.addEach(a.prototype,o.prototype),Object.addEach(a.prototype,c.prototype),a.prototype.Buckets=s,a.prototype.Bucket=r,a.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},a.prototype.has=function(e){var t=this.contentHash(e);return this.buckets.get(t).has(e)},a.prototype.get=function(e){var t=this.contentHash(e),n=this.buckets;return n.has(t)?n.get(t).get(e):this.getDefault(e)},a.prototype["delete"]=function(e){var t=this.contentHash(e),n=this.buckets;if(n.has(t)){var a=n.get(t);if(a["delete"](e))return this.length--,0===a.length&&n["delete"](t),!0}return!1},a.prototype.clear=function(){this.buckets.clear(),this.length=0},a.prototype.add=function(e){var t=this.contentHash(e),n=this.buckets;return n.has(t)||n.set(t,new this.Bucket(null,this.contentEquals)),n.get(t).has(e)?!1:(n.get(t).add(e),this.length++,!0)},a.prototype.reduce=function(e,t){var n=arguments[2],a=this.buckets,s=0;return a.reduce(function(t,a){return a.reduce(function(t,a){return e.call(n,t,a,s++,this)},t,this)},t,this)},a.prototype.one=function(){return this.length>0?this.buckets.one().one():void 0},a.prototype.iterate=function(){return this.buckets.values().flatten().iterate()},a.prototype.log=function(e,t,n,a){e=e||l.unicodeSharp,t=t||this.logNode,n||(n=console.log,a=console),n=n.bind(a);var s=this.buckets,r=s.keys();r.forEach(function(i,o){var l,c;o===r.length-1?(l=e.fromAbove,c=" "):0===o?(l=e.branchDown,c=e.strafe):(l=e.fromBoth,c=e.strafe);var p=s.get(i);n.call(a,l+e.through+e.branchDown+" "+i),p.forEach(function(s,r){var i,o;r===p.head.prev?(i=e.fromAbove,o=" "):(i=e.fromBoth,o=e.strafe);var l;t(r,function(t){l?n.call(a,c+" "+o+"  "+t):(n.call(a,c+" "+i+e.through+e.through+t),l=!0)},function(t){n.call(a,c+" "+e.strafe+"  "+t)})})})},a.prototype.logNode=function(e,t){var n=e.value;Object(n)===n?JSON.stringify(n,null,4).split("\n").forEach(function(e){t(" "+e)}):t(" "+n)}}}),montageDefine("febb707","generic-set",{dependencies:[],factory:function(e,t,n){function a(){throw Error("Can't construct. GenericSet is a mixin.")}n.exports=a,a.prototype.union=function(e){var t=this.constructClone(this);return t.addEach(e),t},a.prototype.intersection=function(e){return this.constructClone(this.filter(function(t){return e.has(t)}))},a.prototype.difference=function(e){var t=this.constructClone(this);return t.deleteEach(e),t},a.prototype.symmetricDifference=function(e){var t=this.union(e),n=this.intersection(e);return t.difference(n)},a.prototype.equals=function(e,t){var n=this;return Object.can(e,"reduce")&&this.length===e.length&&e.reduce(function(e,a){return e&&n.has(a,t)},!0)},a.prototype.contains=function(e){return this.has(e)},a.prototype.remove=function(e){return this["delete"](e)},a.prototype.toggle=function(e){this.has(e)?this["delete"](e):this.add(e)}}}),montageDefine("febb707","listen/range-changes",{dependencies:["../weak-map","../dict"],factory:function(e,t,n){"use strict";function a(){throw Error("Can't construct. RangeChanges is a mixin.")}var s=e("../weak-map"),r=e("../dict"),i=new s;n.exports=a,a.prototype.getAllRangeChangeDescriptors=function(){return i.has(this)||i.set(this,r()),i.get(this)},a.prototype.getRangeChangeDescriptor=function(e){var t=this.getAllRangeChangeDescriptors();return e=e||"",t.has(e)||t.set(e,{isActive:!1,changeListeners:[],willChangeListeners:[]}),t.get(e)},a.prototype.addRangeChangeListener=function(e,t,n){!this.isObservable&&this.makeObservable&&this.makeObservable();var a,s=this.getRangeChangeDescriptor(t);a=n?s.willChangeListeners:s.changeListeners,a.push(e),this.dispatchesRangeChanges=!0;var r=this;return function(){r&&(r.removeRangeChangeListener(e,t,n),r=null)}},a.prototype.removeRangeChangeListener=function(e,t,n){var a,s=this.getRangeChangeDescriptor(t);a=n?s.willChangeListeners:s.changeListeners;var r=a.lastIndexOf(e);if(-1===r)throw Error("Can't remove listener: does not exist.");a.splice(r,1)},a.prototype.dispatchRangeChange=function(e,t,n,a){var s=this.getAllRangeChangeDescriptors(),r="Range"+(a?"WillChange":"Change");s.forEach(function(s,i){if(!s.isActive){s.isActive=!0;var o;o=a?s.willChangeListeners:s.changeListeners;var l="handle"+(i.slice(0,1).toUpperCase()+i.slice(1))+r;try{o.forEach(function(s){if(s[l])s[l](e,t,n,this,a);else{if(!s.call)throw Error("Handler "+s+" has no method "+l+" and is not callable");s.call(this,e,t,n,this,a)}},this)}finally{s.isActive=!1}}},this)},a.prototype.addBeforeRangeChangeListener=function(e,t){return this.addRangeChangeListener(e,t,!0)},a.prototype.removeBeforeRangeChangeListener=function(e,t){return this.removeRangeChangeListener(e,t,!0)},a.prototype.dispatchBeforeRangeChange=function(e,t,n){return this.dispatchRangeChange(e,t,n,!0)}}}),montageDefine("febb707","listen/map-changes",{dependencies:["../weak-map","../list","../dict"],factory:function(e,t,n){"use strict";function a(){throw Error("Can't construct. MapChanges is a mixin.")}var s=e("../weak-map"),r=e("../list");n.exports=a,Object.prototype.hasOwnProperty;var i=new s;a.prototype.getAllMapChangeDescriptors=function(){var t=e("../dict");return i.has(this)||i.set(this,t()),i.get(this)},a.prototype.getMapChangeDescriptor=function(e){var t=this.getAllMapChangeDescriptors();return e=e||"",t.has(e)||t.set(e,{willChangeListeners:new r,changeListeners:new r}),t.get(e)},a.prototype.addMapChangeListener=function(e,t,n){!this.isObservable&&this.makeObservable&&this.makeObservable();var a,s=this.getMapChangeDescriptor(t);a=n?s.willChangeListeners:s.changeListeners,a.push(e),this.dispatchesMapChanges=!0;var r=this;return function(){r&&(r.removeMapChangeListener(e,t,n),r=null)}},a.prototype.removeMapChangeListener=function(e,t,n){var a,s=this.getMapChangeDescriptor(t);a=n?s.willChangeListeners:s.changeListeners;var r=a.findLast(e);if(!r)throw Error("Can't remove listener: does not exist.");r["delete"]()},a.prototype.dispatchMapChange=function(e,t,n){var a=this.getAllMapChangeDescriptors(),s="Map"+(n?"WillChange":"Change");a.forEach(function(a,r){if(!a.isActive){a.isActive=!0;var i;i=n?a.willChangeListeners:a.changeListeners;var o="handle"+(r.slice(0,1).toUpperCase()+r.slice(1))+s;try{i.forEach(function(n){if(n[o])n[o](t,e,this);else{if(!n.call)throw Error("Handler "+n+" has no method "+o+" and is not callable");n.call(n,t,e,this)}},this)}finally{a.isActive=!1}}},this)},a.prototype.addBeforeMapChangeListener=function(e,t){return this.addMapChangeListener(e,t,!0)},a.prototype.removeBeforeMapChangeListener=function(e,t){return this.removeMapChangeListener(e,t,!0)},a.prototype.dispatchBeforeMapChange=function(e,t){return this.dispatchMapChange(e,t,!0)}}}),montageDefine("febb707","dict",{dependencies:["./shim","./generic-collection","./generic-map","./listen/property-changes"],factory:function(e,t,n){"use strict";function a(e,t){return this instanceof a?(t=t||Function.noop,this.getDefault=t,this.store={},this.length=0,this.addEach(e),void 0):new a(e,t)}function s(e){return"~"+e}function r(e){return e.slice(1)}e("./shim");var i=e("./generic-collection"),o=e("./generic-map"),l=e("./listen/property-changes");n.exports=a,Object.addEach(a.prototype,i.prototype),Object.addEach(a.prototype,o.prototype),Object.addEach(a.prototype,l.prototype),a.prototype.constructClone=function(e){return new this.constructor(e,this.mangle,this.getDefault)},a.prototype.assertString=function(e){if("string"!=typeof e)throw new TypeError("key must be a string.")},a.prototype.get=function(e,t){this.assertString(e);var n=s(e);return n in this.store?this.store[n]:arguments.length>1?t:this.getDefault(e)},a.prototype.set=function(e,t){this.assertString(e);var n=s(e);return n in this.store?(this.dispatchesBeforeMapChanges&&this.dispatchBeforeMapChange(e,this.store[n]),this.store[n]=t,this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0),!1):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,void 0),this.length++,this.store[n]=t,this.dispatchesMapChanges&&this.dispatchMapChange(e,t),!0)},a.prototype.has=function(e){this.assertString(e);var t=s(e);return t in this.store},a.prototype["delete"]=function(e){this.assertString(e);var t=s(e);return t in this.store?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,this.store[t]),delete this.store[s(e)],this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0),!0):!1},a.prototype.clear=function(){for(var e in this.store)this.dispatchesMapChanges&&this.dispatchBeforeMapChange(key,this.store[e]),delete this.store[e],this.dispatchesMapChanges&&this.dispatchMapChange(key,void 0);
this.length=0},a.prototype.reduce=function(e,t,n){for(var a in this.store)t=e.call(n,t,this.store[a],r(a),this);return t},a.prototype.reduceRight=function(e,t,n){var a=this,s=this.store;return Object.keys(this.store).reduceRight(function(t,i){return e.call(n,t,s[i],r(i),a)},t)},a.prototype.one=function(){var e;for(var e in this.store)return this.store[e]}}}),montageDefine("febb707","tree-log",{dependencies:[],factory:function(e,t,n){"use strict";function a(){}n.exports=a,a.ascii={intersection:"+",through:"-",branchUp:"+",branchDown:"+",fromBelow:".",fromAbove:"'",fromBoth:"+",strafe:"|"},a.unicodeRound={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"╭",fromAbove:"╰",fromBoth:"┣",strafe:"┃"},a.unicodeSharp={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"┏",fromAbove:"┗",fromBoth:"┣",strafe:"┃"}}}),montageDefine("5b57d38","deserialization/reviver",{dependencies:["q"],factory:function(e,t){(function(t){function n(){}function a(e){var t=n.prototype.getCustomObjectTypeOf;return function(n){return e(n)||t(n)}}var s=function(){return this}(),r=e("q");Object.defineProperties(n.prototype,{_createAssignValueFunction:{value:function(e,t){return function(n){e[t]=n}}},getTypeOf:{value:function(e){var t=typeof e;return null===e?"null":Array.isArray(e)?"array":"object"===t&&1===Object.keys(e).length?"@"in e?"reference":"/"in e?"regexp":"object":t}},getCustomObjectTypeOf:{writable:!0,value:function(){}},reviveRootObject:{value:function(e,t,n){var a;return e.debugger,"value"in e?t.hasUserObject(n)?(a=t.getUserObject(n),t.setObjectLabel(a,n),a):this.reviveValue(e.value,t,n):0===Object.keys(e).length?t.hasUserObject(n)?(a=t.getUserObject(n),t.setObjectLabel(a,n),a):this.reviveExternalObject(e,t,n):this.reviveCustomObject(e,t,n)}},reviveValue:{value:function(e,t,n){var a=this.getTypeOf(e);return"string"===a||"number"===a||"boolean"===a||"null"===a||"undefined"===a?this.reviveNativeValue(e,t,n):"regexp"===a?this.reviveRegExp(e,t,n):"reference"===a?this.reviveObjectReference(e,t,n):"array"===a?this.reviveArray(e,t,n):"object"===a?this.reviveObjectLiteral(e,t,n):this._callReviveMethod("revive"+a,e,t,n)}},reviveNativeValue:{value:function(e,t,n){return n&&t.setObjectLabel(e,n),e}},reviveObjectLiteral:{value:function(e,t,n){var a,s=[];n&&t.setObjectLabel(e,n);for(var i in e)a=this.reviveValue(e[i],t),r.isPromise(a)?s.push(a.then(this._createAssignValueFunction(e,i))):e[i]=a;return 0===s.length?e:r.all(s).then(function(){return e})}},reviveRegExp:{value:function(e,t,n){var e=e["/"],a=RegExp(e.source,e.flags);return n&&t.setObjectLabel(a,n),a}},reviveObjectReference:{value:function(e,t){var e=e["@"],n=t.getObject(e);return n}},reviveArray:{value:function(e,t,n){var a,s=[];n&&t.setObjectLabel(e,n);for(var i=0,o=e.length;o>i;i++)a=this.reviveValue(e[i],t),r.isPromise(a)?s.push(a.then(this._createAssignValueFunction(e,i))):e[i]=a;return 0===s.length?e:r.all(s).then(function(){return e})}},reviveCustomObject:{value:function(e,t,n){var a=this.getCustomObjectTypeOf(e),o=i["revive"+a];return a?o.call(s,e,t,n):r.reject(Error("Object's type is unknown: "+JSON.stringify(e)))}},reviveExternalObject:{value:function(e,t,n){return r.reject(Error("External object '"+n+"' not found in user objects."))}},_callReviveMethod:{value:function(e,t,n,a){return this[e](t,n,a)}}});var i=Object.create(null);n.addCustomObjectReviver=function(e){for(var t in e)if("getTypeOf"!==t&&"function"==typeof e[t]&&/^revive/.test(t)){if(void 0!==i[t])return Error("Reviver '"+t+"' is already registered.");i[t]=e[t].bind(e)}this.prototype.getCustomObjectTypeOf=a(e.getTypeOf)},n.resetCustomObjectRevivers=function(){i=Object.create(null),this.prototype.getCustomObjectTypeOf=function(){}},t.Reviver=n})(t),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)})}}),montageDefine("5b57d38","serialization/malker",{dependencies:[],factory:function(e,t){(function(e){function t(e){this._handlers=e,this._enteredObjects={}}Object.defineProperties(t.prototype,{_handlers:{value:null,writable:!0},_enteredObjects:{value:null,writable:!0},_isObjectEntered:{value:function(e){return Object.hash(e)in this._enteredObjects}},_markObjectAsEntered:{value:function(e){this._enteredObjects[Object.hash(e)]=!0}},visit:{value:function(e,t){this._visitValue(e,t)},enumerable:!0},_getTypeOf:{value:function(e){return Array.isArray(e)?"array":RegExp.isRegExp(e)?"regexp":null===e?"null":"object"==typeof e||"function"==typeof e?this._getObjectType(e):typeof e}},_getObjectType:{value:function(e){var t,n=this._handlers;return"function"==typeof n.getTypeOf&&(t=n.getTypeOf(e)),void 0===t?typeof e:t}},_visitValue:{value:function(e,t){var n=this._getTypeOf(e);"object"===n?this._visitObject(e,t):"array"===n?this._visitArray(e,t):"regexp"===n?this._visitRegExp(e,t):"number"===n?this._visitNumber(e,t):"string"===n?this._visitString(e,t):"boolean"===n?this._visitBoolean(e,t):"null"===n?this._visitNull(t):"undefined"===n?this._visitUndefined(t):this._visitCustomType(n,e,t)}},_visitCustomType:{value:function(e,t,n){this._callVisitorMethod("visit"+e,t,n)}},_enterCustomObject:{value:function(e,t,n){this._callVisitorMethod("enter"+e,t,n),this._callVisitorMethod("exit"+e,t,n)}},_visitObject:{value:function(e,t){var n;this._isObjectEntered(e)?this._callVisitorMethod("visitObject",e,t):(n=this._callVisitorMethod("willEnterObject",e,t),n!==!1&&(this._markObjectAsEntered(e),this._enterObject(e,t)))}},_enterObject:{value:function(e,t){var n,a=Object.keys(e);this._callVisitorMethod("enterObject",e,t);for(var s=0,r=a.length;r>s;s++)n=a[s],this._visitValue(e[n],n);this._callVisitorMethod("exitObject",e,t)}},_visitArray:{value:function(e,t){var n;this._isObjectEntered(e)?this._callVisitorMethod("visitArray",e,t):(n=this._callVisitorMethod("willEnterArray",e,t),n!==!1&&(this._markObjectAsEntered(e),this._enterArray(e,t)))}},_enterArray:{value:function(e,t){this._callVisitorMethod("enterArray",e,t);for(var n=0,a=e.length;a>n;n++)this._visitValue(e[n],""+n);this._callVisitorMethod("exitArray",e,t)}},_visitRegExp:{value:function(e,t){this._callVisitorMethod("visitRegExp",e,t)}},_visitString:{value:function(e,t){this._callVisitorMethod("visitString",e,t)}},_visitNumber:{value:function(e,t){this._callVisitorMethod("visitNumber",e,t)}},_visitBoolean:{value:function(e,t){this._callVisitorMethod("visitBoolean",e,t)}},_visitNull:{value:function(e){this._callVisitorMethod("visitNull",e)}},_visitUndefined:{value:function(e){this._callVisitorMethod("visitUndefined",e)}},_callVisitorMethod:{value:function(e){var t,n=this._handlers;return"function"==typeof n[e]?(t=Array.prototype.slice.call(arguments,1),t.unshift(this),n[e].apply(n,t)):void 0}}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),RegExp.isRegExp||(RegExp.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}),e.Malker=t,e.visit=function(e,n){var a=new t(n);a.visit(e)}})(t)}}),montageDefine("5b57d38","serialization/serializer",{dependencies:["./malker","./builder","./labeler","./visitor"],factory:function(e,t){(function(t){function n(){var e;this._builder=new s,this._labeler=new r,e=new i(this._builder,this._labeler),this._malker=new a(e)}var a=e("./malker").Malker,s=e("./builder").Builder,r=e("./labeler").Labeler,i=e("./visitor").Visitor;Object.defineProperties(n.prototype,{_labeler:{value:null,writable:!0},_builder:{value:null,writable:!0},_serializationIndentation:{value:2,writable:!0},_malker:{value:null,writable:!0},setSerializationIndentation:{value:function(e){this._serializationIndentation=e}},serialize:{value:function(e){var t;this._labeler.initWithObjects(e);for(var n in e)this._malker.visit(e[n]);return t=this._formatSerialization(this._builder.getSerialization(this._serializationIndentation))}},serializeObject:{value:function(e){return this.serialize({root:e})}},_formatSerializationBindingsRegExp:{value:/\{\s*("(?:<->?)")\s*:\s*("[^"]+"\s*(?:,\s*"converter"\s*:\s*\{\s*"@"\s*:\s*"[^"]+"\s*\}\s*|,\s*"deferred"\s*:\s*(true|false)\s*)*)\}/gi},_formatSerializationBindingsReplacer:{value:function(e,t,n){return"{"+t+": "+n.replace(/\n\s*/g,"").replace(/,\s*/g,", ")+"}"}},_formatSerializationBindings:{value:function(e){return e.replace(this._formatSerializationBindingsRegExp,this._formatSerializationBindingsReplacer)}},_formatSerializationReferencesRegExp:{value:/\{\s*("[#@]")\s*:\s*("[^"]+")\s*\}/gi},_formatSerializationReferences:{value:function(e){return e.replace(this._formatSerializationReferencesRegExp,"{$1: $2}")}},_formatSerialization:{value:function(e){return this._formatSerializationBindings(this._formatSerializationReferences(e))}}}),t.Serializer=n,t.serialize=function(e){return(new n).serializeObject(e)}})(t)}}),montageDefine("5b57d38","deserialization/interpreter",{dependencies:["./reviver","./context"],factory:function(e,t){(function(t){function n(){}var a=e("./reviver").Reviver,s=e("./context").Context;Object.defineProperties(n.prototype,{instantiate:{value:function(e,t){var n=new a,r=new s(e,n,t);return r.getObjects()}}}),t.Interpreter=n})(t)}}),montageDefine("5b57d38","deserialization/deserializer",{dependencies:["q","./interpreter"],factory:function(e,t){(function(t){function n(e){this._serializationString=e}function a(e){return new n(e).deserializeObject()}var s=e("q"),r=e("./interpreter").Interpreter;Object.defineProperties(n.prototype,{_interpreter:{value:new r},_serializationString:{value:null,writable:!0},deserialize:{value:function(e){var t;try{t=JSON.parse(this._serializationString)}catch(n){return s.reject(n)}return this._interpreter.instantiate(t,e)}},deserializeObject:{value:function(e){return this.deserialize(e).then(function(e){return e.root})}}}),t.Deserializer=n,t.deserialize=a})(t)}}),montageDefine("5b57d38","serialization/builder",{dependencies:["./ast"],factory:function(e,t){(function(t){function n(){this.init()}var a=e("./ast");Object.defineProperties(n.prototype,{_root:{value:null,writable:!0},_stack:{value:null,writable:!0},_references:{value:null,writable:!0},_placeholderProperty:{value:Object.create(null)},init:{value:function(){return this._references=Object.create(null),this._root=new a.Root,this._stack=[this._root],this}},cleanup:{value:function(){this._references=null,this._root=null,this._stack=null}},getExternalReferences:{value:function(){var e=this._references,t=this._root,n=[];for(var a in e)t.hasProperty(a)&&t.getProperty(a)!==this._placeholderProperty||n.push(a);return n}},relabelReferences:{value:function(e,t){var n=this._references[e];if(n){n=n.slice(0);for(var a=0,s=n.length;s>a;a++)n[a].value=t}}},_registerReference:{value:function(e){var t=this._references,n=e.value;t[n]?t[n].push(e):t[n]=[e]}},_unregisterReference:{value:function(e){var t,n=e.label,a=this._references[n];1===a.length?delete this._references[n]:(t=a.indexOf(e),-1===t?console.log("BUG: reference '"+n+"' not found in registry."):a.splice(t,1))}},_createPlaceholdersForReferences:{value:function(){var e=this._references,t=this._root;for(var n in e)t.hasProperty(n)||t.setProperty(n,this._placeholderProperty)}},getSerialization:{value:function(e){return this._createPlaceholdersForReferences(),this._root.serialize(e)}},root:{get:function(){return this._root}},top:{get:function(){return this._stack[0]}},push:{value:function(e){return this._stack.unshift(e)}},pop:{value:function(){return this._stack.shift()}},createObjectLiteral:{value:function(){return new a.ObjectLiteral(this._root,Object.create(null))}},createArray:{value:function(){return new a.ObjectLiteral(this._root,[])}},createObjectReference:{value:function(e){var t=new a.ObjectReference(this._root,e);return this._registerReference(t),t}},createRegExp:{value:function(e){return new a.RegExpObject(this._root,e)}},createString:{value:function(e){return new a.Value(this._root,e)}},createNumber:{value:function(e){return new a.Value(this._root,e)}},createBoolean:{value:function(e){return new a.Value(this._root,e)}},createNull:{value:function(){return new a.Value(this._root,null)}},createCustomObject:{value:function(){return new a.CustomObject(this._root)}}}),t.Builder=n})(t)}}),montageDefine("5b57d38","serialization/labeler",{dependencies:[],factory:function(e,t){(function(e){function t(){this._objectsLabels=Object.create(null),this._objects=Object.create(null),this._objectNamesIndex=Object.create(null),this._userDefinedLabels=Object.create(null)}Object.defineProperties(t.prototype,{_objectsLabels:{value:null,writable:!0},_objects:{value:null,writable:!0},_INITIAL_LABEL_NUMBER:{value:2},_objectNamesIndex:{value:null,writable:!0},_userDefinedLabels:{value:null,writable:!0},initWithObjects:{value:function(e){for(var t in e)this.setObjectLabel(e[t],t),this._userDefinedLabels[t]=!0}},cleanup:{value:function(){this._objectsLabels=null,this._objects=null,this._objectNamesIndex=null,this._userDefinedLabels=null}},getObjectName:{value:function(e){return Array.isArray(e)?"array":RegExp.isRegExp(e)?"regexp":"object"}},generateObjectLabel:{value:function(e){var t,n=this.getObjectName(e),a=this._objectNamesIndex[n];do a?(t=n+a,this._objectNamesIndex[n]=a+=1):(t=n,this._objectNamesIndex[n]=a=this._INITIAL_LABEL_NUMBER);while(t in this._objects);return t}},getObjectLabel:{value:function(e){var t,n=Object.hash(e);return n in this._objectsLabels?t=this._objectsLabels[n]:(t=this.generateObjectLabel(e),this._objectsLabels[n]=t,this._objects[t]=e),t}},setObjectLabel:{value:function(e,t){if(void 0!==e){var n=Object.hash(e);this._objectsLabels[n]=t,this._objects[t]=e}}},getObjectByLabel:{value:function(e){return this._objects[e]}},isUserDefinedLabel:{value:function(e){return e in this._userDefinedLabels}}}),e.Labeler=t})(t)}}),montageDefine("5b57d38","serialization/visitor",{dependencies:["collections/shim-object"],factory:function(e,t){(function(t){function n(e,t){this.builder=e,this.labeler=t,this._objectsSerialization=Object.create(null)}function a(e){var t=n.prototype.getCustomObjectTypeOf;return function(n){return e(n)||t(n)}}e("collections/shim-object"),Object.defineProperties(n.prototype,{builder:{value:null,writable:!0},labeler:{value:null,writable:!0},getTypeOf:{value:function(e){return this.isCustomObject(e)?"CustomObject":void 0}},getCustomObjectTypeOf:{value:function(){},writable:!0},isCustomObject:{value:function(e){var t=this.getCustomObjectTypeOf(e);return"string"==typeof t}},_objectsSerialization:{value:null,writable:!0},setObjectSerialization:{value:function(e,t){this._objectsSerialization[Object.hash(e)]=t}},getObjectSerialization:{value:function(e){return this._objectsSerialization[Object.hash(e)]}},isObjectSerialized:{value:function(e){return Object.hash(e)in this._objectsSerialization}},enterObject:{value:function(e,t){var n=this.builder.createObjectLiteral();this.setObjectSerialization(t,n),this.builder.push(n)}},exitObject:{value:function(e,t,n){this.storeValue(this.builder.pop(),t,n)}},visitObject:{value:function(e,t,n){var a=this.labeler.getObjectLabel(t),s=this.builder.createObjectReference(a);this.getObjectSerialization(t).setLabel(a),this.builder.top.setProperty(n,s)}},enterArray:{value:function(e,t){var n=this.builder.createArray();this.setObjectSerialization(t,n),this.builder.push(n)}},exitArray:{value:function(e,t,n){this.storeValue(this.builder.pop(),t,n)}},visitArray:{value:function(e,t,n){var a=this.labeler.getObjectLabel(t),s=this.builder.createObjectReference(a);this.getObjectSerialization(t).setLabel(a),this.builder.top.setProperty(n,s)}},visitRegExp:{value:function(e,t,n){this.storeValue(this.builder.createRegExp(t),t,n)}},visitString:{value:function(e,t,n){this.storeValue(this.builder.createString(t),t,n)}},visitNumber:{value:function(e,t,n){this.storeValue(this.builder.createNumber(t),t,n)}},visitBoolean:{value:function(e,t,n){this.storeValue(this.builder.createBoolean(t),t,n)}},visitNull:{value:function(e,t){this.storeValue(this.builder.createNull(),null,t)}},visitCustomObject:{value:function(e,t,n){var a=this.getCustomObjectTypeOf(t),r=s["visit"+a];if(a)return r.call(global,e,this,t,n);throw Error("Object's type is unknown: "+t)}},storeValue:{value:function(e,t,n){void 0===n?e.setLabel(this.labeler.getObjectLabel(t)):this.builder.top.setProperty(n,e)}}});var s=Object.create(null);n.addCustomObjectVisitor=function(e){for(var t in e)if("getTypeOf"!==t&&"function"==typeof e[t]&&/^visit/.test(t)){if(void 0!==s[t])return Error("Visitor '"+t+"' is already registered.");s[t]=e[t].bind(e)}this.prototype.getCustomObjectTypeOf=a(e.getTypeOf)},n.resetCustomObjectVisitors=function(){s=Object.create(null),this.prototype.getCustomObjectTypeOf=function(){}},t.Visitor=n})(t)}}),montageDefine("5b57d38","deserialization/context",{dependencies:["q"],factory:function(e,t){var n=e("q");(function(e){function t(e,t,n){if(this._reviver=t,this._serialization=e,this._objects=Object.create(null),n){this._userObjects=Object.create(null);for(var a in n)this._userObjects[a]=n[a]}}Object.defineProperties(t.prototype,{_objects:{value:null,writable:!0},_userObjects:{value:null,writable:!0},_serialization:{value:null,writable:!0},_reviver:{value:null,writable:!0},setObjectLabel:{value:function(e,t){this._objects[t]=e}},getObject:{value:function(e){var t,a=this._serialization,s=this._reviver,r=this._objects;return e in r?r[e]:e in a?(t=s.reviveRootObject(a[e],this,e),e in r||(r[e]=t),t):n.reject(Error("Object with label '"+e+"' was not found."))}},getObjects:{value:function(){var e,t=this,a=(this._reviver,this._serialization),s=[];for(var r in a)e=this.getObject(r),n.isPromise(e)&&s.push(e);return 0===s.length?n.resolve(this._invokeDidReviveObjects()):n.all(s).then(function(){return t._invokeDidReviveObjects()})}},hasUserObject:{value:function(e){var t=this._userObjects;return t?e in t:!1}},getUserObject:{value:function(e){var t=this._userObjects;return t?t[e]:void 0}},_invokeDidReviveObjects:{value:function(){var e,t=this,a=this._reviver;return"function"==typeof a.didReviveObjects&&(e=a.didReviveObjects(this._objects,this),n.isPromise(e))?e.then(function(){return t._objects}):this._objects}}}),e.Context=t})(t)}}),montageDefine("5b57d38","serialization/ast",{dependencies:[],factory:function(e,t){(function(e){function t(){this.object=Object.create(null)}function n(e,t){this.root=e,this.value=t}function a(e,t){n.call(this,e,t)}function s(e,t){n.call(this,e,t)}function r(e,t){n.call(this,e,t)}function i(e){n.call(this,e,Object.create(null))}function o(e,t){n.call(this,e,t)}Object.defineProperties(t.prototype,{object:{value:null,writable:!0},setProperty:{value:function(e,t){null!=e&&(this.object[e]=t)}},getProperty:{value:function(e){return this.object[e]}},clearProperty:{value:function(e){delete this.object[e]}},hasProperty:{value:function(e){return e in this.object}},serialize:{value:function(e){return JSON.stringify(this,null,e)}},toJSON:{value:function(){var e,t=Object.create(null);for(var n in this.object)e=this.object[n],t[n]=e.toJSON?e.toJSON(1):e;return t}}}),Object.defineProperties(n.prototype,{root:{value:null,writable:!0},label:{value:null,writable:!0},value:{value:null,writable:!0},setLabel:{value:function(e){this.label&&this.root.clearProperty(this.label),this.label=e,this.root.setProperty(e,this)}},getLabel:{value:function(){return this.label}},clearLabel:{value:function(){this.root.clearProperty(this.label),this.label=null}},_getSerializationValue:{value:function(){return this.value}},toJSON:{value:function(e){var t=this._getSerializationValue();return 1===e?{value:t}:t}}}),a.prototype=Object.create(n.prototype,{constructor:{value:a},toJSON:{value:function(e){var t,n=this._getSerializationValue();return 1===e?{value:n}:this.label?(t=new o(this.root,this.label),t.toJSON()):n}}}),s.prototype=Object.create(a.prototype,{constructor:{value:s},setProperty:{value:function(e,t){null!=e&&(this.value[e]=t)}},getProperty:{value:function(e){return this.value[e]}},clearProperty:{value:function(e){delete this.value[e]}},getPropertyNames:{value:function(){return Object.keys(this.value)}}}),r.prototype=Object.create(a.prototype,{constructor:{value:r},_getSerializationValue:{value:function(){var e=this.value;return{"/":{source:e.source,flags:(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")}}}}}),i.prototype=Object.create(n.prototype,{constructor:{value:i},setProperty:{value:function(e,t){null!=e&&(this.value[e]=t)}},getProperty:{value:function(e){return this.value[e]}},clearProperty:{value:function(e){delete this.value[e]}},toJSON:{value:function(e){var t,n=this._getSerializationValue();return 1===e?n:(t=new o(this.root,this.label),t.toJSON())}}}),o.prototype=Object.create(n.prototype,{constructor:{value:o},_getSerializationValue:{value:function(){return{"@":this.value}}}}),e.Root=t,e.Value=n,e.ReferenceableValue=a,e.ObjectLiteral=s,e.RegExpObject=r,e.CustomObject=i,e.ObjectReference=o})(t)}}),montageDefine("1bc5415","parse",{dependencies:["collections/shim","./grammar"],factory:function(e,t,n){function a(e,t){if(Array.isArray(e))return{type:"tuple",args:e.map(function(e){return a(e,t)})};try{return s.parse(e,t||Object.empty)}catch(n){throw n.message=n.message.replace(/[\s\.]+$/,"")+" "+" on line "+n.line+" column "+n.column,n}}e("collections/shim");var s=e("./grammar");n.exports=a}}),montageDefine("1bc5415","evaluate",{dependencies:["./parse","./compile-evaluator","./scope"],factory:function(e,t,n){function a(e,t,n,a,o){var l;l="string"==typeof e?s(e):e;var c=r(l);return c(new i(t,null,n,a,o))}var s=e("./parse"),r=e("./compile-evaluator"),i=e("./scope");n.exports=a}}),montageDefine("1bc5415","assign",{dependencies:["./parse","./compile-assigner","./scope"],factory:function(e,t,n){function a(e,t,n,a,o,l){var c;c="string"==typeof t?s(t):t;var p=r(c);return p(n,new i(e,null,a,o,l))}var s=e("./parse"),r=e("./compile-assigner"),i=e("./scope");n.exports=a}}),montageDefine("1bc5415","observe",{dependencies:["./parse","./compile-observer","./observers","./scope"],factory:function(e,t,n){function a(e,t,n){var a;a="function"==typeof n?{change:n}:n,a=a||c,a.source=e,a.sourcePath=t;var p=a.parameters=a.parameters||e,u=a.document,h=a.components,d=a.beforeChange,m=a.contentChange,g=new l(e,null,p,u,h,d),f=s(t),v=r(f);return m===!0&&(v=i.makeRangeContentObserver(v)),v(o(function(t){if(t){if("function"!=typeof m)return a.change.apply(e,arguments);if("function"==typeof m)return t.addRangeChangeListener(m),i.once(function(){t.removeRangeChangeListener(m)})}}),g)}var s=e("./parse"),r=e("./compile-observer"),i=e("./observers"),o=i.autoCancelPrevious,l=e("./scope");n.exports=a;var c={}}}),montageDefine("1bc5415","bind",{dependencies:["./parse","./algebra","./stringify","./compile-observer","./compile-binder","./observers","./scope"],factory:function(e,t,n){function a(e,t,n){n.target=e,n.targetPath=t;var a=n.source=n.source||e,o=n["<-"]||n["<->"]||"",l=n.twoWay="<->"in n;n.sourcePath=o,n.value;var c=n.parameters=n.parameters||a,p=n.document,u=n.components,d=n.trace,m=n.sourceScope=new h(a,null,c,p,u),g=n.targetScope=new h(e,null,c,p,u);if(n.converter){var f=n.converter;f.convert&&(n.convert=f.convert.bind(f)),f.revert&&(n.revert=f.revert.bind(f))}var v=n.convert,b=n.revert,y=n.sourceSyntax=i(o),w=n.targetSyntax=i(t);d&&console.log("DEFINE BINDING",t,"<-",o,e);var _=s(g,w,m,y,v,n,d),L=r;return l&&(d&&console.log("DEFINE BINDING",t,"->",o,a),L=s(m,y,g,w,b,n,d)),function(){_(),L()}}function s(e,t,n,a,s,r,i){var h=o(t,a);t=h[0],a=h[1];var d=c(a);s&&(d=u.makeConverterObserver(d,s,n));var m=p(t);return m(d,n,e,r,i?{sourcePath:l(a),targetPath:l(t)}:null)}function r(){}var i=e("./parse"),o=e("./algebra"),l=e("./stringify"),c=e("./compile-observer"),p=e("./compile-binder"),u=e("./observers"),h=e("./scope");n.exports=a}}),montageDefine("1bc5415","compile-observer",{dependencies:["./observers","./operators"],factory:function(e,t,n){function a(e){return i.compile(e)}var s=e("./observers"),r=e("./operators");n.exports=a;var i=a.semantics={compilers:{property:s.makePropertyObserver,get:s.makeGetObserver,path:s.makePathObserver,"with":s.makeWithObserver,"if":s.makeConditionalObserver,parent:s.makeParentObserver,not:s.makeNotObserver,and:s.makeAndObserver,or:s.makeOrObserver,"default":s.makeDefaultObserver,defined:s.makeDefinedObserver,rangeContent:s.makeAsArrayObserver,mapContent:Function.identity,keys:s.makeKeysObserver,values:s.makeValuesObserver,items:s.makeItemsObserver,toMap:s.makeToMapObserver,mapBlock:s.makeMapBlockObserver,filterBlock:s.makeFilterBlockObserver,everyBlock:s.makeEveryBlockObserver,someBlock:s.makeSomeBlockObserver,sortedBlock:s.makeSortedBlockObserver,groupBlock:s.makeGroupBlockObserver,groupMapBlock:s.makeGroupMapBlockObserver,minBlock:s.makeMinBlockObserver,maxBlock:s.makeMaxBlockObserver,enumerate:s.makeEnumerationObserver,reversed:s.makeReversedObserver,flatten:s.makeFlattenObserver,view:s.makeViewObserver,sum:s.makeSumObserver,average:s.makeAverageObserver,has:s.makeHasObserver,tuple:s.makeArrayObserver,range:s.makeRangeObserver,startsWith:s.makeStartsWithObserver,endsWith:s.makeEndsWithObserver,contains:s.makeContainsObserver,asArray:s.makeAsArrayObserver},compile:function(e){var t=this.compilers;if("literal"===e.type)return s.makeLiteralObserver(e.value);if("value"===e.type)return s.observeValue;if("parameters"===e.type)return s.observeParameters;if("element"===e.type)return s.makeElementObserver(e.id);if("component"===e.type)return s.makeComponentObserver(e.label,e);if("record"===e.type){var n={},a=e.args;for(var r in a)n[r]=this.compile(a[r]);return s.makeObjectObserver(n)}t.hasOwnProperty(e.type)||(t[e.type]=s.makeMethodObserverMaker(e.type));var i=e.args.map(this.compile,this);return t[e.type].apply(null,i)}},o=i.compilers;Object.keys(r).forEach(function(e){o[e]||(o[e]=s.makeOperatorObserverMaker(r[e]))})}}),montageDefine("1bc5415","scope",{dependencies:[],factory:function(e,t,n){function a(e,t,n,a,s,r){this.value=e,this.parent=t,this.parameters=n,this.document=a,this.components=s,this.beforeChange=r}n.exports=a,a.nest=function(e,t){return e=e||new a,new a(t,e,e.parameters,e.document,e.components,e.beforeChange)}}}),montageDefine("1bc5415","observers",{dependencies:["collections/shim","collections/listen/property-changes","collections/listen/array-changes","collections/sorted-array","collections/map","collections/set","collections/heap","./scope","./operators","./parse","./compile-observer"],factory:function(e,t){function n(e){return function(t){return t(e)||Function.noop}}function a(e,t){return e(t.value)||Function.noop}function s(e,t){return e(t.parameters)||Function.noop}function r(e){return function(t,n){return t(n.document.getElementById(e))||Function.noop}}function i(e,t){return function(n,a){var s=a.components,r=s.getObjectByLabel||s.getComponentByLabel,i=r.call(s,e);return t.component=i,n(i)||Function.noop}}function o(e,t,n,a){function s(e,t,a){r(),r=n(e,t,a)||Function.noop}if(null==e)return n();var r=Function.noop;return pt.addOwnPropertyChangeListener(e,t,s,a.beforeChange),s(e[t],t,e),ct(function(){r(),pt.removeOwnPropertyChangeListener(e,t,s,a.beforeChange)})}function l(e,t){return function(n,a){return t(lt(function(t){return null==t?n():e(lt(function(e){return null==e?n():e.observeProperty?e.observeProperty(t,n,a):vt(e,t,n,a)}),a)}),a)}}function c(e,t,n,a){function s(e,a,s){i(t,a)&&(r(),r=n(e,t,s)||Function.noop)}var r=Function.noop,i=e.contentEquals||Object.equals;return s(e.get(t),t,e),e.addMapChangeListener(s,a.beforeChange),ct(function(){r(),e.removeMapChangeListener(s)})}function p(e,t){return function(n,a){return e(lt(function(e){return e?t(lt(function(t){return null==t?n():e.observeGet?e.observeGet(t,n,a):bt(e,t,n,a)}),a):n()}),a)}}function u(e,t){return function(n,a){return n=it(n),t(lt(function(t){return e(lt(function(e){return e?U(e,function(){return n((e.has||e.contains).call(e,t))},a):n()}),a)}),a)}}function h(e){return function(t,n){for(var a=Array(e.length),s=0;e.length>s;s++)a[s]=void 0;var r=e.map(function(e,t){return e(function(e){a.set(t,e)},n)}),i=t(a)||Function.noop;return ct(function(){i(),ot(r)})}}function d(e){return function(t,n){var a={},s={};for(var r in e)(function(e,t){a[e]=t(function(t){s[e]=t},n)})(r,e[r]);var i=t(s)||Function.noop;return function(){i();for(var e in a)a[e]()}}}function m(){return h(Array.prototype.slice.call(arguments))}function g(e){return function(){var t=h(Array.prototype.slice.call(arguments)),n=H(t);return function(t,a){return n(lt(function(n){return n.every(ft.defined)?t(e.apply(void 0,n)):t()}),a)}}}function f(e){var t=e.slice(0,1).toUpperCase()+e.slice(1),n="make"+t+"Observer",a="observe"+t;return function(){var t=arguments[0],s=Array.prototype.slice.call(arguments,1),r=s.map(function(e){return function(t,n){return e(lt(t),n)}}),i=h(s),o=H(i);return function(s,i){return t(lt(function(t){return t?t[n]?t[n].apply(t,r)(s,i):t[a]?t[a](s,i):o(lt(function(n){if(!n.every(ft.defined))return s();if(t[e])return s(t[e].apply(t,n));throw Error("Object has no method "+JSON.stringify(e)+": "+t)}),i):s()}),i)}}}function v(e){return function(t,n){return e(lt(function(e){return t(!e)}),n)}}function b(e,t){return function(n,a){return e(lt(function(e){return e?t(n,a):n(e)}),a)}}function y(e,t){return function(n,a){return e(lt(function(e){return e?n(e):t(n,a)}),a)}}function w(e,t,n){return function(a,s){return e(lt(function(e){return null==e?a():e?t(a,s):n(a,s)}),s)}}function _(e){return function(t,n){return e(lt(function(e){return t(null!=e)}),n)}}function L(e,t){return function(n,a){return e(lt(function(e){return null==e?t(n,a):n(e)}),a)}}function x(e,t){return function(n,a){return e(lt(function(e){function s(t){for(;e.length>t;t++)o[t].index=t}function r(e,n,r){o.swap(r,n.length,e.map(function(e,t){return{index:r+t}})),s(r+e.length);var c,p=[];ot(l.swap(r,n.length,e.map(function(e,n){var s=o[r+n];return t(lt(function(e){c?i.set(s.index,e):p[n]=e}),gt.nest(a,e))}))),c=!0,i.swap(r,n.length,p)}if(!e)return n();var i=[],o=[],l=[],c=U(e,r,a),p=n(i,e)||Function.noop;return ct(function(){p(),ot(l),c()})}),a)}}function C(e,t){var n=x(e,t);return function(e,t){return n(lt(function(n,a){function s(e){for(;n.length>e;e++)l[e+1]=l[e]+n[e]}function r(e,t,n){var r=a.slice(n,n+e.length),o=t.map(Boolean).sum(),c=r.filter(function(t,n){return e[n]}),p=l[n];i.swap(p,o,c),s(p)}if(!a)return e();var i=[],o=[],l=[0],c=U(n,r,t),p=e(i)||Function.noop;return ct(function(){p(),ot(o),c()})}),t)}}function M(e,t){var n=z(t),a=x(e,n),s=function(e,t){return a(lt(function(n){function a(e,t){r.addEach(e),r.deleteEach(t)}if(!n)return e();var s=[],r=ut(s,function(e,t){return Object.equals(e[1],t[1])},function(e,t){return Object.compare(e[1],t[1])}),i=U(n,a,t),o=e(s)||Function.noop;return function(){o(),i()}}),t)};return yt(s,Z)}function z(e){return function(t,n){return e(lt(function(e){return t([n.value,e])||Function.noop}),n)}}function S(e){return function(t,n){return e(lt(function(e){function a(e,t,n){var a=s.length-n-t.length;s.swap(a,t.length,e.reversed())}if(!e)return t();var s=[],r=U(e,a,n),i=t(s);return ct(function(){i(),r()})}),n)}}function E(e){return function(t,n){return e(lt(function(e){function a(t){for(var n=t;e.length>n;n++)l[n].index=n,o[n+1]=o[n]+e[n].length}function s(e,t,s){var c=o[s],p=o[s+t.length],u=p-c;r.swap(c,u,[]),l.swap(s,t.length,e.map(function(){return{index:null}})),a(s),ot(i.swap(s,t.length,e.map(function(e,t){function i(e,t,n){a(c.index);var s=o[c.index]+n,i=o[c.index]+n+t.length,l=i-s;r.swap(s,l,e)}var c=l[s+t];return U(e,i,n)})))}if(!e)return t();var r=[],i=[],o=[0],l=[],c=U(e,s,n),p=t(r)||Function.noop;return ct(function(){p(),ot(i),c()})}),n)}}function k(e,t){var n=wt(e,t),a=l(n,_t);return tt(a,Boolean)}function T(e,t){var n=tt(t,ft.not),a=wt(e,n),s=l(a,_t);return tt(s,ft.not)}function j(e,t){var n=O(e,t);return Lt(n)}function O(e,t){var n=z(t),a=x(e,n);return function(e,t){return a(lt(function(n,a){function s(e,t){var n=dt();t.forEach(function(e){var t=r.get(e[1]);t["delete"](e[0]),n.add(e[1])}),e.forEach(function(e){r.has(e[1])||r.set(e[1],a.constructClone());var t=r.get(e[1]);t.add(e[0])
}),n.forEach(function(e){var t=r.get(e);0===t.length&&r["delete"](e)})}if(!n)return e();var r=ht(),i=U(n,s,t),o=e(r)||Function.noop;return function(){i(),o()}}),t)}}function B(e,t,n){function a(e,t){return Object.compare(e[1],t[1])*n}function s(e,t){return Object.equals(e[1],t[1])}var r=z(t),i=x(e,r);return function(e,t){return i(lt(function(n){function r(e,t){o.addEach(e),o.deleteEach(t)}function i(t,n){return 0===n?t?e(t[0]):e():void 0}if(!n)return e();var o=new mt(null,s,a),l=U(n,r,t),c=Y(o,i,t);return function(){l(),c()}}),t)}}function D(e,t){return B(e,t,1)}function P(e,t){return B(e,t,-1)}function A(e){return function(t){return function(n,a){return n=it(n),t(lt(function(t){if(!t)return n();var s=e(t,n);return U(t,function(e,t,a){return n(s(e,t,a))},a)}),a)}}}function I(e,t,n){return function(a,s){return e(lt(function(e){return e?n(lt(function(n){return null==n?a():t(lt(function(t){function r(a,s,r){var o=a.length-s.length;t>r&&0>o&&n>o?(i.swap(i.length,0,e.slice(t+n+o,t+n)),i.splice(0,-o)):t>r&&o>0&&n>o?(i.swap(0,0,e.slice(t,t+o)),i.splice(i.length-o,o)):r>=t&&0>o&&t+n>r?(i.swap(i.length,0,e.slice(t+n+o,t+n)),i.splice(r-t,-o)):r>=t&&o>0&&t+n>r?(i.swap(r-t,0,e.slice(r,r+o)),i.splice(i.length-o,o)):t+n>r&&i.swap(0,i.length,e.slice(t,t+n))}if(null==t)return a();var i=[],o=U(e,r,s),l=a(i)||Function.noop;return ct(function(){l(),o()})}),s)}),s):a()}),s)}}function R(e){return function(t,n){return e(lt(function(e){function a(e){for(;r.length>e;e++)r[e].set(0,e)}function s(e,t,n){r.swap(n,t.length,e.map(function(e,t){return[n+t,e]})),a(n+e.length)}if(!e)return t();var r=[],i=U(e,s,n),o=t(r)||Function.noop;return function(){o(),i()}}),n)}}function N(e){return function(t,n){var a=[],s=t(a)||Function.noop,r=e(function(e){if(e>>>=0,null==e)a.clear();else if(e>a.length){for(var t=[],n=a.length;e>n;n++)t.push(n);a.swap(a.length,0,t)}else a.length>e&&a.splice(e,a.length)},n);return function(){s(),r()}}}function q(e,t){return function(n,a){return t(function(t){var s=RegExp("^"+RegExp.escape(t));return e(function(e){return n(s.test(e))||Function.noop},a)},a)}}function F(e,t){return function(n,a){return t(function(t){var s=RegExp(RegExp.escape(t)+"$");return e(function(e){return n(s.test(e))||Function.noop},a)},a)}}function W(e,t){return function(n,a){return t(function(t){var s=RegExp(RegExp.escape(t));return e(function(e){return n(s.test(e))||Function.noop},a)},a)}}function U(e,t,n){function a(e,n,a){s(),s=t(e,n,a)||Function.noop}if(e){var s=Function.noop;if(!e.toArray)throw Error("Can't observe range changes on "+e+" because it has no toArray method");if(!e.addRangeChangeListener)throw Error("Can't observe range changes on "+e);a(e.toArray(),[],0);var r=e.addRangeChangeListener(a,n.beforeChange);return ct(function(){s(),r()})}}function H(e){return function(t,n){return e(lt(function(e){return e&&e.addRangeChangeListener?U(e,function(){return t(e)},n):t(e)}),n)}}function V(e){return function(t,n){return e(lt(function(e){return e&&e.addMapChangeListener?Y(e,function(){return t(e)},n):t(e)}),n)}}function Y(e,t,n){function a(e,n,a){var r=s.get(n)||Function.noop;r(),r=t(e,n,a)||Function.noop,s.set(n,r)}var s=ht();e.forEach(a);var r=e.addMapChangeListener(a,n.beforeChange);return ct(function(){s.forEach(function(e){e()}),r()})}function G(e){return function(t,n){return e(lt(function(e){return e?K(e,t,n):t()}),n)}}function K(e,t,n){function a(e,t){var n,a;r.has(t)?null==e?(n=r.get(t),r["delete"](t),a=s.indexOf(n),s.splice(a,1)):(n=r.get(t),n.set(1,e)):(n=[t,e],r.set(t,n),s.push(n))}var s=[],r=ht(),i=t(s)||Function.noop,o=Y(e,a,n);return ct(function(){i(),o()})}function X(e){var t=Lt(e);return yt(t,Z)}function Z(e,t){return t.value?e(t.value[0])||Function.noop:e()}function J(e){var t=Lt(e);return yt(t,$)}function $(e,t){return t.value?e(t.value[1])||Function.noop:e()}function Q(e){return function(t,n){var a=ht(),s=t(a)||Function.noop,r=e(lt(function(e){if(a.clear(),e&&!e.addRangeChangeListener){var t=Object.keys(e).map(function(t){return vt(e,t,lt(function(e){a.set(t,e)}),n)});return function(){ot(t)}}}),n);return function(){s(),r()}}}function et(e){return function(t,n){return e(t,n.parent||new gt)}}function tt(e,t,n){return function(a,s){return a=it(a),e(lt(function(e){return a(t.call(n,e))}),s)}}function nt(e,t,n){return function(a,s){return a=it(a),e(lt(function(e){return e&&e.every(ft.defined)?a(t.apply(n,e)):void 0}),s)}}function at(t,n){var a=e("./parse"),s=e("./compile-observer");return function(e,r){return e=it(e),n(lt(function(n){if(null==n)return e();var i,o;try{i=a(n),o=s(i)}catch(l){return e()}return t(lt(function(t){return o(e,gt.nest(r,t))}),r)}),r)}}function st(e,t){return function(n,a){return e(lt(function(e){return t(lt(function(e){return n(e)}),gt.nest(a,e))}),a)}}function rt(e){return function(){var t=e.apply(this,arguments);return function(e,n){var a=[],s=t(lt(function(e){function t(e,t,n){a.swap(n,t.length,e)}if(e){a.swap(0,a.length,e);var s=e.addRangeChangeListener(t,n.beforeChange);return ct(s)}a.clear()}),n),r=e(a)||Function.noop;return ct(function(){s(),r()})}}}function it(e){var t;return function(n){if(n!==t){var a=e.apply(this,arguments);return t=n,a}}}function ot(e){e.forEach(function(e){e&&e()})}function lt(e){var t=Function.noop;return function(){return t(),t=e.apply(this,arguments)||Function.noop,function(){t()}}}function ct(e){var t;return function(){return t?Function.noop:(t=!0,e.apply(this,arguments))}}e("collections/shim");var pt=e("collections/listen/property-changes");e("collections/listen/array-changes");var ut=e("collections/sorted-array"),ht=e("collections/map"),dt=e("collections/set"),mt=e("collections/heap"),gt=e("./scope"),ft=e("./operators");t.makeLiteralObserver=n,t.observeValue=a,t.observeParameters=s,t.makeElementObserver=r,t.makeComponentObserver=i,t.observeProperty=o;var vt=o;t.makePropertyObserver=l,t.observeKey=c,t.observeGet=c;var bt=c;t.makeGetObserver=p,t.makeHasObserver=u,t.makeObserversObserver=h,t.makeRecordObserver=d,t.makeObjectObserver=d,t.makeTupleObserver=m,t.makeArrayObserver=m,t.makeOperatorObserverMaker=g,t.makeMethodObserverMaker=f,t.makeNotObserver=v,t.makeAndObserver=b,t.makeOrObserver=y,t.makeConditionalObserver=w,t.makeDefinedObserver=_,t.makeDefaultObserver=L;var yt=t.makeMapBlockObserver=rt(x),wt=t.makeFilterBlockObserver=rt(C);t.makeSortedBlockObserver=M,t.makeReversedObserver=rt(S),t.makeFlattenObserver=rt(E),t.makeSomeBlockObserver=k,t.makeEveryBlockObserver=T,t.makeGroupBlockObserver=j,t.makeGroupMapBlockObserver=O,t.makeMaxBlockObserver=D,t.makeMinBlockObserver=P;var _t=n("length");t.makeSumObserver=A(function(){var e=0;return function(t,n){return e+=t.sum()-n.sum()}}),t.makeAverageObserver=A(function(){var e=0,t=0;return function(n,a){return e+=n.sum()-a.sum(),t+=n.length-a.length,e/t}}),t.makeViewObserver=rt(I),t.makeEnumerateObserver=rt(R),t.makeEnumerationObserver=t.makeEnumerateObserver,t.makeRangeObserver=N,t.makeStartsWithObserver=q,t.makeEndsWithObserver=F,t.makeContainsObserver=W,t.observeRangeChange=U,t.makeRangeContentObserver=H,t.makeMapContentObserver=V,t.observeMapChange=Y;var Lt=t.makeItemsObserver=rt(G);t.observeItems=K,t.makeKeysObserver=X,t.observeItemKey=Z,t.makeValuesObserver=J,t.observeItemValue=$,t.makeToMapObserver=Q,t.makeParentObserver=et,t.makeConverterObserver=tt,t.makeComputerObserver=nt,t.makePathObserver=at,t.makeExpressionObserver=at,t.makeWithObserver=st,t.makeAsArrayObserver=rt(Function.identity),t.makeUniq=it,t.cancelEach=ot,t.autoCancelPrevious=lt,t.once=ct}}),montageDefine("1bc5415","stringify",{dependencies:["./parse","./language"],factory:function(e,t,n){"use strict";function a(e,t){return a.semantics.stringify(e,t)}function s(e){return function(t,n,a){var s=e+"{"+a(t.args[1],n)+"}";return"value"===t.args[0].type?s:a(t.args[0],n)+"."+s}}e("./parse");var r=e("./language").precedence,i=e("./language").operatorTypes;e("./language").operatorTokens,n.exports=a,a.semantics={makeBlockStringifier:s,stringify:function(e,t,n){var a,s=this.stringify.bind(this),i=this.stringifiers;if(i[e.type])a=i[e.type](e,t,s);else if(e.inline)a="&"+e.type+"("+e.args.map(function(e){return s(e,t)}).join(", ")+")";else{var o;1===e.args.length&&"mapBlock"===e.args[0].type?(o=e.type+"{"+s(e.args[0].args[1],t)+"}",e=e.args[0]):o=e.type+"("+e.args.slice(1).map(function(e){return s(e,t)}).join(", ")+")",a="value"===e.args[0].type?o:s(e.args[0],t)+"."+o}return!n||n.type===e.type&&"if"!==n.type||r.get(n.type).has(e.type)?a:"("+a+")"},stringifiers:{value:function(){return""},literal:function(e){return"string"==typeof e.value?"'"+e.value.replace("'","\\'")+"'":""+e.value},parameters:function(){return"$"},record:function(e,t,n){return"{"+Object.map(e.args,function(e,a){var s;return s="value"===e.type?"()":n(e,t),a+": "+s}).join(", ")+"}"},tuple:function(e,t,n){return"["+Object.map(e.args,function(e){return"value"===e.type?"()":n(e)}).join(", ")+"]"},component:function(e,t){var n;return t&&t.components&&e.component?t.components.getObjectLabel?n=t.components.getObjectLabel(e.component):t.components.getLabelForObject&&(n=t.components.getLabelForObject(e.component)):n=e.label,"@"+n},element:function(e){return"#"+e.id},mapBlock:s("map"),filterBlock:s("filter"),someBlock:s("some"),everyBlock:s("every"),sortedBlock:s("sorted"),groupBlock:s("group"),groupMapBlock:s("groupMap"),minBlock:s("min"),maxBlock:s("max"),property:function(e,t,n){return"value"===e.args[0].type?"string"==typeof e.args[1].value?e.args[1].value:"literal"===e.args[1].type?"."+e.args[1].value:"()["+n(e.args[1],t)+"]":"parameters"===e.args[0].type?"$"+e.args[1].value:"literal"===e.args[1].type&&/^[\w\d_]+$/.test(e.args[1].value)?n(e.args[0],t,{type:"scope"})+"."+e.args[1].value:n(e.args[0],{type:"scope"},t)+"["+n(e.args[1],t)+"]"},"with":function(e,t,n){var a=n(e.args[1],t,e);return n(e.args[0],t)+"."+a},get:function(e,t,n){var a;return a="value"===e.args[0].type?"()":n(e.args[0],t),a+"["+n(e.args[1],t)+"]"},not:function(e,t,n){return"equals"===e.args[0].type?n(e.args[0].args[0],t,{type:"equals"})+" != "+n(e.args[0].args[1],t,{type:"equals"}):"!"+n(e.args[0],t,e)},neg:function(e,t,n){return"-"+n(e.args[0],t,e)},number:function(e,t,n){return"+"+n(e.args[0],t,e)},parent:function(e,t,n){return"^"+n(e.args[0],t,e)},"if":function(e,t,n){return n(e.args[0],t,e)+" ? "+n(e.args[1],t)+" : "+n(e.args[2],t)},event:function(e,t,n){return e.when+" "+e.event+" -> "+n(e.listener,t)},bind:function(e,t,n){return n(e.args[0],t)+" <- "+n(e.args[1],t)},bind2:function(e,t,n){return n(e.args[0],t)+" <-> "+n(e.args[1],t)},assign:function(e,t,n){return n(e.args[0],t)+": "+n(e.args[1],t)},block:function(e,t,n){var a="@"+e.label;return e.connection&&("prototype"===e.connection?a+=" < ":"object"===e.connection&&(a+=" : "),a+=n({type:"literal",value:e.module}),e.exports&&"value"!==e.exports.type&&(a+=" "+n(e.exports,t))),a+" {\n"+e.statements.map(function(e){return"    "+n(e,t)+";\n"}).join("")+"}\n"},sheet:function(e,t,n){return"\n"+e.blocks.map(function(e){return n(e,t)}).join("\n")+"\n"}}},i.forEach(function(e,t){a.semantics.stringifiers[t]=function(t,n,a){return t.args.map(function(e){return a(e,n,t)}).join(" "+e+" ").trim()}})}}),montageDefine("1bc5415","expand",{dependencies:["collections/set","collections/map","./operators"],factory:function(e,t,n){function a(e,t){var n=a.semantics.expand.bind(a.semantics);return n(e,t,n)}var s=e("collections/set"),r=e("collections/map"),i=e("./operators");n.exports=a,a.semantics={reflexive:s(["literal","element","rangeContent","mapContent"]),traverseLeft:s(["with","mapBlock","filterBlock","someBlock","everyBlock","sortedBlock","groupBlock","groupMapBlock"]),traverseAll:s(["if","tuple","property","get","has","map","filter","some","every","sorted","one","only","enumerate","flatten","reversed","view","order","sum","average","min","max","keys","values","items","evaluate","parent"]).addEach(Object.keys(i)),expanders:r({value:function(e,t){return t.value||{type:"value"}},parameters:function(e,t){return t.parameters||{type:"parameters"}},record:function(e,t,n){var a={type:"record",args:[]};for(var s in e.args)a.args[s]=n(e.args[s],t,n);return a},component:function(e,t){return t.components&&e.component?{type:"component",label:t.components.getObjectLabel(e.component)}:e}}),expand:function(e,t,n){return this.expanders.has(e.type)?this.expanders.get(e.type)(e,t,n):this.traverseLeft.has(e.type)?{type:e.type,args:[n(e.args[0],t,n)].concat(e.args.slice(1))}:this.reflexive.has(e.type)?e:{type:e.type,args:e.args.map(function(e){return n(e,t,n)})}}}}}),montageDefine("1bc5415","bindings",{dependencies:["collections/map","./bind","./compute","./observe"],factory:function(e,t){function n(e,t,n){if(t)for(var s in t)a(e,s,t[s],n);return e}function a(e,n,a,r){r=r||Object.empty;var i=s(e);if(h.call(i,n))throw Error("Can't bind to already bound target, "+JSON.stringify(n));return"<-"in a||"<->"in a||"compute"in a?(a.target=e,a.parameters=a.parameters||r.parameters,a.document=a.document||r.document,a.components=a.components||r.components,a.cancel="compute"in a?p(e,n,a):c(e,n,a),i[n]=a,t.count++):("get"in a||"set"in a||"writable"in a||(a.writable=!0),"configurable"in a||(a.configurable=!0),"enumerable"in a||(a.enumerable=!0),Object.defineProperty(e,n,a)),e}function s(e){return u.has(e)||u.set(e,{}),u.get(e)}function r(e,t){var n=s(e);return n[t]}function i(e){var t=s(e);for(var n in t)o(e,n)}function o(e,n){var a=s(e);if(!a[n])throw Error("Can't cancel non-existent binding to "+JSON.stringify(n));var r=a[n];if(r&&r.cancel){r.cancel(),delete a[n],t.count--;for(var n in a)return;u["delete"](e)}}var l=e("collections/map"),c=e("./bind"),p=e("./compute");e("./observe");var u=new l,h=Object.prototype.hasOwnProperty;t.count=0,t.bindings=u,t.defineBindings=n,t.defineBinding=a,t.getBindings=s,t.getBinding=r,t.cancelBindings=i,t.cancelBinding=o}}),montageDefine("1bc5415","grammar",{dependencies:[],factory:function(e,t,n){n.exports=function(){function e(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function t(e,t,n,a,s){function r(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var a,s;switch(e.length){case 0:a="end of input";break;case 1:a=e[0];break;default:a=e.slice(0,-1).join(", ")+" or "+e[e.length-1]}return s=t?'"'+n(t)+'"':"end of input","Expected "+a+" but "+s+" found."}this.expected=e,this.found=t,this.offset=n,this.line=a,this.column=s,this.name="SyntaxError",this.message=r(e,t)}function n(e){function n(t){function n(t,n,a){var s,r;for(s=n;a>s;s++)r=e.charAt(s),"\n"===r?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===r||"\u2028"===r||"\u2029"===r?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return Bs!==t&&(Bs>t&&(Bs=0,Ds={line:1,column:1,seenCR:!1}),n(Ds,Bs,t),Bs=t),Ds}function a(e){Ps>js||(js>Ps&&(Ps=js,As=[]),As.push(e))}function s(e){var t=0;for(e.sort();e.length>t;)e[t-1]===e[t]?e.splice(t,1):t++}function r(){var e,t,n,a;if(e=js,t=V(),null!==t){for(n=[],a=i();null!==a;)n.push(a),a=i();null!==n?(a=V(),null!==a?(Os=e,t=J(n),null===t?(js=e,e=t):e=t):(js=e,e=Z)):(js=e,e=Z)}else js=e,e=Z;return e}function i(){var t,n,s,r,i,c,p,u,h,d;return t=js,64===e.charCodeAt(js)?(n=$,js++):(n=null,0===Is&&a(Q)),null!==n?(s=z(),null!==s?(r=V(),null!==r?(i=o(),null===i&&(i=et),null!==i?(123===e.charCodeAt(js)?(c=tt,js++):(c=null,0===Is&&a(nt)),null!==c?(p=V(),null!==p?(u=l(),null!==u?(125===e.charCodeAt(js)?(h=at,js++):(h=null,0===Is&&a(st)),null!==h?(d=V(),null!==d?(Os=t,n=rt(s,i,u),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z),t}function o(){var t,n,s,r,i,o,l,c;return t=js,60===e.charCodeAt(js)?(n=it,js++):(n=null,0===Is&&a(ot)),null===n&&(58===e.charCodeAt(js)?(n=lt,js++):(n=null,0===Is&&a(ct))),null!==n?(s=V(),null!==s?(r=S(),null===r&&(r=et),null!==r?(i=V(),null!==i?(o=js,l=js,Is++,123===e.charCodeAt(js)?(c=tt,js++):(c=null,0===Is&&a(nt)),Is--,null===c?l=et:(js=l,l=Z),null!==l?(c=p(),null!==c?(l=[l,c],o=l):(js=o,o=Z)):(js=o,o=Z),null===o&&(o=et),null!==o?(l=V(),null!==l?(Os=t,n=pt(n,r,o),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=js,n=V(),null!==n&&(Os=t,n=ut()),null===n?(js=t,t=n):t=n),t}function l(){var t,n,s,r,i,o,l,p,u;if(t=js,n=c(),null!==n)if(s=V(),null!==s){for(r=[],i=js,59===e.charCodeAt(js)?(o=ht,js++):(o=null,0===Is&&a(dt)),null!==o?(l=V(),null!==l?(p=c(),null!==p?(u=V(),null!==u?(o=[o,l,p,u],i=o):(js=i,i=Z)):(js=i,i=Z)):(js=i,i=Z)):(js=i,i=Z);null!==i;)r.push(i),i=js,59===e.charCodeAt(js)?(o=ht,js++):(o=null,0===Is&&a(dt)),null!==o?(l=V(),null!==l?(p=c(),null!==p?(u=V(),null!==u?(o=[o,l,p,u],i=o):(js=i,i=Z)):(js=i,i=Z)):(js=i,i=Z)):(js=i,i=Z);null!==r?(59===e.charCodeAt(js)?(i=ht,js++):(i=null,0===Is&&a(dt)),null===i&&(i=et),null!==i?(o=V(),null!==o?(Os=t,n=mt(n,r),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)}else js=t,t=Z;else js=t,t=Z;return null===t&&(t=js,n=c(),null!==n?(s=V(),null!==s?(59===e.charCodeAt(js)?(r=ht,js++):(r=null,0===Is&&a(dt)),null===r&&(r=et),null!==r?(i=V(),null!==i?(Os=t,n=gt(n),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=js,n=V(),null!==n&&(Os=t,n=ft()),null===n?(js=t,t=n):t=n)),t}function c(){var t,n,s,r,i,o,l,c,u,h;return t=js,e.substr(js,2)===vt?(n=vt,js+=2):(n=null,0===Is&&a(bt)),null===n&&(e.substr(js,6)===yt?(n=yt,js+=6):(n=null,0===Is&&a(wt))),null!==n?(32===e.charCodeAt(js)?(s=_t,js++):(s=null,0===Is&&a(Lt)),null!==s?(r=V(),null!==r?(i=z(),null!==i?(o=V(),null!==o?(e.substr(js,2)===xt?(l=xt,js+=2):(l=null,0===Is&&a(Ct)),null!==l?(c=V(),null!==c?(u=p(),null!==u?(h=V(),null!==h?(Os=t,n=Mt(n,i,u),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=js,n=p(),null!==n?(s=V(),null!==s?(58===e.charCodeAt(js)?(r=lt,js++):(r=null,0===Is&&a(ct)),null===r&&(e.substr(js,3)===zt?(r=zt,js+=3):(r=null,0===Is&&a(St)),null===r&&(e.substr(js,2)===Et?(r=Et,js+=2):(r=null,0===Is&&a(kt)))),null!==r?(i=V(),null!==i?(o=p(),null!==o?(l=V(),null!==l?(Os=t,n=Tt(n,r,o),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)),t}function p(){var e,t;return Is++,e=d(),Is--,null===e&&(t=null,0===Is&&a(jt)),e}function u(){var t,n,s,r,i,o,l;if(t=js,n=p(),null!==n){for(s=[],r=js,44===e.charCodeAt(js)?(i=Ot,js++):(i=null,0===Is&&a(Bt)),null!==i?(o=V(),null!==o?(l=p(),null!==l?(i=[i,o,l],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==r;)s.push(r),r=js,44===e.charCodeAt(js)?(i=Ot,js++):(i=null,0===Is&&a(Bt)),null!==i?(o=V(),null!==o?(l=p(),null!==l?(i=[i,o,l],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==s?(Os=t,n=mt(n,s),null===n?(js=t,t=n):t=n):(js=t,t=Z)}else js=t,t=Z;return t}function h(){var t,n,s,r;return t=js,40===e.charCodeAt(js)?(n=Dt,js++):(n=null,0===Is&&a(Pt)),null!==n?(s=V(),null!==s?(41===e.charCodeAt(js)?(r=At,js++):(r=null,0===Is&&a(It)),null!==r?(Os=t,n=ft(),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=js,40===e.charCodeAt(js)?(n=Dt,js++):(n=null,0===Is&&a(Pt)),null!==n?(s=u(),null!==s?(41===e.charCodeAt(js)?(r=At,js++):(r=null,0===Is&&a(It)),null!==r?(Os=t,n=Rt(s),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)),t}function d(){var t,n,s,r,i,o,l,c,u,h,d;return t=js,n=m(),null!==n?(s=V(),null!==s?(r=js,63===e.charCodeAt(js)?(i=Nt,js++):(i=null,0===Is&&a(qt)),null!==i?(o=V(),null!==o?(l=p(),null!==l?(c=V(),null!==c?(58===e.charCodeAt(js)?(u=lt,js++):(u=null,0===Is&&a(ct)),null!==u?(h=V(),null!==h?(d=p(),null!==d?(i=[i,o,l,c,u,h,d],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z),null===r&&(r=et),null!==r?(Os=t,n=Ft(n,r),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z),t}function m(){var t,n,s,r,i,o,l,c;if(t=js,n=g(),null!==n){for(s=[],r=js,i=V(),null!==i?(e.substr(js,2)===Wt?(o=Wt,js+=2):(o=null,0===Is&&a(Ut)),null!==o?(l=V(),null!==l?(c=g(),null!==c?(i=[i,o,l,c],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==r;)s.push(r),r=js,i=V(),null!==i?(e.substr(js,2)===Wt?(o=Wt,js+=2):(o=null,0===Is&&a(Ut)),null!==o?(l=V(),null!==l?(c=g(),null!==c?(i=[i,o,l,c],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==s?(Os=t,n=Ht(n,s),null===n?(js=t,t=n):t=n):(js=t,t=Z)}else js=t,t=Z;return t}function g(){var t,n,s,r,i,o,l,c;if(t=js,n=f(),null!==n){for(s=[],r=js,i=V(),null!==i?(e.substr(js,2)===Vt?(o=Vt,js+=2):(o=null,0===Is&&a(Yt)),null!==o?(l=V(),null!==l?(c=f(),null!==c?(i=[i,o,l,c],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==r;)s.push(r),r=js,i=V(),null!==i?(e.substr(js,2)===Vt?(o=Vt,js+=2):(o=null,0===Is&&a(Yt)),null!==o?(l=V(),null!==l?(c=f(),null!==c?(i=[i,o,l,c],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==s?(Os=t,n=Ht(n,s),null===n?(js=t,t=n):t=n):(js=t,t=Z)}else js=t,t=Z;return t}function f(){var t,n,s,r,i,o,l,c,p;return t=js,n=v(),null!==n?(s=js,r=V(),null!==r?(i=js,e.substr(js,3)===Gt?(o=Gt,js+=3):(o=null,0===Is&&a(Kt)),null===o&&(e.substr(js,2)===Xt?(o=Xt,js+=2):(o=null,0===Is&&a(Zt)),null===o&&(e.substr(js,2)===Jt?(o=Jt,js+=2):(o=null,0===Is&&a($t)),null===o&&(o=js,60===e.charCodeAt(js)?(l=it,js++):(l=null,0===Is&&a(ot)),null!==l?(c=js,Is++,45===e.charCodeAt(js)?(p=Qt,js++):(p=null,0===Is&&a(en)),Is--,null===p?c=et:(js=c,c=Z),null!==c?(l=[l,c],o=l):(js=o,o=Z)):(js=o,o=Z),null===o&&(62===e.charCodeAt(js)?(o=tn,js++):(o=null,0===Is&&a(nn)),null===o&&(e.substr(js,2)===an?(o=an,js+=2):(o=null,0===Is&&a(sn)),null===o&&(e.substr(js,2)===rn?(o=rn,js+=2):(o=null,0===Is&&a(on)))))))),null!==o&&(o=e.substring(i,js)),i=o,null!==i?(o=V(),null!==o?(l=v(),null!==l?(r=[r,i,o,l],s=r):(js=s,s=Z)):(js=s,s=Z)):(js=s,s=Z)):(js=s,s=Z),null===s&&(s=et),null!==s?(Os=t,n=ln(n,s),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z),t}function v(){var t,n,s,r,i,o,l,c;if(t=js,n=b(),null!==n){for(s=[],r=js,i=V(),null!==i?(o=js,43===e.charCodeAt(js)?(l=cn,js++):(l=null,0===Is&&a(pn)),null===l&&(45===e.charCodeAt(js)?(l=Qt,js++):(l=null,0===Is&&a(en))),null!==l&&(l=e.substring(o,js)),o=l,null!==o?(l=V(),null!==l?(c=b(),null!==c?(i=[i,o,l,c],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==r;)s.push(r),r=js,i=V(),null!==i?(o=js,43===e.charCodeAt(js)?(l=cn,js++):(l=null,0===Is&&a(pn)),null===l&&(45===e.charCodeAt(js)?(l=Qt,js++):(l=null,0===Is&&a(en))),null!==l&&(l=e.substring(o,js)),o=l,null!==o?(l=V(),null!==l?(c=b(),null!==c?(i=[i,o,l,c],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==s?(Os=t,n=Ht(n,s),null===n?(js=t,t=n):t=n):(js=t,t=Z)}else js=t,t=Z;return t}function b(){var t,n,s,r,i,o,l,c;if(t=js,n=y(),null!==n){for(s=[],r=js,i=V(),null!==i?(o=js,42===e.charCodeAt(js)?(l=un,js++):(l=null,0===Is&&a(hn)),null===l&&(47===e.charCodeAt(js)?(l=dn,js++):(l=null,0===Is&&a(mn)),null===l&&(37===e.charCodeAt(js)?(l=gn,js++):(l=null,0===Is&&a(fn)),null===l&&(e.substr(js,3)===vn?(l=vn,js+=3):(l=null,0===Is&&a(bn))))),null!==l&&(l=e.substring(o,js)),o=l,null!==o?(l=V(),null!==l?(c=y(),null!==c?(i=[i,o,l,c],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==r;)s.push(r),r=js,i=V(),null!==i?(o=js,42===e.charCodeAt(js)?(l=un,js++):(l=null,0===Is&&a(hn)),null===l&&(47===e.charCodeAt(js)?(l=dn,js++):(l=null,0===Is&&a(mn)),null===l&&(37===e.charCodeAt(js)?(l=gn,js++):(l=null,0===Is&&a(fn)),null===l&&(e.substr(js,3)===vn?(l=vn,js+=3):(l=null,0===Is&&a(bn))))),null!==l&&(l=e.substring(o,js)),o=l,null!==o?(l=V(),null!==l?(c=y(),null!==c?(i=[i,o,l,c],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==s?(Os=t,n=Ht(n,s),null===n?(js=t,t=n):t=n):(js=t,t=Z)}else js=t,t=Z;return t}function y(){var t,n,s,r,i,o,l,c;if(t=js,n=w(),null!==n){for(s=[],r=js,i=V(),null!==i?(o=js,e.substr(js,2)===yn?(l=yn,js+=2):(l=null,0===Is&&a(wn)),null===l&&(e.substr(js,2)===_n?(l=_n,js+=2):(l=null,0===Is&&a(Ln)),null===l&&(e.substr(js,2)===xn?(l=xn,js+=2):(l=null,0===Is&&a(Cn)))),null!==l&&(l=e.substring(o,js)),o=l,null!==o?(l=V(),null!==l?(c=w(),null!==c?(i=[i,o,l,c],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==r;)s.push(r),r=js,i=V(),null!==i?(o=js,e.substr(js,2)===yn?(l=yn,js+=2):(l=null,0===Is&&a(wn)),null===l&&(e.substr(js,2)===_n?(l=_n,js+=2):(l=null,0===Is&&a(Ln)),null===l&&(e.substr(js,2)===xn?(l=xn,js+=2):(l=null,0===Is&&a(Cn)))),null!==l&&(l=e.substring(o,js)),o=l,null!==o?(l=V(),null!==l?(c=w(),null!==c?(i=[i,o,l,c],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==s?(Os=t,n=Ht(n,s),null===n?(js=t,t=n):t=n):(js=t,t=Z)}else js=t,t=Z;return t}function w(){var t,n,s,r,i,o,l,c;if(t=js,n=_(),null!==n){for(s=[],r=js,i=V(),null!==i?(e.substr(js,2)===Mn?(o=Mn,js+=2):(o=null,0===Is&&a(zn)),null!==o?(l=V(),null!==l?(c=_(),null!==c?(i=[i,o,l,c],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==r;)s.push(r),r=js,i=V(),null!==i?(e.substr(js,2)===Mn?(o=Mn,js+=2):(o=null,0===Is&&a(zn)),null!==o?(l=V(),null!==l?(c=_(),null!==c?(i=[i,o,l,c],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==s?(Os=t,n=Ht(n,s),null===n?(js=t,t=n):t=n):(js=t,t=Z)}else js=t,t=Z;return t}function _(){var t,n,s;return t=js,n=js,33===e.charCodeAt(js)?(s=Sn,js++):(s=null,0===Is&&a(En)),null===s&&(43===e.charCodeAt(js)?(s=cn,js++):(s=null,0===Is&&a(pn)),null===s&&(45===e.charCodeAt(js)?(s=Qt,js++):(s=null,0===Is&&a(en)),null===s&&(94===e.charCodeAt(js)?(s=kn,js++):(s=null,0===Is&&a(Tn))))),null!==s&&(s=e.substring(n,js)),n=s,null!==n?(s=_(),null!==s?(Os=t,n=jn(n,s),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=L()),t}function L(){var e,t,n,a;if(e=js,t=M(),null!==t){for(n=[],a=x();null!==a;)n.push(a),a=x();null!==n?(Os=e,t=On(t,n),null===t?(js=e,e=t):e=t):(js=e,e=Z)}else js=e,e=Z;return e}function x(){var t,n,s,r;return t=js,46===e.charCodeAt(js)?(n=Bn,js++):(n=null,0===Is&&a(Dn)),null!==n?(s=C(),null!==s?(Os=t,n=Pn(s),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=js,91===e.charCodeAt(js)?(n=An,js++):(n=null,0===Is&&a(In)),null!==n?(s=p(),null!==s?(93===e.charCodeAt(js)?(r=Rn,js++):(r=null,0===Is&&a(Nn)),null!==r?(Os=t,n=qn(s),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)),t}function C(){var t,n,s,r,i;return t=js,n=z(),null!==n?(123===e.charCodeAt(js)?(s=tt,js++):(s=null,0===Is&&a(nt)),null!==s?(r=p(),null!==r?(125===e.charCodeAt(js)?(i=at,js++):(i=null,0===Is&&a(st)),null!==i?(Os=t,n=Fn(n,r),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=js,n=z(),null!==n?(s=h(),null!==s?(Os=t,n=Wn(n,s),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=js,n=F(),null!==n&&(Os=t,n=Un(n)),null===n?(js=t,t=n):t=n,null===t&&(t=js,n=z(),null!==n&&(Os=t,n=Hn(n)),null===n?(js=t,t=n):t=n,null===t&&(t=js,n=O(),null!==n&&(Os=t,n=Vn(n)),null===n?(js=t,t=n):t=n,null===t&&(t=js,n=B(),null!==n&&(Os=t,n=Vn(n)),null===n?(js=t,t=n):t=n,null===t&&(t=js,40===e.charCodeAt(js)?(n=Dt,js++):(n=null,0===Is&&a(Pt)),null!==n?(s=p(),null!==s?(41===e.charCodeAt(js)?(r=At,js++):(r=null,0===Is&&a(It)),null!==r?(Os=t,n=Vn(s),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z))))))),t}function M(){var t,n,s,r;return t=O(),null===t&&(t=B(),null===t&&(t=S(),null===t&&(t=A(),null===t&&(t=js,e.substr(js,4)===Yn?(n=Yn,js+=4):(n=null,0===Is&&a(Gn)),null!==n&&(Os=t,n=Kn()),null===n?(js=t,t=n):t=n,null===t&&(t=js,e.substr(js,4)===Xn?(n=Xn,js+=4):(n=null,0===Is&&a(Zn)),null!==n&&(Os=t,n=Jn()),null===n?(js=t,t=n):t=n,null===t&&(t=js,e.substr(js,5)===$n?(n=$n,js+=5):(n=null,0===Is&&a(Qn)),null!==n&&(Os=t,n=ea()),null===n?(js=t,t=n):t=n,null===t&&(t=js,e.substr(js,4)===ta?(n=ta,js+=4):(n=null,0===Is&&a(na)),null!==n&&(Os=t,n=aa()),null===n?(js=t,t=n):t=n,null===t&&(t=js,64===e.charCodeAt(js)?(n=$,js++):(n=null,0===Is&&a(Q)),null!==n?(s=z(),null!==s?(Os=t,n=sa(s),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=js,36===e.charCodeAt(js)?(n=ra,js++):(n=null,0===Is&&a(ia)),null!==n?(s=z(),null!==s?(Os=t,n=oa(s),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=js,36===e.charCodeAt(js)?(n=ra,js++):(n=null,0===Is&&a(ia)),null!==n&&(Os=t,n=la()),null===n?(js=t,t=n):t=n,null===t&&(t=js,35===e.charCodeAt(js)?(n=ca,js++):(n=null,0===Is&&a(pa)),null!==n?(s=z(),null!==s?(Os=t,n=ua(s),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=js,38===e.charCodeAt(js)?(n=ha,js++):(n=null,0===Is&&a(da)),null!==n?(s=z(),null!==s?(r=h(),null!==r?(Os=t,n=ma(s,r),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=js,40===e.charCodeAt(js)?(n=Dt,js++):(n=null,0===Is&&a(Pt)),null!==n?(s=p(),null!==s?(41===e.charCodeAt(js)?(r=At,js++):(r=null,0===Is&&a(It)),null!==r?(Os=t,n=ga(s),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=js,n=C(),null!==n&&(Os=t,n=fa(n)),null===n?(js=t,t=n):t=n,null===t&&(t=js,n=[],null!==n&&(Os=t,n=va()),null===n?(js=t,t=n):t=n))))))))))))))),t}function z(){var t,n,s;if(Is++,t=js,n=[],ya.test(e.charAt(js))?(s=e.charAt(js),js++):(s=null,0===Is&&a(wa)),null!==s)for(;null!==s;)n.push(s),ya.test(e.charAt(js))?(s=e.charAt(js),js++):(s=null,0===Is&&a(wa));else n=Z;return null!==n&&(Os=t,n=_a(n)),null===n?(js=t,t=n):t=n,Is--,null===t&&(n=null,0===Is&&a(ba)),t}function S(){var t,n,s,r;if(Is++,t=js,39===e.charCodeAt(js)?(n=xa,js++):(n=null,0===Is&&a(Ca)),null!==n){for(s=[],r=E();null!==r;)s.push(r),r=E();null!==s?(39===e.charCodeAt(js)?(r=xa,js++):(r=null,0===Is&&a(Ca)),null!==r?(Os=t,n=Ma(s),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)}else js=t,t=Z;if(null===t)if(t=js,34===e.charCodeAt(js)?(n=za,js++):(n=null,0===Is&&a(Sa)),null!==n){for(s=[],r=k();null!==r;)s.push(r),r=k();null!==s?(34===e.charCodeAt(js)?(r=za,js++):(r=null,0===Is&&a(Sa)),null!==r?(Os=t,n=Ma(s),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)}else js=t,t=Z;return Is--,null===t&&(n=null,0===Is&&a(La)),t}function E(){var t,n;return Ea.test(e.charAt(js))?(t=e.charAt(js),js++):(t=null,0===Is&&a(ka)),null===t&&(t=js,e.substr(js,2)===Ta?(n=Ta,js+=2):(n=null,0===Is&&a(ja)),null!==n&&(Os=t,n=Oa()),null===n?(js=t,t=n):t=n,null===t&&(t=T())),t}function k(){var t,n;return Ba.test(e.charAt(js))?(t=e.charAt(js),js++):(t=null,0===Is&&a(Da)),null===t&&(t=js,e.substr(js,2)===Pa?(n=Pa,js+=2):(n=null,0===Is&&a(Aa)),null!==n&&(Os=t,n=Ia()),null===n?(js=t,t=n):t=n,null===t&&(t=T())),t}function T(){var t,n,s,r,i,o,l,c;return t=js,e.substr(js,2)===Ra?(n=Ra,js+=2):(n=null,0===Is&&a(Na)),null!==n&&(Os=t,n=qa()),null===n?(js=t,t=n):t=n,null===t&&(t=js,e.substr(js,2)===Fa?(n=Fa,js+=2):(n=null,0===Is&&a(Wa)),null!==n&&(Os=t,n=Ua()),null===n?(js=t,t=n):t=n,null===t&&(t=js,e.substr(js,2)===Ha?(n=Ha,js+=2):(n=null,0===Is&&a(Va)),null!==n&&(Os=t,n=Ya()),null===n?(js=t,t=n):t=n,null===t&&(t=js,e.substr(js,2)===Ga?(n=Ga,js+=2):(n=null,0===Is&&a(Ka)),null!==n&&(Os=t,n=Xa()),null===n?(js=t,t=n):t=n,null===t&&(t=js,e.substr(js,2)===Za?(n=Za,js+=2):(n=null,0===Is&&a(Ja)),null!==n&&(Os=t,n=$a()),null===n?(js=t,t=n):t=n,null===t&&(t=js,e.substr(js,2)===Qa?(n=Qa,js+=2):(n=null,0===Is&&a(es)),null!==n&&(Os=t,n=ts()),null===n?(js=t,t=n):t=n,null===t&&(t=js,e.substr(js,2)===ns?(n=ns,js+=2):(n=null,0===Is&&a(as)),null!==n&&(Os=t,n=ss()),null===n?(js=t,t=n):t=n,null===t&&(t=js,e.substr(js,2)===rs?(n=rs,js+=2):(n=null,0===Is&&a(is)),null!==n&&(Os=t,n=os()),null===n?(js=t,t=n):t=n,null===t&&(t=js,e.substr(js,2)===ls?(n=ls,js+=2):(n=null,0===Is&&a(cs)),null!==n?(s=js,r=js,i=j(),null!==i?(o=j(),null!==o?(l=j(),null!==l?(c=j(),null!==c?(i=[i,o,l,c],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z),null!==r&&(r=e.substring(s,js)),s=r,null!==s?(Os=t,n=ps(s),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z))))))))),t}function j(){var t;return us.test(e.charAt(js))?(t=e.charAt(js),js++):(t=null,0===Is&&a(hs)),t}function O(){var t,n,s,r;
return t=js,91===e.charCodeAt(js)?(n=An,js++):(n=null,0===Is&&a(In)),null!==n?(s=V(),null!==s?(93===e.charCodeAt(js)?(r=Rn,js++):(r=null,0===Is&&a(Nn)),null!==r?(Os=t,n=ds(),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=js,91===e.charCodeAt(js)?(n=An,js++):(n=null,0===Is&&a(In)),null!==n?(s=u(),null!==s?(93===e.charCodeAt(js)?(r=Rn,js++):(r=null,0===Is&&a(Nn)),null!==r?(Os=t,n=ms(s),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)),t}function B(){var t,n,s,r,i,o;return t=js,123===e.charCodeAt(js)?(n=tt,js++):(n=null,0===Is&&a(nt)),null!==n?(s=V(),null!==s?(125===e.charCodeAt(js)?(r=at,js++):(r=null,0===Is&&a(st)),null!==r?(i=V(),null!==i?(Os=t,n=gs(),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=js,123===e.charCodeAt(js)?(n=tt,js++):(n=null,0===Is&&a(nt)),null!==n?(s=V(),null!==s?(r=D(),null!==r?(125===e.charCodeAt(js)?(i=at,js++):(i=null,0===Is&&a(st)),null!==i?(o=V(),null!==o?(Os=t,n=fs(r),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)),t}function D(){var t,n,s,r,i,o,l;if(t=js,n=P(),null!==n){for(s=[],r=js,44===e.charCodeAt(js)?(i=Ot,js++):(i=null,0===Is&&a(Bt)),null!==i?(o=V(),null!==o?(l=P(),null!==l?(i=[i,o,l],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==r;)s.push(r),r=js,44===e.charCodeAt(js)?(i=Ot,js++):(i=null,0===Is&&a(Bt)),null!==i?(o=V(),null!==o?(l=P(),null!==l?(i=[i,o,l],r=i):(js=r,r=Z)):(js=r,r=Z)):(js=r,r=Z);null!==s?(Os=t,n=vs(n,s),null===n?(js=t,t=n):t=n):(js=t,t=Z)}else js=t,t=Z;return t}function P(){var t,n,s,r,i;return t=js,n=z(),null!==n?(58===e.charCodeAt(js)?(s=lt,js++):(s=null,0===Is&&a(ct)),null!==s?(r=V(),null!==r?(i=p(),null!==i?(Os=t,n=bs(n,i),null===n?(js=t,t=n):t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z),t}function A(){var t,n,s;return Is++,t=js,n=js,s=I(),null!==s&&(s=e.substring(n,js)),n=s,null!==n&&(Os=t,n=ws(n)),null===n?(js=t,t=n):t=n,Is--,null===t&&(n=null,0===Is&&a(ys)),t}function I(){var e,t,n,a;return e=js,t=R(),null!==t?(n=N(),null!==n?(a=q(),null!==a?(t=[t,n,a],e=t):(js=e,e=Z)):(js=e,e=Z)):(js=e,e=Z),null===e&&(e=js,t=R(),null!==t?(n=N(),null!==n?(t=[t,n],e=t):(js=e,e=Z)):(js=e,e=Z),null===e&&(e=js,t=R(),null!==t?(n=q(),null!==n?(t=[t,n],e=t):(js=e,e=Z)):(js=e,e=Z),null===e&&(e=R()))),e}function R(){var t,n,s,r;return t=js,n=H(),null!==n?(s=F(),null!==s?(n=[n,s],t=n):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=U(),null===t&&(t=js,45===e.charCodeAt(js)?(n=Qt,js++):(n=null,0===Is&&a(en)),null!==n?(s=H(),null!==s?(r=F(),null!==r?(n=[n,s,r],t=n):(js=t,t=Z)):(js=t,t=Z)):(js=t,t=Z),null===t&&(t=js,45===e.charCodeAt(js)?(n=Qt,js++):(n=null,0===Is&&a(en)),null!==n?(s=U(),null!==s?(n=[n,s],t=n):(js=t,t=Z)):(js=t,t=Z)))),t}function N(){var t,n,s;return t=js,46===e.charCodeAt(js)?(n=Bn,js++):(n=null,0===Is&&a(Dn)),null!==n?(s=F(),null!==s?(n=[n,s],t=n):(js=t,t=Z)):(js=t,t=Z),t}function q(){var e,t,n;return e=js,t=W(),null!==t?(n=F(),null!==n?(t=[t,n],e=t):(js=e,e=Z)):(js=e,e=Z),e}function F(){var e,t;if(e=[],t=U(),null!==t)for(;null!==t;)e.push(t),t=U();else e=Z;return e}function W(){var t,n,s;return t=js,_s.test(e.charAt(js))?(n=e.charAt(js),js++):(n=null,0===Is&&a(Ls)),null!==n?(xs.test(e.charAt(js))?(s=e.charAt(js),js++):(s=null,0===Is&&a(Cs)),null===s&&(s=et),null!==s?(n=[n,s],t=n):(js=t,t=Z)):(js=t,t=Z),t}function U(){var t;return Ms.test(e.charAt(js))?(t=e.charAt(js),js++):(t=null,0===Is&&a(zs)),t}function H(){var t;return Ss.test(e.charAt(js))?(t=e.charAt(js),js++):(t=null,0===Is&&a(Es)),t}function V(){var t,n;for(t=[],ks.test(e.charAt(js))?(n=e.charAt(js),js++):(n=null,0===Is&&a(Ts));null!==n;)t.push(n),ks.test(e.charAt(js))?(n=e.charAt(js),js++):(n=null,0===Is&&a(Ts));return t}var Y,G=arguments.length>1?arguments[1]:{},K={expression:p,sheet:r},X=p,Z=null,J=function(e){return{type:"sheet",blocks:e}},$="@",Q='"@"',et="",tt="{",nt='"{"',at="}",st='"}"',rt=function(e,t,n){return{type:"block",connection:t.connection,module:t.module,exports:t.exports,label:e,statements:n}},it="<",ot='"<"',lt=":",ct='":"',pt=function(e,t,n){return{connection:{"<":"prototype",":":"object"}[e],module:t&&t.value,exports:""!==n?n[1]:void 0}},ut=function(){return{}},ht=";",dt='";"',mt=function(e,t){for(var n=[e],a=0;t.length>a;a++)n.push(t[a][2]);return n},gt=function(e){return[e]},ft=function(){return[]},vt="on",bt='"on"',yt="before",wt='"before"',_t=" ",Lt='" "',xt="->",Ct='"->"',Mt=function(e,t,n){return{type:"event",when:e,event:t,listener:n}},zt="<->",St='"<->"',Et="<-",kt='"<-"',Tt=function(e,t,n){return{type:Fs[t],args:[e,n]}},jt="expression",Ot=",",Bt='","',Dt="(",Pt='"("',At=")",It='")"',Rt=function(e){return e},Nt="?",qt='"?"',Ft=function(e,t){if(t){var n=t[2],a=t[6];return{type:"if",args:[e,n,a]}}return e},Wt="||",Ut='"||"',Ht=function(e,t){for(var n=0;t.length>n;n++)e={type:Rs[t[n][1]],args:[e,t[n][3]]};return e},Vt="&&",Yt='"&&"',Gt="<=>",Kt='"<=>"',Xt="<=",Zt='"<="',Jt=">=",$t='">="',Qt="-",en='"-"',tn=">",nn='">"',an="==",sn='"=="',rn="!=",on='"!="',ln=function(e,t){if(t){var n=t[1],a=t[3];return"!="===n?{type:"not",args:[{type:"equals",args:[e,a]}]}:{type:Rs[n],args:[e,a]}}return e},cn="+",pn='"+"',un="*",hn='"*"',dn="/",mn='"/"',gn="%",fn='"%"',vn="rem",bn='"rem"',yn="**",wn='"**"',_n="//",Ln='"//"',xn="%%",Cn='"%%"',Mn="??",zn='"??"',Sn="!",En='"!"',kn="^",Tn='"^"',jn=function(e,t){return{type:Ns[e],args:[t]}},On=function(e,t){for(var n=0;t.length>n;n++)e=t[n](e);return e},Bn=".",Dn='"."',Pn=function(e){return e},An="[",In='"["',Rn="]",Nn='"]"',qn=function(e){return function(t){return{type:"property",args:[t,e]}}},Fn=function(e,t){return qs[e]?function(n){return{type:qs[e],args:[n,t]}}:"value"===t.type?function(t){return{type:e,args:[t]}}:function(n){return{type:e,args:[{type:"mapBlock",args:[n,t]}]}}},Wn=function(e,t){return function(n){return{type:e,args:[n].concat(t)}}},Un=function(e){return function(t){return{type:"property",args:[t,{type:"literal",value:+e.join("")}]}}},Hn=function(e){return function(t){return{type:"property",args:[t,{type:"literal",value:e}]}}},Vn=function(e){return function(t){return{type:"with",args:[t,e]}}},Yn="this",Gn='"this"',Kn=function(){return{type:"value"}},Xn="true",Zn='"true"',Jn=function(){return{type:"literal",value:!0}},$n="false",Qn='"false"',ea=function(){return{type:"literal",value:!1}},ta="null",na='"null"',aa=function(){return{type:"literal",value:null}},sa=function(e){return{type:"component",label:e}},ra="$",ia='"$"',oa=function(e){return{type:"property",args:[{type:"parameters"},{type:"literal",value:e}]}},la=function(){return{type:"parameters"}},ca="#",pa='"#"',ua=function(e){return{type:"element",id:e}},ha="&",da='"&"',ma=function(e,t){return{type:e,args:t,inline:!0}},ga=function(e){return e},fa=function(e){return e({type:"value"})},va=function(){return{type:"value"}},ba="word",ya=/^[a-zA-Z_0-9\-]/,wa="[a-zA-Z_0-9\\-]",_a=function(e){return e.join("")},La="string",xa="'",Ca='"\'"',Ma=function(e){return{type:"literal",value:e.join("")}},za='"',Sa='"\\""',Ea=/^[^'\\\0-\x1F]/,ka="[^'\\\\\\0-\\x1F]",Ta="\\'",ja='"\\\\\'"',Oa=function(){return"'"},Ba=/^[^"\\\0-\x1F]/,Da='[^"\\\\\\0-\\x1F]',Pa='\\"',Aa='"\\\\\\""',Ia=function(){return'"'},Ra="\\\\",Na='"\\\\\\\\"',qa=function(){return"\\"},Fa="\\/",Wa='"\\\\/"',Ua=function(){return"/"},Ha="\\b",Va='"\\\\b"',Ya=function(){return"\b"},Ga="\\f",Ka='"\\\\f"',Xa=function(){return"\f"},Za="\\n",Ja='"\\\\n"',$a=function(){return"\n"},Qa="\\r",es='"\\\\r"',ts=function(){return"\r"},ns="\\t",as='"\\\\t"',ss=function(){return"	"},rs="\\0",is='"\\\\0"',os=function(){return"\0"},ls="\\u",cs='"\\\\u"',ps=function(e){return String.fromCharCode(parseInt(e,16))},us=/^[0-9a-fA-F]/,hs="[0-9a-fA-F]",ds=function(){return{type:"tuple",args:[]}},ms=function(e){return{type:"tuple",args:e}},gs=function(){return{type:"record",args:[]}},fs=function(e){return{type:"record",args:e}},vs=function(e,t){var n={};n[e[0]]=e[1];for(var a=0;t.length>a;a++)n[t[a][2][0]]=t[a][2][1];return n},bs=function(e,t){return[e,t]},ys="number",ws=function(e){return{type:"literal",value:+e}},_s=/^[eE]/,Ls="[eE]",xs=/^[+\-]/,Cs="[+\\-]",Ms=/^[0-9]/,zs="[0-9]",Ss=/^[1-9]/,Es="[1-9]",ks=/^[ \n]/,Ts="[ \\n]",js=0,Os=0,Bs=0,Ds={line:1,column:1,seenCR:!1},Ps=0,As=[],Is=0;if("startRule"in G){if(!(G.startRule in K))throw Error("Can't start parsing from rule \""+G.startRule+'".');X=K[G.startRule]}var Rs={"**":"pow","//":"root","%%":"log","*":"mul","/":"div","%":"mod",rem:"rem","+":"add","-":"sub","<":"lt",">":"gt","<=":"le",">=":"ge","==":"equals","<=>":"compare","??":"default","&&":"and","||":"or","<-":"bind","<->":"bind2",":":"assign"},Ns={"+":"number","-":"neg","!":"not","^":"parent"},qs={map:"mapBlock",filter:"filterBlock",some:"someBlock",every:"everyBlock",sorted:"sortedBlock",group:"groupBlock",groupMap:"groupMapBlock",min:"minBlock",max:"maxBlock"},Fs={":":"assign","<-":"bind","<->":"bind2"};if(Y=X(),null!==Y&&js===e.length)return Y;throw s(As),Os=Math.max(js,Ps),new t(As,e.length>Os?e.charAt(Os):null,Os,n(Os).line,n(Os).column)}return e(t,Error),{SyntaxError:t,parse:n}}()}}),montageDefine("1bc5415","compile-evaluator",{dependencies:["collections/shim-object","collections/map","./operators","./scope","./parse"],factory:function(e,t,n){function a(e){return a.semantics.compile(e)}var s=e("collections/shim-object"),r=e("collections/map"),i=e("./operators"),o=e("./scope");n.exports=a;var l={literal:function(e){return function(){return e.value}},value:function(){return function(e){return e.value}},parameters:function(){return function(e){return e.parameters}},element:function(e){return function(t){return t.document.getElementById(e.id)}},component:function(e){return function(t){return t.components.getObjectByLabel(e.label)}},tuple:function(e){var t=e.args.map(this.compile,this);return function(e){return t.map(function(t){return t(e)})}},record:function(e){var t=e.args,n={};for(var a in t)n[a]=this.compile(t[a]);return function(e){var t={};for(var a in n)t[a]=n[a](e);return t}}},c={mapBlock:function(e,t){return function(n){return e(n).map(function(e){return t(o.nest(n,e))})}},filterBlock:function(e,t){return function(n){return e(n).filter(function(e){return t(o.nest(n,e))})}},someBlock:function(e,t){return function(n){return e(n).some(function(e){return t(o.nest(n,e))})}},everyBlock:function(e,t){return function(n){return e(n).every(function(e){return t(o.nest(n,e))})}},sortedBlock:function(e,t){return function(n){return e(n).sorted(Function.by(function(e){return t(o.nest(n,e))}))}},groupBlock:function(e,t){return function(n){return e(n).group(function(e){return t(o.nest(n,e))})}},groupMapBlock:function(e,t){return function(n){return new r(e(n).group(function(e){return t(o.nest(n,e))}))}},minBlock:function(e,t){return function(n){return e(n).min(Function.by(function(e){return t(o.nest(n,e))}))}},maxBlock:function(e,t){return function(n){return e(n).max(Function.by(function(e){return t(o.nest(n,e))}))}},parent:function(e){return function(t){return e(t.parent)}},"with":function(e,t){return function(n){return t(o.nest(n,e(n)))}},"if":function(e,t,n){return function(a){return e(a)?t(a):n(a)}},not:function(e){return function(t){return!e(t)}},and:function(e,t){return function(n){return e(n)&&t(n)}},or:function(e,t){return function(n){return e(n)||t(n)}},"default":function(e,t){return function(n){var a=e(n);return null==a&&(a=t(n)),a}},defined:function(e){return function(t){var n=e(t);return null!=n}},path:function(t,n){return function(s){var r=t(s),i=n(s),l=e("./parse");try{var c=l(i),p=a(c);return p(o.nest(s,r))}catch(u){}}}},p=s.clone(i,1);s.addEach(p,{property:function(e,t){return e[t]},get:function(e,t){return e.get(t)},mapContent:Function.identity,rangeContent:Function.identity,view:function(e,t,n){return e.slice(t,t+n)}}),a.semantics={compilers:l,argCompilers:c,operators:p,compile:function(e){var t=this.compilers,n=this.argCompilers,a=this.operators;if(t.hasOwnProperty(e.type))return t[e.type].call(this,e);if(n.hasOwnProperty(e.type)){var s=e.args.map(this.compile,this);return n[e.type].apply(null,s)}a.hasOwnProperty(e.type)||(a[e.type]=function(t){var n=Array.prototype.slice.call(arguments,1);if(!t[e.type])throw new TypeError("Can't call "+JSON.stringify(e.type)+" of "+t);return t[e.type].apply(t,n)});var r=a[e.type],s=e.args.map(this.compile,this);return function(e){var t=s.map(function(t){return t(e)});return t.every(i.defined)?r.apply(null,t):void 0}}}}}),montageDefine("1bc5415","compile-assigner",{dependencies:["./compile-evaluator","./algebra","./scope"],factory:function(e,t,n){function a(e){return a.semantics.compile(e)}var s=e("./compile-evaluator"),r=e("./algebra"),i=e("./scope");n.exports=a,a.semantics={compile:function(e){var t=this.compilers;if("equals"===e.type){var n=this.compile(e.args[0]),a=this.compileEvaluator(e.args[1]);return t.equals(n,a)}if("if"===e.type){var s=this.compileEvaluator(e.args[0]),i=this.compile(e.args[1]),o=this.compile(e.args[2]);return t["if"](s,i,o)}if("everyBlock"===e.type){var l=this.compileEvaluator(e.args[0]),c=r(e.args[1],{type:"literal",value:!0}),p=this.compile(c[0]),u=this.compileEvaluator(c[1]);return t.everyBlock(l,p,u)}if(t.hasOwnProperty(e.type)){var h=e.args.map(this.compileEvaluator,this.compileEvaluator.semantics);return t[e.type].apply(null,h)}throw Error("Can't compile assigner for "+JSON.stringify(e.type))},compileEvaluator:s,compilers:{property:function(e,t){return function(n,a){var s=e(a);if(s){var r=t(a);null!=r&&(Array.isArray(s)?s.set(r,n):s[r]=n)}}},get:function(e,t){return function(n,a){var s=e(a);if(s){var r=t(a);null!=r&&s.set(r,n)}}},has:function(e,t){return function(n,a){var s=e(a);if(s){var r=t(a);null!=n&&(n?(s.has||s.contains).call(s,r)||s.add(r):(s.has||s.contains).call(s,r)&&(s.remove||s["delete"]).call(s,r))}}},equals:function(e,t){return function(n,a){return n?e(t(a),a):void 0}},"if":function(e,t,n){return function(a,s){var r=e(s);return null!=r?r?t(a,s):n(a,s):void 0}},rangeContent:function(e){return function(t,n){var a=e(n);a&&(t?a.swap(0,a.length,t):a.clear())}},mapContent:function(e){return function(t,n){var a=e(n);a&&(a.clear(),n.value&&a.addEach(t))}},reversed:function(e){return function(t,n){var a=e(n);a&&a.swap(0,a.length,t.reversed())}},everyBlock:function(e,t,n){return function(a,s){if(a){var r=e(s),o=n(s);r.forEach(function(e){t(o,i.nest(s,e))})}}}}}}}),montageDefine("1bc5415","algebra",{dependencies:[],factory:function(e,t,n){function a(e,t){return a.semantics.solve(e,t)}n.exports=a,a.semantics={solve:function(e,t){for(;;){for(;this.simplifiers.hasOwnProperty(e.type);){var n=this.simplifiers[e.type](e);if(!n)break;e=n}if(!this.solvers.hasOwnProperty(e.type))break;t=this.solvers[e.type](e,t),e=e.args[0]}return[e,t]},simplifiers:{not:function(e){var t=e.args[0];return"not"===t.type?t.args[0]:void 0},add:function(e){var t=e.args[0];return"literal"===t.type&&""===t.value?{type:"string",args:[e.args[1]]}:void 0},someBlock:function(e){return{type:"not",args:[{type:"everyBlock",args:[e.args[0],{type:"not",args:[e.args[1]]}]}]}}},solvers:{reflect:function(e,t){return{type:e.type,args:[t]}},invert:function(e,t,n){return{type:n,args:[t,e.args[1]]}},number:function(e,t){return this.reflect(e,t)},string:function(e,t){return this.reflect(e,t)},not:function(e,t){return this.reflect(e,t)},neg:function(e,t){return this.reflect(e,t)},add:function(e,t){return this.invert(e,t,"sub")},sub:function(e,t){return this.invert(e,t,"add")},mul:function(e,t){return this.invert(e,t,"div")},div:function(e,t){return this.invert(e,t,"mul")},pow:function(e,t){return this.invert(e,t,"root")},root:function(e,t){return this.invert(e,t,"pow")}}}}}),montageDefine("1bc5415","compile-binder",{dependencies:["./compile-observer","./observers","./binders","./algebra"],factory:function(e,t,n){function a(e){return a.semantics.compile(e)}var s=e("./compile-observer");e("./observers");var r=e("./binders"),i=e("./algebra");n.exports=a,a.semantics={compilers:{property:r.makePropertyBinder,get:r.makeGetBinder,has:r.makeHasBinder,rangeContent:r.makeRangeContentBinder,mapContent:r.makeMapContentBinder,reversed:r.makeReversedBinder},compile:function(e){var t=this.compilers;if("equals"===e.type){var n=this.compile(e.args[0]),a=s(e.args[1]);return r.makeEqualityBinder(n,a)}if("if"===e.type){var o=s(e.args[0]),l=this.compile(e.args[1]),c=this.compile(e.args[2]);return r.makeConditionalBinder(o,l,c)}if("everyBlock"===e.type){var p=s(e.args[0]),u=i(e.args[1],{type:"literal",value:!0}),h=this.compile(u[0]),d=s(u[1]);return r.makeEveryBlockBinder(p,h,d)}if("rangeContent"===e.type){var m,g=s(e.args[0]);try{m=this.compile(e.args[0])}catch(f){m=Function.noop}return r.makeRangeContentBinder(g,m)}if(t.hasOwnProperty(e.type)){var v=e.args.map(s,s.semantics);return t[e.type].apply(null,v)}throw Error("Can't compile binder for "+JSON.stringify(e.type))}}}}),montageDefine("1bc5415","operators",{dependencies:["collections/shim-object","collections/shim-regexp"],factory:function(e,t){e("collections/shim-object"),e("collections/shim-regexp"),t.number=function(e){return"number"==typeof e?e:"string"==typeof e?parseInt(e,10)||0:0},t.string=function(e){return"string"==typeof e?e:"number"==typeof e?""+e:""},t.not=function(e){return!e},t.neg=function(e){return-e},t.pow=function(e,t){return Math.pow(e,t)},t.root=function(e,t){return Math.pow(e,1/t)},t.log=function(e,t){return Math.log(e)/Math.log(t)},t.mul=function(e,t){return e*t},t.div=function(e,t){return e/t},t.mod=function(e,t){return(e%t+t)%t},t.rem=function(e,t){return e%t},t.add=function(e,t){return e+t},t.sub=function(e,t){return e-t},t.lt=function(e,t){return 0>Object.compare(e,t)},t.gt=function(e,t){return Object.compare(e,t)>0},t.le=function(e,t){return 0>=Object.compare(e,t)},t.ge=function(e,t){return Object.compare(e,t)>=0},t.equals=Object.equals,t.compare=Object.compare,t.and=function(e,t){return e&&t},t.or=function(e,t){return e||t},t.defined=function(e){return null!=e},t.startsWith=function(e,t){var n=RegExp("^"+RegExp.escape(t));return n.test(e)},t.endsWith=function(e,t){var n=RegExp(RegExp.escape(t)+"$");return n.test(e)},t.contains=function(e,t){var n=RegExp(RegExp.escape(t));return n.test(e)},t.join=function(e,t){return e.join(t||"")},t.split=function(e,t){return e.split(t||"")},t.range=function(e){for(var t=[],n=0;e>n;n++)t.push(n);return t}}}),montageDefine("1bc5415","language",{dependencies:["collections/set","collections/dict"],factory:function(e,t){var n=e("collections/set"),a=e("collections/dict"),s=t.precedence=a(),r=t.precedenceLevels=[["tuple","record"],["literal","value","parameters","property","element","component","mapBlock","filterBlock","sortedBlock","groupBlock","groupMapBlock","with"],["not","neg","number","parent"],["scope"],["default"],["pow","root","log"],["mul","div","mod","rem"],["add","sub"],["equals","lt","gt","le","ge","compare"],["and"],["or"],["if"]];r.forEach(function(e){var t=n(s.keys());e.forEach(function(e){s.set(e,t)})});var i=t.operatorTokens=a({"**":"pow","//":"root","%%":"log","*":"mul","/":"div","%":"mod",rem:"rem","+":"add","-":"sub","<":"lt",">":"gt","<=":"le",">=":"ge","==":"equals","<=>":"compare","!=":"notEquals","??":"default","&&":"and","||":"or","?":"then",":":"else"});t.operatorTypes=a(i.map(function(e,t){return[e,t]}))}}),montageDefine("1bc5415","compute",{dependencies:["./parse","./compile-observer","./compile-binder","./observers","./scope"],factory:function(e,t,n){function a(e,t,n){n.target=e,n.targetPath=t;var a=n.source=n.source||e,c=n.args,p=n.compute,u=n.parameters=n.parameters||a,h=n.document,d=n.components,m=n.trace,g=n.sourceScope=new l(a,null,u,h,d),f=n.targetScope=new l(e,null,u,h,d),v=c.map(function(e){return s(e)}).map(function(e){if("rangeContent"===e.type){var t=r(e.args[0]);return o.makeRangeContentObserver(t)}if("mapContent"===e.type){var t=r(e.args[0]);return o.makeMapContentObserver(t)}return r(e)}),b=o.makeRangeContentObserver(o.makeObserversObserver(v)),y=o.makeComputerObserver(b,p,e),w=s(t),_=i(w);return _(y,g,f,n,m?{sourcePath:c.join(", "),targetPath:t}:void 0)}var s=e("./parse"),r=e("./compile-observer"),i=e("./compile-binder"),o=e("./observers"),l=e("./scope");n.exports=a}}),montageDefine("1bc5415","binders",{dependencies:["./scope","./observers"],factory:function(e,t){function n(e,t,n,a,s,r){return n(f(function(n){if(!s.isActive)try{s.isActive=!0,r&&console.log("SET",r.targetPath,"TO",n,"ON",e,"BECAUSE",r.sourcePath,Error("here").stack),Array.isArray(e)&&t>>>0===t?e.set(t,n):e[t]=n}finally{s.isActive=!1}}),a)}function a(e,t){return function(n,a,s,r,i){return t(f(function(t){return null!=t?e(f(function(e){return null!=e?e.bindProperty?e.bindProperty(t,n,a,r,i):w(e,t,n,a,r,i):void 0}),s):void 0}),s)}}function s(e,t,n,a,s,r){return n(f(function(n){if(!s.isActive)try{s.isActive=!0,r&&console.log("SET FOR KEY",t,"TO",n,"ON",e,"BECAUSE",r.sourcePath,Error("here").stack),e.set(t,n)}finally{s.isActive=!1}}),a)}function r(e,t){return function(n,a,s,r,i){return e(f(function(e){return e?t(f(function(t){return null!=t?_(e,t,n,a,r,i):void 0}),s):void 0}),s)}}function i(e,t){return function(n,a,s,r,i){return e(f(function(e){return e?t(f(function(t){return n(f(function(n){if(n)(e.has||e.contains).call(e,t)||(i&&console.log("ADD",t,"TO",i.targetPath,"BECAUSE",i.sourcePath,Error("here").stack),e.add(t));else for(;(e.has||e.contains).call(e,t);)i&&console.log("REMOVE",t,"FROM",i.targetPath,"BECAUSE",i.sourcePath,Error("here").stack),(e.remove||e["delete"]).call(e,t)}),a)}),s):void 0}),s)}}function o(e,t){return function(n,a,s,r,i){return n(f(function(n){return n?(i&&console.log("BIND",i.targetPath,"TO",i.sourcePath,Error("here").stack),e(t,a,a,r,i),function(){i&&console.log("UNBIND",i.targetPath,"FROM",i.sourcePath,Error("here").stack)}):void 0}),s)}}function l(e,t,n){return function(a,s,r,i,o){return a(f(function(a){return a?e(f(function(e){function a(e,a,l){s.swap(l,a.length,e.map(function(e){var a=m.nest(r,e);return t(n,a,a,i,o)}))}if(e){var s=[],l=b(e,a,r);return function(){y(s),l()}}}),r):void 0}),s)}}function c(e,t,n){return function(a,s,r,i,o){return e(f(function(e){return null!=e?e?t(a,s,r,i,o):n(a,s,r,i,o):void 0}),s)}}function p(e,t){return function(n,a,s,r,i){return e(f(function(e){return e?n(f(function(t){function n(t,n,a){d(e)||(i&&console.log("SWAPPING",n,"FOR",t,"AT",a,"ON",i.targetPath,Error("here").stack),e.swap?e.swap(a,n.length,t):e.add&&(e.remove||e["delete"])&&(t.forEach(e.add,e),n.forEach(e.remove||e["delete"],e)))}if(t!==e){if(!t)return e.clear(),void 0;if(!t.addRangeChangeListener)throw Error("Can't bind rangeContent() from object that does not support range content change listeners: "+t);return t.addRangeChangeListener(n),n(Array.from(t),Array.from(e),0),v(function(){t.removeRangeChangeListener(n)})}}),a):t(g.makeLiteralObserver([]),a,s,r,i)}),s)}}function u(e){return function(t,n,a,s,r){return e(f(function(e){return e?t(f(function(t){function n(t,n){if(!s.isActive)try{s.isActive=!0,void 0===t?(r&&r&&console.log("DELETED",r.targetPath,"FOR KEY",n,"ON",e,"BECAUSE",r.sourcePath,Error("here").stack),Array.isArray(e)?e.splice(n,1):e["delete"](n)):(r&&r&&console.log("SET",r.targetPath,"FOR KEY",n,"TO",t,"ON",e,"BECAUSE",r.sourcePath,Error("here").stack),e.set(n,t))}finally{s.isActive=!1}}return t?(e.clear(),t.forEach(n),t.addMapChangeListener(n)):(e.clear(),void 0)}),n):void 0}),a)}}function h(e){return function(t,n,a){return e(f(function(e){return e?t(f(function(t){function n(t,n,a){if(!d(e)){var s=e.length-a-n.length;e.swap(s,n.length,t.reversed())}}return t?(t.addRangeChangeListener(n),n(t,e,0),v(function(){t.removeRangeChangeListener(n)})):(e.clear(),void 0)}),n):void 0}),a)}}function d(e){return e.getRangeChangeDescriptor&&e.getRangeChangeDescriptor().isActive}var m=e("./scope"),g=e("./observers"),f=g.autoCancelPrevious,v=g.once,b=g.observeRangeChange,y=g.cancelEach;t.bindProperty=n;var w=n;t.makePropertyBinder=a,t.bindGet=s;var _=s;t.makeGetBinder=r,t.makeHasBinder=i,t.makeEqualityBinder=o,t.makeEveryBlockBinder=l,t.makeConditionalBinder=c,t.makeRangeContentBinder=p,t.makeMapContentBinder=u,t.makeReversedBinder=h}}),montageDefine("33e5fbc","ui/number-field.reel/number-field",{dependencies:["montage/ui/base/abstract-number-field"],factory:function(e,t){var n=e("montage/ui/base/abstract-number-field").AbstractNumberField;t.NumberField=n.specialize({constructor:{value:function(){this.super()}}})}}),montageDefine("33e5fbc","ui/slider.reel/slider",{dependencies:["montage/ui/base/abstract-slider"],factory:function(e,t){var n=e("montage/ui/base/abstract-slider").AbstractSlider;t.Slider=n.specialize({constructor:{value:function(){this.super()}}})}}),montageDefine("33e5fbc","ui/number-field.reel/number-field.html",{text:'<!doctype html>\n<html>\n<head>\n    <meta charset=utf-8>\n    <link href=number-field.css rel=stylesheet>\n\n    <script type="text/montage-serialization">{"owner":{"properties":{"element":{"#":"numberField"},"_numberFieldTextFieldComponent":{"@":"textField"},"_numberFieldMinusComponent":{"@":"minus"},"_numberFieldPlusComponent":{"@":"plus"}}},"textField":{"prototype":"ui/text-field.reel","properties":{"element":{"#":"textField"}},"bindings":{"value":{"<->":"@owner.value"}}},"plus":{"prototype":"ui/button.reel","properties":{"element":{"#":"buttonPlus"}},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"minus":{"prototype":"ui/button.reel","properties":{"element":{"#":"buttonMinus"}},"listeners":[{"type":"action","listener":{"@":"owner"}}]}}</script>\n\n</head>\n<body>\n\n    <span data-montage-id=numberField class=digit-NumberField>\n        <button data-montage-id=buttonMinus class=digit-NumberField-minus tabindex=-1>-</button>\n        <input data-montage-id=textField class=digit-NumberField-input>\n        <button data-montage-id=buttonPlus class=digit-NumberField-plus tabindex=-1>+</button>\n    </span>\n    \n</body>\n</html>'}),montageDefine("33e5fbc","ui/slider.reel/slider.html",{text:'<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=slider.css>\n    <script type="text/montage-serialization">{"owner":{"properties":{"element":{"#":"slider"},"_sliderThumbTrackElement":{"#":"thumbTrack"},"_sliderThumbElement":{"#":"sliderThumb"}}}}</script>\n</head>\n<body>\n    <div data-montage-id=slider class=digit-Slider>\n        <div data-montage-id=thumbTrack class=digit-Slider-thumbTrack>\n            <div data-montage-id=sliderThumb class=digit-Slider-thumb></div>\n        </div>\n    </div>\n</body>\n</html>'}),montageDefine("33e5fbc","ui/text-field.reel/text-field",{dependencies:["montage/ui/base/abstract-text-field"],factory:function(e,t){var n=e("montage/ui/base/abstract-text-field").AbstractTextField;t.TextField=n.specialize({hasTemplate:{value:!0},constructor:{value:function(){this.super(),this.classList.add("digit-TextField")}}})}}),montageDefine("33e5fbc","ui/button.reel/button",{dependencies:["montage/ui/base/abstract-button"],factory:function(e,t){var n=e("montage/ui/base/abstract-button").AbstractButton;t.Button=n.specialize({hasTemplate:{value:!0},constructor:{value:function(){this.super(),this.classList.add("digit-Button")}}})}}),montageDefine("33e5fbc","ui/text-field.reel/text-field.html",{text:"<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=text-field.css>\n</head>\n<body>\n</body>\n</html>"}),montageDefine("33e5fbc","ui/button.reel/button.html",{text:"<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=button.css>\n</head>\n<body>\n</body>\n</html>"});